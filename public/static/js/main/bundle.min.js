const Hue={};Hue.load_date_1=Date.now(),Hue.debug_socket=!0,Hue.debug_functions=!1,Hue.load_scripts=!0,Hue.config={},Hue.ls_global_settings="global_settings_v1",Hue.ls_room_settings="room_settings_v1",Hue.ls_room_state="room_state_v1",Hue.ls_input_history="input_history_v17",Hue.ls_first_time="first_time_v2",Hue.ls_last_message_board_post_checked="last_message_board_post_checked_v4",Hue.ls_notebook="notebook_v1",Hue.vtypes=["voice1","voice2","voice3","voice4"],Hue.roles=["admin","op"].concat(Hue.vtypes),Hue.topic="",Hue.topic_setter="",Hue.topic_date="",Hue.colorlib=ColorLib(),Hue.played=[],Hue.input_history=[],Hue.input_history_index=0,Hue.userlist=[],Hue.usernames=[],Hue.all_usernames=[],Hue.role="",Hue.can_chat=!1,Hue.can_images=!1,Hue.can_radio=!1,Hue.can_tv=!1,Hue.tab_info={},Hue.create_room_open=!1,Hue.open_room_open=!1,Hue.radio_picker_open=!1,Hue.tv_picker_open=!1,Hue.image_picker_open=!1,Hue.goto_room_open=!1,Hue.import_settings_open=!1,Hue.background_image_input_open=!1,Hue.admin_list_open=!1,Hue.ban_list_open=!1,Hue.image_upload_comment_open=!1,Hue.modal_image_number_open=!1,Hue.change_user_username_open=!1,Hue.change_user_password_open=!1,Hue.change_user_email_open=!1,Hue.media_menu_open=!1,Hue.writing_reply=!1,Hue.modal_open=!1,Hue.started=!1,Hue.started_safe=!1,Hue.afk=!1,Hue.alert_mode=0,Hue.commands_list_sorted={},Hue.commands_list_sorted_2={},Hue.utilz=Utilz(),Hue.change_image_when_focused=!1,Hue.change_tv_when_focused=!1,Hue.change_radio_when_focused=!1,Hue.room_images_mode="enabled",Hue.room_tv_mode="enabled",Hue.room_radio_mode="enabled",Hue.radio_started=!1,Hue.background_image_setter="",Hue.background_image_date="",Hue.files={},Hue.input_changed=!1,Hue.youtube_video_play_on_queue=!1,Hue.message_id=0,Hue.chat_content_container_id=0,Hue.popup_message_id=0,Hue.popup_id=0,Hue.writing_message=!1,Hue.double_tap_key_pressed=0,Hue.double_tap_key_2_pressed=0,Hue.double_tap_key_3_pressed=0,Hue.images_visible=!0,Hue.tv_visible=!0,Hue.radio_visible=!0,Hue.images_changed=[],Hue.tv_changed=[],Hue.radio_changed=[],Hue.modal_image_open=!1,Hue.current_image_data={},Hue.filter_delay=350,Hue.resize_delay=350,Hue.double_tap_delay=250,Hue.wheel_delay=100,Hue.wheel_delay_2=25,Hue.check_scrollers_delay=100,Hue.requesting_roomlist=!1,Hue.emit_queue=[],Hue.app_focused=!0,Hue.message_unames="",Hue.message_type="",Hue.stop_radio_delay=0,Hue.aura_timeouts={},Hue.reaction_types=["like","love","happy","meh","sad","dislike"],Hue.mouse_over_reactions=!1,Hue.reactions_hover_delay=500,Hue.reactions_hover_delay_2=1e3,Hue.user_functions=[1,2,3,4,5,6,7,8],Hue.speeches=[1,2,3,4,5,6,7,8,9,10],Hue.mouse_is_down=!1,Hue.draw_message_just_entered=!1,Hue.draw_image_just_entered=!1,Hue.draw_image_mode="pencil",Hue.draw_image_scale=2.4,Hue.draw_image_num_strokes_save=500,Hue.draw_image_max_levels=200,Hue.draw_image_open=!1,Hue.highlight_same_posts_timeouts={},Hue.highlight_same_posts_delay=800,Hue.radio_get_metadata_ongoing=!1,Hue.radio_get_metadata=!1,Hue.log_messages_processed=!1,Hue.command_aliases={},Hue.commands_queue={},Hue.user_leaving=!1,Hue.admin_activity_filter_string="",Hue.access_log_filter_string="",Hue.keys_pressed={},Hue.hide_infotip_delay=2e3,Hue.active_modal=!1,Hue.activity_list=[],Hue.HOUR=36e5,Hue.DAY=864e5,Hue.YEAR=31536e6,Hue.editing_message=!1,Hue.editing_message_container=!1,Hue.editing_message_area=!1,Hue.synth_timeout_delay=800,Hue.synth_recent_users=[],Hue.synth_open=!1,Hue.synth_voice_speeches=[],Hue.local_storage_to_save={},Hue.local_storage_save_delay=250,Hue.sending_whisper=!1,Hue.small_scroll_amount=250,Hue.fresh_messages_list=[],Hue.max_fresh_messages=100,Hue.fresh_messages_duration=2e3,Hue.autoscrolling=!1,Hue.chat_scrolled=!1,Hue.lockscreen_peek_delay=1e3,Hue.lockscreen_peek_active=!1,Hue.context_menu_open=!1,Hue.image_upload_comment_file=!1,Hue.image_upload_comment_type=!1,Hue.just_tabbed=!1,Hue.update_input_placeholder_delay=1e4,Hue.update_lockscreen_clock_delay=1e4,Hue.screen_locked=!1,Hue.userlist_mode="normal",Hue.usercount=0,Hue.quote_max_length=200,Hue.markdown_regexes={},Hue.show_media_history_type="",Hue.add_to_chat_searches_delay=2e3,Hue.reactions_box_open=!1,Hue.first_media_change=!1,Hue.calc_round_places=10,Hue.media_icons={image:"fa-camera",tv:"fa-tv",radio:"fa-volume-up"},Hue.typing_delay=100,Hue.loaded_image={},Hue.loaded_tv={},Hue.loaded_radio={},Hue.open_profile_username=!1,Hue.open_profile_user=!1,Hue.show_profile_audio_clip_started=!1,Hue.send_badge_disabled=!1,Hue.info_popups=[],Hue.last_media_sync=Date.now(),Hue.writing_message_board_post=!1,Hue.message_board_posting_enabled=!1,Hue.youtube_loading=!1,Hue.youtube_loaded=!1,Hue.youtube_player_requested=!1,Hue.youtube_player_request=!1,Hue.youtube_video_player_requested=!1,Hue.youtube_video_player_request=!1,Hue.twitch_loading=!1,Hue.twitch_loaded=!1,Hue.twitch_video_player_requested=!1,Hue.twitch_video_player_request=!1,Hue.soundcloud_loading=!1,Hue.soundcloud_loaded=!1,Hue.soundcloud_player_requested=!1,Hue.soundcloud_video_player_requested=!1,Hue.soundcloud_video_player_request=!1,Hue.vimeo_loading=!1,Hue.vimeo_loaded=!1,Hue.vimeo_video_player_requested=!1,Hue.vimeo_video_player_request=!1,Hue.hls_loading=!1,Hue.tone_loading=!1,Hue.math_loading=!1,Hue.wordz_loading=!1,Hue.media_info_image_data=[],Hue.media_info_tv_data=[],Hue.init=function(){Hue.create_debouncers(),Hue.setup_separators(),Hue.setup_markdown_regexes(),Hue.activate_key_detection(),Hue.setup_templates(),Hue.get_global_settings(),Hue.get_room_settings(),Hue.get_room_state(),Hue.start_msg(),Hue.start_settings_widgets("global_settings"),Hue.start_settings_widgets_listeners("global_settings"),Hue.start_settings_widgets("room_settings"),Hue.start_settings_widgets_listeners("room_settings"),Hue.setup_settings_windows(),Hue.setup_radio_widget(),Hue.start_filters(),Hue.start_image_events(),Hue.start_dropzone(),Hue.start_volume_scroll(),Hue.generate_highlight_words_regex(),Hue.generate_ignored_words_regex(),Hue.activate_visibility_listener(),Hue.copypaste_events(),Hue.scroll_events(),Hue.resize_events(),Hue.setup_commands(),Hue.start_chat_mouse_events(),Hue.start_chat_hover_events(),Hue.start_body_events(),Hue.start_played_click_events(),Hue.start_roomlist_click_events(),Hue.start_generic_uname_click_events(),Hue.start_user_context_menu(),Hue.start_played_context_menu(),Hue.start_volume_context_menu(),Hue.start_toggle_radio_context_menu(),Hue.start_room_menu_context_menu(),Hue.start_tv_maxer_context_menu(),Hue.start_chat_maxer_context_menu(),Hue.start_footer_media_label_context_menu(),Hue.start_chat_menu_context_menu(),Hue.start_msg_close_buttons_context_menu(),Hue.start_search_context_menus(),Hue.start_titles(),Hue.setup_show_profile(),Hue.setup_room_menu(),Hue.setup_input(),Hue.setup_input_history(),Hue.setup_modal_image(),Hue.setup_footer(),Hue.setup_reactions_box(),Hue.prepare_media_settings(),Hue.setup_message_area(),Hue.setup_draw_image(),Hue.setup_autocomplete(),Hue.setup_modal_image_number(),Hue.setup_command_aliases(),Hue.setup_fonts(),Hue.setup_before_unload(),Hue.start_chat_reply_events(),Hue.maxers_mouse_events(),Hue.check_screen_lock(),Hue.setup_iframe_video(),Hue.setup_synth(),Hue.show_console_message(),Hue.setup_expand_image(),Hue.setup_local_storage(),Hue.get_ignored_usernames_list(),Hue.get_accept_commands_from_list(),Hue.setup_lockscreen(),Hue.setup_image_upload_comment(),Hue.setup_drag_events(),Hue.setup_open_url(),Hue.setup_user_functions(),Hue.setup_header(),Hue.setup_media_pickers(),Hue.setup_generic_separators(),Hue.setup_media_menu(),Hue.configure_notifications(),Hue.start_media_info_events(),Hue.setup_chat(),Hue.setup_message_board(),Hue.change_media_layout(),Hue.change_chat_visibility(),Hue.setup_notebook(),Hue.debug_functions&&Hue.wrap_functions(),Hue.start_socket(),Hue.load_date_2=Date.now()},Hue.on_join=function(e){if(Hue.load_date_3=Date.now(),console.info("Joined Room"),Hue.init_data=e,Hue.room_locked=e.room_locked,Hue.room_locked)return Hue.start_locked_mode(),!1;Hue.room_name=e.room_name,Hue.set_username(e.username),Hue.set_email(e.email),Hue.set_bio(e.bio),Hue.user_reg_date=e.reg_date,Hue.setup_profile_image(e.profile_image),Hue.userlist=e.userlist,Hue.update_userlist(),Hue.log_enabled=e.log,Hue.log_messages=e.log_messages,Hue.set_media_info(e.media_info),Hue.setup_theme_and_background(e),Hue.apply_background(),Hue.apply_theme(),Hue.setup_active_media(e),Hue.start_permissions(e),Hue.is_public=e.public,Hue.set_role(e.role,!1),Hue.set_topic_info(e),Hue.update_title(),Hue.setup_user_menu(),Hue.clear_chat(),Hue.check_firstime(),Hue.get_input_history(),Hue.show_joined(),Hue.check_media_maxers(),Hue.config_room_menu(),Hue.start_metadata_loop(),Hue.goto_bottom(),Hue.make_main_container_visible(),Hue.setup_activity_bar(),Hue.setup_input_placeholder(),Hue.start_active_media(),Hue.check_latest_highlight(),Hue.setup_userlist_window(),Hue.setup_image_picker(),Hue.init_message_board(e),Hue.at_startup()},Hue.at_startup=function(){Hue.date_joined=Date.now(),Hue.started=!0,Hue.execute_commands("at_startup"),setTimeout(function(){Hue.started_safe=!0},2e3),Hue.process_visibility(),Hue.load_date_4=Date.now(),Hue.compare_load_dates()};Hue.sound_notify=function(e){let i;if("message"===e){if(!Hue.get_setting("beep_on_messages"))return!1;if(Hue.afk&&Hue.get_setting("afk_disable_messages_beep"))return!1;i="pup"}else if("media_change"===e){if(!Hue.get_setting("beep_on_media_change"))return!1;if(Hue.afk&&Hue.get_setting("afk_disable_media_change_beep"))return!1;i="pup"}else if("highlight"===e){if(!Hue.get_setting("beep_on_highlights"))return!1;if(Hue.afk&&Hue.get_setting("afk_disable_highlights_beep"))return!1;i="highlight"}else{if("join"!==e)return!1;if(!Hue.get_setting("beep_on_user_joins"))return!1;if(Hue.afk&&Hue.get_setting("afk_disable_joins_beep"))return!1;i="join"}Hue.play_audio(i)},Hue.play_audio=function(e){$(`#audio_${e}`)[0].play()};
Hue.generate_words_to_autocomplete=function(){let e=[];for(let t of Hue.usernames)e.push(`${t}'s`);let t=[];t.push(...Hue.commands_list,...Hue.usernames,...e,"@everyone",...Object.keys(Hue.command_aliases),...Hue.all_usernames),t=[...new Set(t)];let a=Hue.get_setting("other_words_to_autocomplete");return a&&t.push(...a.split("\n")),t.sort(),t},Hue.get_closest_autocomplete=function(e,t){let a=Hue.tab_info[e.id],u=Hue.generate_words_to_autocomplete(),b=t.toLowerCase(),n=!1;for(let e=0;e<u.length;e++){let b=u[e];if(b.startsWith(t)&&(n=!0,!a.tabbed_list.includes(b)))return a.tabbed_list.push(b),u[e]}for(let e=0;e<u.length;e++){let t=u[e];if(t.toLowerCase().startsWith(b)&&(n=!0,!a.tabbed_list.includes(t)))return a.tabbed_list.push(t),u[e]}return n?(a.tabbed_list=[],Hue.get_closest_autocomplete(e,t)):""},Hue.tabbed=function(e){if(!e.id)return!1;let t=Hue.tab_info[e.id];if(void 0===t&&(Hue.clear_tabbed(e),t=Hue.tab_info[e.id]),""!==t.tabbed_word)return void Hue.replace_tabbed(e,t.tabbed_word);let a=e.selectionStart,u=e.value.replace(/\n/g," "),b=u.substring(0,a).match(/[^ ]*$/)[0],n=u.substring(a).match(/^[^ ]*/)[0],l=b+n;t.tabbed_start=a-b.length,t.tabbed_end=a+n.length,""!==l&&(t.tabbed_word=l,Hue.replace_tabbed(e,l))},Hue.replace_tabbed=function(e,t){let a=Hue.tab_info[e.id],u=Hue.get_closest_autocomplete(e,t);if(u){" "===e.value[a.tabbed_end]?e.value=Hue.utilz.replace_between(e.value,a.tabbed_start,a.tabbed_end,u):e.value=Hue.utilz.replace_between(e.value,a.tabbed_start,a.tabbed_end,`${u} `);let t=a.tabbed_start+u.length;e.setSelectionRange(t+1,t+1),a.tabbed_start=t-u.length,a.tabbed_end=t,Hue.just_tabbed=!0}},Hue.clear_tabbed=function(e){if(!e.id)return!1;Hue.tab_info[e.id]={tabbed_list:[],tabbed_word:"",tabbed_start:0,tabbed_end:0}},Hue.setup_autocomplete=function(){$("body").on("keydown","textarea, input[type='text'], input[type='search']",function(e){if(Hue.just_tabbed=!1,"Tab"===e.key){if($(this).val().length>0)return void Hue.tabbed(this)}Hue.clear_tabbed(this)}),$("body").on("click","textarea, input[type='text'], input[type='search']",function(e){Hue.clear_tabbed(this)})};
Hue.start_body_events=function(){$("body").on("click",".spoiler",function(){$(this).removeClass("spoiler"),$(this).removeAttr("title")}),$("body").on("mouseenter",".dynamic_title",function(){let o=`${$(this).data("otitle")} (${Hue.get_timeago($(this).data("date"))})`;$(this).attr("title",o)}),$("body").on("auxclick",".Msg-window-inner-x",function(o){2===o.which&&Hue.process_msg_close_button(this)}),$("body").mousedown(function(){Hue.mouse_is_down=!0}),$("body").mouseup(function(o){Hue.mouse_is_down=!1}),$("body").mouseleave(function(){Hue.mouse_is_down=!1})};
Hue.process_message=function(e={}){let t=(e=Object.assign({message:"",to_history:!0,clr_input:!0,callback:!1,edit_id:!1},e)).message.split("\n").length;if(e.message=Hue.utilz.clean_multiline_2(e.message),1===t&&Hue.is_command(e.message)&&!e.edit_id){e.message=Hue.utilz.clean_string2(e.message);let t,a=e.message.split(" && "),i=e.message.toLowerCase();if(t=i.startsWith("/js ")||i.startsWith("/js2 ")?i.includes("/endjs"):i.startsWith("/input ")?e.message.includes("/endinput"):!i.startsWith("/whisper ")&&!i.startsWith("/whisper2 ")||e.message.includes("/endwhisper"),a.length>1&&t){e.to_history&&Hue.add_to_input_history(e.message),Hue.clear_input();let t=e.message.split(" "),a=[],i="",s="normal";for(let e=0;e<t.length;e++){let n=t[e],_=n.toLowerCase();if("js"===s)"/endjs"===_?(a.push(i),i="",s="normal"):i+=` ${n}`;else if("input"===s)"/endinput"===_?(a.push(i),i="",s="normal"):i+=` ${n}`;else if("whisper"===s)"/endwhisper"===_?(a.push(i),i="",s="normal"):i+=` ${n}`;else{if(void 0!==Hue.command_aliases[n]){t.splice(e,1,...Hue.command_aliases[n].split(" ")),e-=1;continue}""===i?"&&"!==n&&(i=n,"/js"===_||"/js2"===_?s="js":"/input"===_?s="input":"/whisper"!==_&&"/whisper2"!==_||(s="whisper")):"&&"===n?(a.push(i),i=""):i+=` ${n}`}}i&&a.push(i);let n,_=0;for(;n=Hue.utilz.get_random_string(5)+Date.now(),void 0!==Hue.commands_queue[n];)if((_+=1)>=100)return!!e.callback&&e.callback(!1);return Hue.commands_queue[n]=a,Hue.run_commands_queue(n),!e.callback||e.callback(!0)}let s,n,_=e.message.split(" "),r=_[0].trim();r.endsWith("?")?(s=r.slice(0,-1),n=!0):(s=r,n=!1);let c=Hue.command_aliases[s];if(void 0!==c){let t=`${c} ${_.slice(1).join(" ").trim()}`.trim();if(s.startsWith("/X")&&(e.to_history=!1),e.to_history&&Hue.add_to_input_history(e.message),n){if(!confirm(`Are you sure you want to execute ${s}?`))return!!e.callback&&e.callback(!1);Hue.process_message({message:t,to_history:!1,clr_input:e.clr_input})}else Hue.process_message({message:t,to_history:!1,clr_input:e.clr_input})}else{let t=Hue.execute_command(e.message,{to_history:e.to_history,clr_input:e.clr_input});e.to_history=t.to_history,e.clr_input=t.clr_input}}else if(Hue.can_chat){if(e.message=Hue.utilz.clean_multiline_2(e.message),0===e.message.length)return Hue.clear_input(),!!e.callback&&e.callback(!1);if(t>Hue.config.max_num_newlines)return!!e.callback&&e.callback(!1);e.message.length>Hue.config.max_input_length&&(e.message=e.message.substring(0,Hue.config.max_input_length)),Hue.socket_emit("sendchat",{message:e.message,edit_id:e.edit_id})}else Hue.cant_chat();return e.to_history&&Hue.add_to_input_history(e.message),e.clr_input&&Hue.clear_input(),!e.callback||e.callback(!0)},Hue.update_chat=function(e={}){if(e=Object.assign({id:!1,user_id:!1,username:"",message:"",prof_image:"",date:!1,third_person:!1,brk:!1,public:!0,link_title:!1,link_image:!1,link_url:!1,edited:!1,just_edited:!1},e),Hue.check_ignored_words(e.message,e.username))return!1;if(e.username&&Hue.user_is_ignored(e.username))return!1;e.message.startsWith("//")&&(e.message=e.message.slice(1));let t,a="message chat_message",i="chat_content_container chat_menu_button_main",s="chat_content dynamic_title",n=e.date?e.date:Date.now(),_=Hue.utilz.nice_date(n);t=""===e.prof_image||void 0===e.prof_image?Hue.config.default_profile_image_url:e.prof_image;let r=!1,c=!1,o=!1,u=e.message.startsWith("/me ")||e.message.startsWith("/em ");if(!u&&Hue.get_setting("show_image_previews")){let t=Hue.make_image_preview(e.message);r=t.image_preview,c=t.image_preview_src_original,o=t.image_preview_text}let l=!1,d=!1;if(!u&&!r&&e.link_url&&Hue.get_setting("show_link_previews")){let t=Hue.make_link_preview(e.message,e.link_url,e.link_title,e.link_image);l=t.link_preview,d=t.link_preview_text}let g,m=!1,h="";e.username!==Hue.username&&(r&&o?Hue.check_highlights(o)&&(h+=" highlighted4",m=!0):l&&d?Hue.check_highlights(d)&&(h+=" highlighted4",m=!0):Hue.check_highlights(e.message)&&(s+=" highlighted4",m=!0));let p=_;if(e.id&&(p=`${e.id.slice(-3)} | ${p}`),u||e.third_person){let t;t=u?e.message.substr(4):e.message,e.brk||(e.brk="<i class='icon2c fa fa-user-circle'></i>"),i+=" chat_content_container_third";let _=`\n        <div class='${a+=" thirdperson"}'>\n            <div class='chat_third_container'>\n                <div class='brk chat_third_brk'>${e.brk}</div>\n                <div class='${i}'>\n                    <div class='chat_menu_button_container unselectable'>\n                        <i class='icon5 fa fa-ellipsis-h chat_menu_button action chat_menu_button_menu'></i>\n                    </div>\n\n                    <div class='chat_third_content'>\n                        <span class='chat_uname action'></span><span class='${s}' title='${p}' data-otitle='${p}' data-date='${n}'></span>\n                    </div>\n\n                    <div class='message_edited_label'>(Edited)</div>\n\n                    <div class='message_edit_container'>\n                        <textarea class='message_edit_area'></textarea>\n                        <div class='message_edit_buttons unselectable'>\n                            <div class='message_edit_button action message_edit_cancel'>Cancel</div>\n                            <div class='message_edit_button action message_edit_submit'>Submit</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>`;(g=$(_)).find(".chat_content").eq(0).text(t),g.find(".chat_content_container").eq(0).data("original_message",t)}else{(g=$(`\n        <div class='${a}'>\n            <div class='chat_left_side'>\n                <div class='chat_profile_image_container round_image_container unselectable action4'>\n                    <img class='chat_profile_image profile_image' src='${t}'>\n                </div>\n            </div>\n            <div class='chat_right_side'>\n                <div class='chat_uname_container'>\n                    <div class='chat_uname action'></div>\n                </div>\n                <div class='chat_container'>\n                    <div class='${i}'>\n\n                        <div class='chat_menu_button_container unselectable'>\n                            <i class='icon5 fa fa-ellipsis-h chat_menu_button action chat_menu_button_menu'></i>\n                        </div>\n\n                        <div class='${s}' title='${p}' data-otitle='${p}' data-date='${n}'></div>\n\n                        <div class='message_edited_label'>(Edited)</div>\n\n                        <div class='message_edit_container'>\n                            <textarea class='message_edit_area'></textarea>\n                            <div class='message_edit_buttons unselectable'>\n                                <div class='message_edit_button action message_edit_cancel'>Cancel</div>\n                                <div class='message_edit_button action message_edit_submit'>Submit</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>`)).find(".chat_content_container").eq(0).data("original_message",e.message),g.find(".chat_profile_image_container").eq(0).attr("title",e.username),r?(g.find(".chat_content").eq(0).html(r),g.find(".image_preview_text").eq(0).addClass(h)):l?(g.find(".chat_content").eq(0).html(l),g.find(".link_preview_text").eq(0).addClass(h)):g.find(".chat_content").eq(0).html(Hue.replace_markdown(Hue.utilz.make_html_safe(e.message)))}let H=g.find(".chat_uname").eq(0);H.text(e.username),H.data("prof_image",t),g.find(".chat_profile_image").eq(0).on("error",function(){$(this).attr("src")!==Hue.config.default_profile_image_url&&$(this).attr("src",Hue.config.default_profile_image_url)});let f=!1;(r||l)&&(f=!0);let v=!1;v=r?c:l?e.link_url:Hue.utilz.get_first_url(e.message),g.data("user_id",e.user_id),g.data("public",e.public),g.data("date",n),g.data("highlighted",m),g.data("uname",e.username),g.data("mode","chat"),g.data("has_embed",f),g.find(".chat_profile_image").eq(0).data("username",e.username);let k=g.find(".chat_content_container").eq(0),w=g.find(".chat_content").eq(0),b=g.find(".message_edited_label").eq(0);e.edited&&b.css("display","block"),k.data("id",e.id),k.data("edited",e.edited),k.data("highlighted",m),k.data("date",n),k.data("first_url",v),r||l||w.urlize(),r&&Hue.setup_image_preview(g,c,e.user_id),l&&Hue.setup_link_preview(g,e.link_url,e.user_id),Hue.setup_whispers_click(g,e.username);let y=Hue.add_to_chat({id:e.id,message:g,save:!0,just_edited:e.just_edited}).message_id;return!e.edited&&Hue.get_setting("chat_enabled")&&e.username!==Hue.username&&(m?Hue.on_highlight():Hue.on_activity("message")),e.user_id&&Hue.replace_property_in_userlist_by_user_id(e.user_id,"last_message",e.message),Hue.push_to_all_usernames(e.username),{message_id:y}},Hue.chat_announce=function(e={}){e=Object.assign({id:!1,brk:"",message:"",highlight:!1,title:!1,onclick:!1,onmiddleclick:!1,container_id:!1,date:!1,type:"normal",info1:"",info2:"",username:!1,open_profile:!1,public:!1,link_title:!1,link_image:!1,link_url:!1,preview_image:!1,comment:"",comment_icon:!0,comment_onclick:!1,user_id:!1,replace_markdown:!1,in_log:!0},e);let t=!1;Hue.check_ignored_words(e.message,e.username)&&(t=!0),e.username&&Hue.user_is_ignored(e.username)&&(t=!0);let a="announcement_content",i="brk announcement_brk",s=" ";e.container_id&&(s=` id='${e.container_id}' `);let n=!1;e.highlight&&(a+=" highlighted4",n=!0);let _=e.date?e.date:Date.now(),r=e.title?e.title:Hue.utilz.nice_date(_),c=!1,o=!1,u=!1;if(e.preview_image&&Hue.get_setting("show_image_previews")){let t=Hue.make_image_preview(e.message);c=t.image_preview,o=t.image_preview_src_original,u=t.image_preview_text}let l="";if(e.comment){let t="announcement_comment";e.username&&e.username!==Hue.username&&!n&&Hue.check_highlights(e.comment)&&(t+=" highlighted4",n=!0);let a=Hue.replace_markdown(Hue.utilz.make_html_safe(e.comment));l=e.comment_icon?`<div class='${t}'><div class='announcement_comment_inner flex_row_center'><i class='announcement_comment_icon far fa-comment icon2'></i>${a}</div></div>`:`<div class='${t}'><div class='announcement_comment_inner flex_row_center'>${a}</div></div>`}else l="<div class='announcement_comment'></div>";let d=!1,g=!1;if(!c&&e.link_url&&Hue.get_setting("show_link_previews")){let t=Hue.make_link_preview(e.message,e.link_url,e.link_title,e.link_image);d=t.link_preview,g=t.link_preview_text}!(e.onclick||e.onmiddleclick||e.username&&e.open_profile)||d||c||(a+=" pointer action",i+=" pointer action");let m=!1;c?m=o:d&&(m=e.link_url);let h="";e.username!==Hue.username&&(c&&u?Hue.check_highlights(u)&&(h+=" highlighted4",n=!0):d&&g&&Hue.check_highlights(g)&&(h+=" highlighted4",n=!0));let p,H=`\n    <div${s}class='message announcement'>\n        <div class='${i}'>${e.brk}</div>\n        <div class='announcement_content_container chat_menu_button_main'>\n            <div class='chat_menu_button_container unselectable'>\n                <i class='icon5 fa fa-ellipsis-h chat_menu_button action chat_menu_button_menu'></i>\n            </div>\n            <div class='announcement_content_split dynamic_title'>\n                <div class='${a}'></div>\n                ${l}\n            </div>\n        </div>\n    </div>`,f=$(H),v=f.find(".announcement_content").eq(0),k=f.find(".announcement_comment_inner").eq(0),w=f.find(".announcement_content_split").eq(0),b=f.find(".brk").eq(0);if(w.attr("title",r),w.data("otitle",r),w.data("date",_),c?(v.html(c),v.find(".image_preview_text").eq(0).addClass(h),Hue.setup_image_preview(f,o,"none")):d?(v.html(d),v.find(".link_preview_text").eq(0).addClass(h),Hue.setup_link_preview(f,e.link_url,"none")):e.replace_markdown?v.html(Hue.replace_markdown(Hue.utilz.make_html_safe(e.message))).urlize():v.text(e.message).urlize(),e.comment&&(k.urlize(),e.username&&Hue.setup_whispers_click(k,e.username),e.comment_onclick&&(k.click(e.comment_onclick),k.addClass("special_link"))),!e.onclick||d||c){if(e.username&&e.open_profile){let t=function(){Hue.show_profile(e.username)};v.on("click",t),b.on("click",t)}}else v.on("click",e.onclick),b.on("click",e.onclick);return e.onmiddleclick&&v.on("auxclick",function(t){2===t.which&&e.onmiddleclick()}),f.data("id",e.id),f.data("public",e.public),f.data("date",_),f.data("highlighted",n),f.data("type",e.type),f.data("info1",e.info1),f.data("info2",e.info2),f.data("uname",e.username),f.data("mode","announcement"),f.data("first_url",m),f.data("user_id",e.user_id),f.data("in_log",e.in_log),t||(p=Hue.add_to_chat({message:f}).message_id,n&&Hue.get_setting("chat_enabled")&&Hue.on_highlight()),Hue.push_to_all_usernames(e.username),{message_id:p}},Hue.add_to_chat=function(e={}){if(!(e=Object.assign({id:!1,message:!1,notify:!0,just_edited:!1,fader:!0},e)).message)return!1;let t,a,i=$("#chat_area"),s=$("#chat_area > .message").last(),n=!1,_=e.message.data("mode"),r=e.message.data("uname"),c=e.message.data("date"),o=e.message.data("public"),u=e.message.data("highlighted"),l=e.message.find("pre code");if(l.length>0&&l.each(function(){hljs.highlightBlock(this)}),"chat"===_&&(t=e.message.find(".chat_content_container").eq(0),Hue.chat_content_container_id+=1,t.data("chat_content_container_id",Hue.chat_content_container_id),t.addClass(`chat_content_container_${Hue.chat_content_container_id}`),e.just_edited&&e.id))return $(".chat_content_container").each(function(){if($(this).data("id")===e.id)return $(this).html(t.html()),$(this).data(t.data()),$(this).find(".message_edited_label").css("display","inline-block"),Hue.goto_bottom(!1,!1),!1}),!1;if(e.message.hasClass("chat_message")&&!e.message.hasClass("thirdperson")&&s.hasClass("chat_message")&&!s.hasClass("thirdperson")&&e.message.find(".chat_uname").eq(0).text()===s.find(".chat_uname").eq(0).text()&&s.find(".chat_content").length<Hue.config.max_same_post_messages){e.message.find(".chat_content").last().data("date")-s.find(".chat_content").last().data("date")<Hue.config.max_same_post_diff&&(Hue.started&&Hue.app_focused&&e.fader&&t.addClass("fader"),t.data("date",c),t.data("highlighted",u),s.find(".chat_container").eq(0).append(t),a=s.data("message_id"),s.data("highlighted")||s.data("highlighted",u),n=!0)}if(!n){Hue.started&&Hue.app_focused&&e.fader&&e.message.addClass("fader");let t=$("#chat_area > .message").last().data("date");c&&t&&c-t>Hue.config.old_activity_min&&i.append(Hue.generate_vseparator(Hue.get_old_activity_message(t,c))),i.append(e.message);let s=$("#chat_area > .message").length,n=Hue.get_setting("chat_crop_limit");s>n&&$("#chat_area").find(`.message:lt(${s-n})`).remove(),Hue.message_id+=1,a=Hue.message_id,e.message.data("message_id",a),e.message.addClass(`message_id_${a}`)}return Hue.started&&(Hue.goto_bottom(!1,!1),u&&Hue.room_state.last_highlight_date<c&&(Hue.room_state.last_highlight_date=c,Hue.save_room_state())),Hue.started&&!Hue.app_focused&&(t?Hue.add_fresh_message(t):Hue.add_fresh_message(e.message)),Hue.scroll_timer(),o&&r&&c&&Hue.push_to_activity_bar(r,c),e.notify&&Hue.started&&u&&Hue.get_setting("chat_enabled")&&Hue.electron_signal("highlighted"),{message_id:a}},Hue.get_old_activity_message=function(e,t){let a,i=t-e;if(i<Hue.HOUR){let e=Math.floor(i/60/1e3);a=1===e?`Over ${e} Minute Passed`:`Over ${e} Minutes Passed`}else if(i>=Hue.HOUR&&i<Hue.DAY){let e=Math.floor(i/60/60/1e3);a=1===e?`Over ${e} Hour Passed`:`Over ${e} Hours Passed`}else if(i>=Hue.DAY&&i<Hue.YEAR){let e=Math.floor(i/24/60/60/1e3);a=1===e?`Over ${e} Day Passed`:`Over ${e} Days Passed`}else if(i>=Hue.YEAR){let e=Math.floor(i/365/24/60/60/1e3);a=1===e?`Over ${e} Year Passed`:`Over ${e} Years Passed`}return a},Hue.generate_vseparator=function(e="",t=""){return`\n        <div class='message vseparator_container ${t}'>\n            <div class='vseparator_line'></div>\n            <div class='vseparator_text'>${e}</div>\n            <div class='vseparator_line'></div>\n        </div>\n    `},Hue.start_chat_mouse_events=function(){$(".chat_area").on("click",".chat_uname",function(){Hue.show_profile($(this).closest(".message").data("uname"),$(this).data("prof_image"))}),$(".chat_area").on("click",".chat_profile_image",function(){Hue.show_profile($(this).closest(".message").data("uname"),$(this).attr("src"))}),$(".chat_area").on("click",".message_edit_submit",function(){Hue.send_edit_messsage()}),$(".chat_area").on("click",".message_edit_cancel",function(){Hue.stop_edit_message()}),$(".chat_area").on("auxclick",".chat_uname",function(e){2===e.which&&Hue.process_write_whisper($(this).closest(".message").data("uname"))}),$(".chat_area").on("auxclick",".chat_profile_image",function(e){2===e.which&&Hue.process_write_whisper($(this).closest(".message").data("uname"))})},Hue.start_chat_hover_events=function(){$("#chat_area").on("mouseenter",".chat_uname, .chat_profile_image, .brk",function(){let e=$(this).closest(".message").data("uname");if(!e)return!1;clearTimeout(Hue.highlight_same_posts_timeouts[e]),Hue.highlight_same_posts_timeouts[e]=setTimeout(function(){Hue.highlight_same_posts(e,!0)},Hue.highlight_same_posts_delay)}),$("#chat_area").on("mouseleave",".chat_uname, .chat_profile_image, .brk",function(){let e=$(this).closest(".message").data("uname");if(!e)return!1;clearTimeout(Hue.highlight_same_posts_timeouts[e]),$(this).closest(".message").hasClass("highlighted")&&Hue.highlight_same_posts(e,!1)})},Hue.highlight_same_posts=function(e,t=!0){$("#chat_area > .message").each(function(){$(this).data("uname")===e&&(t?$(this).addClass("highlighted"):$(this).removeClass("highlighted"))})},Hue.make_markdown_char_regex=function(e){let t=`(^|\\s|\\[dummy\\-space\\])(${Hue.utilz.escape_special_characters(e)}+)(?!\\s)(.*[^${Hue.utilz.escape_special_characters(e)}\\s])\\2($|\\s|\\[dummy\\-space\\])`;return new RegExp(t,"gm")},Hue.make_markdown_char_regex_2=function(e){let t=`(^|\\s|\\[dummy\\-space\\])(${Hue.utilz.escape_special_characters(e)}+)([\\s\\S]+[^${Hue.utilz.escape_special_characters(e)}])\\2($|\\s|\\[dummy\\-space\\])`;return new RegExp(t,"gm")},Hue.setup_markdown_regexes=function(){Hue.markdown_regexes["*"]={},Hue.markdown_regexes["*"].regex=Hue.make_markdown_char_regex("*"),Hue.markdown_regexes["*"].replace_function=function(e,t,a,i,s){let n=a.length;return 1===n?`${t}<span class='italic'>[dummy-space]${i}[dummy-space]</span>${s}`:2===n?`${t}<span class='bold'>[dummy-space]${i}[dummy-space]</span>${s}`:3===n?`${t}<span class='italic bold'>[dummy-space]${i}[dummy-space]</span>${s}`:e},Hue.markdown_regexes._={},Hue.markdown_regexes._.regex=Hue.make_markdown_char_regex("_"),Hue.markdown_regexes._.replace_function=function(e,t,a,i,s){let n=a.length;return 1===n?`${t}<span class='italic'>[dummy-space]${i}[dummy-space]</span>${s}`:2===n?`${t}<span class='underlined'>[dummy-space]${i}[dummy-space]</span>${s}`:e},Hue.markdown_regexes["="]={},Hue.markdown_regexes["="].regex=Hue.make_markdown_char_regex("="),Hue.markdown_regexes["="].replace_function=function(e,t,a,i,s){return 1===a.length?`${t}<span class='backgrounded'>[dummy-space]${i}[dummy-space]</span>${s}`:e},Hue.markdown_regexes["|"]={},Hue.markdown_regexes["|"].regex=Hue.make_markdown_char_regex("|"),Hue.markdown_regexes["|"].replace_function=function(e,t,a,i,s){return 2===a.length?`${t}<span class='spoiler' title='Click To Reveal'>[dummy-space]${i}[dummy-space]</span>${s}`:e},Hue.markdown_regexes["`"]={},Hue.markdown_regexes["`"].regex=Hue.make_markdown_char_regex_2("`"),Hue.markdown_regexes["`"].replace_function=function(e,t,a,i,s){return 3===a.length?`${t}<pre><code>[dummy-space]${i}[dummy-space]</code></pre>${s}`:e},Hue.markdown_regexes.whisper_link={},Hue.markdown_regexes.whisper_link.regex=new RegExp("\\[whisper\\s+(.*?)\\](.*?)\\[/whisper\\]","gm"),Hue.markdown_regexes.whisper_link.replace_function=function(e,t,a){return`<span class="whisper_link special_link" data-whisper="${t}" title="[Whisper] ${t}">[dummy-space]${a.replace(/\s+/,"&nbsp;")}[dummy-space]</span>`},Hue.markdown_regexes.anchor_link={},Hue.markdown_regexes.anchor_link.regex=new RegExp("\\[anchor\\s+(.*?)\\](.*?)\\[/anchor\\]","gm"),Hue.markdown_regexes.anchor_link.replace_function=function(e,t,a){return`<a href="${t}" class="stop_propagation anchor_link special_link" target="_blank">[dummy-space]${a.trim().replace(/\s+/,"&nbsp;")}[dummy-space]</a>`},Hue.markdown_regexes.dummy_space={},Hue.markdown_regexes.dummy_space.regex=new RegExp("\\[dummy\\-space\\]","gm"),Hue.markdown_regexes.dummy_space.replace_function=function(){return""}},Hue.replace_markdown=function(e){let t=e.length;return e=(e=(e=(e=(e=(e=e.replace(Hue.markdown_regexes.whisper_link.regex,Hue.markdown_regexes.whisper_link.replace_function)).replace(Hue.markdown_regexes.anchor_link.regex,Hue.markdown_regexes.anchor_link.replace_function)).replace(Hue.markdown_regexes["*"].regex,Hue.markdown_regexes["*"].replace_function)).replace(Hue.markdown_regexes._.regex,Hue.markdown_regexes._.replace_function)).replace(Hue.markdown_regexes["="].regex,Hue.markdown_regexes["="].replace_function)).replace(Hue.markdown_regexes["`"].regex,Hue.markdown_regexes["`"].replace_function),Hue.get_setting("autoreveal_spoilers")||(e=e.replace(Hue.markdown_regexes["|"].regex,Hue.markdown_regexes["|"].replace_function)),e.length!==t?Hue.replace_markdown(e):e=e.replace(Hue.markdown_regexes.dummy_space.regex,Hue.markdown_regexes.dummy_space.replace_function)},Hue.start_chat_reply_events=function(){$("#chat_area").on("mouseup",".chat_content",function(e){1===e.button&&(Hue.start_reply(e.target),e.preventDefault())})},Hue.start_reply=function(e){if($(e).is("a"))return!1;let t=$(e).closest(".chat_message").data("uname"),a=$(e).closest(".chat_content_container").data("original_message");if(!t||!a)return!1;let i=a.replace(/\n+/gm," "),s=i.length>Hue.quote_max_length;a=i.substring(0,Hue.quote_max_length),s&&(a+="...");let n=`${Hue.replace_markdown(Hue.utilz.make_html_safe(`${a}`))}`;Hue.reply_text_raw=`=[dummy-space]${t} said: "[dummy-space]${a}[dummy-space]"[dummy-space]=`,Hue.show_reply(t,n)},Hue.show_reply=function(e,t){$("#reply_text").html(t),$("#reply_input").val(""),Hue.msg_reply.set_title(`Re: ${e}`),Hue.msg_reply.show(function(){$("#reply_input").focus()})},Hue.submit_reply=function(){let e=$("#reply_input").val().trim();Hue.is_command(e)&&(e=`/${e}`),Hue.msg_reply.close(),Hue.goto_bottom(!0,!1),Hue.process_message({message:Hue.reply_text_raw,to_history:!1}),e&&Hue.process_message({message:e})},Hue.toggle_chat_font_size=function(e=!1){let t=Hue.get_setting("chat_font_size"),a="normal";if(e?a=e:"normal"!==t&&"big"!==t&&"very_big"!==t||("normal"===t?a="big":"big"===t?a="very_big":"very_big"===t&&(a="normal")),t===a)return!1;Hue.enable_setting_override("chat_font_size"),Hue.modify_setting(`chat_font_size ${a}`,!1),Hue.show_infotip(`Font Size: ${a}`)},Hue.add_fresh_message=function(e){Hue.fresh_messages_list.push(e),Hue.fresh_messages_list.length>Hue.max_fresh_messages&&Hue.fresh_messages_list.shift()},Hue.show_fresh_messages=function(){if(0===Hue.fresh_messages_list.length)return!1;for(let e of Hue.fresh_messages_list)e.addClass("highlighted3"),setTimeout(function(){e.removeClass("highlighted3")},Hue.fresh_messages_duration);Hue.fresh_messages_list=[]},Hue.focus_edit_area=function(){Hue.editing_message_area!==document.activeElement&&Hue.editing_message_area.focus()},Hue.handle_edit_direction=function(e=!1){let t=Hue.editing_message_area;return!!(e&&t.selectionStart===t.value.length||!e&&0===t.selectionStart)&&(Hue.edit_last_message(e),!0)},Hue.edit_last_message=function(e=!1){let t=!1,a=!0,i=!1;Hue.editing_message&&(a=!1),$($("#chat_area > .message").get().reverse()).each(function(){if(t)return!1;$(this).data("user_id")===Hue.user_id&&$($(this).find(".chat_content_container").get().reverse()).each(function(){if(Hue.editing_message&&this===Hue.editing_message_container)return a=!0,!0;let s=this;return a?(e&&(s=i),s?Hue.edit_message(s):Hue.stop_edit_message(),t=!0,!1):(i=this,!0)})})},Hue.edit_message=function(e){Hue.editing_message&&Hue.stop_edit_message();let t=$(e).find(".message_edit_container").get(0),a=$(e).find(".message_edit_area").get(0),i=$(e).find(".chat_content").get(0),s=$(e).find(".message_edited_label").get(0);if($(e).hasClass("chat_content_container_third")){let t=$(e).find(".chat_uname").get(0);$(t).css("display","none")}$(t).css("display","block"),$(i).css("display","none"),$(e).removeClass("chat_menu_button_main"),$(e).css("display","block"),$(s).css("display","none"),Hue.editing_message=!0,Hue.editing_message_container=e,Hue.editing_message_area=a,$(a).val($(e).data("original_message")).focus(),setTimeout(function(){a.setSelectionRange(a.value.length,a.value.length)},40),a.scrollIntoView({block:"center"}),Hue.check_scrollers()},Hue.stop_edit_message=function(){if(!Hue.editing_message||!Hue.editing_message_container)return!1;let e=$(Hue.editing_message_container).find(".message_edit_container").get(0),t=$(Hue.editing_message_container).find(".chat_content").get(0),a=$(Hue.editing_message_container).find(".message_edited_label").get(0);if($(e).css("display","none"),$(Hue.editing_message_container).data("edited")&&$(a).css("display","block"),$(Hue.editing_message_container).hasClass("chat_content_container_third")){let e=$(Hue.editing_message_container).find(".chat_uname").get(0);$(e).css("display","inline-block")}$(Hue.editing_message_area).val(""),$(t).css("display","inline-block"),$(Hue.editing_message_container).addClass("chat_menu_button_main"),$(Hue.editing_message_container).css("display","flex"),Hue.editing_message=!1,Hue.editing_message_container=!1,Hue.editing_message_area=!1,Hue.goto_bottom(!1,!1)},Hue.send_edit_messsage=function(e){if(!Hue.editing_message_container)return!1;let t=$(Hue.editing_message_container).find(".chat_content").get(0),a=Hue.editing_message_area.value.trim(),i=$(Hue.editing_message_container).data("id"),s=!1;return $(Hue.editing_message_container).hasClass("chat_content_container_third")&&(s=!0),Hue.stop_edit_message(),$(t).text()!==a&&(!!i&&(0===a.length?(Hue.delete_message(i),!1):(s&&(a=`/me ${a}`),void Hue.process_message({message:a,edit_id:i}))))},Hue.delete_message=function(e,t=!1){if(!e)return!1;if(t)Hue.send_delete_message(e);else{if(!Hue.started_safe)return!1;confirm("Are you sure you want to delete this message?")&&Hue.send_delete_message(e)}},Hue.send_delete_message=function(e){Hue.socket_emit("delete_message",{id:e})},Hue.remove_message_from_chat=function(e){"chat"===e.type||"reaction"===e.type?$(".chat_content_container").each(function(){if($(this).data("id")==e.id)return Hue.process_remove_chat_message(this),!1}):"announcement"!==e.type&&"reaction"!==e.type&&"image"!==e.type&&"tv"!==e.type&&"radio"!==e.type||$(".message.announcement").each(function(){if($(this).data("id")==e.id)return Hue.process_remove_announcement(this),!1}),Hue.goto_bottom(!1,!1)},Hue.remove_message_from_context_menu=function(e){let t=$(e).closest(".message"),a=t.data("mode");"chat"===a?Hue.process_remove_chat_message($(e).closest(".chat_content_container")):"announcement"===a&&Hue.process_remove_announcement(t)},Hue.process_remove_chat_message=function(e){let t=$(e).data("chat_content_container_id");$(".chat_content_container").each(function(){if($(this).data("chat_content_container_id")===t){let e=$(this).closest(".message");e.hasClass("thirdperson")?e.remove():1===$(this).closest(".chat_container").find(".chat_content_container").length?e.remove():$(this).remove()}})},Hue.process_remove_announcement=function(e){let t=$(e).data("type"),a=$(e).data("message_id");if("image_change"===t||"tv_change"===t||"radio_change"===t){let a=$(e).data("id");Hue.remove_item_from_media_changed(t.replace("_change",""),a)}$(`.message_id_${a}`).each(function(){$(this).remove()}),Hue.check_media_menu_loaded_media()},Hue.check_typing=function(){let e=$("#input").val();if(e.length<Hue.old_input_val.length)return!1;let t=e.trim();if(Hue.can_chat&&""!==t){if("/"===t[0]&&"/"!==t[1]&&!t.startsWith("/me "))return!1;Hue.typing_timer()}},Hue.show_typing=function(e){if(Hue.user_is_ignored(e.username))return!1;Hue.show_pencil(),Hue.typing_remove_timer(),Hue.show_aura(e.username)},Hue.show_pencil=function(){$("#footer_user_menu").addClass("fa-pencil-alt"),$("#footer_user_menu").removeClass("fa-user-circle")},Hue.hide_pencil=function(){$("#footer_user_menu").removeClass("fa-pencil-alt"),$("#footer_user_menu").addClass("fa-user-circle")},Hue.get_last_chat_message_by_username=function(e){let t=!1;return $($("#chat_area > .message.chat_message").get().reverse()).each(function(){let a=$(this).data("uname");if(a&&a===e)return t=this,!1}),t},Hue.get_last_chat_message_by_user_id=function(e){let t=!1;return $($("#chat_area > .message.chat_message").get().reverse()).each(function(){let a=$(this).data("user_id");if(a&&a===e)return t=this,!1}),t},Hue.show_aura=function(e){if(!Hue.app_focused)return!1;void 0===Hue.aura_timeouts[e]?Hue.add_aura(e):clearTimeout(Hue.aura_timeouts[e]),Hue.aura_timeouts[e]=setTimeout(function(){Hue.remove_aura(e)},Hue.config.max_typing_inactivity)},Hue.add_aura=function(e){let t=Hue.get_last_chat_message_by_username(e);t&&$(t).find(".chat_profile_image_container").eq(0).addClass("aura");let a=Hue.get_activity_bar_item_by_username(e);a&&$(a).find(".activity_bar_image_container").eq(0).addClass("aura")},Hue.remove_aura=function(e){clearTimeout(Hue.aura_timeouts[e]);let t=".chat_profile_image_container.aura";$(t).each(function(){let t=$(this).closest(".chat_message");t.length>0&&t.data("uname")===e&&$(this).removeClass("aura")}),t=".activity_bar_image_container.aura",$(t).each(function(){let t=$(this).closest(".activity_bar_item");t.length>0&&t.data("username")===e&&$(this).removeClass("aura")}),Hue.aura_timeouts[e]=void 0},Hue.jump_to_chat_message=function(e){let t=$(`#chat_area > .message_id_${e}`).eq(0);if(0===t.length)return!1;t[0].scrollIntoView({block:"center"}),t.addClass("highlighted2"),setTimeout(function(){t.removeClass("highlighted2")},2e3),Hue.close_all_modals()},Hue.get_loaded_media_messages=function(){let e={};for(let t of Hue.utilz.media_types){e[t]=!1;let a=Hue[`loaded_${t}`];if(a){let i=a.message_id,s=$(`#chat_area > .message_id_${i}`).eq(0);s.length>0&&(e[t]=s.clone(!0,!0))}else e[t]="Not Loaded Yet"}return e},Hue.on_chat_message=function(e){Hue.update_chat({id:e.id,user_id:e.user_id,username:e.username,message:e.message,prof_image:e.profile_image,date:e.date,link_title:e.link_title,link_image:e.link_image,link_url:e.link_url,edited:e.edited,just_edited:e.just_edited}),Hue.hide_pencil(),Hue.remove_aura(e.username)},Hue.cant_chat=function(){Hue.feedback("You don't have permission to chat")},Hue.activity_above=function(e=!0){let t=!1,a=$("#up_scroller").outerHeight(),i=$("#chat_area").scrollTop();$($("#chat_area > .message").get().reverse()).each(function(){let s=!1,n=$(this).data("uname");if(n&&n===Hue.username&&(s=!0),s||$(this).data("highlighted")){let s=$(this).position();if(s.top<a){let n=i+s.top-a;return Hue.scroll_chat_to(n,e),t=!0,!1}}}),t||Hue.goto_top(e)},Hue.activity_below=function(e=!0){let t=!1,a=$("#up_scroller").outerHeight(),i=$("#down_scroller").outerHeight(),s=$("#chat_area").innerHeight(),n=$("#chat_area").scrollTop();$("#chat_area > .message").each(function(){let _=!1,r=$(this).data("uname");if(r&&r===Hue.username&&(_=!0),_||$(this).data("highlighted")){let _=$(this).position(),r=$(this).outerHeight();if(_.top+r+i>s){let i=n+_.top-a;return Hue.scroll_chat_to(i,e),t=!0,!1}}}),t||Hue.goto_bottom(!0,e)},Hue.clear_chat=function(){$("#chat_area").html(""),Hue.show_log_messages(),Hue.goto_bottom(!0),Hue.focus_input()},Hue.do_chat_size_change=function(e){return"max"===e?e=90:"min"===e&&(e=10),!((e=parseInt(e))<10||e>100)&&(100===e?(Hue.toggle_media(),void Hue.show_infotip("Chat Maximized")):(e!==Hue.get_setting("chat_display_percentage")&&Hue.modify_setting(`chat_display_percentage ${e}`,!1),void Hue.notify_chat_size_change(e)))},Hue.notify_chat_size_change=function(e){let t;t=e===Hue.config.global_settings_default_chat_display_percentage?" (Default)":"",Hue.show_infotip(`Chat Size: ${e}%${t}`)},Hue.scroll_chat_to=function(e,t=!0,a=500){$("#chat_area").stop(),Hue.started&&Hue.app_focused&&t&&Hue.get_setting("animate_scroll")?$("#chat_area").animate({scrollTop:e},a,function(){Hue.check_scrollers()}):$("#chat_area").scrollTop(e)},Hue.scroll_up=function(e){Hue.scroll_chat_to($("#chat_area").scrollTop()-e,!1)},Hue.scroll_down=function(e){let t=$("#chat_area"),a=t.prop("scrollHeight")-t.innerHeight();a-t.scrollTop<e?Hue.scroll_chat_to(a+10):Hue.scroll_chat_to(t.scrollTop()+e,!1)},Hue.generate_highlights_regex=function(e,t=!1,a=!0){let i="gm";return t&&(i+="i"),a&&(e=Hue.utilz.escape_special_characters(e)),new RegExp(`(?:^|\\s|\\"|\\[dummy\\-space\\])(?:\\@)?(?:${e})(?:\\'s)?(?:$|\\s|\\"|\\[dummy\\-space\\]|\\!|\\?|\\,|\\.|\\:)`,i)},Hue.generate_mentions_regex=function(){Hue.get_setting("case_insensitive_username_highlights")?Hue.mentions_regex=Hue.generate_highlights_regex(Hue.username,!0,!0):Hue.mentions_regex=Hue.generate_highlights_regex(Hue.username,!1,!0)},Hue.generate_highlight_words_regex=function(){let e="",t=Hue.get_setting("other_words_to_highlight").split("\n");for(let a=0;a<t.length;a++){let i=t[a];e+=Hue.utilz.escape_special_characters(i),a<t.length-1&&(e+="|")}e.length>0?Hue.get_setting("case_insensitive_words_highlights")?Hue.highlight_words_regex=Hue.generate_highlights_regex(e,!0,!1):Hue.highlight_words_regex=Hue.generate_highlights_regex(e,!1,!1):Hue.highlight_words_regex=!1},Hue.check_highlights=function(e){return!(!Hue.get_setting("highlight_current_username")||-1===e.search(Hue.mentions_regex))||!(!Hue.highlight_words_regex||-1===e.search(Hue.highlight_words_regex))},Hue.generate_ignored_words_regex=function(){let e="",t=Hue.get_setting("ignored_words").split("\n");for(let a=0;a<t.length;a++){let i=t[a];e+=Hue.utilz.escape_special_characters(i),a<t.length-1&&(e+="|")}e.length>0?Hue.get_setting("case_insensitive_ignored_words")?Hue.ignored_words_regex=Hue.generate_highlights_regex(e,!0,!1):Hue.ignored_words_regex=Hue.generate_highlights_regex(e,!1,!1):Hue.ignored_words_regex=!1},Hue.check_ignored_words=function(e="",t=""){return!(!Hue.ignored_words_regex||-1===e.search(Hue.ignored_words_regex))&&(!t||t!==Hue.username||!Hue.get_setting("ignored_words_exclude_same_user"))},Hue.check_latest_highlight=function(){let e=Hue.get_latest_highlight();if(e){let t=$(e).data("date");t>Hue.room_state.last_highlight_date&&(Hue.feedback("Click here to see new highlights",{onclick:function(){Hue.show_highlights()}}),Hue.room_state.last_highlight_date=t,Hue.save_room_state())}},Hue.get_latest_highlight=function(){let e=!1;return $($("#chat_area .chat_content_container").get().reverse()).each(function(){if($(this).data("highlighted"))return e=this,!1}),e&&$($("#chat_area > .message.announcement").get().reverse()).each(function(){if($(this).data("highlighted"))return $(this).data("date")>$(e).data("date")&&(e=this),!1}),e},Hue.on_highlight=function(){if(!Hue.started)return!1;Hue.app_focused&&!Hue.room_state.screen_locked||(Hue.alert_title(2),Hue.check_lockscreen_activity(),Hue.show_highlight_desktop_notification(),Hue.sound_notify("highlight"))},Hue.on_activity=function(e=!1){if(!Hue.started)return!1;Hue.app_focused&&!Hue.room_state.screen_locked||(Hue.alert_title(1),Hue.check_lockscreen_activity(),e&&Hue.sound_notify(e))},Hue.reset_highlights_filter=function(){$("#highlights_filter").val(""),$("#highlights_container").html(""),$("#highlights_no_results").css("display","none")},Hue.show_highlights=function(e=!1){e&&(e=e.trim());let t=e||"";$("#highlights_container").html(""),$("#highlights_filter").val(t),$("#highlights_no_results").css("display","none");let a=$($("#chat_area").children().get().reverse()).clone(!0,!0);if(a.each(function(){$(this).removeAttr("id")}),e){let t=Hue.utilz.clean_string2(e).toLowerCase().split(" ").filter(e=>""!==e.trim());a=a.filter(function(){if(!$(this).data("highlighted"))return!1;if($(this).hasClass("vseparator_container"))return!1;let e=$(this).text().toLowerCase();return t.some(t=>e.includes(t))})}else a=a.filter(function(){return!!$(this).data("highlighted")&&!$(this).hasClass("vseparator_container")});0!==a.children().length||e?a.appendTo("#highlights_container"):$("#highlights_no_results").css("display","block"),Hue.msg_highlights.show(function(){Hue.scroll_modal_to_top("highlights")})},Hue.make_image_preview=function(e){let t={image_preview:!1,image_preview_src:!1,image_preview_src_original:!1,image_preview_text:!1},a=Hue.utilz.get_first_url(e);if(!a)return t;if(a.includes("imgur.com")){let i=Hue.utilz.get_imgur_image_code(a);if(i){let s=Hue.utilz.get_extension(a);t.image_preview_src_original=`https://i.imgur.com/${i}.${s}`,t.image_preview_src=`https://i.imgur.com/${i}l.jpg`,t.image_preview=`<div class='image_preview action'><img draggable="false" class="image_preview_image" src="${t.image_preview_src}"></div>`;let n=`<div class='image_preview_text'>${Hue.replace_markdown(Hue.utilz.make_html_safe(e))}</div>`;t.image_preview_text=e,t.image_preview=n+t.image_preview}}return t},Hue.make_link_preview=function(e,t,a,i){let s={link_preview:!1},n=!1;if(a&&i?n=`<div class='link_preview action'>\n        <div class='link_preview_image_with_title'><img class='link_preview_image' src='${i}'></div>\n            <div class='link_preview_title link_preview_title_with_image'>${Hue.utilz.make_html_safe(a)}</div>\n        </div>`:a?n=`<div class='link_preview action'>\n            <div class='link_preview_title'>${Hue.utilz.make_html_safe(a)}</div>\n        </div>`:i&&(n=`<div class='link_preview action'>\n            <img class='link_preview_image' src='${i}'>\n        </div>`),n){s.link_preview=n;let t=Hue.replace_markdown(Hue.utilz.make_html_safe(e)),a=`<div class='link_preview_text'>${t}</div>`;s.link_preview_text=t,s.link_preview=a+s.link_preview}return s},Hue.setup_image_preview=function(e,t,a){let i=Hue.started,s=e.find(".image_preview").eq(0);s.click(function(){Hue.open_url_menu({source:t})});let n=s.find(".image_preview_image").eq(0);n[0].addEventListener("load",function(){a!==Hue.user_id&&i?Hue.goto_bottom(!1,!1):Hue.goto_bottom(!0,!1)}),n.click(function(e){e.stopPropagation(),Hue.expand_image(t.replace(".gifv",".gif"))}),s.parent().find(".image_preview_text").eq(0).urlize()},Hue.setup_link_preview=function(e,t,a){let i=Hue.started,s=e.find(".link_preview").eq(0),n=s.find(".link_preview_title").eq(0);s.click(function(){Hue.open_url_menu({source:t,title:n.text()})});let _=s.find(".link_preview_image").eq(0);_.length>0&&_[0].addEventListener("load",function(){a!==Hue.user_id&&i?Hue.goto_bottom(!1,!1):Hue.goto_bottom(!0,!1)}),_.click(function(e){e.stopPropagation(),Hue.expand_image($(this).attr("src").replace(".gifv",".gif"))}),s.parent().find(".link_preview_text").eq(0).urlize()},Hue.say_command=function(e,t){Hue.process_message({message:e,to_history:t.to_history,clr_input:t.clr_input})},Hue.scroll_events=function(){$("#chat_area")[0].addEventListener("wheel",function(e){$("#chat_area").stop(),Hue.clear_autoscroll()}),$("#chat_area").scroll(function(){Hue.scroll_timer()})},Hue.show_top_scroller=function(){$("#top_scroller_container").css("visibility","visible")},Hue.hide_top_scroller=function(){$("#top_scroller_container").css("visibility","hidden")},Hue.show_bottom_scroller=function(){$("#bottom_scroller_container").css("visibility","visible"),Hue.chat_scrolled=!0},Hue.hide_bottom_scroller=function(){$("#bottom_scroller_container").css("visibility","hidden"),Hue.chat_scrolled=!1},Hue.check_scrollers=function(){if($("#chat_area").is(":animated"))return!1;let e=$("#chat_area"),t=e.prop("scrollHeight")-e.innerHeight(),a=e.scrollTop(),i=t-a;i>Hue.small_scroll_amount?(a>0?Hue.show_top_scroller():(Hue.hide_top_scroller(),Hue.clear_autoscroll()),Hue.show_bottom_scroller()):(Hue.hide_top_scroller(),Hue.hide_bottom_scroller(),i<=0&&Hue.clear_autoscroll())},Hue.autoscroll_up=function(){if(Hue.autoscrolling)return Hue.clear_autoscroll(),!1;Hue.clear_autoscroll(),Hue.autoscroll_up_interval=setInterval(function(){Hue.scroll_up(Hue.get_setting("autoscroll_amount"))},Hue.get_setting("autoscroll_delay")),Hue.autoscrolling=!0},Hue.autoscroll_down=function(){if(Hue.autoscrolling)return Hue.clear_autoscroll(),!1;Hue.clear_autoscroll(),Hue.autoscroll_up_interval=setInterval(function(){Hue.scroll_down(Hue.get_setting("autoscroll_amount"))},Hue.get_setting("autoscroll_delay")),Hue.autoscrolling=!0},Hue.clear_autoscroll=function(){clearInterval(Hue.autoscroll_up_interval),clearInterval(Hue.autoscroll_down_interval),Hue.autoscrolling=!1},Hue.show_announcement=function(e,t=Date.now()){Hue.public_feedback(e.message,{id:e.id,brk:"<i class='icon2c fa fa-star'></i>",date:t,preview_image:!0,link_title:e.link_title,link_image:e.link_image,link_url:e.link_url})},Hue.goto_top=function(e=!0){Hue.clear_autoscroll(),Hue.scroll_chat_to(0,e),Hue.hide_top_scroller()},Hue.goto_bottom=function(e=!1,t=!0){let a=$("#chat_area"),i=a.prop("scrollHeight")-a.innerHeight();e?(Hue.clear_autoscroll(),Hue.scroll_chat_to(i,t),Hue.hide_top_scroller(),Hue.hide_bottom_scroller()):Hue.chat_scrolled||(Hue.clear_autoscroll(),Hue.scroll_chat_to(i,t))},Hue.show_log_messages=function(){if(Hue.log_messages_processed)return!1;let e=0,t=0,a=0;if(Hue.log_messages&&Hue.log_messages.length>0)for(let i of Hue.log_messages){let s=i.type;"image"===s?e+=1:"tv"===s?t+=1:"radio"===s&&(a+=1)}if(0===e&&Hue.setup_image("show",Object.assign(Hue.get_media_object_from_init_data("image"),{in_log:!1})),0===t&&Hue.setup_tv("show",Object.assign(Hue.get_media_object_from_init_data("tv"),{in_log:!1})),0===a&&Hue.setup_radio("show",Object.assign(Hue.get_media_object_from_init_data("radio"),{in_log:!1})),Hue.log_messages&&Hue.log_messages.length>0)for(let e of Hue.log_messages){let t=e.id,a=e.type,i=e.data,s=e.date;i&&("chat"===a?Hue.update_chat({id:t,user_id:i.user_id,username:i.username,message:i.content,prof_image:i.profile_image,link_title:i.link_title,link_image:i.link_image,link_url:i.link_url,date:s,scroll:!1,edited:i.edited}):"image"===a?(i.id=t,i.date=s,Hue.setup_image("show",i)):"tv"===a?(i.id=t,i.date=s,Hue.setup_tv("show",i)):"radio"===a?(i.id=t,i.date=s,Hue.setup_radio("show",i)):"reaction"===a?(i.id=t,Hue.show_reaction(i,s)):"announcement"===a&&(i.id=t,Hue.show_announcement(i,s)))}Hue.log_messages_processed=!0},Hue.shrug=function(){Hue.process_message({message:"\\_()_/",to_history:!1})},Hue.show_afk=function(){Hue.process_message({message:"/me is now AFK",to_history:!1})},Hue.feedback=function(e,t=!1){let a={brk:"<i class='icon2c fa fa-info-circle'></i>",message:e,public:!1};return t&&Object.assign(a,t),a.brk.startsWith("<")||a.brk.endsWith(">")||(a.brk=`<div class='inline'>${a.brk}</div>`),Hue.chat_announce(a)},Hue.public_feedback=function(e,t=!1){let a={brk:"<i class='icon2c fa fa-info-circle'></i>",message:e,public:!0};return t&&Object.assign(a,t),a.brk.startsWith("<")||a.brk.endsWith(">")||(a.brk=`<div class='inline'>${a.brk}</div>`),Hue.chat_announce(a)},Hue.remove_messages_after_id=function(e,t){let a=!1;if($($("#chat_area .chat_content_container").get().reverse()).each(function(){if($(this).data("id")===e){let e=$(this).index(),i=$(this).closest(".message");return $(this).closest(".chat_container").find(".chat_content_container").length>1&&("above"===t?i.find(".chat_content_container").slice(0,e).remove():"below"===t&&i.find(".chat_content_container").slice(e+1).remove()),a=i.index(),!1}}),!1===a&&$($("#chat_area > .announcement").get().reverse()).each(function(){if($(this).data("id")===e)return a=$(this).index(),!1}),!1===a)return!1;"above"===t?$("#chat_area > .message").slice(0,a).remove():"below"===t&&$("#chat_area > .message").slice(a+1).remove(),Hue.goto_bottom(!0,!1)},Hue.apply_chat_style=function(){let e=Hue.get_setting("chat_font_size");cfsize_factor="very_small"===e?.5:"small"===e?.8:"normal"===e?1:"big"===e?1.2:"very_big"===e?1.5:1;let t=Hue.get_setting("chat_profile_image_size"),a=45;"small"===t?a=25:"normal"===t?a=45:"big"===t&&(a=65);let i=`${cfsize_factor}rem`,s=a*cfsize_factor,n=`${s}px`,_=s/45,r="0";_<1&&(r=`${10/_/10}px`);let c=`\n    <style class='appended_chat_style'>\n\n    .message\n    {\n        font-size: ${i} !important;\n    }\n\n    .chat_profile_image_container\n    {\n        min-width: ${n} !important;\n        max-width: ${n} !important;\n        min-height: ${n} !important;\n        max-height: ${n} !important;\n        margin-top: ${r} !important;\n    }\n\n    .brk\n    {\n        min-width: ${n} !important;\n        max-width: ${n} !important;\n    }\n\n    </style>\n    `;$(".appended_chat_style").each(function(){$(this).remove()}),$("head").append(c)},Hue.setup_chat=function(){Hue.apply_chat_style()},Hue.change_chat_visibility=function(){Hue.get_setting("chat_enabled")?$("#chat_main").css("display","flex"):$("#chat_main").css("display","none"),Hue.fix_frames()};
Hue.reset_chat_search_filter=function(){$("#chat_search_filter").val(""),$("#chat_search_container").html(""),$("#chat_search_no_results").css("display","none")},Hue.show_chat_search=function(e=!1){e&&(e=e.trim());let t=e||"";if($("#chat_search_container").html(""),$("#chat_search_no_results").css("display","none"),$("#chat_search_filter").val(t),e){let t=Hue.utilz.clean_string2(e).toLowerCase().split(" ").filter(e=>""!==e.trim()),a=$($("#chat_area").children().get().reverse()).clone(!0,!0);a.each(function(){$(this).removeAttr("id")}),0===(a=a.filter(function(){if($(this).hasClass("vseparator_container"))return!1;let e=$(this).text().toLowerCase();return t.some(t=>e.includes(t))})).children().length?$("#chat_search_no_results").css("display","block"):a.appendTo("#chat_search_container"),Hue.add_to_chat_searches(e)}Hue.msg_chat_search.show(function(){Hue.scroll_modal_to_top("chat_search")})},Hue.add_to_chat_searches=function(e){clearTimeout(Hue.add_to_chat_searches_timeout),Hue.add_to_chat_searches_timeout=setTimeout(function(){Hue.do_add_to_chat_searches(e)},Hue.add_to_chat_searches_delay)},Hue.do_add_to_chat_searches=function(e){for(let t=0;t<Hue.room_state.chat_searches.length;t++)if(Hue.room_state.chat_searches[t]===e){Hue.room_state.chat_searches.splice(t,1);break}Hue.room_state.chat_searches.unshift(e),Hue.room_state.chat_searches.length>Hue.config.max_chat_searches&&(Hue.room_state.chat_searches=Hue.room_state.chat_searches.slice(0,Hue.config.max_chat_searches)),Hue.save_room_state()},Hue.clear_chat_searches=function(){Hue.room_state.chat_searches=[],Hue.save_room_state()};
Hue.commands={"/clear":{action:(e,t)=>{Hue.clear_chat()},description:"Clears the chat"},"/clearinput":{action:(e,t)=>{Hue.clear_input()},description:"Clears the text input"},"/users":{action:(e,t)=>{e?Hue.show_userlist_window("normal",e):Hue.show_userlist_window()},description:"Shows the user list. Accepts a filter as an argument"},"/publicrooms":{action:(e,t)=>{e?Hue.request_roomlist(e,"public_roomlist"):Hue.request_roomlist("","public_roomlist")},description:"Shows the public room list. Accepts a filter as an argument"},"/visitedrooms":{action:(e,t)=>{e?Hue.request_roomlist(e,"visited_roomlist"):Hue.request_roomlist("","visited_roomlist")},description:"Shows the visited room list. Accepts a filter as an argument"},"/roomname":{action:(e,t)=>{e?Hue.change_room_name(e):Hue.show_room()},description:"Changes the name of the room"},"/roomnameedit":{action:(e,t)=>{Hue.room_name_edit(),t.to_history=!1,t.clr_input=!1},description:"Puts the room name in the input, ready to be edited"},"/played":{action:(e,t)=>{e?Hue.show_played(e):Hue.show_played()},description:"Shows the list of songs played. Accepts a filter as an argument"},"/search":{action:(e,t)=>{e?Hue.show_chat_search(e):Hue.show_chat_search()},description:"Opens the search window. Accepts a query as an argument"},"/clearsearches":{action:(e,t)=>{Hue.clear_chat_searches()},description:"Clears the saved recent searches"},"/role":{action:(e,t)=>{Hue.show_role()},description:"Shows your role and permissions"},"/voice1":{action:(e,t)=>{Hue.change_role(e,"voice1")},description:"Gives voice 1 to a user"},"/voice2":{action:(e,t)=>{Hue.change_role(e,"voice2")},description:"Gives voice 2 to a user"},"/voice3":{action:(e,t)=>{Hue.change_role(e,"voice3")},description:"Gives voice 3 to a user"},"/voice4":{action:(e,t)=>{Hue.change_role(e,"voice4")},description:"Gives voice 4 to a user"},"/op":{action:(e,t)=>{Hue.change_role(e,"op")},description:"Gives op to a user. Ops can do anything an admin can do except more high level commands"},"/admin":{action:(e,t)=>{Hue.change_role(e,"admin")},description:"Gives admin to a user. This gives a user the same rights as the original admin"},"/resetvoices":{action:(e,t)=>{Hue.reset_voices()},description:"Turns all voices above 1 to voice 1"},"/removeops":{action:(e,t)=>{Hue.remove_ops()},description:"Removes all op roles"},"/ban":{action:(e,t)=>{Hue.ban(e)},description:"Bans a user from the room"},"/unban":{action:(e,t)=>{Hue.unban(e)},description:"Unbans a user from the room"},"/unbanall":{action:(e,t)=>{Hue.unban_all()},description:"Removes all bans"},"/bancount":{action:(e,t)=>{Hue.get_ban_count()},description:"Displays the number of banned users in the room"},"/kick":{action:(e,t)=>{Hue.kick(e)},description:"Kicks a user out of the room"},"/public":{action:(e,t)=>{Hue.change_privacy(!0)},description:"Room appears in the public room list"},"/private":{action:(e,t)=>{Hue.change_privacy(!1)},description:"Room doesn't appear in the public room list"},"/privacy":{action:(e,t)=>{Hue.show_public()},description:"Shows if a room is public or private"},"/log":{action:(e,t)=>{Hue.show_log()},description:"Shows if the log is enabled or disabled"},"/enablelog":{action:(e,t)=>{Hue.change_log(!0)},description:"Enables logging of the room. Which allows users to see previous messages before they joined"},"/disablelog":{action:(e,t)=>{Hue.change_log(!1)},description:"Disables logging"},"/clearlog":{action:(e,t)=>{Hue.clear_log("all")},description:"Removes all messages from the log and resets client state for all the users in the room"},"/radio":{action:(e,t)=>{e?Hue.change_radio_source(e):Hue.show_media_source("radio")},description:'Changes the radio using a search term or URL. "/radio restart" restarts the current radio for all users, in case it gets stuck. "/radio default" sets the radio to the site\'s default radio. "/radio prev" changes to the previous radio source'},"/tv":{action:(e,t)=>{e?Hue.change_tv_source(e):Hue.show_media_source("tv")},description:'Changes the TV using a search term or URL. "/tv restart" restarts the current video for all users, in case it gets stuck. To link a Youtube playlist the URL must be a pure playlist URL without a video ID. "/tv default" sets the tv to the site\'s default tv. "/tv prev" changes to the previous tv source'},"/image":{action:(e,t)=>{e?Hue.change_image_source(e):Hue.show_media_source("image")},description:'Sends an image to be uploaded by URL. "/image default" sets the image to the site\'s default image. "/image prev" changes to the previous image source'},"/status":{action:(e,t)=>{Hue.show_status()},description:"Shows the room status window"},"/topic":{action:(e,t)=>{e?Hue.change_topic(e):Hue.show_topic()},description:"Changes the topic of the room"},"/topicadd":{action:(e,t)=>{Hue.topicadd(e)},description:"Adds a section at the end of the topic"},"/topictrim":{action:(e,t)=>{e?Hue.topictrim(e):Hue.topictrim(1)},description:"Removes a section from the end of the topic, where the optional x is the number of trims you want to do"},"/topicaddstart":{action:(e,t)=>{Hue.topicstart(e)},description:"Adds a section at the start of the topic"},"/topictrimstart":{action:(e,t)=>{e?Hue.topictrimstart(e):Hue.topictrimstart(1)},description:"Removes a section from the start of the topic, where the optional x is the number of trims you want to do"},"/topicedit":{action:(e,t)=>{Hue.topicedit(),t.to_history=!1,t.clr_input=!1},description:"Puts the topic in the input, ready to be edited"},"/room":{action:(e,t)=>{Hue.show_room()},description:"Shows the room name"},"/help":{action:(e,t)=>{Hue.show_help()},description:"Shows Help"},"/commands":{action:(e,t)=>{e?Hue.show_commands(e):Hue.show_commands()},description:"Shows Commands"},"/stopradio":{action:(e,t)=>{Hue.stop_radio()},description:"Stops the radio"},"/startradio":{action:(e,t)=>{Hue.start_radio()},description:"Starts the radio"},"/radiovolume":{action:(e,t)=>{Hue.change_volume_command(e,"radio")},description:"Changes the volume of the radio"},"/tvvolume":{action:(e,t)=>{Hue.change_volume_command(e,"tv")},description:"Changes the volume of the tv"},"/volume":{action:(e,t)=>{Hue.change_volume_all(e)},description:"Changes the volume of the radio and the tv"},"/inputhistory":{action:(e,t)=>{e?Hue.show_input_history(e):Hue.show_input_history()},description:"Shows the input history. Accepts a filter as an argument"},"/clearinputhistory":{action:(e,t)=>{Hue.clear_input_history()},description:"Clears the input history"},"/changeusername":{action:(e,t)=>{Hue.change_username(e)},description:"Changes the account username"},"/changepassword":{action:(e,t)=>{Hue.change_password(e)},description:"Changes the account password"},"/changeemail":{action:(e,t)=>{Hue.change_email(e)},description:"Changes the account email"},"/verifyemail":{action:(e,t)=>{Hue.verify_email(e)},description:"Used to verify an email email with a received code"},"/details":{action:(e,t)=>{Hue.show_details()},description:"Shows the account details"},"/logout":{action:(e,t)=>{Hue.logout()},description:"Ends the user session"},"/fill":{action:(e,t)=>{Hue.fill()},description:"Used for debugging purposes"},"/shrug":{action:(e,t)=>{Hue.shrug()},description:"Shows the shrug ascii"},"/afk":{action:(e,t)=>{Hue.show_afk()},description:"Shows that the user went AFK"},"/disconnectothers":{action:(e,t)=>{Hue.disconnect_others()},description:"Disconnects other connected account clients"},"/whisper":{action:(e,t)=>{Hue.process_write_whisper(e,!0)},description:"Opens a window to write a whisper to x user. If the argument contains the &gt; character it will use the inline method where the username is whatever is to the left of the &gt; and the message whatever is to the right of it, and send the message directly without using the window"},"/whisper2":{action:(e,t)=>{Hue.process_write_whisper(e,!1)},description:'Same as /whisper but it doesn\'t show feedback when sent through the inline format, for example "/whisper2 user > message". Useful for making calls to bots without filling your own chat too much'},"/whisperops":{action:(e,t)=>{Hue.write_popup_message(!1,"ops")},description:"Opens a window to write a whisper to ops and admins"},"/broadcast":{action:(e,t)=>{Hue.write_popup_message(!1,"room")},description:"Opens a window to write a message to be sent to the entire room"},"/systembroadcast":{action:(e,t)=>{Hue.write_popup_message(!1,"system"),t.to_history=!1},description:"(Only for superusers) Opens a window to write a message to be sent to the entire system"},"/systemrestart":{action:(e,t)=>{Hue.send_system_restart_signal(),t.to_history=!1},description:"(Only for superusers) Sends a signal to every connected client to restart the application"},"/annex":{action:(e,t)=>{e?Hue.annex(e):(Hue.annex(),t.to_history=!1)},description:"(Only for superusers) Used to change the user's role"},"/highlights":{action:(e,t)=>{e?Hue.show_highlights(e):Hue.show_highlights()},description:"Shows chat messages where you were highlighted. Accepts a filter as an argument"},"/lock":{action:(e,t)=>{Hue.stop_and_lock(!1)},description:"Locks all media"},"/unlock":{action:(e,t)=>{Hue.default_media_state(!1)},description:"Unlocks all media"},"/stopandlock":{action:(e,t)=>{Hue.stop_and_lock()},description:"Stops and locks all media"},"/stop":{action:(e,t)=>{Hue.stop_media()},description:"Stops all media"},"/default":{action:(e,t)=>{Hue.default_media_state()},description:"Sets media visibility and locks to the default state"},"/roommenu":{action:(e,t)=>{Hue.show_room_menu()},description:"Shows the room menu"},"/usermenu":{action:(e,t)=>{Hue.show_user_menu()},description:"Shows the user menu"},"/mediamenu":{action:(e,t)=>{Hue.show_media_menu()},description:"Shows the media menu"},"/imagehistory":{action:(e,t)=>{e?Hue.show_media_history("image",e):Hue.show_media_history("image")},description:"Shows the image history. Accepts a filter as an argument"},"/tvhistory":{action:(e,t)=>{e?Hue.show_media_history("tv",e):Hue.show_media_history("tv")},description:"Shows the tv history. Accepts a filter as an argument"},"/radiohistory":{action:(e,t)=>{e?Hue.show_media_history("radio",e):Hue.show_media_history("radio")},description:"Shows the radio history. Accepts a filter as an argument"},"/lockimages":{action:(e,t)=>{Hue.toggle_lock_images(!0)},description:"Locks images"},"/locktv":{action:(e,t)=>{Hue.toggle_lock_tv(!0)},description:"Locks the tv"},"/lockradio":{action:(e,t)=>{Hue.toggle_lock_radio(!0)},description:"Locks the radio"},"/unlockimages":{action:(e,t)=>{Hue.toggle_lock_images(!1)},description:"Unlocks images"},"/unlocktv":{action:(e,t)=>{Hue.toggle_lock_tv(!1)},description:"Unlocks the tv"},"/unlockradio":{action:(e,t)=>{Hue.toggle_lock_radio(!1)},description:"Unlocks the radio"},"/togglelockimages":{action:(e,t)=>{Hue.toggle_lock_images()},description:"Toggles between lock and unlock images"},"/togglelocktv":{action:(e,t)=>{Hue.toggle_lock_tv()},description:"Toggles between lock and unlock the tv"},"/togglelockradio":{action:(e,t)=>{Hue.toggle_lock_radio()},description:"Toggles between lock and unlock the radio"},"/showimages":{action:(e,t)=>{Hue.toggle_images(!0)},description:"Makes images visible and active"},"/showtv":{action:(e,t)=>{Hue.toggle_tv(!0)},description:"Makes the tv visible and active"},"/showradio":{action:(e,t)=>{Hue.toggle_radio(!0)},description:"Makes the radio images visible and active"},"/hideimages":{action:(e,t)=>{Hue.toggle_images(!1)},description:"Makes images invisible and inactive"},"/hidetv":{action:(e,t)=>{Hue.toggle_tv(!1)},description:"Makes the tv invisible and inactive"},"/hideradio":{action:(e,t)=>{Hue.toggle_radio(!1)},description:"Makes the radio images invisible and inactive"},"/toggleimages":{action:(e,t)=>{Hue.toggle_images()},description:"Toggles between show and hide images"},"/toggletv":{action:(e,t)=>{Hue.toggle_tv()},description:"Toggles between show and hide the tv"},"/toggleradio":{action:(e,t)=>{Hue.toggle_radio()},description:"Toggles between show and hide the radio"},"/maximizeimages":{action:(e,t)=>{Hue.maximize_images()},description:"Maximize/Restore images"},"/maximizetv":{action:(e,t)=>{Hue.maximize_tv()},description:"Maximize/Restore the tv"},"/starttv":{action:(e,t)=>{Hue.play_tv()},description:"Starts the tv"},"/stoptv":{action:(e,t)=>{Hue.stop_tv()},description:"Stops the tv"},"/openimage":{action:(e,t)=>{Hue.show_current_image_modal()},description:"Opens the image modal with the current image"},"/openlastimage":{action:(e,t)=>{Hue.show_current_image_modal(!1)},description:"Opens the image modal with the latest announced image"},"/date":{action:(e,t)=>{Hue.show_current_date()},description:"Shows current date"},"/js":{action:(e,t)=>{Hue.execute_javascript(e)},description:"Executes a javascript operation"},"/js2":{action:(e,t)=>{Hue.execute_javascript(e,!1)},description:"Executes a javascript operation without showing the result"},"/changeimage":{action:(e,t)=>{Hue.show_image_picker()},description:"Opens window to change the image"},"/changetv":{action:(e,t)=>{Hue.show_tv_picker()},description:"Opens the window to change the tv"},"/changeradio":{action:(e,t)=>{Hue.show_radio_picker()},description:"Opens the window to change the radio"},"/closeall":{action:(e,t)=>{Hue.close_all_message()},description:"Closes all the modal windows and popups"},"/closeallmodals":{action:(e,t)=>{Hue.close_all_modals()},description:"Closes all the modal windows"},"/closeallpopups":{action:(e,t)=>{Hue.close_all_popups()},description:"Closes all the popups"},"/activityabove":{action:(e,t)=>{Hue.activity_above(!0)},description:"Scrolls chat to activity pertaining you above"},"/activityabove2":{action:(e,t)=>{Hue.activity_above(!1)},description:"Scrolls chat to activity pertaining you above without animating the scroll"},"/activitybelow":{action:(e,t)=>{Hue.activity_below(!0)},description:"Scrolls chat to activity pertaining you below"},"/activitybelow2":{action:(e,t)=>{Hue.activity_below(!1)},description:"Scrolls chat to activity pertaining you below without animating the scroll"},"/globalsettings":{action:(e,t)=>{e?Hue.show_global_settings(e):Hue.show_global_settings()},description:"Shows the global settings window. Accepts a filter as an argument"},"/roomsettings":{action:(e,t)=>{e?Hue.show_room_settings(e):Hue.show_room_settings()},description:"Shows the room settings window. Accepts a filter as an argument"},"/goto":{action:(e,t)=>{Hue.goto_url(e,"tab")},description:"Goes to room ID or URL"},"/toggleplayradio":{action:(e,t)=>{Hue.toggle_play_radio()},description:"Starts or stops the radio"},"/refreshimage":{action:(e,t)=>{Hue.refresh_image()},description:"Loads the image again"},"/refreshtv":{action:(e,t)=>{Hue.refresh_tv()},description:"Loads the tv again"},"/refreshradio":{action:(e,t)=>{Hue.refresh_radio()},description:"Loads the radio again"},"/stopradioin":{action:(e,t)=>{Hue.stop_radio_in(e)},description:"Stops the radio automatically after the given x minutes"},"/ping":{action:(e,t)=>{Hue.ping_server()},description:"Pings the server and shows the delay from the moment it was sent to the moment it was received"},"/reactlike":{action:(e,t)=>{Hue.send_reaction("like")},description:'Sends reaction "like"'},"/reactlove":{action:(e,t)=>{Hue.send_reaction("love")},description:'Sends reaction "love"'},"/reacthappy":{action:(e,t)=>{Hue.send_reaction("happy")},description:'Sends reaction "happy"'},"/reactmeh":{action:(e,t)=>{Hue.send_reaction("meh")},description:'Sends reaction "meh"'},"/reactsad":{action:(e,t)=>{Hue.send_reaction("sad")},description:'Sends reaction "sad"'},"/reactdislike":{action:(e,t)=>{Hue.send_reaction("dislike")},description:'Sends reaction "dislike"'},"/f1":{action:(e,t)=>{Hue.run_user_function(1),t.to_history=!1},description:"Runs User Function 1"},"/f2":{action:(e,t)=>{Hue.run_user_function(2),t.to_history=!1},description:"Runs User Function 2"},"/f3":{action:(e,t)=>{Hue.run_user_function(3),t.to_history=!1},description:"Runs User Function 3"},"/f4":{action:(e,t)=>{Hue.run_user_function(4),t.to_history=!1},description:"Runs User Function 4"},"/f5":{action:(e,t)=>{Hue.run_user_function(5),t.to_history=!1},description:"Runs User Function 5"},"/f6":{action:(e,t)=>{Hue.run_user_function(6),t.to_history=!1},description:"Runs User Function 6"},"/f7":{action:(e,t)=>{Hue.run_user_function(7),t.to_history=!1},description:"Runs User Function 7"},"/f8":{action:(e,t)=>{Hue.run_user_function(8),t.to_history=!1},description:"Runs User Function 8"},"/lockscreen":{action:(e,t)=>{Hue.lock_screen()},description:"Locks the screen"},"/unlockscreen":{action:(e,t)=>{Hue.unlock_screen()},description:"Unlocks the screen"},"/togglelockscreen":{action:(e,t)=>{Hue.room_state.screen_locked?Hue.unlock_screen():Hue.lock_screen()},description:"Locks or unlocks the screen"},"/drawimage":{action:(e,t)=>{Hue.open_draw_image()},description:"Opens the window to draw an image"},"/say":{action:(e,t)=>{Hue.say_command(e,t)},description:"Sends a normal chat message. Useful if you want to make a chain of commands that starts with a message"},"/input":{action:(e,t)=>{Hue.input_command(e),t.to_history=!1,t.clr_input=!1},description:"Adds text to the input"},"/top":{action:(e,t)=>{Hue.goto_top(!0)},description:"Scrolls the chat to the top"},top2:{action:(e,t)=>{Hue.goto_top(!1)},description:"Scrolls the chat to the top"},"/bottom":{action:(e,t)=>{Hue.goto_bottom(!0,!0)},description:"Scrolls the chat to the bottom"},"/bottom2":{action:(e,t)=>{Hue.goto_bottom(!0,!1)},description:"Scrolls the chat to the bottom without animating the scroll"},"/background":{action:(e,t)=>{Hue.change_background_image_source(e)},description:"Changes the background image to a specified URL"},"/whatis":{action:(e,t)=>{Hue.inspect_command(e)},description:"This can be used to inspect commands. If the command is an alias it will show what it is an alias of"},"/refresh":{action:(e,t)=>{Hue.restart_client()},description:"Refreshes/Restarts the client"},"/modifysetting":{action:(e,t)=>{Hue.modify_setting(e)},description:"This can be used to change user settings directly. This requires the internal name of the setting and the value"},"/modifysetting2":{action:(e,t)=>{Hue.modify_setting(e,!1)},description:"Same as /modifysetting but it doesn't show feedback on completion"},"/feedback":{action:(e,t)=>{Hue.feedback(e)},description:"Displays a simple feedback information message for the user"},"/imagesmode":{action:(e,t)=>{Hue.change_room_images_mode(e)},description:"Changes the images mode. Valid modes include enabled, disabled, and locked"},"/tvmode":{action:(e,t)=>{Hue.change_room_tv_mode(e)},description:"Changes the tv mode. Valid modes include enabled, disabled, and locked"},"/radiomode":{action:(e,t)=>{Hue.change_room_radio_mode(e)},description:"Changes the radio mode. Valid modes include enabled, disabled, and locked"},"/theme":{action:(e,t)=>{Hue.change_theme(e)},description:"Changes the theme to a specified hex color"},"/thememode":{action:(e,t)=>{Hue.change_theme_mode(e)},description:"Changes the theme mode. Valid modes include automatic and custom"},"/textcolormode":{action:(e,t)=>{Hue.change_text_color_mode(e)},description:"Changes the text color mode. Valid modes include automatic, and custom"},"/textcolor":{action:(e,t)=>{Hue.change_text_color(e)},description:"Changes the text color to a specified hex color"},"/backgroundmode":{action:(e,t)=>{Hue.change_background_mode(e)},description:"Changes the background mode. Valid modes include normal, tiled, mirror, mirror_tiled, and solid"},"/backgroundeffect":{action:(e,t)=>{Hue.change_background_effect(e)},description:"Changes the background effect mode. Valid modes include none and blur"},"/tiledimensions":{action:(e,t)=>{Hue.change_background_tile_dimensions(e)},description:"Changes the dimension for tiled backgrounds"},"/adminactivity":{action:(e,t)=>{e?Hue.request_admin_activity(e):Hue.request_admin_activity()},description:"Shows recent activity by ops and admins. Accepts a filter as an argument"},"/accesslog":{action:(e,t)=>{e?Hue.request_access_log(e):Hue.request_access_log()},description:"Shows the Access Log"},"/togglefontsize":{action:(e,t)=>{Hue.toggle_chat_font_size()},description:"Toggles chat font size between normal, big, and very big"},"/adminlist":{action:(e,t)=>{Hue.request_admin_list()},description:"Shows the list of ops and admins of the room"},"/banlist":{action:(e,t)=>{Hue.request_ban_list()},description:"Displays a list of banned users"},"/synthkey":{action:(e,t)=>{Hue.send_synth_key(e)},description:"Plays the synth key with that number"},"/synthkeylocal":{action:(e,t)=>{Hue.play_synth_key(e)},description:"Plays the synth key only for the user"},"/togglemutesynth":{action:(e,t)=>{Hue.set_synth_muted()},description:"Mutes or unmutes the synth"},"/speak":{action:(e,t)=>{Hue.send_synth_voice(e)},description:"Makes the voice synth say some text"},"/speaklocal":{action:(e,t)=>{Hue.play_synth_voice(e,Hue.username,!0)},description:"Makes the voice synth say some text only for that user"},"/speech":{action:(e,t)=>{Hue.play_speech(e)},description:"Plays one of the configured speeches"},"/unmaximize":{action:(e,t)=>{Hue.unmaximize_media()},description:"Un-maximizes media"},"/maximizechat":{action:(e,t)=>{Hue.toggle_media()},description:"Maximize/Restore the chat"},"/autoscrollup":{action:(e,t)=>{Hue.autoscroll_up()},description:"Slowly scrolls chat up automatically"},"/autoscrolldown":{action:(e,t)=>{Hue.autoscroll_down()},description:"Slowly scrolls chat down automatically"},"/loadnextimage":{action:(e,t)=>{Hue.media_load_next("images")},description:"Loads the next image"},"/loadprevimage":{action:(e,t)=>{Hue.media_load_previous("images")},description:"Loads the previous image"},"/loadnexttv":{action:(e,t)=>{Hue.media_load_next("tv")},description:"Loads the next tv item"},"/loadprevtv":{action:(e,t)=>{Hue.media_load_previous("tv")},description:"Loads the previous tv item"},"/loadnextradio":{action:(e,t)=>{Hue.media_load_next("radio")},description:"Loads the next radio item"},"/loadprevradio":{action:(e,t)=>{Hue.media_load_previous("radio")},description:"Loads the previous radio item"},"/calc":{action:(e,t)=>{Hue.do_math_calculation(e)},description:"Does a mathematical calculation"},"/bio":{action:(e,t)=>{e&&Hue.change_bio(e)},description:"Changes the user's bio"},"/badgeheart":{action:(e,t)=>{e&&Hue.send_badge(e,"heart")},description:"Sends a heart badge to a user"},"/badgeskull":{action:(e,t)=>{e&&Hue.send_badge(e,"skull")},description:"Sends a skull badge to a user"},"/notifications":{action:(e,t)=>{Hue.show_notifications(e)},description:"Opens the notifications window. Accepts a filter as an argument"},"/whispers":{action:(e,t)=>{Hue.show_whispers(e)},description:"Opens the whispers window. Accepts a filter as an argument"},"/synctv":{action:(e,t)=>{e&&Hue.sync_tv(e)},description:"Syncs a TV video with another user's video progress"},"/mediainfo":{action:(e,t)=>{Hue.change_media_info(e)},description:"Changes the media info mode. Either enabled or disabled"},"/links":{action:(e,t)=>{Hue.show_links()},description:"Custom chat search to show links"},"/messageboard":{action:(e,t)=>{Hue.show_message_board()},description:"Opens the message board"},"/clearmessageboard":{action:(e,t)=>{Hue.clear_message_board()},description:"Deletes all message board posts"},"/swap":{action:(e,t)=>{Hue.swap_display_positions_2()},description:"Shortcut to change media positions"},"/rotate":{action:(e,t)=>{Hue.swap_media_layout_2()},description:"Shortcut to change media layout"},"/notebook":{action:(e,t)=>{Hue.show_notebook()},description:"Opens the notebook"},"/note":{action:(e,t)=>{e&&Hue.add_to_notebook(e)},description:"Adds a note at the start of the notebook"}},Hue.setup_commands=function(){Hue.commands_list=[];for(let e in Hue.commands)Hue.commands_list.push(e);Hue.commands_list.sort();for(let e of Hue.commands_list){let t=e.split("").sort().join("");Hue.commands_list_sorted[e]=t,Hue.commands_list_sorted_2[t]=e}for(let e in Hue.commands_list_sorted){let t=Hue.commands_list_sorted[e];for(let o in Hue.commands_list_sorted){let i=Hue.commands_list_sorted[o];e!==o&&t===i&&console.error(`Command anagrams detected. ${e} and ${o}`)}}},Hue.is_command=function(e){return e.length>=2&&"/"===e[0]&&"/"!==e[1]&&" "!==e[1]&&!e.startsWith("/me ")&&!e.startsWith("/em ")},Hue.execute_command=function(e,t){let o=e.split(" "),i=o[0].toLowerCase(),s=o.slice(1).join(" "),a=!1;if(i.endsWith("?")&&(i=i.slice(0,-1),a=!0),i.length<2)return Hue.feedback("Invalid empty command"),t;let n=i.split("").sort().join(""),c=Hue.commands_list_sorted_2[n];if(!c)return Hue.feedback(`Invalid command "${i.slice(1)}". Maybe it is missing an argument. To start a message with / use //`),t;if(a){if(!confirm(`Are you sure you want to execute ${c}?`))return t;Hue.commands[c].action(s,t)}else Hue.commands[c].action(s,t);return t},Hue.execute_commands=function(e){if(Hue.get_setting(e)){let t=Hue.get_setting(e).split("\n");for(let e of t)Hue.process_message({message:e,to_history:!1,clr_input:!1})}},Hue.run_commands_queue=function(e){let t=Hue.commands_queue[e];if(!t||0===t.length)return delete Hue.commands_queue[e],!1;let o=t.shift(),i=o.toLowerCase(),s={message:o,to_history:!1,clr_input:!1,callback:function(){Hue.run_commands_queue(e)}};if(i.startsWith("/sleep")||"/sleep"===i){let t=parseInt(i.replace("/sleep ",""));isNaN(t)&&(t=1e3),setTimeout(function(){Hue.run_commands_queue(e)},t)}else if("/closeandwait"===i)Hue.close_all_modals(function(){Hue.run_commands_queue(e)});else if("/inputenter"===i){let t=$("#input").val();t.length>0?(s.message=t,s.clr_input=!0,Hue.process_message(s)):Hue.run_commands_queue(e)}else Hue.process_message(s)},Hue.inspect_command=function(e){e.startsWith("/")||(e=`/${e}`);let t=e;void 0!==Hue.command_aliases[e]?t+=` is an alias to: "${Hue.command_aliases[e]}"`:Hue.commands_list.includes(e)?t+=`: ${Hue.commands[e].description}`:t+=" is not a valid command",Hue.feedback(t)},Hue.execute_whisper_command=function(e,t){if(Hue.includes_critical_command(e,t))return!1;Hue.feedback(`${e} executed "${t}" in your client`),Hue.process_message({message:t,to_history:!1,clr_input:!1})},Hue.show_commands=function(e=""){let t=Hue.template_commands(),o="";for(let e in Hue.commands){o+=`<div class='info_item modal_item'>${e}: ${Hue.commands[e].description}</div>`}Hue.msg_info2.show(["Commands",t]),$("#commands_container").html(o),e&&($("#commands_filter").val(e),Hue.do_modal_filter())},Hue.setup_command_aliases=function(){let e=Hue.get_setting("aliases").split("\n");Hue.command_aliases={};for(let t of e){let e=t.split("=");if(e.length<2)continue;let o=e[0].trim();if(!(o.length<2)&&("/"===o[0]&&"/"!==o[1])){let t=e.slice(1).join("=").trim();Hue.command_aliases[o]=t}}},Hue.format_command_aliases=function(e){let t=e.split("\n"),o="";for(let e of t){let t=e.split("=");if(t.length<2)continue;let i=`/${Hue.utilz.clean_string5(t[0]).replace(/\//g,"")}`;"/"!==i[0]&&(i="/"+i),o+=`${i} = ${t.slice(1).join("=").trim()}\n`}return o.slice(0,-1)},Hue.includes_critical_command=function(e,t,o=!0){let i=["/js","/js2","/changeusername","/changepassword","/changeemail","/systembroadcast","/systemrestart","/annex"],s=t.split(" ");for(let t of s){let s;if(Hue.is_command(t)){s=t.toLowerCase().split("").sort().join("");for(let t of i)if(Hue.command_sorted_equals(s,t))return o&&Hue.feedback(`${e} attempted to run "${t}" in your client`),!0}}return!1},Hue.get_accept_commands_from_list=function(){let e=Hue.get_setting("accept_commands_from").split("\n");1!==e.length||e[0]||(e=[]),Hue.accept_commands_from_list=e},Hue.command_sorted_equals=function(e,t){return e===Hue.commands_list_sorted[t]};
Hue.context_menu_events={show:function(){Hue.context_menu_on_show()},hide:function(){Hue.context_menu_on_hide()}},Hue.context_menu_on_show=function(){Hue.context_menu_open=!0},Hue.context_menu_on_hide=function(){Hue.context_menu_open=!1},Hue.start_chat_menu_context_menu=function(){$.contextMenu({selector:".chat_menu_button_menu",trigger:"left",animation:{duration:250,hide:"fadeOut"},zIndex:9e9,events:Hue.context_menu_events,events:{show:function(e){Hue.context_menu_on_show(),$(this).closest(".chat_menu_button_main").addClass("chat_menu_button_main_selected")},hide:function(e){Hue.context_menu_on_hide(),$(this).closest(".chat_menu_button_main").removeClass("chat_menu_button_main_selected")}},items:{item0:{name:"Jump",callback:function(e,t){let n=$(this).closest(".message").data("message_id");Hue.jump_to_chat_message(n)},visible:function(e,t){return 0===$(this).closest("#chat_area").length}},item1:{name:"Reply",callback:function(e,t){let n=$(this).closest(".chat_content_container").eq(0).find(".chat_content").get(0);Hue.start_reply(n)},visible:function(e,t){return"chat"===$(this).closest(".message").data("mode")}},item2:{name:"Edit",callback:function(e,t){let n=$(this).closest(".chat_content_container").get(0);Hue.edit_message(n)},visible:function(e,t){return"chat"===$(this).closest(".message").data("mode")&&$(this).closest(".message").data("user_id")===Hue.user_id}},item4:{name:"Change Image",callback:function(e,t){},visible:function(e,t){let n=$(this).closest(".chat_content_container").data("first_url");if(n){if(Hue.change_image_source(n,!0))return!0}return!1},items:{opsure:{name:"I'm Sure",callback:function(e,t){let n=$(this).closest(".chat_content_container").data("first_url");Hue.change_image_source(n)}}}},item5:{name:"Change TV",callback:function(e,t){},visible:function(e,t){let n=$(this).closest(".chat_content_container").data("first_url");if(n){if(Hue.change_tv_source(n,!0))return!0}return!1},items:{opsure:{name:"I'm Sure",callback:function(e,t){let n=$(this).closest(".chat_content_container").data("first_url");Hue.change_tv_source(n)}}}},item6:{name:"Change Radio",callback:function(e,t){},visible:function(e,t){let n=$(this).closest(".chat_content_container").data("first_url");if(n){if(Hue.change_radio_source(n,!0))return!0}return!1},items:{opsure:{name:"I'm Sure",callback:function(e,t){let n=$(this).closest(".chat_content_container").data("first_url");Hue.change_radio_source(n)}}}},item7:{name:"Hide",callback:function(e,t){},items:{opsure:{name:"I'm Sure",callback:function(e,t){Hue.remove_message_from_context_menu(this)}}}},itemdel:{name:"Delete",callback:function(e,t){},visible:function(e,t){if(!Hue.log_enabled)return!1;let n=$(this).closest(".message"),a=n.data("mode");if("chat"===a){let e=$(this).closest(".message").data("user_id");if(e){let t=Hue.get_user_by_id(e);if(t&&!Hue.user_is_controllable(t))return!1}if(e&&e===Hue.user_id||Hue.is_admin_or_op())return!0}else if("announcement"===a){if(n.data("id")){let e=n.data("user_id");if(e){let t=Hue.get_user_by_id(e);if(t&&!Hue.user_is_controllable(t))return!1}if(e&&e===Hue.user_id||Hue.is_admin_or_op())return!0}}return!1},items:{opsure:{name:"I'm Sure",callback:function(e,t){let n=!1,a=$(this).closest(".message"),i=a.data("mode");"chat"===i?n=$(this).closest(".chat_content_container").eq(0).data("id"):"announcement"===i&&(n=a.data("id")),n&&Hue.delete_message(n,!0)}}}},item8:{name:"Clear Log",callback:function(e,t){},items:{above:{name:"Above This Point",callback:function(e,t){},items:{opsure:{name:"I'm Sure",callback:function(e,t){let n,a=$(this).closest(".message"),i=a.data("mode");"chat"===i?n=$(this).closest(".chat_content_container").data("id"):"announcement"===i&&(n=a.data("id")),Hue.clear_log("above",n)}}}},below:{name:"Below This Point",callback:function(e,t){},items:{opsure:{name:"I'm Sure",callback:function(e,t){let n,a=$(this).closest(".message"),i=a.data("mode");"chat"===i?n=$(this).closest(".chat_content_container").data("id"):"announcement"===i&&(n=a.data("id")),Hue.clear_log("below",n)}}}}},visible:function(e,t){if(!Hue.is_admin_or_op())return!1;if(!Hue.log_enabled)return!1;let n=$(this).closest(".message"),a=n.data("mode");if("chat"===a){if($(this).closest(".chat_content_container").data("id"))return!0}else if("announcement"===a){if(!n.data("in_log"))return!1;if(n.data("id"))return!0}return!1}}}})},Hue.generate_chat_maxer_context_items=function(){let e={};for(let t=10;t>0;t--){let n=10*t;e[`per${n}`]={name:`Chat ${n}%`,callback:function(e,t){Hue.do_chat_size_change(n),100!==n&&Hue.show_media_items()}}}return Object.assign({very_big:{name:"Very Big",callback:function(e,t){Hue.toggle_chat_font_size("very_big")}},big:{name:"Big",callback:function(e,t){Hue.toggle_chat_font_size("big")}},normal:{name:"Normal",callback:function(e,t){Hue.toggle_chat_font_size("normal")}},small:{name:"Small",callback:function(e,t){Hue.toggle_chat_font_size("small")}},very_small:{name:"Very Small",callback:function(e,t){Hue.toggle_chat_font_size("very_small")}}},e,{def:{name:"Default",callback:function(e,t){Hue.set_default_chat_size(),Hue.show_media_items()}}})},Hue.start_chat_maxer_context_menu=function(){$.contextMenu({selector:"#chat_maxer",animation:{duration:250,hide:"fadeOut"},zIndex:9e9,events:Hue.context_menu_events,className:"maxer_context",items:Hue.generate_chat_maxer_context_items()})},Hue.generate_tv_maxer_context_items=function(){let e={};for(let t=10;t>=0;t--){let n=10*t;e[`per${n}`]={name:`TV ${n}%`,callback:function(e,t){Hue.unmaximize_media(),Hue.do_media_tv_size_change(n)}}}return Object.assign({swap:{name:"Swap",callback:function(e,t){Hue.swap_display_positions_2()}},rotate:{name:"Rotate",callback:function(e,t){Hue.swap_media_layout_2()}}},e,{def:{name:"Default",callback:function(e,t){Hue.unmaximize_media(),Hue.set_default_tv_size()}}})},Hue.start_tv_maxer_context_menu=function(){$.contextMenu({selector:"#media_tv_maxer, #media_image_maxer, #footer_media_rotate",animation:{duration:250,hide:"fadeOut"},zIndex:9e9,events:Hue.context_menu_events,className:"maxer_context",items:Hue.generate_tv_maxer_context_items()})},Hue.start_room_menu_context_menu=function(){$.contextMenu({selector:"#room_menu_icon",animation:{duration:250,hide:"fadeOut"},zIndex:9e9,events:Hue.context_menu_events,items:{mm0:{name:"About",callback:function(e,t){Hue.show_credits()}}}})},Hue.start_footer_media_label_context_menu=function(){$.contextMenu({selector:".footer_media_label ",animation:{duration:250,hide:"fadeOut"},zIndex:9e9,events:Hue.context_menu_events,items:{mm1:{name:"Load Next",callback:function(e,t){Hue.media_load_next($(this).data("type"))},disabled:function(e,t){return!Hue.media_load_next($(this).data("type"),!0)}},mm2:{name:"Load Previous",callback:function(e,t){Hue.media_load_previous($(this).data("type"))},disabled:function(e,t){return!Hue.media_load_previous($(this).data("type"),!0)}}}})},Hue.start_played_context_menu=function(){$.contextMenu({selector:".played_item_inner, #header_now_playing_controls",animation:{duration:250,hide:"fadeOut"},zIndex:9e9,events:Hue.context_menu_events,items:{cmenu1:{name:"Search on Google",callback:function(e,t){Hue.search_on("google",this.data("q"))}},cmenu2:{name:"Search on SoundCloud",callback:function(e,t){Hue.search_on("soundcloud",this.data("q"))}},cmenu3:{name:"Search on YouTube",callback:function(e,t){Hue.search_on("youtube",this.data("q"))}}}})},Hue.generate_volume_context_items=function(){let e={};for(let t=10;t>=0;t--){let n=10*t,a=t/10;e[`vcm${n}`]={name:`${n}%`,callback:function(e,t){Hue.set_radio_volume(a)},disabled:function(e,t){return a===Hue.room_state.radio_volume}}}return e},Hue.start_volume_context_menu=function(){$.contextMenu({selector:"#header_radio_volume_controls",animation:{duration:250,hide:"fadeOut"},zIndex:9e9,events:Hue.context_menu_events,className:"volume_context",items:Hue.generate_volume_context_items()})},Hue.start_toggle_radio_context_menu=function(){$.contextMenu({selector:"#toggle_radio_state",animation:{duration:250,hide:"fadeOut"},zIndex:9e9,events:Hue.context_menu_events,className:"toggle_radio_context",items:{trs0:{name:"Don't Stop Automatically",callback:function(e,t){Hue.clear_automatic_stop_radio()},visible:function(e,t){return Hue.stop_radio_delay>0}},trs1:{name:"Stop in 1 Minute",callback:function(e,t){Hue.stop_radio_in(1)},visible:function(e,t){return 1!==Hue.stop_radio_delay}},trs1b:{name:"Stop in 1 Minute (*)",callback:function(e,t){Hue.stop_radio_in(1)},visible:function(e,t){return 1===Hue.stop_radio_delay}},trs2:{name:"Stop in 5 Minutes",callback:function(e,t){Hue.stop_radio_in(5)},visible:function(e,t){return 5!==Hue.stop_radio_delay}},trs2b:{name:"Stop in 5 Minutes (*)",callback:function(e,t){Hue.stop_radio_in(5)},visible:function(e,t){return 5===Hue.stop_radio_delay}},trs3:{name:"Stop in 10 Minutes",callback:function(e,t){Hue.stop_radio_in(10)},visible:function(e,t){return 10!==Hue.stop_radio_delay}},trs3b:{name:"Stop in 10 Minutes (*)",callback:function(e,t){Hue.stop_radio_in(10)},visible:function(e,t){return 10===Hue.stop_radio_delay}},trs4:{name:"Stop in 30 Minutes",callback:function(e,t){Hue.stop_radio_in(30)},visible:function(e,t){return 30!==Hue.stop_radio_delay}},trs4b:{name:"Stop in 30 Minutes (*)",callback:function(e,t){Hue.stop_radio_in(30)},visible:function(e,t){return 30===Hue.stop_radio_delay}},trs5:{name:"Stop in 60 Minutes",callback:function(e,t){Hue.stop_radio_in(60)},visible:function(e,t){return 60!==Hue.stop_radio_delay}},trs5b:{name:"Stop in 60 Minutes (*)",callback:function(e,t){Hue.stop_radio_in(60)},visible:function(e,t){return 60===Hue.stop_radio_delay}},trrestart:{name:"Restart",callback:function(e,t){Hue.refresh_radio()},visible:function(e,t){return Hue.radio_started}}},events:{show:function(){return Hue.radio_started}}})},Hue.get_user_context_menu_username=function(e){let t;return t=$(e).hasClass("profile_image")?$(e).data("username"):$(e).text()},Hue.start_user_context_menu=function(){$.contextMenu({selector:".userlist_item_username, .chat_uname, #show_profile_uname, .generic_uname, .admin_list_username, .activity_bar_text, .profile_image, .media_info_username",animation:{duration:250,hide:"fadeOut"},zIndex:9e9,events:Hue.context_menu_events,items:{cmwhisper:{name:"Whisper",callback:callback=function(e,t){let n=Hue.get_user_context_menu_username(this);Hue.process_write_whisper(n)},visible:function(e,t){let n=Hue.get_user_context_menu_username(this);return Hue.user_is_online_by_username(n)}},cmbadge:{name:"Badge",items:{bheart:{name:"Heart",icon:"far fa-heart",callback:callback=function(e,t){let n=Hue.get_user_context_menu_username(this);Hue.send_badge(n,"heart")}},bskull:{name:"Skull",icon:"fas fa-skull",callback:callback=function(e,t){let n=Hue.get_user_context_menu_username(this);Hue.send_badge(n,"skull")}}},visible:function(e,t){let n=Hue.get_user_context_menu_username(this);return n!==Hue.username&&Hue.user_is_online_by_username(n)}},cmvoice1:{name:"Voice 1",callback:function(e,t){let n=Hue.get_user_context_menu_username(this);Hue.change_role(n,"voice1")},visible:function(e,t){return!!Hue.is_admin_or_op(Hue.role)}},cmvoice2:{name:"Voice 2",callback:function(e,t){let n=Hue.get_user_context_menu_username(this);Hue.change_role(n,"voice2")},visible:function(e,t){return!!Hue.is_admin_or_op(Hue.role)}},cmvoice3:{name:"Voice 3",callback:function(e,t){let n=Hue.get_user_context_menu_username(this);Hue.change_role(n,"voice3")},visible:function(e,t){return!!Hue.is_admin_or_op(Hue.role)}},cmvoice4:{name:"Voice 4",callback:function(e,t){let n=Hue.get_user_context_menu_username(this);Hue.change_role(n,"voice4")},visible:function(e,t){return!!Hue.is_admin_or_op(Hue.role)}},cmop:{name:"Op",visible:function(e,t){return"admin"===Hue.role},items:{opsure:{name:"I'm Sure",callback:function(e,t){let n=Hue.get_user_context_menu_username(this);Hue.change_role(n,"op")}}}},cmadmin:{name:"Admin",visible:function(e,t){return"admin"===Hue.role},items:{adminsure:{name:"I'm Sure",callback:function(e,t){let n=Hue.get_user_context_menu_username(this);Hue.change_role(n,"admin")}}}},cmkick:{name:"Kick",visible:function(e,t){if(Hue.is_admin_or_op(Hue.role)){let e=Hue.get_user_context_menu_username(this);return Hue.user_is_online_by_username(e)}return!1},items:{kicksure:{name:"I'm Sure",callback:function(e,t){let n=Hue.get_user_context_menu_username(this);Hue.kick(n)}}}},cmban:{name:"Ban",visible:function(e,t){return!!Hue.is_admin_or_op(Hue.role)},items:{bansure:{name:"I'm Sure",callback:function(e,t){let n=Hue.get_user_context_menu_username(this);Hue.ban(n)}}}}}})},Hue.start_msg_close_buttons_context_menu=function(){$.contextMenu({selector:".Msg-window-inner-x",animation:{duration:250,hide:"fadeOut"},zIndex:9e9,events:Hue.context_menu_events,items:{mm0:{name:"Close All",callback:function(e,t){Hue.process_msg_close_button(this)}}}})},Hue.generate_chat_search_context_items=function(){let e={};if(0===Hue.room_state.chat_searches.length)e.item0={name:"No searches yet",disabled:!0};else{let t=0;for(let n of Hue.room_state.chat_searches)e[`item_${t}`]={name:n,callback:function(e,t){Hue.show_chat_search(n)}},t+=1;e.clear={name:"Clear",icon:"far fa-trash-alt",callback:function(e,t){Hue.clear_chat_searches()}}}return e},Hue.start_search_context_menus=function(){$.contextMenu({selector:"#room_menu_search_button",animation:{duration:250,hide:"fadeOut"},zIndex:9e9,events:Hue.context_menu_events,build:function(e,t){return{items:Hue.generate_chat_search_context_items()}}}),$.contextMenu({selector:"#chat_search_history_icon",animation:{duration:250,hide:"fadeOut"},zIndex:9e9,events:Hue.context_menu_events,trigger:"left",build:function(e,t){return{items:Hue.generate_chat_search_context_items()}}})};
Hue.show_current_date=function(){Hue.feedback(Hue.utilz.nice_date())},Hue.get_timeago=function(e){return Hue.utilz.capitalize_words(timeago.format(e))};
Hue.create_debouncer=function(e,u){return function(){let _;return function(...t){clearTimeout(_),_=setTimeout(function(){e(...t)},u)}}()},Hue.create_debouncers=function(){Hue.do_modal_filter_timer=Hue.create_debouncer(function(){Hue.do_modal_filter()},Hue.filter_delay),Hue.save_local_storage_timer=Hue.create_debouncer(function(){Hue.do_save_local_storage()},Hue.local_storage_save_delay),Hue.double_tap_timer=Hue.create_debouncer(function(){Hue.double_tap_key_pressed=0},Hue.double_tap_delay),Hue.double_tap_2_timer=Hue.create_debouncer(function(){Hue.double_tap_key_2_pressed=0},Hue.double_tap_delay),Hue.double_tap_3_timer=Hue.create_debouncer(function(){Hue.double_tap_key_3_pressed=0},Hue.double_tap_delay),Hue.scroll_timer=Hue.create_debouncer(function(){Hue.check_scrollers()},Hue.check_scrollers_delay),Hue.resize_timer=Hue.create_debouncer(function(){Hue.on_resize()},Hue.resize_delay),Hue.chat_search_timer=Hue.create_debouncer(function(){Hue.show_chat_search($("#chat_search_filter").val())},Hue.filter_delay),Hue.input_history_filter_timer=Hue.create_debouncer(function(){Hue.show_input_history($("#input_history_filter").val())},Hue.filter_delay),Hue.typing_timer=Hue.create_debouncer(function(){Hue.socket_emit("typing",{})},Hue.typing_delay),Hue.typing_remove_timer=Hue.create_debouncer(function(){Hue.hide_pencil()},Hue.config.max_typing_inactivity),Hue.highlights_filter_timer=Hue.create_debouncer(function(){Hue.show_highlights($("#highlights_filter").val())},Hue.filter_delay),Hue.media_history_filter_timer=Hue.create_debouncer(function(e){let u=$(`#${e}_history_filter`).val();Hue.show_media_history(e,u)},Hue.filter_delay),Hue.modal_image_prev_wheel_timer=Hue.create_debouncer(function(){Hue.modal_image_prev_click()},Hue.wheel_delay),Hue.modal_image_next_wheel_timer=Hue.create_debouncer(function(){Hue.modal_image_next_click()},Hue.wheel_delay),Hue.maxer_wheel_timer=Hue.create_debouncer(function(e){e()},Hue.wheel_delay_2),Hue.settings_filter_timer=Hue.create_debouncer(function(e){Hue.do_settings_filter(e,$(`#${e}_filter`).val())},Hue.filter_delay),Hue.infotip_timer=Hue.create_debouncer(function(){Hue.hide_infotip()},Hue.hide_infotip_delay),Hue.on_userlist_scroll=Hue.create_debouncer(function(){Hue.after_userlist_scroll()},Hue.filter_delay)};
Hue.compare_load_dates=function(){let e=Hue.utilz.nice_time(Hue.load_date_1,Hue.load_date_2),n=Hue.utilz.nice_time(Hue.load_date_2,Hue.load_date_3),o=Hue.utilz.nice_time(Hue.load_date_3,Hue.load_date_4);console.info(`Time from load to init ready: ${e}`),console.info(`Time from init ready and join: ${n}`),console.info(`Time from join to everything ready: ${o}`)},Hue.fill=function(){Hue.update_chat({username:Hue.username,message:"abc def ghi jkl mno pqrs tuv wxyz ABC DEF GHI JKL MNO PQRS TUV WXYZ !\"\n$%& /() =?* '<> #|; ~ @   {} abc def ghi jkl mno pqrs tuv wxyz ABC\nDEF GHI JKL MNO PQRS TUV WXYZ !\" $%& /() =?* '<> #|; ~ @   {} abc\ndef ghi jkl mno pqrs tuv wxyz ABC DEF GHI JKL MNO PQRS TUV WXYZ !\" $%& /()\n=?* '<> #|; ~ @   {} abc def ghi jkl mno pqrs tuv wxyz ABC DEF GHI\nJKL MNO PQRS TUV WXYZ !\" $%& /() =?* '<> #|; ~ @`   {} abc def\nghi jkl mno pqrs tuv wxyz ABC DEF GHI JKL MNO PQRS TUV WXYZ !\" $%& /() =?*\n'<> #|; ~ @`   {} abc def ghi jkl mno pqrs tuv wxyz ABC DEF GHI JKL\nMNO PQRS TUV WXYZ !\" $%& /() =?* '<> #|; ~ @`   {} abc def ghi jkl\nmno pqrs tuv wxyz ABC DEF GHI JKL MNO PQRS TUV WXYZ !\" $%& /() =?* '<> #|; ~\n@`   {} abc def ghi jkl mno pqrs tuv wxyz ABC DEF GHI JKL MNO PQRS TUV\nWXYZ !\" $%& /() =?* '<> #|; ~ @`   {} abc def ghi jkl mno pqrs tuv\nwxyz ABC DEF GHI JKL MNO PQRS TUV WXYZ !\" $%& /() =?* '<> #|; ~ @`  \n{} abc def ghi jkl mno pqrs tuv wxyz ABC DEF GHI JKL MNO PQRS TUV WXYZ !\" $%& /()\n=?* '<> #|; ~ @`   {} abc def ghi jkl mno pqrs tuv wxyz ABC DEF GHI JKL\nMNO PQRS TUV WXYZ !\" $%& /() =?* '<> #|; ~ @`   {} abc def ghi jkl mno\npqrs tuv wxyz ABC DEF GHI JKL MNO PQRS TUV WXYZ !\" $%& /() =?* '<> #|; ~ @`\n  {} abc def ghi jkl mno pqrs tuv wxyz ABC DEF GHI JKL MNO PQRS TUV WXYZ !\"\n$%& /() =?* '<> #|; ~ @`   {} abc def ghi jkl mno pqrs tuv wxyz ABC DEF\nGHI JKL MNO PQRS TUV WXYZ !\" $%& /() =?* '<> #|; ~ @`   {}abc def ghi\njkl mno pqrs tuv wxyz ABC DEF GHI JKL MNO PQRS TUV WXYZ !\" $%& /() =?* '<> #|;",prof_image:Hue.profile_image})},Hue.sdeb=function(e,n=!1){n&&console.info(Hue.utilz.nice_date());for(let n of`${e}`.split("\n"))console.info(`>${n}<`);console.info("-------------")},Hue.fillet=function(e){for(let n=0;n<e;n++)Hue.feedback("Some feedback")},Hue.wrap_function=function(e,n){return function(){let o=dateFormat(Date.now(),"h:MM:ss:l");return console.info(`${o} | Running: ${n}`),e(...arguments)}},Hue.wrap_functions=function(){for(let e in Hue){if("wrap_functions"===e||"wrap_function"===e)continue;let n=Hue[e];"function"==typeof n&&(Hue[e]=Hue.wrap_function(n,e))}};
Hue.request_desktop_notifications_permission=function(){return"undefined"!=typeof Notification&&(Hue.has_desktop_notifications_permission()?(Hue.msg_info.show("Desktop Notifications are already enabled"),!1):void Notification.requestPermission())},Hue.has_desktop_notifications_permission=function(){return"undefined"!=typeof Notification&&"granted"===Notification.permission},Hue.show_desktop_notification=function(i){if("undefined"==typeof Notification)return!1;if(!Hue.has_desktop_notifications_permission())return!1;new Notification(i).addEventListener("click",function(i){window.focus(),i.target.close()})},Hue.show_highlight_desktop_notification=function(){return!!Hue.has_desktop_notifications_permission()&&((!Hue.afk||!Hue.get_setting("afk_disable_desktop_notifications"))&&void Hue.show_desktop_notification(`New highlight in ${Hue.room_name.substring(0,40)}`))};
Hue.copypaste_events=function(){$(document).bind("copy",function(e){""!==window.getSelection().toString()&&setTimeout(function(){if(Hue.utilz.is_textbox(document.activeElement)){let e=document.activeElement.selectionEnd;document.activeElement.setSelectionRange(e,e)}else window.getSelection().removeAllRanges(),Hue.focus_input()},200)})};
Hue.redraw_draw_message=function(){Hue.canvas_redraw({context:Hue.draw_message_context,click_x:Hue.draw_message_click_x,click_y:Hue.draw_message_click_y,drag:Hue.draw_message_drag})},Hue.clear_draw_message_state=function(){Hue.draw_message_click_x=[],Hue.draw_message_click_y=[],Hue.draw_message_drag=[],Hue.draw_message_context.clearRect(0,0,Hue.draw_message_context.canvas.width,Hue.draw_message_context.canvas.height)},Hue.draw_message_add_click=function(e,a,_){Hue.draw_message_click_x.push(e),Hue.draw_message_click_y.push(a),Hue.draw_message_drag.push(_),Hue.draw_message_click_x.length>Hue.config.draw_coords_max_array_length&&(Hue.draw_message_click_x.shift(),Hue.draw_message_click_y.shift(),Hue.draw_message_drag.shift())},Hue.canvas_redraw=function(e={}){!1===(e=Object.assign({context:!1,click_x:!1,click_y:!1,drag:!1,bg_color:!1,colors:!1,sizes:!1,sector_index:!1,type:!1},e)).sector_index&&(e.sector_index=e.click_x.length),e.context.clearRect(0,0,e.context.canvas.width,e.context.canvas.height),e.context.lineJoin="round";"draw_image"===e.type&&Hue.draw_image_context.putImageData(Hue.draw_image_current_snapshot.data,0,0),e.bg_color&&(e.context.fillStyle=e.bg_color,e.context.fillRect(0,0,e.context.canvas.width,e.context.canvas.height));for(let a=0;a<e.sector_index;a++)e.context.beginPath(),e.drag[a]&&a?e.context.moveTo(e.click_x[a-1],e.click_y[a-1]):e.context.moveTo(e.click_x[a]-1,e.click_y[a]),e.context.lineTo(e.click_x[a],e.click_y[a]),e.context.closePath(),e.colors?e.context.strokeStyle=e.colors[a]:e.context.strokeStyle=$("#draw_message_area").css("color"),e.sizes?e.context.lineWidth=e.sizes[a]:e.context.lineWidth=2,e.context.stroke()},Hue.open_draw_image=function(){if(!Hue.can_images)return Hue.feedback("You don't have permission to draw images"),!1;Hue.msg_draw_image.show()},Hue.draw_image_scale_fix=function(e){return parseInt(Math.round(e*Hue.draw_image_scale))},Hue.draw_image_add_sector=function(){Hue.draw_image_current_snapshot.sectors.push(Hue.draw_image_current_snapshot.click_x.length)},Hue.setup_draw_image=function(){Hue.draw_image_context=$("#draw_image_area")[0].getContext("2d"),Hue.draw_image_context.scale(Hue.draw_image_scale,Hue.draw_image_scale),Hue.clear_draw_image_state(),$("#draw_image_area").mousedown(function(e){if("bucket"===Hue.draw_image_mode)return!1;Hue.draw_image_just_entered=!1,Hue.draw_image_check_increase_snapshot(),Hue.draw_image_add_sector(),Hue.draw_image_add_click(e.offsetX,e.offsetY,!1),Hue.redraw_draw_image()}),$("#draw_image_area").mousemove(function(e){Hue.mouse_is_down&&(Hue.draw_image_add_click(e.offsetX,e.offsetY,!Hue.draw_image_just_entered),Hue.redraw_draw_image()),Hue.draw_image_just_entered=!1}),$("#draw_image_area").mouseenter(function(e){Hue.draw_image_just_entered=!0}),$("#draw_image_area").click(function(e){if("bucket"===Hue.draw_image_mode){let a=Hue.draw_image_bucket_fill(Hue.draw_image_scale_fix(e.offsetX),Hue.draw_image_scale_fix(e.offsetY));a&&(Hue.draw_image_check_redo(),Hue.increase_draw_image_snapshot(a))}}),Hue.draw_image_prepare_settings(),Hue.horizontal_separator.separate("draw_image_buttons")},Hue.draw_image_prepare_settings=function(){Hue.draw_image_pencil_color="#333333",Hue.draw_image_bucket_color="#4898b7",Hue.draw_image_pencil_size=4,Hue.set_draw_image_mode_input("pencil"),$("#draw_image_pencil_color").val(Hue.draw_image_pencil_color),$("#draw_image_pencil_color").click(function(){Hue.set_draw_image_mode_input("pencil")}),$("#draw_image_pencil_color").change(function(){Hue.draw_image_pencil_color=$(this).val()}),$("#draw_image_bucket_color").val(Hue.draw_image_bucket_color),$("#draw_image_bucket_color").click(function(){Hue.set_draw_image_mode_input("bucket")}),$("#draw_image_bucket_color").change(function(){Hue.draw_image_bucket_color=$(this).val()}),$("#draw_image_pencil_size").find("option").each(function(){$(this).val()==Hue.draw_image_pencil_size&&$(this).prop("selected",!0)}),$("#draw_image_pencil_size").change(function(){Hue.draw_image_pencil_size=$(this).val()})},Hue.set_draw_image_mode_input=function(e){"pencil"===e?($("#draw_image_mode_select_pencil").addClass("modal_icon_selected"),$("#draw_image_mode_select_bucket").removeClass("modal_icon_selected")):"bucket"===e&&($("#draw_image_mode_select_bucket").addClass("modal_icon_selected"),$("#draw_image_mode_select_pencil").removeClass("modal_icon_selected")),Hue.draw_image_mode=e},Hue.increase_draw_image_snapshot=function(e){let a=Hue.draw_image_current_snapshot.level+1;Hue.draw_image_snapshots[`level_${a}`]={level:a,data:e,click_x:[],click_y:[],drag:[],color_array:[],size_array:[],sectors:[],sector_index:0},Hue.draw_image_current_snapshot=Hue.draw_image_snapshots[`level_${a}`];let _=Object.keys(Hue.draw_image_snapshots);if(_.length>Hue.draw_image_max_levels){let e=_.length;for(let a in Hue.draw_image_snapshots){let _=Hue.draw_image_snapshots[a];_.level<e&&(e=_.level)}delete Hue.draw_image_snapshots[`level_${e}`]}},Hue.clear_draw_image_state=function(){let e=Hue.draw_image_context;e.fillStyle="#ffffff",e.fillRect(0,0,e.canvas.width,e.canvas.height),Hue.draw_image_snapshots={level_0:{level:0,data:Hue.draw_image_get_image_data(),click_x:[],click_y:[],drag:[],color_array:[],size_array:[],sectors:[],sector_index:0}},Hue.draw_image_current_snapshot=Hue.draw_image_snapshots.level_0},Hue.redraw_draw_image=function(){Hue.canvas_redraw({context:Hue.draw_image_context,click_x:Hue.draw_image_current_snapshot.click_x,click_y:Hue.draw_image_current_snapshot.click_y,drag:Hue.draw_image_current_snapshot.drag,colors:Hue.draw_image_current_snapshot.color_array,sizes:Hue.draw_image_current_snapshot.size_array,sector_index:Hue.draw_image_current_snapshot.sector_index,type:"draw_image"})},Hue.draw_image_clean_redo=function(e){Hue.draw_image_current_snapshot.click_x=Hue.draw_image_current_snapshot.click_x.slice(0,e),Hue.draw_image_current_snapshot.click_y=Hue.draw_image_current_snapshot.click_y.slice(0,e),Hue.draw_image_current_snapshot.color_array=Hue.draw_image_current_snapshot.color_array.slice(0,e),Hue.draw_image_current_snapshot.size_array=Hue.draw_image_current_snapshot.size_array.slice(0,e),Hue.draw_image_current_snapshot.drag=Hue.draw_image_current_snapshot.drag.slice(0,e);let a=[];for(let _ of Hue.draw_image_current_snapshot.sectors)_<=e&&a.push(_);Hue.draw_image_current_snapshot.sectors=a;for(let e in Hue.draw_image_snapshots)Hue.draw_image_snapshots[e].level>Hue.draw_image_current_snapshot.level&&delete Hue.draw_image_snapshots[e]},Hue.draw_image_has_levels_above=function(){let e=Hue.draw_image_current_snapshot.level;for(let a in Hue.draw_image_snapshots)if(Hue.draw_image_snapshots[a].level>e)return!0;return!1},Hue.draw_image_check_redo=function(){(Hue.draw_image_current_snapshot.click_x.length!==Hue.draw_image_current_snapshot.sector_index||Hue.draw_image_has_levels_above())&&Hue.draw_image_clean_redo(Hue.draw_image_current_snapshot.sector_index)},Hue.draw_image_get_image_data=function(){let e=Hue.draw_image_context,a=e.canvas.width,_=e.canvas.height;return Hue.draw_image_context.getImageData(0,0,a,_)},Hue.draw_image_check_increase_snapshot=function(){if(Hue.draw_image_current_snapshot.click_x.length===Hue.draw_image_current_snapshot.sector_index&&!Hue.draw_image_has_levels_above()&&Hue.draw_image_current_snapshot.click_x.length>=Hue.draw_image_num_strokes_save){let e=Hue.draw_image_current_snapshot.sectors[Hue.draw_image_current_snapshot.sectors.length-1];Hue.draw_image_clean_redo(e),Hue.increase_draw_image_snapshot(Hue.draw_image_get_image_data())}},Hue.draw_image_add_click=function(e,a,_){Hue.draw_image_check_redo(),Hue.draw_image_current_snapshot.click_x.push(e),Hue.draw_image_current_snapshot.click_y.push(a),Hue.draw_image_current_snapshot.color_array.push(Hue.draw_image_pencil_color),Hue.draw_image_current_snapshot.size_array.push(Hue.draw_image_pencil_size),Hue.draw_image_current_snapshot.drag.push(_),Hue.draw_image_current_snapshot.sector_index=Hue.draw_image_current_snapshot.click_x.length},Hue.upload_draw_image=function(){return Hue.can_images?(0!==Hue.draw_image_current_snapshot.level||0!==Hue.draw_image_current_snapshot.click_x.length)&&void $("#draw_image_area")[0].toBlob(function(e){e.name="draw_image.png",Hue.show_image_upload_comment(e,"image_upload"),Hue.msg_draw_image.close()},"image/png",.95):(Hue.feedback("You don't have permission to change images"),!1)},Hue.clear_draw_image_func=function(){Hue.clear_draw_image_state()},Hue.draw_image_undo=function(){if(Hue.draw_image_current_snapshot.sector_index>0){for(let e of Hue.draw_image_current_snapshot.sectors.slice(0).reverse())if(e<Hue.draw_image_current_snapshot.sector_index){Hue.draw_image_current_snapshot.sector_index=e,Hue.redraw_draw_image();break}}else{let e=Hue.draw_image_current_snapshot.level-1;void 0!==Hue.draw_image_snapshots[`level_${e}`]&&(Hue.draw_image_current_snapshot.sector_index=0,Hue.draw_image_current_snapshot=Hue.draw_image_snapshots[`level_${e}`],Hue.draw_image_current_snapshot.sector_index=Hue.draw_image_current_snapshot.click_x.length,Hue.redraw_draw_image())}},Hue.draw_image_redo=function(){if(Hue.draw_image_current_snapshot.sector_index<Hue.draw_image_current_snapshot.click_x.length){let e=!1;for(let a of Hue.draw_image_current_snapshot.sectors)if(a>Hue.draw_image_current_snapshot.sector_index){Hue.draw_image_current_snapshot.sector_index=a,Hue.redraw_draw_image(),e=!0;break}e||Hue.draw_image_current_snapshot.sector_index!==Hue.draw_image_current_snapshot.click_x.length&&(Hue.draw_image_current_snapshot.sector_index=Hue.draw_image_current_snapshot.click_x.length,Hue.redraw_draw_image())}else{let e=Hue.draw_image_current_snapshot.level+1;void 0!==Hue.draw_image_snapshots[`level_${e}`]&&(Hue.draw_image_current_snapshot.sector_index=Hue.draw_image_current_snapshot.click_x.length,Hue.draw_image_current_snapshot=Hue.draw_image_snapshots[`level_${e}`],Hue.draw_image_current_snapshot.sector_index=0,Hue.redraw_draw_image())}},Hue.draw_image_bucket_fill=function(e,a){let _=Hue.draw_image_context,r=_.canvas.width,t=_.canvas.height,s=Hue.draw_image_get_image_data(),c=s.data,n=[a,e],i=Hue.get_canvas_node_color(c,n,r),o=Hue.colorlib.hex_to_rgb(Hue.draw_image_bucket_color);if(o.push(255),Hue.canvas_node_color_is_equal(i,o))return!1;let u=[];for(c=Hue.set_canvas_node_color(c,n,o,r),u.push(n);u.length;){let e=u.shift();if(e[1]>0){let a=[e[0],e[1]-1],_=Hue.get_canvas_node_color(c,a,r);Hue.canvas_node_color_is_equal(_,i)&&(c=Hue.set_canvas_node_color(c,a,o,r),u.push(a))}if(e[1]<r-1){let a=[e[0],e[1]+1],_=Hue.get_canvas_node_color(c,a,r);Hue.canvas_node_color_is_equal(_,i)&&(c=Hue.set_canvas_node_color(c,a,o,r),u.push(a))}if(e[0]>0){let a=[e[0]-1,e[1]],_=Hue.get_canvas_node_color(c,a,r);Hue.canvas_node_color_is_equal(_,i)&&(c=Hue.set_canvas_node_color(c,a,o,r),u.push(a))}if(e[0]<t-1){let a=[e[0]+1,e[1]],_=Hue.get_canvas_node_color(c,a,r);Hue.canvas_node_color_is_equal(_,i)&&(c=Hue.set_canvas_node_color(c,a,o,r),u.push(a))}}return s.data=c,_.putImageData(s,0,0),s},Hue.get_canvas_node_index=function(e,a,_){return 4*(a[0]*_+a[1])},Hue.get_canvas_node_color=function(e,a,_){let r=Hue.get_canvas_node_index(e,a,_);return[e[r],e[r+1],e[r+2],e[r+3]]},Hue.set_canvas_node_color=function(e,a,_,r){let t=Hue.get_canvas_node_index(e,a,r);return e[t]=_[0],e[t+1]=_[1],e[t+2]=_[2],e[t+3]=_[3],e},Hue.canvas_node_color_is_equal=function(e,a){let _=Math.abs(e[0]-a[0])<=10,r=Math.abs(e[1]-a[1])<=10,t=Math.abs(e[2]-a[2])<=10,s=Math.abs(e[3]-a[3])<=10;return _&&r&&t&&s},Hue.draw_image_change_mode=function(){"pencil"===Hue.draw_image_mode?Hue.set_draw_image_mode_input("bucket"):"bucket"===Hue.draw_image_mode&&Hue.set_draw_image_mode_input("pencil")};
Hue.setup_footer_icons=function(){"disabled"===Hue.room_images_mode?$("#footer_images_controls").css("display","none"):$("#footer_images_controls").css("display","flex"),Hue.can_images?$("#footer_images_icon_container").css("display","flex"):$("#footer_images_icon_container").css("display","none"),"disabled"===Hue.room_tv_mode?$("#footer_tv_controls").css("display","none"):$("#footer_tv_controls").css("display","flex"),Hue.can_tv?$("#footer_tv_icon_container").css("display","flex"):$("#footer_tv_icon_container").css("display","none"),"disabled"===Hue.room_radio_mode?$("#footer_radio_controls").css("display","none"):$("#footer_radio_controls").css("display","flex"),Hue.can_radio?$("#footer_radio_icon_container").css("display","flex"):$("#footer_radio_icon_container").css("display","none")},Hue.setup_footer=function(){$("#footer_images_icon").on("auxclick",function(e){2===e.which&&$("#image_file_picker").click()}),$("#footer_user_menu_container").on("auxclick",function(e){2===e.which&&(Hue.clear_show_reactions_box(),Hue.show_global_settings())}),$("#footer_media_menu_container").on("auxclick",function(e){2===e.which&&Hue.stop_media()}),$("#footer_media_rotate").click(function(){if(Hue.num_media_elements_visible()<2)return!1;Hue.swap_media_layout()}),$("#footer_media_rotate").on("auxclick",function(e){if(Hue.num_media_elements_visible()<2)return!1;2===e.which&&Hue.swap_display_positions_2()}),Hue.horizontal_separator.separate("footer_media_items")},Hue.check_footer_media_rotate=function(){Hue.num_media_elements_visible()<2?$("#footer_media_rotate").addClass("faded"):$("#footer_media_rotate").removeClass("faded")};
Hue.update_header_separators=function(){Hue.horizontal_separator.separate("header_items_inner")},Hue.setup_header=function(){Hue.horizontal_separator.separate("header_radio"),$("#room_menu_icon").on("auxclick",function(e){if(2===e.which){let e=$("#main_container").data("hue_rotated"),a=e?0:180;$("#main_container").css("transform",`rotateY(${a}deg)`),$("#main_container").data("hue_rotated",!Boolean(e))}}),$("#usercount").on("auxclick",function(e){if(2===e.which){let e=Hue.userlist[Hue.utilz.get_random_int(0,Hue.userlist.length-1)];Hue.show_profile(e.username)}}),$("#header_radio_volume_area").on("auxclick",function(e){2===e.which&&(0!==Hue.room_state.radio_volume?Hue.set_radio_volume(0):Hue.set_radio_volume(1))})};
Hue.setup_image=function(e,a={}){let i={};if(i.id=a.id,i.user_id=a.user_id,i.type=a.type,i.source=a.source,i.setter=a.setter,i.size=a.size,i.date=a.date,i.query=a.query,i.comment=a.comment,i.in_log=void 0===a.in_log||a.in_log,i.nice_date=i.date?Hue.utilz.nice_date(i.date):Hue.utilz.nice_date(),i.setter||(i.setter="The system"),i.source||(i.source=Hue.config.default_image_source),i.source.startsWith("/"))i.source=window.location.origin+i.source;else if(i.source.startsWith(window.location.origin)&&!i.size)for(let e of Hue.images_changed)if(e.source===i.source){i.type=e.type,i.size=e.size;break}i.date||(i.date=Date.now());let _=i.id?`${i.id.slice(-3)} | `:"";i.info=`${_}Setter: ${i.setter} | ${i.nice_date}`,i.info_html=`<div>Setter: ${Hue.utilz.make_html_safe(i.setter)}</div><div>${i.nice_date}</div>`,"upload"===i.type&&(i.info+=` | Size: ${Hue.utilz.get_size_string(i.size)}`,i.info_html+=`<div>Size: ${Hue.utilz.get_size_string(i.size)}</div>`),i.query&&(i.info+=` | Search Term: "${i.query}"`,i.info_html+=`<div>Search Term: "${Hue.utilz.make_html_safe(i.query)}"</div>`),i.message=`${i.setter} changed the image`,i.onclick=function(){Hue.show_modal_image(i)},i.message&&(i.message_id=Hue.announce_image(i).message_id),i.setter||(i.info="Default Image"),"change"!==e&&"show"!==e||(Hue.push_images_changed(i),Hue.set_modal_image_number()),"change"===e&&(Hue.room_state.images_locked&&$("#footer_lock_images_icon").addClass("blinking"),Hue.change({type:"image"}))},Hue.announce_image=function(e){return Hue.public_feedback(e.message,{id:e.id,save:!0,brk:"<i class='icon2c fa fa-camera'></i>",date:e.date,username:e.setter,title:e.info,onclick:e.onclick,comment:e.comment,type:"image_change",user_id:e.user_id,in_log:e.in_log})},Hue.push_images_changed=function(e){Hue.images_changed.push(e),Hue.images_changed.length>Hue.config.media_changed_crop_limit&&(Hue.images_changed=Hue.images_changed.slice(Hue.images_changed.length-Hue.config.media_changed_crop_limit)),Hue.after_push_media_change("image",e)},Hue.current_image=function(){return Hue.images_changed.length>0?Hue.images_changed[Hue.images_changed.length-1]:{}},Hue.show_image=function(e=!1){let a=Hue.loaded_image;$("#media_image_frame").attr("crossOrigin","anonymous"),$("#media_image_error").css("display","none"),$("#media_image_frame").css("display","initial"),e||$("#media_image_frame").attr("src")!==a.source?$("#media_image_frame").attr("src",a.source):Hue.after_image_load()},Hue.change_image_source=function(e,a=!1,i=""){let _=!0;if(a&&(_=!1),!Hue.can_images)return _&&Hue.feedback("You don't have permission to change images"),!1;if(!i){let a=Hue.get_media_change_inline_comment("image",e);e=a.source,i=a.comment}if(i.length>Hue.config.max_media_comment_length)return _&&Hue.feedback("Comment is too long"),!1;if(0===e.length)return!1;if((e=Hue.utilz.clean_string2(e)).length>Hue.config.max_media_source_length)return!1;if(e.startsWith("/"))return!1;if(e===Hue.current_image().source||e===Hue.current_image().query)return _&&Hue.feedback("Image is already set to that"),!1;if("default"===e);else if("prev"===e||"previous"===e){if(!(Hue.images_changed.length>1))return _&&Hue.feedback("No image source before current one"),!1;e=Hue.images_changed[Hue.images_changed.length-2].source}else if(Hue.utilz.is_url(e)){if(e=e.replace(/\.gifv/g,".gif"),Hue.check_domain_list("images",e))return _&&Hue.feedback("Image sources from that domain are not allowed"),!1;let a=Hue.utilz.get_extension(e).toLowerCase();if(!a||!Hue.utilz.image_extensions.includes(a))return _&&Hue.feedback("That doesn't seem to be an image"),!1}else{if(e.length>Hue.config.safe_limit_1)return _&&Hue.feedback("Query is too long"),!1;if(!Hue.config.imgur_enabled)return _&&Hue.feedback("Imgur support is not enabled"),!1}if(a)return!0;Hue.emit_change_image_source(e,i)},Hue.emit_change_image_source=function(e,a=""){if(!Hue.can_images)return Hue.feedback("You don't have permission to change images"),!1;Hue.socket_emit("change_image_source",{src:e,comment:a})},Hue.image_prev=function(){Hue.change_image_source("prev"),Hue.msg_image_picker.close()},Hue.fix_image_frame=function(){return!!Hue.images_visible&&(!!$("#media_image_frame")[0].naturalHeight&&void Hue.fix_frame("media_image_frame"))},Hue.toggle_images=function(e,a=!0){void 0!==e?Hue.room_state.images_enabled!==e?Hue.room_state.images_enabled=e:a=!1:Hue.room_state.images_enabled=!Hue.room_state.images_enabled,Hue.images_visible!==e&&Hue.change_images_visibility(),a&&Hue.save_room_state()},Hue.change_images_visibility=function(){if("disabled"!==Hue.room_images_mode&&Hue.room_state.images_enabled)$("#media").css("display","flex"),$("#media_image").css("display","flex"),$("#footer_toggle_images_icon").removeClass("fa-toggle-off"),$("#footer_toggle_images_icon").addClass("fa-toggle-on"),Hue.first_media_change&&Hue.change({type:"image"}),Hue.images_visible=!0,Hue.fix_image_frame();else{$("#media_image").css("display","none"),0===Hue.num_media_elements_visible()&&Hue.hide_media(),$("#footer_toggle_images_icon").removeClass("fa-toggle-on"),$("#footer_toggle_images_icon").addClass("fa-toggle-off"),Hue.images_visible=!1}Hue.tv_visible&&Hue.fix_visible_video_frame(),Hue.check_footer_media_rotate(),Hue.goto_bottom(!1,!1)},Hue.modal_image_prev_click=function(){let e=Hue.images_changed.indexOf(Hue.loaded_modal_image)-1;e<0&&(e=Hue.images_changed.length-1);let a=Hue.images_changed[e];Hue.show_modal_image(a)},Hue.modal_image_next_click=function(e){let a=Hue.images_changed.indexOf(Hue.loaded_modal_image)+1;a>Hue.images_changed.length-1&&(a=0);let i=Hue.images_changed[a];Hue.show_modal_image(i)},Hue.setup_modal_image=function(){let e=$("#modal_image");e[0].addEventListener("load",function(){$("#modal_image_spinner").css("display","none"),$("#modal_image").css("display","block"),Hue.show_modal_image_resolution()}),e.on("error",function(){$("#modal_image_spinner").css("display","none"),$("#modal_image").css("display","none"),$("#modal_image_error").css("display","block")});$("#Msg-window-modal_image")[0].addEventListener("wheel",function(e){if(e.ctrlKey||e.shiftKey)return!1;let a=e.deltaY>0?"down":"up";"up"===a?Hue.modal_image_next_wheel_timer():"down"===a&&Hue.modal_image_prev_wheel_timer()}),$("#modal_image_container").click(function(){Hue.msg_modal_image.close()}),$("#modal_image_header_info").click(function(){Hue.show_media_history("image")}),$("#modal_image_footer_info").click(function(){Hue.show_modal_image_number()}),$("#modal_image_footer_prev").click(function(e){Hue.modal_image_prev_click()}),$("#modal_image_footer_next").click(function(e){Hue.modal_image_next_click()}),$("#modal_image_toolbar_load").click(function(e){let a=Hue.loaded_modal_image;Hue.toggle_images(!0),Hue.change({type:"image",item:a,force:!0}),Hue.toggle_lock_images(!0),Hue.close_all_modals()}),$("#modal_image_toolbar_change").click(function(e){if(confirm("This will change it for everyone. Are you sure?")){let e=Hue.loaded_modal_image;Hue.change_image_source(e.source),Hue.close_all_modals()}})},Hue.show_current_image_modal=function(e=!0){if(e)Hue.show_modal_image(Hue.current_image_data);else if(Hue.images_changed.length>0){let e=Hue.images_changed[Hue.images_changed.length-1];Hue.show_modal_image(e)}},Hue.clear_modal_image_info=function(){$("#modal_image_header_info").html(""),$("#modal_image_footer_info").html("")},Hue.show_modal_image=function(e){if(!e.source)return Hue.images_changed.length>0?(Hue.show_current_image_modal(!1),!1):(Hue.msg_info.show("No image loaded yet"),!1);Hue.loaded_modal_image=e;let a=$("#modal_image");a.css("display","none"),$("#modal_image_spinner").css("display","block"),$("#modal_image_error").css("display","none"),a.attr("src",e.source),$("#modal_image_header_info").html(e.info_html),Hue.horizontal_separator.separate("modal_image_header_info"),e.comment?($("#modal_image_subheader").html(Hue.replace_markdown(Hue.utilz.make_html_safe(e.comment))),$("#modal_image_subheader").css("display","block"),Hue.setup_whispers_click($("#modal_image_subheader"),e.setter)):$("#modal_image_subheader").css("display","none"),"enabled"!==Hue.room_images_mode&&"locked"!==Hue.room_images_mode||e===Hue.loaded_image?$("#modal_image_toolbar_load").css("display","none"):$("#modal_image_toolbar_load").css("display","block"),Hue.change_image_source(e.source,!0)?$("#modal_image_toolbar_change").css("display","flex"):$("#modal_image_toolbar_change").css("display","none"),Hue.horizontal_separator.separate("modal_image_header_info_container"),Hue.msg_modal_image.show(function(){Hue.set_modal_image_number()})},Hue.set_modal_image_number=function(e){if(!Hue.modal_image_open)return!1;let a=Hue.images_changed.indexOf(Hue.loaded_modal_image)+1,i=`${a} of ${Hue.images_changed.length}`;$("#modal_image_footer_info").text(i),a>0?$("#modal_image_number_input").val(a):$("#modal_image_number_input").val(1)},Hue.setup_modal_image_number=function(){$("#modal_image_number_button").click(function(){Hue.modal_image_number_go()}),$("#modal_image_number_input").on("input",function(){let e=parseInt($("#modal_image_number_input").val());e<1?$("#modal_image_number_input").val(Hue.images_changed.length):e===Hue.images_changed.length+1?$("#modal_image_number_input").val(1):e>Hue.images_changed.length&&$("#modal_image_number_input").val(Hue.images_changed.length)})},Hue.show_modal_image_number=function(){Hue.msg_modal_image_number.show(function(){$("#modal_image_number_input").focus(),$("#modal_image_number_input").select()})},Hue.modal_image_number_go=function(){let e=parseInt($("#modal_image_number_input").val()),a=Hue.images_changed[e-1];a&&(Hue.show_modal_image(a),Hue.msg_modal_image_number.close())},Hue.show_modal_image_resolution=function(){let e=$("#modal_image")[0],a=e.naturalWidth,i=e.naturalHeight;e.src===Hue.loaded_modal_image.source&&($("#modal_image_header_info").html(Hue.loaded_modal_image.info_html+`<div>Resolution: ${a} x ${i}</div>`),Hue.horizontal_separator.separate("modal_image_header_info"))},Hue.start_image_events=function(){$("#media_image_frame")[0].addEventListener("load",function(e){Hue.after_image_load()}),$("#media_image_frame").on("error",function(){$("#media_image_frame")[0].hasAttribute("crossOrigin")?($("#media_image_frame").removeAttr("crossOrigin"),$("#media_image_frame").attr("src",$("#media_image_frame").attr("src"))):($("#media_image_frame").css("display","none"),$("#media_image_info").css("display","none"),$("#media_image_error").css("display","initial"))}),$("#media_image_frame").height(0),$("#media_image_frame").width(0)},Hue.after_image_load=function(){Hue.current_image_data=Hue.loaded_image,$("#media_image_info").css("display","initial"),Hue.apply_media_info($("#media_image_info")[0],Hue.loaded_image,"image"),Hue.get_dominant_theme(),Hue.fix_image_frame()},Hue.get_dominant_theme=function(){try{let e=Hue.colorlib.get_dominant($("#media_image_frame")[0],1,!0)[0];e?(Hue.dominant_theme=e,"automatic"===Hue.theme_mode&&Hue.apply_theme()):Hue.dominant_theme=!1}catch(e){Hue.dominant_theme=!1}},Hue.images_is_maximized=function(){return Hue.images_visible&&!Hue.tv_visible},Hue.maximize_images=function(){Hue.images_visible?Hue.tv_visible?Hue.toggle_tv(!1,!1):Hue.toggle_tv(!0,!1):(Hue.toggle_images(!0,!1),Hue.tv_visible&&Hue.toggle_tv(!1,!1)),Hue.save_room_state()},Hue.setup_expand_image=function(){let e=$("#expand_image");e[0].addEventListener("load",function(){e.css("display","block"),$("#expand_image_spinner").css("display","none")}),e.on("error",function(){$("#expand_image_spinner").css("display","none"),$("#expand_image").css("display","none"),$("#expand_image_error").css("display","block")})},Hue.expand_image=function(e){$("#expand_image").css("display","none"),$("#expand_image_spinner").css("display","block"),$("#expand_image_error").css("display","none"),$("#expand_image").attr("src",e),Hue.msg_expand_image.show()},Hue.hide_expand_image=function(){Hue.msg_expand_image.close()},Hue.toggle_lock_images=function(e,a=!0){Hue.room_state.images_locked=void 0!==e?e:!Hue.room_state.images_locked,Hue.change_lock_images(),a&&Hue.save_room_state()},Hue.change_lock_images=function(){Hue.change_media_lock("images")},Hue.fix_images_string=function(e){return"image"===e?"images":e},Hue.refresh_image=function(){Hue.change({type:"image",force:!0,play:!0,current_source:!0})},Hue.show_image_picker=function(){if(!Hue.can_images)return Hue.feedback("You don't have images permission"),!1;Hue.msg_image_picker.show(function(){$("#image_source_picker_input").focus(),Hue.scroll_modal_to_bottom("image_picker")})},Hue.set_room_images_mode=function(e){Hue.room_images_mode=e,Hue.config_admin_room_images_mode()},Hue.announce_room_images_mode_change=function(e){Hue.show_room_notification(e.username,`${e.username} changed the images mode to ${e.what}`),Hue.set_room_images_mode(e.what),Hue.change_images_visibility(),Hue.check_permissions(),Hue.check_media_maxers()},Hue.show_image_upload_comment=function(e,a){$("#image_upload_comment_image_feedback").css("display","none"),$("#image_upload_comment_image_preview").css("display","inline-block");let i=new FileReader;i.onload=function(i){Hue.image_upload_comment_file=e,Hue.image_upload_comment_type=a,$("#image_upload_comment_image_preview").attr("src",i.target.result),Hue.msg_image_upload_comment.set_title(`${Hue.utilz.slice_string_end(e.name,20)} (${Hue.utilz.get_size_string(e.size,2)})`),$("#Msg-titlebar-image_upload_comment").attr("title",e.name),Hue.msg_image_upload_comment.show(function(){$("#image_upload_comment_submit").click(function(){Hue.process_image_upload_comment()}),$("#image_upload_comment_input").focus(),Hue.scroll_modal_to_bottom("image_upload_comment")})},i.readAsDataURL(e)},Hue.setup_image_upload_comment=function(){$("#image_upload_comment_image_preview").on("error",function(){$(this).css("display","none"),$("#image_upload_comment_image_feedback").css("display","inline")})},Hue.process_image_upload_comment=function(){if(!Hue.image_upload_comment_open)return!1;Hue.image_upload_comment_open=!1;let e=Hue.image_upload_comment_file,a=Hue.image_upload_comment_type,i=Hue.utilz.clean_string2($("#image_upload_comment_input").val());if(i.length>Hue.config.max_media_comment_length)return!1;Hue.upload_file({file:e,action:a,comment:i}),Hue.msg_image_upload_comment.close()},Hue.change_room_images_mode=function(e){if(!Hue.is_admin_or_op(Hue.role))return Hue.not_an_op(),!1;let a=["enabled","disabled","locked"];return a.includes(e)?e===Hue.room_images_mode?(Hue.feedback("Images mode is already set to that"),!1):void Hue.socket_emit("change_images_mode",{what:e}):(Hue.feedback(`Valid images modes: ${a.join(" ")}`),!1)},Hue.setup_image_picker=function(){$("#image_source_picker_input").on("input",function(){Hue.check_image_picker()}),Hue.check_image_picker()},Hue.check_image_picker=function(e){$("#image_source_picker_input").val().trim().length>0?($("#image_file_picker").css("display","none"),$("#image_picker_submit").css("display","inline-block")):($("#image_file_picker").css("display","inline-block"),$("#image_picker_submit").css("display","none"))},Hue.image_picker_submit=function(){let e=$("#image_source_picker_input").val().trim();""!==e&&(Hue.change_image_source(e),Hue.msg_image_picker.close())};
Hue.show_infotip=function(i){$("#infotip").text(i),$("#infotip_container").css("display","block"),Hue.infotip_timer()},Hue.hide_infotip=function(){$("#infotip_container").css("display","none")};
Hue.input_is_scrolled=function(){let e=$("#input")[0];return e.clientHeight<e.scrollHeight},Hue.setup_input=function(){$("#input").on("input",function(){let e=$("#input").val();(e=Hue.utilz.clean_string9(e)).length>Hue.config.max_input_length&&(e=e.substring(0,Hue.config.max_input_length),Hue.change_input(e)),Hue.old_input_val!==e&&(Hue.input_changed=!0,Hue.check_typing(),Hue.old_input_val=e)}),$("#input").on("click",function(){Hue.editing_message&&Hue.stop_edit_message()}),$("#input").on("focus",function(){Hue.context_menu_open&&$(".context-menu-list").trigger("contextmenu:hide")}),Hue.old_input_val=$("#input").val(),Hue.input_tag_scroll_height=$("#input")[0].scrollHeight,computedVariables("--expand",(e,t,u)=>(Hue.input_tag_scroll_height!==u.scrollHeight&&($("#footer").css("height",$("#footer").height()),u.style.height="auto",Hue.input_tag_scroll_height=u.scrollHeight,u.style.height="",$("#footer").css("height","auto")),Hue.input_tag_scroll_height+"px"),"#input",["input","paste","blur","reprocess"],{afterChange:function(e){Hue.last_input_height&&Hue.last_input_height!==e&&Hue.resize_timer(),Hue.last_input_height=e}}),Hue.reprocess_input()},Hue.reprocess_input=function(){$("#input")[0].dispatchEvent(new Event("reprocess"))},Hue.setup_input_placeholder=function(){Hue.get_setting("show_input_placeholder")?(clearInterval(Hue.update_input_placeholder_interval),Hue.update_input_placeholder(),Hue.get_setting("show_clock_in_input_placeholder")&&(Hue.update_input_placeholder_interval=setInterval(function(){Hue.update_input_placeholder()},Hue.update_input_placeholder_delay))):(clearInterval(Hue.update_input_placeholder_interval),$("#input").attr("placeholder",""))},Hue.update_input_placeholder=function(){let e,t=`Hi ${Hue.username}, write something to ${Hue.room_name}`;e=Hue.get_setting("show_clock_in_input_placeholder")?`(${Hue.utilz.clock_time()})  ${t}`:t,$("#input").attr("placeholder",e)},Hue.input_oversized_active=function(){let e=$("#input")[0];return document.activeElement===e&&e.clientHeight<e.scrollHeight},Hue.clear_input=function(){Hue.change_input(""),Hue.old_input_val=""},Hue.add_to_input=function(e){Hue.change_input(`${$("#input").val()+e}`)},Hue.change_input=function(e,t=!0,u=!0){$("#input").val(e),t&&Hue.input_to_end(),u&&Hue.focus_input(),Hue.reprocess_input()},Hue.focus_input=function(){if(Hue.modal_open)return!1;$("#input").focus()},Hue.blur_input=function(){$("#input").blur()},Hue.input_to_end=function(){$("#input")[0].scrollLeft=$("#input")[0].scrollWidth},Hue.add_linebreak_to_input=function(){Hue.add_to_input("\n"),Hue.scroll_input_to_bottom()},Hue.scroll_input_to_bottom=function(){let e=$("#input")[0];e.scrollTop=e.scrollHeight},Hue.input_command=function(e){e=e.replace(/\s\/endinput/gi,""),Hue.change_input(e)};
Hue.add_to_input_history=function(t,i=!0){for(let i=0;i<Hue.input_history.length;i++)if(Hue.input_history[i].message===t){Hue.input_history.splice(i,1);break}let e={message:t,date:Date.now()};Hue.input_history.push(e),Hue.input_history.length>Hue.config.input_history_crop_limit&&(Hue.input_history=Hue.input_history.slice(Hue.input_history.length-Hue.config.input_history_crop_limit)),i&&Hue.reset_input_history_index(),Hue.save_input_history()},Hue.save_input_history=function(){Hue.save_local_storage(Hue.ls_input_history,Hue.input_history)},Hue.get_input_history=function(){Hue.input_history=Hue.get_local_storage(Hue.ls_input_history),null===Hue.input_history&&(Hue.input_history=[]),Hue.reset_input_history_index()},Hue.reset_input_history_index=function(){Hue.input_history_index=Hue.input_history.length},Hue.input_history_change=function(t){if(0===Hue.input_history.length)return!1;if(Hue.input_changed){Hue.input_changed=!1;let i=$("#input").val().trim();""!==i&&(Hue.add_to_input_history(i,!1),Hue.input_history_index="up"===t?Hue.input_history.length-1:Hue.input_history.length)}let i;if("up"===t){if(Hue.input_history_index-=1,-2===Hue.input_history_index)Hue.input_history_index=Hue.input_history.length-1;else if(-1===Hue.input_history_index)return void Hue.change_input("");i=Hue.input_history[Hue.input_history_index].message}else{if(Hue.input_history_index<0)return void Hue.change_input("");if(Hue.input_history_index+=1,Hue.input_history_index>Hue.input_history.length-1)return Hue.change_input(""),Hue.reset_input_history_index(),!1;if(Hue.input_history_index>=Hue.input_history.length)return Hue.change_input(""),void Hue.reset_input_history_index();i=Hue.input_history[Hue.input_history_index].message}Hue.change_input(i)},Hue.setup_input_history=function(){$("#input_history_container").on("click",".input_history_item",function(){0===$(this).find("a").length&&(Hue.change_input($(this).text()),Hue.close_all_modals())}),$("#input_history_clear_icon").click(function(){confirm("Are you sure you want to clear the input history?")&&(Hue.clear_input_history(),Hue.show_input_history())})},Hue.clear_input_history=function(){Hue.input_history=[],Hue.save_input_history()},Hue.show_input_history=function(t=!1){t&&(t=t.trim());let i,e,u=t||"";if($("#input_history_container").html(""),$("#input_history_filter").val(u),$("#input_history_container").html(""),t){let e=Hue.utilz.clean_string2(t).toLowerCase();i=e.split(" ").filter(t=>""!==t.trim())}e=t?Hue.input_history.filter(function(t){let e=t.message.toLowerCase();return i.some(t=>e.includes(t))}):Hue.input_history;for(let t of e){let i=$("<div class='modal_item input_history_item dynamic_title action pointer'></div>"),e=Hue.utilz.nice_date(t.date);i.attr("title",e),i.data("otitle",e),i.data("date",t.date),i.text(t.message),$("#input_history_container").prepend(i)}Hue.input_history.length>0?$("#input_history_clear_icon").removeClass("inactive"):$("#input_history_clear_icon").addClass("inactive"),Hue.msg_input_history.show(function(){Hue.scroll_modal_to_top("input_history")})};
Hue.execute_javascript=function(arg,show_result=!0){let r;arg=arg.replace(/\s\/endjs/gi,"");try{if(r=eval(arg),"number"==typeof r)try{r=Hue.utilz.round(r,2)}catch(r){}try{r=JSON.stringify(r)}catch(e){r="Done"}}catch(e){r="Error"}if(show_result){let e=Hue.make_safe({text:arg}),t=function(){Hue.msg_info2.show(["Executed Javascript",e])};Hue.feedback(`js: ${r}`,{onclick:t})}};
Hue.activate_key_detection=function(){document.addEventListener("keydown",e=>{if(Hue.started){if("Tab"===e.key&&e.preventDefault(),Hue.utilz.is_textbox(document.activeElement)&&document.activeElement.value.trim()||void 0!==Hue.keys_pressed[e.keyCode]||e.repeat?Hue.reset_double_tap_keys_pressed():(Hue.keys_pressed[e.keyCode]=!0,1===Object.keys(Hue.keys_pressed).length?e.key===Hue.config.double_tap_key?(Hue.double_tap_key_pressed+=1,2===Hue.double_tap_key_pressed?Hue.on_double_tap():Hue.double_tap_timer()):e.key===Hue.config.double_tap_key_2?(Hue.double_tap_key_2_pressed+=1,2===Hue.double_tap_key_2_pressed?Hue.on_double_tap_2():Hue.double_tap_2_timer()):e.key===Hue.config.double_tap_key_3?(Hue.double_tap_key_3_pressed+=1,2===Hue.double_tap_key_3_pressed?Hue.on_double_tap_3():Hue.double_tap_3_timer()):Hue.reset_double_tap_keys_pressed():Hue.reset_double_tap_keys_pressed()),Hue.modal_open)return"Escape"===e.key&&e.shiftKey?(Hue.close_all_modals(),void e.preventDefault()):Hue.image_picker_open&&Hue.msg_image_picker.is_highest()?void("Enter"===e.key?(Hue.image_picker_submit(),e.preventDefault()):"Tab"===e.key&&(Hue.do_media_picker_input_cycle("image"),e.preventDefault())):Hue.tv_picker_open&&Hue.msg_tv_picker.is_highest()?void("Enter"===e.key?(Hue.tv_picker_submit(),e.preventDefault()):"Tab"===e.key&&(Hue.do_media_picker_input_cycle("tv"),e.preventDefault())):Hue.radio_picker_open&&Hue.msg_radio_picker.is_highest()?void("Enter"===e.key?(Hue.radio_picker_submit(),e.preventDefault()):"Tab"===e.key&&(Hue.do_media_picker_input_cycle("radio"),e.preventDefault())):(Hue.image_upload_comment_open&&Hue.msg_image_upload_comment.is_highest()&&"Enter"===e.key&&(Hue.process_image_upload_comment(),e.preventDefault()),Hue.open_room_open&&Hue.msg_info2.is_highest()?void("Enter"===e.key&&(e.shiftKey?$("#open_room_here").trigger("click"):$("#open_room_new_tab").trigger("click"),e.preventDefault())):Hue.background_image_input_open&&Hue.msg_info2.is_highest()?void("Enter"===e.key&&(Hue.background_image_input_action(),e.preventDefault())):Hue.create_room_open&&Hue.msg_info2.is_highest()?void("Enter"===e.key&&(Hue.create_room_submit(),e.preventDefault())):Hue.import_settings_open&&Hue.msg_info2.is_highest()?void("Enter"===e.key&&(Hue.process_imported_settings(),e.preventDefault())):Hue.goto_room_open&&Hue.msg_info2.is_highest()?void("Enter"===e.key&&(Hue.goto_room_action(),e.preventDefault())):Hue.writing_message&&Hue.msg_message.is_highest()?void("Enter"!==e.key||e.shiftKey||(Hue.send_popup_message(),e.preventDefault())):Hue.writing_message_board_post&&Hue.msg_message_board.is_highest()?void("Enter"!==e.key||e.shiftKey||(Hue.submit_message_board_post(),e.preventDefault())):Hue.modal_image_open&&Hue.msg_modal_image.is_highest()?("ArrowLeft"===e.key?(Hue.modal_image_prev_click(),e.preventDefault()):"ArrowRight"===e.key?(Hue.modal_image_next_click(),e.preventDefault()):"ArrowUp"===e.key?(Hue.modal_image_next_click(),e.preventDefault()):"ArrowDown"===e.key&&(Hue.modal_image_prev_click(),e.preventDefault()),"Enter"===e.key&&(Hue.show_media_history("image"),e.preventDefault()),void(" "===e.key&&(Hue.show_modal_image_number(),e.preventDefault()))):(Hue.draw_image_open&&(" "===e.key&&Hue.draw_image_change_mode(),"z"===e.key&&e.ctrlKey&&Hue.draw_image_undo(),"y"===e.key&&e.ctrlKey&&Hue.draw_image_redo()),Hue.modal_image_number_open&&"Enter"===e.key&&Hue.modal_image_number_go(),Hue.writing_reply&&Hue.msg_reply.is_highest()?void("Enter"!==e.key||e.shiftKey||(Hue.submit_reply(),e.preventDefault())):Hue.change_user_username_open&&Hue.msg_info2.is_highest()?void("Enter"!==e.key||e.shiftKey||(Hue.submit_change_username(),e.preventDefault())):Hue.change_user_password_open&&Hue.msg_info2.is_highest()?void("Enter"!==e.key||e.shiftKey||(Hue.submit_change_password(),e.preventDefault())):Hue.change_user_email_open&&Hue.msg_info2.is_highest()?void("Enter"!==e.key||e.shiftKey||(Hue.submit_change_email(),e.preventDefault())):void 0));if(Hue.editing_message){if(Hue.focus_edit_area(),"Enter"!==e.key||e.shiftKey){if("Escape"===e.key)Hue.stop_edit_message(),e.preventDefault();else if("ArrowUp"===e.key){Hue.handle_edit_direction()&&e.preventDefault()}else if("ArrowDown"===e.key){Hue.handle_edit_direction(!0)&&e.preventDefault()}}else Hue.send_edit_messsage(),e.preventDefault();return!1}if(Hue.synth_open&&Hue.synth_voice_input_focused)return"Enter"===e.key&&Hue.send_synth_voice(),"Escape"===e.key&&($("#synth_voice_input").val()?Hue.clear_synth_voice():Hue.hide_synth(!0)),!1;if(e.ctrlKey&&""!==window.getSelection().toString()||Hue.focus_input(),"Enter"===e.key)return e.shiftKey?Hue.add_linebreak_to_input():0===$("#input").val().length?Hue.goto_bottom(!0):Hue.process_message({message:$("#input").val()}),void e.preventDefault();if("ArrowUp"!==e.key){if("ArrowDown"!==e.key)return"PageUp"===e.key?(e.shiftKey?Hue.goto_top():Hue.scroll_up(Hue.config.big_keyboard_scroll),void e.preventDefault()):"PageDown"===e.key?(e.shiftKey?Hue.goto_bottom(!0):Hue.scroll_down(Hue.config.big_keyboard_scroll),void e.preventDefault()):"Escape"!==e.key||e.shiftKey?void 0:($("#input").val().length>0?(Hue.clear_input(),Hue.reset_input_history_index()):Hue.goto_bottom(!0,!0),Hue.hide_reactions_box(),void e.preventDefault());if(Hue.input_oversized_active()&&!e.shiftKey)return;e.shiftKey?(Hue.input_history_change("down"),e.preventDefault()):e.ctrlKey?(Hue.scroll_down(Hue.config.small_keyboard_scroll),e.preventDefault()):Hue.goto_bottom(!0,!0)}else{if(Hue.input_oversized_active()&&!e.shiftKey)return;e.shiftKey?(Hue.input_history_change("up"),e.preventDefault()):e.ctrlKey?(Hue.scroll_up(Hue.config.small_keyboard_scroll),e.preventDefault()):Hue.edit_last_message()}}}),document.addEventListener("keyup",e=>{Hue.started&&delete Hue.keys_pressed[e.keyCode]}),document.addEventListener("input",e=>{if(Hue.modal_open&&Hue.active_modal){if("manual"===$(e.target).data("mode"))return!1;Hue.do_modal_filter_timer()}})},Hue.reset_double_tap_keys_pressed=function(){Hue.double_tap_key_pressed=0,Hue.double_tap_key_2_pressed=0,Hue.double_tap_key_3_pressed=0},Hue.on_double_tap=function(){Hue.execute_commands("double_tap")},Hue.on_double_tap_2=function(){Hue.execute_commands("double_tap_2")},Hue.on_double_tap_3=function(){Hue.execute_commands("double_tap_3")};
Hue.get_local_storage=function(e){let t;if(localStorage[e])try{t=JSON.parse(localStorage.getItem(e))}catch(o){localStorage.removeItem(e),t=null}else t=null;return t},Hue.save_local_storage=function(e,t,o=!1){Hue.local_storage_to_save[e]=t,o?Hue.do_save_local_storage():Hue.save_local_storage_timer()},Hue.do_save_local_storage=function(){for(let e in Hue.local_storage_to_save){let t=Hue.local_storage_to_save[e];t=JSON.stringify(t),localStorage.setItem(e,t)}Hue.local_storage_to_save={}},Hue.remove_local_storage=function(e){localStorage.removeItem(e)},Hue.setup_local_storage=function(){window.addEventListener("storage",function(e){if(e.key!==Hue.ls_global_settings&&e.key!==Hue.ls_room_settings&&e.key!==Hue.ls_last_message_board_post_checked)return!1;let t;try{t=JSON.parse(e.newValue)}catch(e){return!1}if(Hue.utilz.is_empty_object(t))return!1;e.key===Hue.ls_global_settings?Hue.reset_settings("global_settings",!1):e.key===Hue.ls_room_settings?e.url===document.location.href&&Hue.reset_settings("room_settings",!1):e.key===Hue.ls_last_message_board_post_checked&&(Hue.get_last_message_board_post_checked(),Hue.check_last_message_board_post())},!1)};
Hue.start_locked_mode=function(){$("#header").css("display","none"),$("#footer").css("display","none"),Hue.show_locked_menu(),Hue.make_main_container_visible()},Hue.show_locked_menu=function(){Hue.msg_locked.show()};
Hue.setup_lockscreen=function(){$("#lockscreen_title_menu").on("mouseenter",function(){Hue.lockscreen_peek_timeout=setTimeout(function(){$("#Msg-container-lockscreen").css("opacity",.2),Hue.lockscreen_peek_active=!0},Hue.lockscreen_peek_delay)}),$("#lockscreen_title_menu").on("mouseleave",function(){clearTimeout(Hue.lockscreen_peek_timeout),Hue.lockscreen_peek_active&&($("#Msg-container-lockscreen").css("opacity",1),$("#lockscreen_title_info").text("")),Hue.lockscreen_peek_active=!1}),Hue.setup_lockscreen_clock()},Hue.setup_lockscreen_clock=function(){Hue.get_setting("show_clock_in_lockscreen")?$("#lockscreen_clock").css("display","block"):$("#lockscreen_clock").css("display","none")},Hue.lock_screen=function(e=!0){if(Hue.screen_locked)return!1;Hue.room_state.screen_locked=!0,Hue.screen_locked=!0,Hue.process_lockscreen_lights_off(),Hue.msg_lockscreen.show(),Hue.get_setting("afk_on_lockscreen")&&(Hue.afk=!0,Hue.app_focused=!1),Hue.execute_commands("on_lockscreen"),e&&Hue.save_room_state(),$("#lockscreen_clock").text(Hue.utilz.clock_time()),Hue.get_setting("show_clock_in_lockscreen")&&(Hue.lockscreen_clock_interval=setInterval(function(){$("#lockscreen_clock").text(Hue.utilz.clock_time())},Hue.update_lockscreen_clock_delay))},Hue.unlock_screen=function(e=!0){if(!Hue.screen_locked)return!1;clearTimeout(Hue.lockscreen_peek_timeout),clearInterval(Hue.lockscreen_clock_interval),Hue.room_state.screen_locked=!1,Hue.screen_locked=!1,Hue.msg_lockscreen.close(),Hue.process_visibility(),Hue.execute_commands("on_unlockscreen"),$("#lockscreen_title_info").text(""),e&&Hue.save_room_state()},Hue.lockscreen_turn_lights_off=function(){$("#lockscreen_body").addClass("black_background_color"),$("#lockscreen_title_menu").addClass("black_background_color"),$("#lockscreen_principal").addClass("grey_font_color"),$("#lockscreen_lights_off_button").addClass("grey_font_color"),$("#lockscreen_icon_menu").addClass("grey_background_color_parent"),$("#lockscreen_lights_off_button").text("Turn Lights On"),$("#lockscreen_clock").addClass("grey_font_color")},Hue.lockscreen_turn_lights_on=function(){$("#lockscreen_body").removeClass("black_background_color"),$("#lockscreen_title_menu").removeClass("black_background_color"),$("#lockscreen_lights_off_button").text("Turn Lights Off"),$("#lockscreen_principal").removeClass("grey_font_color"),$("#lockscreen_clock").removeClass("grey_font_color"),$("#lockscreen_lights_off_button").removeClass("grey_font_color"),$("#lockscreen_icon_menu").removeClass("grey_background_color_parent")},Hue.check_lockscreen_activity=function(){Hue.room_state.screen_locked&&($("#lockscreen_title_info").text()||$("#lockscreen_title_info").text("(New Activity)"))},Hue.check_screen_lock=function(){Hue.room_state.screen_locked&&Hue.lock_screen(!1)},Hue.toggle_lockscreen_lights_off=function(){Hue.room_state.lockscreen_lights_off=!Hue.room_state.lockscreen_lights_off,Hue.process_lockscreen_lights_off(),Hue.save_room_state()},Hue.process_lockscreen_lights_off=function(){Hue.room_state.lockscreen_lights_off?Hue.lockscreen_turn_lights_off():Hue.lockscreen_turn_lights_on()};
Hue.do_math_calculation=async function(e){if(!e)return Hue.feedback("You must provide a math calculation"),!1;if(void 0===Hue.math){if(Hue.math_loading)return!1;Hue.math_loading=!0,await Hue.load_script("/static/js/libs2/math.min.js"),Hue.math=math.create({number:"BigNumber",precision:64})}let a;try{a=Hue.math.round(Hue.math.eval(e),Hue.calc_round_places).toString()}catch(e){return Hue.feedback("Error"),!1}let t=`${e} = **${a}**`,c=`calc_${Date.now()}`;Hue.feedback(t,{comment:"Make Public",comment_icon:!1,comment_onclick:function(){Hue.process_message({message:t,to_history:!1,callback:function(e){e&&($(`#${c}`).remove(),Hue.goto_bottom(!1,!1))}})},replace_markdown:!0,container_id:c})};
Hue.after_push_media_change=function(e,i){Hue.show_media_history_type&&Hue.prepend_to_media_history(i.message_id)},Hue.apply_media_percentages=function(){let e=Hue.get_setting("media_layout"),i=Hue.get_setting("tv_display_percentage"),t=100-i;"column"===e?($("#media_tv").css("height",`${i}%`),$("#media_image").css("height",`${t}%`),$("#media_tv").css("width","100%"),$("#media_image").css("width","100%")):"row"===e&&($("#media_tv").css("width",`${i}%`),$("#media_image").css("width",`${t}%`),$("#media_tv").css("height","100%"),$("#media_image").css("height","100%"));let _=Hue.get_setting("chat_display_percentage"),a=100-_;$("#chat_main").css("width",`${_}%`),$("#media").css("width",`${a}%`),Hue.on_resize()},Hue.apply_media_positions=function(){let e,i,t=Hue.get_setting("tv_display_position");"top"===t?(e=1,i=2):"bottom"===t&&(e=2,i=1),$("#media_image").css("order",i),$("#media_tv").css("order",e)},Hue.swap_display_positions=function(){let e=Hue.active_settings("tv_display_position");Hue[e].tv_display_position="top"===Hue[e].tv_display_position?"bottom":"top",Hue[`save_${e}`](),Hue.apply_media_positions()},Hue.swap_display_positions_2=function(){Hue.enable_setting_override("tv_display_position"),Hue.swap_display_positions()},Hue.arrange_media_setting_display_positions=function(e){let i,t,_=Hue[e].tv_display_position;"top"===_?(i=1,t=2):"bottom"===_&&(i=2,t=1),$(`#${e}_display_position_image`).css("order",t),$(`#${e}_display_position_tv`).css("order",i)},Hue.check_media_menu_loaded_media=function(){Hue.media_menu_open&&Hue.update_media_menu_loaded_media()},Hue.update_media_menu_loaded_media=function(){let e=Hue.get_loaded_media_messages();for(let i of Hue.utilz.media_types)e[i]?$(`#media_menu_loaded_${i}`).html(e[i]):$(`#media_menu_loaded_${i}`).html("");$("#media_menu_loaded_media").html()},Hue.show_media_menu=function(){Hue.update_media_menu_loaded_media(),Hue.msg_media_menu.show()},Hue.hide_media_menu=function(){Hue.msg_media_menu.close()},Hue.stop_media=function(){Hue.stop_tv(),Hue.stop_radio()},Hue.stop_and_lock=function(e=!0){e&&Hue.stop_media(),Hue.toggle_lock_images(!0,!1),Hue.toggle_lock_tv(!0,!1),Hue.toggle_lock_radio(!0,!1),Hue.save_room_state()},Hue.default_media_state=function(e=!0){Hue.room_state.images_locked!==Hue.config.room_state_default_images_locked&&Hue.toggle_lock_images(Hue.config.room_state_default_images_locked,!1),Hue.room_state.tv_locked!==Hue.config.room_state_default_tv_locked&&Hue.toggle_lock_tv(Hue.config.room_state_default_tv_locked,!1),Hue.room_state.radio_locked!==Hue.config.room_state_default_radio_locked&&Hue.toggle_lock_radio(Hue.config.room_state_default_radio_locked,!1),e&&(Hue.room_state.images_enabled!==Hue.config.room_state_default_images_enabled&&Hue.toggle_images(Hue.config.room_state_default_images_enabled,!1),Hue.room_state.tv_enabled!==Hue.config.room_state_default_tv_enabled&&Hue.toggle_tv(Hue.config.room_state_default_tv_enabled,!1),Hue.room_state.radio_enabled!==Hue.config.room_state_default_radio_enabled&&Hue.toggle_radio(Hue.config.room_state_default_radio_enabled,!1)),Hue.save_room_state()},Hue.start_active_media=function(){Hue.change({type:"image"}),Hue.change({type:"tv"}),Hue.change({type:"radio"}),Hue.first_media_change=!0},Hue.maxers_mouse_events=function(){let e=function(e){if(e.ctrlKey)return!1;if(!e.shiftKey)return!1;let i=!1;1===Hue.num_media_elements_visible()&&(i=!0);let t,_=e.deltaY>0?"down":"up";if("media_image_maxer"===e.target.id)t=$("#media_image")[0];else if("media_tv_maxer"===e.target.id)t=$("#media_tv")[0];else{if("footer_media_rotate_icon"!==e.target.id)return!1;t=$("#media_tv")[0]}if("up"===_){if(i){if(Hue.tv_is_maximized()){"top"===Hue.get_setting("tv_display_position")?(Hue.do_media_tv_size_change(90),Hue.unmaximize_media()):(Hue.swap_display_positions_2(),Hue.do_media_tv_size_change(90),Hue.unmaximize_media())}else if(Hue.images_is_maximized()){"bottom"===Hue.get_setting("tv_display_position")?(Hue.do_media_tv_size_change(10),Hue.unmaximize_media()):(Hue.swap_display_positions_2(),Hue.do_media_tv_size_change(10),Hue.unmaximize_media())}return}1==t.style.order?"media_tv"===t.id?Hue.maxer_wheel_timer(Hue.decrease_tv_percentage):"media_image"===t.id&&Hue.maxer_wheel_timer(Hue.increase_tv_percentage):2==t.style.order&&("media_image"===t.id?Hue.maxer_wheel_timer(Hue.decrease_tv_percentage):"media_tv"===t.id&&Hue.maxer_wheel_timer(Hue.increase_tv_percentage))}else if("down"===_){if(i){if(Hue.tv_is_maximized()){"bottom"===Hue.get_setting("tv_display_position")?(Hue.do_media_tv_size_change(90),Hue.unmaximize_media()):(Hue.swap_display_positions_2(),Hue.do_media_tv_size_change(90),Hue.unmaximize_media())}else if(Hue.images_is_maximized()){"top"===Hue.get_setting("tv_display_position")?(Hue.do_media_tv_size_change(10),Hue.unmaximize_media()):(Hue.swap_display_positions_2(),Hue.do_media_tv_size_change(10),Hue.unmaximize_media())}return}1==t.style.order?"media_tv"===t.id?Hue.maxer_wheel_timer(Hue.increase_tv_percentage):"media_image"===t.id&&Hue.maxer_wheel_timer(Hue.decrease_tv_percentage):2==t.style.order&&("media_image"===t.id?Hue.maxer_wheel_timer(Hue.increase_tv_percentage):"media_tv"===t.id&&Hue.maxer_wheel_timer(Hue.decrease_tv_percentage))}};$("#media_tv_maxer")[0].addEventListener("wheel",e),$("#media_image_maxer")[0].addEventListener("wheel",e),$("#footer_media_rotate")[0].addEventListener("wheel",e);$("#media_image_maxer")[0].addEventListener("mousedown",function(e){e.preventDefault()}),$("#media_image_maxer")[0].addEventListener("dblclick",function(e){Hue.maximize_images()}),$("#media_tv_maxer")[0].addEventListener("mousedown",function(e){e.preventDefault()}),$("#media_tv_maxer")[0].addEventListener("dblclick",function(e){Hue.maximize_tv()}),$("#chat_maxer")[0].addEventListener("wheel",function(e){if(e.ctrlKey)return!1;if(!e.shiftKey)return!1;let i=!1;0===Hue.num_media_elements_visible()&&(i=!0);let t=e.deltaY>0?"down":"up";if("up"===t){if(i)return;Hue.maxer_wheel_timer(Hue.increase_chat_percentage)}else if("down"===t){if(i)return Hue.do_chat_size_change(90),void Hue.show_media_items();Hue.maxer_wheel_timer(Hue.decrease_chat_percentage)}}),$("#chat_maxer")[0].addEventListener("mousedown",function(e){e.preventDefault()}),$("#chat_maxer")[0].addEventListener("dblclick",function(e){Hue.toggle_media()}),$("#media_image_maxer").on("auxclick",function(e){2===e.which&&(Hue.unmaximize_media(),Hue.set_default_tv_size())}),$("#media_tv_maxer").on("auxclick",function(e){2===e.which&&(Hue.unmaximize_media(),Hue.set_default_tv_size())}),$("#chat_maxer").on("auxclick",function(e){2===e.which&&(Hue.set_default_chat_size(),Hue.show_media_items())})},Hue.set_default_chat_size=function(){Hue.do_chat_size_change(Hue.config.global_settings_default_chat_display_percentage)},Hue.unmaximize_media=function(){Hue.tv_is_maximized()?Hue.maximize_tv():Hue.images_is_maximized()&&Hue.maximize_images()},Hue.increase_chat_percentage=function(){let e=parseInt(Hue.get_setting("chat_display_percentage"));e+=10,e=Hue.utilz.round2(e,10),Hue.enable_setting_override("chat_display_percentage"),Hue.do_chat_size_change(e)},Hue.decrease_chat_percentage=function(){let e=parseInt(Hue.get_setting("chat_display_percentage"));e-=10,e=Hue.utilz.round2(e,10),Hue.enable_setting_override("chat_display_percentage"),Hue.do_chat_size_change(e)},Hue.remove_item_from_media_changed=function(e,i){let t=e;"image"===e&&(t="images"),Hue[`${t}_changed`]=Hue[`${t}_changed`].filter(e=>e.id!==i)},Hue.do_media_picker_input_cycle=function(e){if(Hue.just_tabbed)return!1;document.activeElement===$(`#${e}_source_picker_input`)[0]?$(`#${e}_source_picker_input_comment`).focus():(document.activeElement,$("#image_source_picker_input_comment")[0],$(`#${e}_source_picker_input`).focus())},Hue.num_media_elements_visible=function(){let e=0;return $("#media_split").children().each(function(){"none"!==$(this).css("display")&&(e+=1)}),e},Hue.media_lock_valve=function(e,i){return 2===i.which&&(!!Hue.room_state[`${e}_locked`]&&(Hue[`toggle_lock_${e}`](),void Hue[`toggle_lock_${e}`]()))},Hue.media_load_next=function(e,i=!1){let t=e;if("images"===e&&(t="image"),Hue[`${e}_changed`].length<2)return!1;let _=Hue[`${e}_changed`].indexOf(Hue[`loaded_${t}`]);if(_<0)return!1;if(_>=Hue[`${e}_changed`].length-1)return!1;if(i)return!0;let a=Hue[`${e}_changed`][_+1];Hue.change({type:t,item:a,force:!0}),Hue[`toggle_lock_${e}`](!0)},Hue.media_load_previous=function(e,i=!1){let t=e;if("images"===e&&(t="image"),Hue[`${e}_changed`].length<2)return!1;let _=Hue[`${e}_changed`].indexOf(Hue[`loaded_${t}`]);if(_<=0)return!1;if(i)return!0;let a=Hue[`${e}_changed`][_-1];Hue.change({type:t,item:a,force:!0}),Hue[`toggle_lock_${e}`](!0)},Hue.update_media_history_blinks=function(){if(!Hue.started||!Hue.show_media_history_type)return!1;let e=Hue.show_media_history_type,i=Hue[`loaded_${e}`];$(`#${e}_history_container`).find(".message").each(function(){$(this).removeClass("blinking_2")}),i?$(`#${e}_history_container .message_id_${i.message_id}`).eq(0).addClass("blinking_2"):$(`#${e}_history_container`).find(".message").first().addClass("blinking_2")},Hue.get_media_change_inline_comment=function(e,i){let t=$(`#${e}_source_picker_input_comment`).val();if(t);else if(i.includes(">")){let e=i.split(">");i=e[0].trim(),t=e.slice(1).join(">").trim()}else{let e=i.split(" "),_="",a=[];for(let i of e)Hue.utilz.is_url(i)?_||(_=i):a.push(i);_&&a.length>0&&(i=_,t=a.join(" "))}return{source:i,comment:t}},Hue.get_media_object_from_init_data=function(e){let i={};for(let t in Hue.init_data)t.startsWith(`${e}_`)&&(i[t.replace(`${e}_`,"")]=Hue.init_data[t]);return i},Hue.hide_media=function(){Hue.stop_tv(),$("#media").css("display","none")},Hue.toggle_media=function(){Hue.tv_visible||Hue.images_visible?Hue.hide_media_items():Hue.show_media_items()},Hue.hide_media_items=function(){Hue.tv_visible&&Hue.toggle_tv(!1),Hue.images_visible&&Hue.toggle_images(!1)},Hue.show_media_items=function(){Hue.tv_visible||Hue.images_visible||(Hue.toggle_tv(!0),Hue.toggle_images(!0))},Hue.setup_active_media=function(e){Hue.room_images_mode=e.room_images_mode,Hue.room_tv_mode=e.room_tv_mode,Hue.room_radio_mode=e.room_radio_mode,Hue.room_synth_mode=e.room_synth_mode,Hue.media_visibility_and_locks()},Hue.media_visibility_and_locks=function(){Hue.change_images_visibility(),Hue.change_tv_visibility(!1),Hue.change_radio_visibility(),Hue.change_lock_images(),Hue.change_lock_tv(),Hue.change_lock_radio()},Hue.reset_media_history_filter=function(e){$(`#${e}_history_filter`).val(""),$(`#${e}_history_container`).html(""),Hue.show_media_history_type=!1},Hue.show_media_history=function(e,i=!1){i&&(i=i.trim());let t=i||"";$(`#${e}_history_container`).html(""),$(`#${e}_history_filter`).val(t);let _=$($("#chat_area").children().get().reverse()).clone(!0,!0);if(_.each(function(){$(this).removeAttr("id")}),i){let t=Hue.utilz.clean_string2(i).toLowerCase().split(" ").filter(e=>""!==e.trim());_=_.filter(function(){if($(this).data("type")!==`${e}_change`)return!1;let i=$(this).text().toLowerCase();return t.some(e=>i.includes(e))})}else _=_.filter(function(){return $(this).data("type")===`${e}_change`});_.appendTo(`#${e}_history_container`),Hue.show_media_history_type=e,Hue.update_media_history_blinks(),Hue[`msg_${e}_history`].show(function(){Hue.scroll_modal_to_top(`${e}_history`)})},Hue.prepend_to_media_history=function(e){if(!Hue.started||!Hue.show_media_history_type)return!1;let i=Hue.show_media_history_type,t=$(`#chat_area > .message_id_${e}`).eq(0),_=$(`#${i}_history_filter`).val();if(_){let e=Hue.utilz.clean_string2(_).toLowerCase().split(" ").filter(e=>""!==e.trim()),a=t.text().toLowerCase();e.some(e=>a.includes(e))&&$(`#${i}_history_container`).prepend(t)}else $(`#${i}_history_container`).prepend(t)},Hue.setup_media_menu=function(){Hue.set_media_menu_radio_volume(),Hue.set_media_menu_tv_volume(),$("#media_menu_radio_volume").on("input change",function(){Hue.set_radio_volume(parseFloat(this.value),!0,!1)}),$("#media_menu_tv_volume").on("input change",function(){Hue.set_tv_volume(parseFloat(this.value),!0,!1)})},Hue.get_proper_media_url=function(e){let i=Hue[`current_${e}`]().source;return i.startsWith("/")&&(i=window.location.origin+i),i},Hue.show_media_source=function(e){let i,t=Hue.get_proper_media_url(e),_=Hue[`current_${e}`](),a=_.setter,o=_.nice_date;"image"===e?i="Image":"tv"===e?i="TV":"radio"===e&&(i="Radio"),""!==a?Hue.feedback(`${i} Source: ${t}`,{title:`Setter: ${a} | ${o} | ${Hue.utilz.nice_date()}`}):Hue.feedback(`${i} Source: ${t}`)},Hue.setup_media_pickers=function(){for(let e of Hue.utilz.media_types)Hue.horizontal_separator.separate($(`#${e}_picker_options`)[0])},Hue.fix_frame=function(e,i=!1){let t,_=$(`#${e}`);t="media_image_frame"===e?_[0].naturalHeight/_[0].naturalWidth:.5625;let a=_.parent(),o=0,n=_.parent().find(".media_info");n.length>0&&(o=n.eq(0).outerHeight(!0));let u,d,s=a.width(),m=i||a.height()-o,r=m/s;if(r===t?(u=s,d=m):r<t?(u=m/t,d=m):r>t&&(u=s,d=s*t),i)return{width:u,height:d,parent_width:s,parent_height:m};_.width(u),_.height(d)},Hue.fix_frames=function(){Hue.fix_visible_video_frame(),Hue.fix_image_frame()},Hue.change_volume_command=function(e,i="radio"){if(isNaN(e))return Hue.feedback("Argument must be a number"),!1;{let t=e/100;"radio"===i?Hue.set_radio_volume(t):"tv"===i&&Hue.set_tv_volume(t)}},Hue.change_volume_all=function(e){Hue.change_volume_command(e,"radio"),Hue.change_volume_command(e,"tv")},Hue.get_nice_volume=function(e){return parseInt(Math.round(100*e))},Hue.change=function(e={}){let i,t=!1;if((i=(e=Object.assign({type:"",force:!1,play:!0,notify:!0,current_source:!1,item:!1},e)).item?e.item:e.current_source&&Hue[`loaded_${e.type}`].source?Hue[`loaded_${e.type}`]:Hue[`current_${e.type}`]()).setter===Hue.username&&(t=Hue.get_setting("bypass_tv_lock_on_own_change")),"image"===e.type){if(!e.force&&Hue.loaded_image.source===Hue.current_image().source)return!1}else if("tv"===e.type){if(!e.force&&Hue.loaded_tv.source===Hue.current_tv().source)return!1}else{if("radio"!==e.type)return!1;if(!e.force&&Hue.loaded_radio.source===Hue.current_radio().source)return!1}if(Hue.afk)if("image"===e.type){if(Hue.get_setting("afk_disable_image_change"))return Hue.change_image_when_focused=!0,!1}else if("tv"===e.type){if(Hue.get_setting("afk_disable_tv_change"))return Hue.change_tv_when_focused=!0,!1}else if("radio"===e.type&&Hue.get_setting("afk_disable_radio_change"))return Hue.change_radio_when_focused=!0,!1;if("image"===e.type){if(!Hue.room_state.images_enabled)return!1;let _=Hue.room_state.images_locked&&!t;if(!e.item&&_&&Hue.loaded_image.source&&!e.current_source)return!1;if("disabled"===Hue.room_images_mode)return!1;Hue.loaded_image=i,Hue.show_image(e.force),e.item&&e.item!==Hue.current_image()||$("#footer_lock_images_icon").removeClass("blinking"),"mirror"!==Hue.background_mode&&"mirror_tiled"!==Hue.background_mode||Hue.apply_background()}else if("tv"===e.type){if(!Hue.room_state.tv_enabled)return!1;let _=Hue.room_state.tv_locked&&!t;if(!e.item&&_&&Hue.loaded_tv.source&&!e.current_source)return!1;if("disabled"===Hue.room_tv_mode)return!1;if(Hue.loaded_tv.source||e.force||(e.play=!1),"video"!==i.type&&"iframe"!==i.type&&void 0===Hue[`${i.type}_video_player`])return Hue.request_media(`${i.type}_video_player`,e),!1;Hue.loaded_tv=i,Hue[`show_${i.type}_video`](e.play),e.item&&e.item!==Hue.current_tv()||$("#footer_lock_tv_icon").removeClass("blinking")}else{if("radio"!==e.type)return!1;{if(!Hue.room_state.radio_enabled)return!1;let _=Hue.room_state.radio_locked&&!t;if(!e.item&&_&&Hue.loaded_radio.source&&!e.current_source)return!1;if("disabled"===Hue.room_radio_mode)return!1;if("audio"!==i.type&&void 0===Hue[`${i.type}_player`])return Hue.request_media(`${i.type}_player`,e),!1;Hue.loaded_radio=i;let a=!1;(e.item||t)&&(a=!0),Hue.load_radio(a),e.item&&e.item!==i||$("#footer_lock_radio_icon").removeClass("blinking")}}Hue.update_media_history_blinks(),Hue.check_media_menu_loaded_media(),e.notify&&i.setter!==Hue.username&&Hue.on_activity("media_change")},Hue.check_media_maxers=function(){"disabled"!==Hue.room_tv_mode&&"disabled"!==Hue.room_images_mode?$(".maxer_container").css("display","flex"):$(".maxer_container").css("display","none")},Hue.start_media_info_events=function(){$("#media").on("click",".media_info_username",function(){let e=$(this).closest(".media_info").data("item").setter;Hue.show_profile(e)}),$("#media").on("click",".media_info_details",function(){z=this;let e=$(this).closest(".media_info"),i=e.data("item"),t=e.data("mode");Hue.open_url_menu({source:i.source,data:i,media_type:t})}),$("#media").on("auxclick",".media_info_username",function(e){2===e.which&&Hue.process_write_whisper($(this).closest(".media_info").data("item").setter)})},Hue.reapply_media_info=function(){Hue.apply_media_info(...Hue.media_info_image_data),Hue.apply_media_info(...Hue.media_info_tv_data)},Hue.apply_media_info=function(e,i,t){let _;"tv"===t?Hue.media_info_tv_data=[...arguments]:"image"===t&&("upload"===i.type&&(_=`${Hue.utilz.get_size_string(i.size)} upload`),Hue.media_info_image_data=[...arguments]);let a=i.info,o=i.comment||_||i.title||i.source||"";o=o.substring(0,Hue.get_setting("media_info_max_length")).trim();let n=`\n        <div class='media_info_username pointer action'>${Hue.utilz.make_html_safe(i.setter)}</div>\n        <div class='media_info_details pointer action'>: ${Hue.utilz.make_html_safe(o)}</div>\n    `;$(e).html(n),$(e).attr("title",a),$(e).data("otitle",a),$(e).data("date",i.date),$(e).data("item",i),$(e).data("mode",t)},Hue.configure_media_info=function(){let e;"custom_enabled"===Hue.get_setting("media_info")&&(e="flex"),"custom_disabled"===Hue.get_setting("media_info")?e="none":"enabled"===Hue.media_info?e="flex":"disabled"===Hue.media_info&&(e="none");let i=`\n    <style class='appended_media_info_style'>\n        .media_info\n        {\n            display: ${e} !important;    \n        }\n    </style>`;$(".appended_media_info_style").each(function(){$(this).remove()}),$("head").append(i),Hue.fix_frames()},Hue.change_media_info=function(e){return Hue.is_admin_or_op(Hue.role)?"enabled"!==e&&"disabled"!==e?(Hue.feedback("Valid media info modes: enabled disabled"),!1):(e===Hue.media_info&&Hue.feedback("Media info is already set to that"),void Hue.socket_emit("change_media_info",{media_info:e})):(Hue.not_an_op(),!1)},Hue.media_info_changed=function(e){Hue.set_media_info(e.media_info),Hue.show_room_notification(e.username,`${e.username} changed media info to ${e.media_info}`)},Hue.set_media_info=function(e){Hue.media_info=e,Hue.configure_media_info(),Hue.config_admin_media_info()},Hue.change_media_lock=function(e){let i=e;"images"===e&&(i="image"),Hue.room_state[`${e}_locked`]?($(`#footer_lock_${e}_icon`).removeClass("fa-unlock"),$(`#footer_lock_${e}_icon`).addClass("fa-lock"),$(`#footer_lock_${e}_icon`).removeClass("footer_icon3"),$(`#footer_lock_${e}_icon`).addClass("footer_icon2"),$(`#footer_lock_${e}_label`).css("display","block"),Hue[`loaded_${i}`]!==Hue[`current_${i}`]()&&$(`#footer_lock_${e}_icon`).addClass("blinking")):($(`#footer_lock_${e}_icon`).removeClass("fa-lock"),$(`#footer_lock_${e}_icon`).addClass("fa-unlock"),$(`#footer_lock_${e}_icon`).removeClass("blinking"),$(`#footer_lock_${e}_icon`).removeClass("footer_icon2"),$(`#footer_lock_${e}_icon`).addClass("footer_icon3"),$(`#footer_lock_${e}_label`).css("display","none"),Hue.change({type:i}))},Hue.change_media_layout=function(e=!1){e||(e=Hue.get_setting("media_layout")),"column"===e?($("#media_split").css("flex-direction","column"),$(".media_main_container").css("width","100%"),$(".media_main_container").css("height","50%")):"row"===e&&($("#media_split").css("flex-direction","row"),$(".media_main_container").css("width","50%"),$(".media_main_container").css("height","100%")),Hue.apply_media_percentages(),Hue.fix_frames()},Hue.swap_media_layout=function(){let e=Hue.active_settings("media_layout");Hue[e].media_layout="row"===Hue[e].media_layout?"column":"row",Hue[`save_${e}`](),Hue.change_media_layout()},Hue.swap_media_layout_2=function(){Hue.enable_setting_override("media_layout"),Hue.swap_media_layout()};
Hue.setup_message_board=function(){$("#message_board_post_icon").click(function(){Hue.create_message_board_post()}),$("#message_board_post_button").click(function(){Hue.submit_message_board_post()}),$("#message_board_post_textarea").on("input blur",function(){let e=$(this).val().substring(0,Hue.config.max_message_board_post_length);$(this).val(e)}),$("#message_board_container").on("click",".message_board_delete",function(){if("admin"!==Hue.role)return!1;if(confirm("Are you sure?")){let e=$(this).closest(".message_board_item").data("id");e&&Hue.socket_emit("delete_message_board_post",{id:e})}}),$("#message_board_post_textarea").on("focus",function(){Hue.writing_message_board_post=!0}),$("#message_board_post_textarea").on("blur",function(){Hue.writing_message_board_post=!1}),Hue.get_last_message_board_post_checked()},Hue.add_post_to_message_board=function(e){let a=$("\n    <div class='message_board_item modal_item'>\n        <div class='message_board_text dynamic_title'></div>\n        <div><div class='message_board_delete action pointer inline underlined'>Delete</div></div>\n    </div>");a.data("id",e.id),a.data("date",e.date);let s=a.find(".message_board_text").eq(0);s.text(e.message).urlize();let _=Hue.utilz.nice_date(e.date);e.id&&(_=`${e.id.slice(-3)} | ${_}`),s.attr("title",_),s.data("date",e.date),s.data("otitle",_),0===$("#message_board_container .message_board_item").length?$("#message_board_container").html(a):$("#message_board_container").prepend(a),$("#message_board_container").find(".message_board_item").length>Hue.config.max_message_board_posts&&$("#message_board_container").find(".message_board_item").last().remove()},Hue.init_message_board=function(e){for(let a of e.message_board_posts)Hue.add_post_to_message_board(a);Hue.last_message_board_post_date=e.last_message_board_post_date,Hue.check_message_board_delay(),Hue.check_last_message_board_post()},Hue.show_message_board=function(){Hue.msg_message_board.show(function(){Hue.update_last_message_post_checked(),Hue.check_last_message_board_post(),$("#message_board_post_textarea").focus()})},Hue.submit_message_board_post=function(){let e=Hue.utilz.clean_string2($("#message_board_post_textarea").val());if(!e||e.length>Hue.config.max_message_board_post_length)return!1;$("#message_board_post_textarea").val(""),Hue.socket_emit("message_board_post",{message:e})},Hue.on_message_board_received=function(e){Hue.add_post_to_message_board(e),Hue.check_last_message_board_post()},Hue.last_message_board_post_date_update=function(e){Hue.last_message_board_post_date=e.date,Hue.check_message_board_delay()},Hue.check_message_board_delay=function(){if("admin"===Hue.role)return $("#message_board_post_textarea").css("display","block"),Hue.message_board_posting_enabled=!0,!1;let e=Date.now()-Hue.last_message_board_post_date;clearTimeout(Hue.message_board_post_delay_timeout),e<Hue.config.message_board_post_delay?($("#message_board_post_textarea").css("display","none"),Hue.message_board_post_delay_timeout=setTimeout(function(){Hue.check_message_board_delay()},e+1e3),Hue.message_board_posting_enabled=!1):($("#message_board_post_textarea").css("display","block"),Hue.message_board_posting_enabled=!0)},Hue.check_last_message_board_post=function(){let e=$("#message_board_container").find(".message_board_item");if(0===e.length)return $("#activity_left_message_board_label").text(""),!1;let a=Hue.last_message_board_post_checked[Hue.room_id];if(e.first().data("date")>a)if(Hue.msg_message_board.is_open())Hue.update_last_message_post_checked();else{let e=0;$("#message_board_container").find(".message_board_item").each(function(){if($(this).data("date")<=a)return!1;e+=1});let s=1===e?"New Post":"New Posts";$("#activity_left_message_board_label").text(s)}else $("#activity_left_message_board_label").text("")},Hue.update_last_message_post_checked=function(){let e=$("#message_board_container").find(".message_board_item").first().data("date");e!==Hue.last_message_board_post_checked[Hue.room_id]&&Hue.save_last_message_board_post_checked(e)},Hue.save_last_message_board_post_checked=function(e){Hue.last_message_board_post_checked[Hue.room_id]=e,Hue.save_local_storage(Hue.ls_last_message_board_post_checked,Hue.last_message_board_post_checked)},Hue.check_message_board_permissions=function(){if("admin"===Hue.role)$("#message_board_container").addClass("message_board_container_admin"),$("#message_board_post_textarea").attr("placeholder","Write A Post");else{$("#message_board_container").removeClass("message_board_container_admin");let e=Math.round(Hue.config.message_board_post_delay/60/1e3),a=`You can post once every ${e} ${1===e?"minute":"minutes"}`;$("#message_board_post_textarea").attr("placeholder",a)}},Hue.remove_message_board_post=function(e){$("#message_board_container").find(".message_board_item").each(function(){if($(this).data("id")===e.id)return $(this).remove(),!1})},Hue.get_last_message_board_post_checked=function(){Hue.last_message_board_post_checked=Hue.get_local_storage(Hue.ls_last_message_board_post_checked);let e=!1;Hue.last_message_board_post_checked||(Hue.last_message_board_post_checked={},e=!0),Hue.last_message_board_post_checked[Hue.room_id]||(Hue.last_message_board_post_checked[Hue.room_id]=0,e=!0),e&&Hue.save_last_message_board_post_checked(Hue.last_message_board_post_checked[Hue.room_id])},Hue.clear_message_board=function(){if("admin"!==Hue.role)return!1;Hue.socket_emit("clear_message_board",{})},Hue.on_message_board_cleared=function(e){$("#message_board_container").html("No Posts Yet"),Hue.show_room_notification(e.username,`${e.username} cleared the message board`)};
Hue.configure_notifications=function(){$("#notifications_configure_icon").click(function(){Hue.open_user_settings_category("notifications")})},Hue.make_info_popup=function(i=function(){}){let o=Hue.get_setting("auto_close_popup_notifications"),t=!o||Hue.get_setting("popup_notifications_always_show_titlebar"),e="none";t&&(e="inner_right");let n=Hue.create_popup({position:"topright",autoclose:!1,enable_titlebar:t,window_x:e,content_class:"!info_popup",window_width:"auto",on_click:i,before_close:function(i){i.hue_closing=!0},after_close:function(i){i.hue_terminated||Hue.info_popups.shift()},close_on_escape:!1});if(t&&n.set_title(Hue.utilz.nice_date()),n.hue_closing=!1,Hue.app_focused?o&&Hue.add_close_timeout_to_info_popup(n):n.hue_close_timeout=!1,Hue.info_popups.push(n),Hue.info_popups.length>Hue.config.max_info_popups){let i=Hue.info_popups.slice(0,Hue.info_popups.length-Hue.config.max_info_popups);for(let o of i)o.hue_closing||(o.hue_terminated=!0,o.close());Hue.info_popups=Hue.info_popups.slice(-Hue.config.max_info_popups)}return n},Hue.add_close_timeout_to_info_popup=function(i){i.hue_close_timeout=setTimeout(function(){i.close()},Hue.get_setting("popup_notifications_close_delay"))},Hue.activate_info_popup_timeouts=function(){if(!Hue.get_setting("auto_close_popup_notifications"))return!1;for(let i of Hue.info_popups)i.hue_close_timeout||Hue.add_close_timeout_to_info_popup(i)},Hue.make_info_popup_item=function(i={}){let o="";if((i=Object.assign({icon:"",messgage:"",action:!0,push:!0,on_click:!1,type:""},i)).action&&(o="pointer action"),i.push){let o=!0;("user_join"===i.type&&!Hue.get_setting("save_user_join_notifications")||"user_part"===i.type&&!Hue.get_setting("save_user_part_notifications")||"room"===i.type&&!Hue.get_setting("save_room_notifications"))&&(o=!1),o&&Hue.push_notification(i.icon,i.message,i.on_click)}return`<div class='info_popup_item unselectable ${o}'><i class='${i.icon} info_popup_icon'></i><div>${Hue.utilz.make_html_safe(i.message)}</div></div>`},Hue.push_notification=function(i,o,t=!1){let e=Date.now(),n=Hue.utilz.nice_date(e),_="";i&&(_=`<i class='${i} notifications_icon'></i>`);let u=`<div class='notifications_messasge'>${Hue.utilz.make_html_safe(o)}</div>`,s="";t&&(s="pointer action");let c=$(`<div class='notifications_item modal_item'><div class='notifications_item_content ${s} dynamic_title'>${_}${u}</div>`),p=c.find(".notifications_item_content").eq(0);p.attr("title",n),p.data("otitle",n),p.data("date",e),t&&p.click(function(){t()});let a=$("#notifications_container .notifications_item").length;0===a?$("#notifications_container").html(c):$("#notifications_container").prepend(c),a>Hue.config.notifications_crop_limit&&$("#notifications_container .notifications_item").last().remove()},Hue.show_notifications=function(i=!1){Hue.msg_notifications.show(function(){i&&($("#notifications_filter").val(i),Hue.do_modal_filter())})},Hue.show_room_notification=function(i,o){let t=function(){Hue.show_profile(i)},e=Hue.make_info_popup_item({message:o,on_click:t,type:"room"}),n=Hue.get_setting("room_notifications_method");if("popups"===n){Hue.make_info_popup(t).show(e)}else"chat"===n&&Hue.public_feedback(o,{username:i,open_profile:!0})};
Hue.show_help=function(){let e=Hue.template_help();Hue.msg_info2.show(["Help",e])},Hue.copy_string=function(e,o=!0){let u=document.createElement("textarea");document.body.appendChild(u),u.value=e,u.select(),document.execCommand("copy"),document.body.removeChild(u),o&&Hue.play_audio("pup2")},Hue.error_occurred=function(){Hue.feedback("An error occurred")},Hue.needs_confirm=function(e,o=!1){o||(o="Are you sure?"),confirm(o)&&Hue[e]()},Hue.show_credits=function(){Hue.msg_credits.show(function(){Hue.credits_audio?(Hue.credits_audio.currentTime=0,Hue.credits_audio.play()):(Hue.credits_audio=new Audio,Hue.credits_audio.src=Hue.config.credits_audio_url,Hue.credits_audio.setAttribute("loop",!0),Hue.credits_audio.play())})},Hue.show_console_message=function(){console.info("%c Want to work with us? It's pretty much 99.99% risks, some negligible fraction AI, a couple bureaucracies to keep people minimally pissed off, and a whole lot of creativity.","font-size:1.4rem")};
Hue.change_voice_permission=function(e,i){return Hue.is_admin_or_op(Hue.role)?void 0!==Hue[e]&&((!0===i||!1===i)&&(Hue[e]===i?(Hue.feedback("That permission is already set to that"),!1):void Hue.socket_emit("change_voice_permission",{ptype:e,what:i}))):(Hue.not_an_op(),!1)},Hue.announce_voice_permission_change=function(e){let i;i=e.what?`${e.username} set ${e.ptype} to true`:`${e.username} set ${e.ptype} to false`,Hue[e.ptype]=e.what,Hue.show_room_notification(e.username,i),Hue.check_permissions(),Hue.config_admin_permission_checkboxes()},Hue.change_voice_permission_command=function(e){let i=e.split(" ");if(3!==i.length)return!1;let o=i[0],s=i[1],_=i[2],n=`voice${o}_${s}_permission`;return void 0===Hue[n]?(Hue.feedback("Invalid format"),!1):"true"!==_&&"false"!==_?(Hue.feedback("Invalid value"),!1):(_=JSON.parse(_),void Hue.change_voice_permission(n,_))},Hue.start_permissions=function(e){Hue.voice1_chat_permission=e.voice1_chat_permission,Hue.voice1_images_permission=e.voice1_images_permission,Hue.voice1_tv_permission=e.voice1_tv_permission,Hue.voice1_radio_permission=e.voice1_radio_permission,Hue.voice1_synth_permission=e.voice1_synth_permission,Hue.voice2_chat_permission=e.voice2_chat_permission,Hue.voice2_images_permission=e.voice2_images_permission,Hue.voice2_tv_permission=e.voice2_tv_permission,Hue.voice2_radio_permission=e.voice2_radio_permission,Hue.voice2_synth_permission=e.voice2_synth_permission,Hue.voice3_chat_permission=e.voice3_chat_permission,Hue.voice3_images_permission=e.voice3_images_permission,Hue.voice3_tv_permission=e.voice3_tv_permission,Hue.voice3_radio_permission=e.voice3_radio_permission,Hue.voice3_synth_permission=e.voice3_synth_permission,Hue.voice4_chat_permission=e.voice4_chat_permission,Hue.voice4_images_permission=e.voice4_images_permission,Hue.voice4_tv_permission=e.voice4_tv_permission,Hue.voice4_radio_permission=e.voice4_radio_permission,Hue.voice4_synth_permission=e.voice4_synth_permission},Hue.check_permissions=function(){Hue.can_chat=Hue.check_permission(Hue.role,"chat"),Hue.can_images="enabled"===Hue.room_images_mode&&Hue.check_permission(Hue.role,"images"),Hue.can_tv="enabled"===Hue.room_tv_mode&&Hue.check_permission(Hue.role,"tv"),Hue.can_radio="enabled"===Hue.room_radio_mode&&Hue.check_permission(Hue.role,"radio"),Hue.can_synth="enabled"===Hue.room_synth_mode&&Hue.check_permission(Hue.role,"synth"),Hue.setup_footer_icons()},Hue.check_permission=function(e=!1,i=!1){return!!Hue.is_admin_or_op(e)||!!(e&&i&&Hue[`${e}_${i}_permission`])};
Hue.load_youtube=async function(e=""){return Hue.youtube_loaded?(Hue.youtube_player_requested&&void 0===Hue.youtube_player&&Hue.create_youtube_player(),Hue.youtube_video_player_requested&&void 0===Hue.youtube_video_player&&Hue.create_youtube_video_player(),!1):!Hue.youtube_loading&&(Hue.youtube_loading=!0,await Hue.load_script("https://www.youtube.com/iframe_api"),void(Hue.youtube_loaded=!0))},Hue.create_youtube_player=function(){Hue.youtube_player_requested=!1;let e=$("<div id='youtube_player'></div>");$("#media_youtube_audio_container").html(e),Hue.yt_player=new YT.Player("youtube_player",{events:{onReady:Hue.on_youtube_player_ready},playerVars:{iv_load_policy:3,rel:0,width:640,height:360}})},Hue.create_youtube_video_player=function(){Hue.youtube_video_player_requested=!1;$("#media_youtube_video_container").html("<div id='media_youtube_video' class='video_frame'></div>"),Hue.add_media_info("media_youtube_video_container"),Hue.yt_video_player=new YT.Player("media_youtube_video",{events:{onReady:Hue.on_youtube_video_player_ready},playerVars:{iv_load_policy:3,rel:0,width:640,height:360,autoplay:0}})},onYouTubeIframeAPIReady=function(){Hue.youtube_player_requested&&Hue.create_youtube_player(),Hue.youtube_video_player_requested&&Hue.create_youtube_video_player()},Hue.on_youtube_player_ready=function(){Hue.youtube_player=Hue.yt_player,Hue.youtube_player_request&&(Hue.change(Hue.youtube_player_request),Hue.youtube_player_request=!1)},Hue.on_youtube_video_player_ready=function(){Hue.youtube_video_player=Hue.yt_video_player,Hue.youtube_video_player.addEventListener("onStateChange",function(e){5===e.data&&Hue.youtube_video_play_on_queue&&Hue.youtube_video_player.playVideo()}),Hue.youtube_video_player_request&&(Hue.change(Hue.youtube_video_player_request),Hue.youtube_video_player_request=!1)},Hue.start_twitch=async function(){return Hue.twitch_loaded?(Hue.twitch_video_player_requested&&void 0===Hue.twitch_video_player&&Hue.create_twitch_video_player(),!1):!Hue.twitch_loading&&(Hue.twitch_loading=!0,await Hue.load_script("https://player.twitch.tv/js/embed/v1.js"),Hue.twitch_loaded=!0,void(Hue.twitch_video_player_requested&&Hue.create_twitch_video_player()))},Hue.create_twitch_video_player=function(){Hue.twitch_video_player_requested=!1;try{let e=new Twitch.Player("media_twitch_video_container",{width:640,height:360,autoplay:!1});e.addEventListener(Twitch.Player.READY,()=>{Hue.twitch_video_player=e,$("#media_twitch_video_container").find("iframe").eq(0).attr("id","media_twitch_video").addClass("video_frame"),Hue.add_media_info("media_twitch_video_container"),Hue.twitch_video_player_request&&(Hue.change(Hue.twitch_video_player_request),Hue.twitch_video_player_request=!1)})}catch(e){console.error("Twitch failed to load")}},Hue.start_soundcloud=async function(){if(Hue.soundcloud_loaded&&(Hue.soundcloud_player_requested&&void 0===Hue.soundcloud_player&&Hue.create_soundcloud_player(),Hue.soundcloud_video_player_requested&&void 0===Hue.soundcloud_video_player&&Hue.create_soundcloud_video_player()),Hue.soundcloud_loading)return!1;Hue.soundcloud_loading=!0,await Hue.load_script("https://w.soundcloud.com/player/api.js"),Hue.soundcloud_loaded=!0,Hue.soundcloud_player_requested&&Hue.create_soundcloud_player(),Hue.soundcloud_video_player_requested&&Hue.create_soundcloud_video_player()},Hue.create_soundcloud_player=function(){Hue.soundcloud_player_requested=!1;try{let e="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/301986536";$("#media_soundcloud_audio_container").html(`<iframe id='soundcloud_player' src='${e}'></iframe>`);let u=SC.Widget("soundcloud_player");u.bind(SC.Widget.Events.READY,function(){Hue.soundcloud_player=u,Hue.soundcloud_player_request&&(Hue.change(Hue.soundcloud_player_request),Hue.soundcloud_player_request=!1)})}catch(e){console.error("Soundcloud failed to load")}},Hue.create_soundcloud_video_player=function(){Hue.soundcloud_video_player_requested=!1;try{let e="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/301986536";$("#media_soundcloud_video_container").html(`<iframe width="640px" height="360px"\n        id='media_soundcloud_video' class='video_frame' src='${e}'></iframe>`),Hue.add_media_info("media_soundcloud_video_container");let u=SC.Widget("media_soundcloud_video");u.bind(SC.Widget.Events.READY,function(){Hue.soundcloud_video_player=u,Hue.soundcloud_video_player_request&&(Hue.change(Hue.soundcloud_video_player_request),Hue.soundcloud_video_player_request=!1)})}catch(e){console.error("Soundcloud failed to load")}},Hue.start_vimeo=async function(){return Hue.vimeo_loaded?(Hue.vimeo_video_player_requested&&void 0===Hue.vimeo_video_player&&Hue.create_vimeo_video_player(),!1):!Hue.vimeo_loading&&(Hue.vimeo_loading=!0,await Hue.load_script("/static/js/libs2/vimeo.player.min.js"),Hue.vimeo_loaded=!0,void(Hue.vimeo_video_player_requested&&Hue.create_vimeo_video_player()))},Hue.create_vimeo_video_player=function(){Hue.vimeo_video_player_requested=!1;let e=new Vimeo.Player("media_vimeo_video_container",{id:59777392,width:640,loop:!1});e.ready().then(()=>{Hue.vimeo_video_player=e,$("#media_vimeo_video_container").find("iframe").eq(0).attr("id","media_vimeo_video").addClass("video_frame"),Hue.add_media_info("media_vimeo_video_container"),Hue.vimeo_video_player_request&&(Hue.change(Hue.vimeo_video_player_request),Hue.vimeo_video_player_request=!1)})},Hue.request_media=function(e,u){Hue[`${e}_requested`]=!0,Hue[`${e}_request`]=u,"youtube_player"===e||"youtube_video_player"===e?Hue.load_youtube():"soundcloud_player"===e||"soundcloud_video_player"===e?Hue.start_soundcloud():"twitch_video_player"===e?Hue.start_twitch():"vimeo_video_player"===e&&Hue.start_vimeo()},Hue.load_hls=async function(){return!Hue.hls_loading&&(Hue.hls_loading=!0,new Promise(async(e,u)=>{await Hue.load_script("/static/js/libs2/hls.js"),e()}))},Hue.start_hls=async function(){Hue.hls_loading||await Hue.load_hls(),Hue.hls=new Hls({maxBufferSize:5e6,maxBufferLength:10})},Hue.add_media_info=function(e){$(`#${e}`).append("<div class='media_info dynamic_title'></div>")};
Hue.setup_radio=function(e,o={}){let a;if("restart"===e)(a=Hue.current_radio()).date=o.date,a.info+=` | ${Hue.utilz.nice_date(a.date)}`,a.message=`${o.setter} restarted the radio`,a.comment=o.comment,a.in_log=void 0===o.in_log||o.in_log;else{if((a={}).id=o.id,a.user_id=o.user_id,a.type=o.type,a.source=o.source,a.title=o.title,a.setter=o.setter,a.date=o.date,a.query=o.query,a.comment=o.comment,a.nice_date=a.date?Hue.utilz.nice_date(a.date):Hue.utilz.nice_date(),a.in_log=void 0===o.in_log||o.in_log,a.setter||(a.setter="The system"),a.source||(a.source=Hue.config.default_radio_source,a.type=Hue.config.default_radio_type,a.title=Hue.config.default_radio_title),a.title||(a.title=a.source),a.message=`${a.setter} changed the radio to: ${Hue.utilz.conditional_quotes(a.title)}`,"audio"===a.type&&("/"===a.source.slice(-1)?a.metadata_url=`${a.source.slice(0,-1).split("/").slice(0,-1).join("/")}/status-json.xsl`:a.metadata_url=`${a.source.split("/").slice(0,-1).join("/")}/status-json.xsl`),"youtube"===a.type){let e=Hue.utilz.get_youtube_time(a.source);0!==e&&(a.message+=` (At ${Hue.utilz.humanize_seconds(e)})`)}let e=a.id?`${a.id.slice(-3)} | `:"";a.info=`${e}Setter: ${a.setter} | ${a.nice_date}`,a.query&&(a.info+=` | Search Term: "${a.query}"`),a.onclick=function(){Hue.open_url_menu({source:a.source,data:a,media_type:"radio"})}}a.date||(a.date=Date.now()),a.message&&(a.message_id=Hue.announce_radio(a).message_id),"change"!==e&&"show"!==e||Hue.push_radio_changed(a),"change"!==e&&"restart"!==e||("change"===e?(Hue.room_state.radio_locked&&$("#footer_lock_radio_icon").addClass("blinking"),Hue.change({type:"radio",force:!0})):"restart"===e&&Hue.change({type:"radio",force:!0,play:!0}))},Hue.announce_radio=function(e){return Hue.public_feedback(e.message,{id:e.id,save:!0,brk:"<i class='icon2c fa fa-volume-up'></i>",title:e.info,onclick:e.onclick,date:e.date,type:e.type,username:e.setter,comment:e.comment,type:"radio_change",user_id:e.user_id,in_log:e.in_log})},Hue.push_radio_changed=function(e){Hue.radio_changed.push(e),Hue.radio_changed.length>Hue.config.media_changed_crop_limit&&(Hue.radio_changed=Hue.radio_changed.slice(Hue.radio_changed.length-Hue.config.media_changed_crop_limit)),Hue.after_push_media_change("radio",e)},Hue.current_radio=function(){return Hue.radio_changed.length>0?Hue.radio_changed[Hue.radio_changed.length-1]:{}},Hue.load_radio=function(e=!1){let o=Hue.loaded_radio;if(Hue.radio_get_metadata=!1,clearTimeout(Hue.radio_metadata_fail_timeout),Hue.stop_radio(!1),Hue.hide_radio(o),"audio"===o.type)0===$("#audio_player").length&&$("#media_audio_audio_container").html("<audio id='audio_player' preload=\"metadata\"></audio>"),Hue.radio_get_metadata=!0,$("#audio_player").attr("src",o.source),Hue.radio_started&&$("#audio_player")[0].play();else if("youtube"===o.type){if(Hue.youtube_player){let e=Hue.utilz.get_youtube_id(o.source);if("video"===e[0])Hue.radio_started?Hue.youtube_player.loadVideoById({videoId:e[1],startSeconds:Hue.utilz.get_youtube_time(o.source)}):Hue.youtube_player.cueVideoById({videoId:e[1],startSeconds:Hue.utilz.get_youtube_time(o.source)});else{if("list"!==e[0])return!1;Hue.youtube_player.loadPlaylist({list:e[1][0],index:e[1][1]})}Hue.youtube_player.setVolume(Hue.get_nice_volume(Hue.room_state.radio_volume))}!e&&Hue.room_state.radio_locked&&Hue.loaded_radio.source||Hue.push_played(!1,{s1:o.title,s2:o.source})}else"soundcloud"===o.type&&(Hue.soundcloud_player&&Hue.soundcloud_player.load(o.source,{auto_play:!1,single_active:!1,show_artwork:!0,callback:function(){Hue.radio_started&&Hue.soundcloud_player.play(),Hue.soundcloud_player.setVolume(Hue.get_nice_volume(Hue.room_state.radio_volume))}}),!e&&Hue.room_state.radio_locked&&Hue.loaded_radio.source||Hue.push_played(!1,{s1:o.title,s2:o.source}));"audio"===o.type&&Hue.get_radio_metadata(),Hue.set_radio_volume(!1,!1)},Hue.change_radio_source=function(e,o=!1,a=""){let t=!0;if(o&&(t=!1),!Hue.can_radio)return t&&Hue.feedback("You don't have permission to change the radio"),!1;if(!a){let o=Hue.get_media_change_inline_comment("radio",e);e=o.source,a=o.comment}if(a.length>Hue.config.max_media_comment_length)return t&&Hue.feedback("Comment is too long"),!1;if(0===e.length)return!1;if((e=Hue.utilz.clean_string2(e)).length>Hue.config.max_media_source_length)return!1;if(e.startsWith("/"))return!1;if(e===Hue.current_radio().source||e===Hue.current_radio().query)return t&&Hue.feedback("Radio is already set to that"),!1;if("default"===e);else if("prev"===e||"previous"===e){if(!(Hue.radio_changed.length>1))return t&&Hue.feedback("No radio source before current one"),!1;e=Hue.radio_changed[Hue.radio_changed.length-2].source}if(Hue.utilz.is_url(e)){if(Hue.check_domain_list("radio",e))return t&&Hue.feedback("Radio sources from that domain are not allowed"),!1;if(e.includes("youtube.com")||e.includes("youtu.be")){if(!Hue.config.youtube_enabled)return t&&Hue.feedback("YouTube support is not enabled"),!1}else if(e.includes("soundcloud.com")){if(!Hue.config.soundcloud_enabled)return t&&Hue.feedback("Soundcloud support is not enabled"),!1}else{let o=Hue.utilz.get_extension(e).toLowerCase();if(o&&!Hue.utilz.audio_extensions.includes(o))return t&&Hue.feedback("That doesn't seem to be an audio"),!1}}else if("restart"!==e&&"reset"!==e){if(e.length>Hue.config.safe_limit_1)return t&&Hue.feedback("Query is too long"),!1;if(!Hue.config.youtube_enabled)return t&&Hue.feedback("Invalid radio source"),!1}if(o)return!0;Hue.socket_emit("change_radio_source",{src:e,comment:a})},Hue.toggle_lock_radio=function(e,o=!0){Hue.room_state.radio_locked=void 0!==e?e:!Hue.room_state.radio_locked,Hue.change_lock_radio(),o&&Hue.save_room_state()},Hue.change_lock_radio=function(){Hue.change_media_lock("radio")},Hue.toggle_radio=function(e,o=!0){void 0!==e?Hue.room_state.radio_enabled!==e?Hue.room_state.radio_enabled=e:o=!1:Hue.room_state.radio_enabled=!Hue.room_state.radio_enabled,Hue.radio_visible!==e&&Hue.change_radio_visibility(),o&&Hue.save_room_state()},Hue.change_radio_visibility=function(){if("disabled"!==Hue.room_radio_mode&&Hue.room_state.radio_enabled){$("#header_radio").css("display","flex"),$("#footer_toggle_radio_icon").removeClass("fa-toggle-off"),$("#footer_toggle_radio_icon").addClass("fa-toggle-on"),$("#header_topic").css("display","none"),Hue.radio_visible=!0;let e=!1;Hue.loaded_radio.source&&(e=Hue.loaded_radio.source),Hue.first_media_change&&Hue.change({type:"radio",force:!0,play:!1,current_source:Hue.room_state.radio_locked}),Hue.loaded_radio.type&&"radio"===Hue.loaded_radio.type&&e&&e===Hue.loaded_radio.source&&Hue.get_radio_metadata()}else Hue.hide_radio(),Hue.stop_radio(),$("#header_radio").css("display","none"),$("#footer_toggle_radio_icon").removeClass("fa-toggle-on"),$("#footer_toggle_radio_icon").addClass("fa-toggle-off"),$("#header_topic").css("display","flex"),Hue.radio_visible=!1;Hue.update_header_separators()},Hue.radio_prev=function(){Hue.change_radio_source("prev"),Hue.msg_radio_picker.close()},Hue.refresh_radio=function(){Hue.change({type:"radio",force:!0,play:!0,current_source:!0})},Hue.get_radio_metadata_enabled=function(){return Hue.loaded_radio&&"audio"===Hue.loaded_radio.type&&Hue.loaded_radio.metadata_url&&Hue.radio_get_metadata&&"disabled"!==Hue.room_radio_mode&&Hue.room_state.radio_enabled},Hue.get_radio_metadata=function(){if(!Hue.get_radio_metadata_enabled())return!1;if(Hue.radio_get_metadata_ongoing)return!1;try{Hue.radio_get_metadata_ongoing=!0,$.get(Hue.loaded_radio.metadata_url,{},function(e){if(Hue.radio_get_metadata_ongoing=!1,!Hue.get_radio_metadata_enabled())return!1;try{let o=!1;if(Array.isArray(e.icestats.source))for(let a=0;a<e.icestats.source.length&&(!(o=e.icestats.source[a]).listenurl.includes(Hue.loaded_radio.source.split("/").pop())||void 0===o.artist||void 0===o.title);a++);else{if(!e.icestats.source.listenurl.includes(Hue.loaded_radio.source.split("/").pop()))return Hue.on_radio_get_metadata_error(),!1;o=e.icestats.source}if(!o||void 0===o.artist||void 0===o.title)return Hue.on_radio_get_metadata_error(),!1;Hue.push_played({title:o.title,artist:o.artist})}catch(e){return Hue.on_radio_get_metadata_error(),!1}}).fail(function(e,o){Hue.radio_get_metadata_ongoing=!1,404===e.status?Hue.on_radio_get_metadata_error(!0,!1):Hue.on_radio_get_metadata_error()})}catch(e){Hue.radio_get_metadata_ongoing=!1,Hue.on_radio_get_metadata_error()}},Hue.on_radio_get_metadata_error=function(e=!0,o=!0){if(Hue.radio_get_metadata=!1,o&&(clearTimeout(Hue.radio_metadata_fail_timeout),Hue.radio_metadata_fail_timeout=setTimeout(function(){Hue.radio_get_metadata=!0},Hue.config.radio_retry_metadata_delay)),e){let e=Hue.loaded_radio.source.split("/");e.length>1?Hue.push_played(!1,{s1:e.pop(),s2:Hue.loaded_radio.source}):Hue.hide_now_playing()}},Hue.start_played_click_events=function(){$("#played").on("click",".played_item_inner",function(){""!==$(this).data("q2")?Hue.goto_url($(this).data("q2"),"tab"):Hue.search_on("google",$(this).data("q"))})},Hue.push_played=function(e,o=!1){let a,t,i;if(e?(a=`${e.title} - ${e.artist}`,t=`"${e.title}" by "${e.artist}"`,i=""):(a=o.s1,t=o.s1,i=o.s2),$("#now_playing").text()!==a){if($("#now_playing").text(a),$("#header_now_playing_controls").data("q",t),Hue.played[Hue.played.length-1]!==a){let u=Date.now(),d=Hue.utilz.nice_date(u),r=$(`<div class='modal_item played_item'>${`\n        <div class='played_item_inner pointer inline action dynamic_title' title='${d}' data-otitle='${d}' data-date='${u}'>\n            <div class='played_item_title'></div><div class='played_item_artist'></div>\n        </div>`}</div>`);e?(r.find(".played_item_title").eq(0).text(e.title),r.find(".played_item_artist").eq(0).text(`by ${e.artist}`)):(r.find(".played_item_title").eq(0).text(o.s1),r.find(".played_item_artist").eq(0).text(`${o.s2}`));let _=r.find(".played_item_inner").eq(0);if(_.data("q",t),_.data("q2",i),$("#played").prepend(r),Hue.played.push(a),Hue.played.length>Hue.config.played_crop_limit){let e=$("#played").children();e.slice(e.length-1,e.length).remove(),Hue.played.splice(0,1)}Hue.played_filtered&&Hue.do_modal_filter()}Hue.show_now_playing()}},Hue.hide_now_playing=function(){$("#header_now_playing_area").css("display","none"),Hue.horizontal_separator.separate("header_radio")},Hue.show_now_playing=function(){$("#header_now_playing_area").css("display","flex"),Hue.horizontal_separator.separate("header_radio")},Hue.start_radio=function(){if(!Hue.loaded_radio)return!1;if("audio"===Hue.loaded_radio.type)$("#audio_player").attr("src",Hue.loaded_radio.source),$("#audio_player")[0].play();else if("youtube"===Hue.loaded_radio.type){if(!Hue.youtube_player)return!1;Hue.youtube_player.playVideo()}else if("soundcloud"===Hue.loaded_radio.type){if(!Hue.soundcloud_player)return!1;Hue.soundcloud_player.play()}$("#header_radio_playing_icon").css("display","flex"),$("#header_radio_volume_area").css("display","flex"),$("#toggle_now_playing_text").html("Stop Radio"),Hue.horizontal_separator.separate("header_radio"),Hue.radio_started=!0,Hue.stop_radio_timeout&&Hue.clear_automatic_stop_radio(),Hue.get_setting("stop_tv_on_radio_play")&&Hue.stop_tv(!1)},Hue.hide_radio=function(e=!1){$("#media_radio .media_radio_item").each(function(){let o=$(this).attr("id"),a=o.replace("media_","").replace("_audio_container","");if(!e||e.type!==a){let e=$(`<div id='${o}' class='media_radio_item'></div>`);$(this).replaceWith(e),Hue[`${a}_player`]=void 0,Hue[`${a}_player_requested`]=!1,Hue[`${a}_player_request`]=!1}})},Hue.stop_radio=function(e=!0){$("#audio_player").length>0&&$("#audio_player")[0].pause(),Hue.youtube_player&&Hue.youtube_player.stopVideo(),Hue.soundcloud_player&&Hue.soundcloud_player.pause(),e&&($("#header_radio_playing_icon").css("display","none"),$("#header_radio_volume_area").css("display","none"),$("#toggle_now_playing_text").html("Start Radio"),Hue.horizontal_separator.separate("header_radio"),Hue.radio_started=!1,Hue.stop_radio_timeout&&Hue.clear_automatic_stop_radio())},Hue.toggle_play_radio=function(){Hue.radio_started?Hue.stop_radio():Hue.start_radio()},Hue.start_metadata_loop=function(){setInterval(function(){Hue.get_radio_metadata_enabled()&&Hue.get_radio_metadata()},Hue.config.radio_metadata_interval_duration)},Hue.start_volume_scroll=function(){$("#header")[0].addEventListener("wheel",function(e){if(!Hue.radio_started)return!1;let o=e.deltaY>0?"down":"up";"up"===o?Hue.radio_volume_increase():"down"===o&&Hue.radio_volume_decrease()})},Hue.set_radio_volume_widget=function(e=!1){!1===e&&(e=Hue.room_state.radio_volume),$("#volume").text(`${Hue.utilz.to_hundred(e)} %`)},Hue.set_radio_volume=function(e=!1,o=!0,a=!0){"number"!=typeof e&&(e=Hue.room_state.radio_volume),(e=Hue.utilz.round(e,1))>1?e=1:e<0&&(e=0),Hue.room_state.radio_volume=e;let t=Hue.utilz.to_hundred(e);$("#audio_player").length>0&&($("#audio_player")[0].volume=Hue.room_state.radio_volume),Hue.youtube_player&&(t>0&&Hue.youtube_player.unMute(),Hue.youtube_player.setVolume(t)),Hue.soundcloud_player&&Hue.soundcloud_player.setVolume(t),o&&(Hue.set_radio_volume_widget(e),a&&Hue.set_media_menu_radio_volume(e),Hue.save_room_state())},Hue.radio_volume_increase=function(e=.1){if(1===Hue.room_state.radio_volume)return!1;let o=Hue.room_state.radio_volume+e;Hue.set_radio_volume(o)},Hue.radio_volume_decrease=function(e=.1){if(0===Hue.room_state.radio_volume)return!1;let o=Hue.room_state.radio_volume-e;Hue.set_radio_volume(o)},Hue.show_played=function(e=!1){Hue.msg_played.show(function(){e&&($("#played_filter").val(e),Hue.do_modal_filter())})},Hue.announce_room_radio_mode_change=function(e){Hue.show_room_notification(e.username,`${e.username} changed the radio mode to ${e.what}`),Hue.set_room_radio_mode(e.what),Hue.change_radio_visibility(),Hue.check_permissions()},Hue.change_room_radio_mode=function(e){if(!Hue.is_admin_or_op(Hue.role))return Hue.not_an_op(),!1;let o=["enabled","disabled","locked"];return o.includes(e)?e===Hue.room_radio_mode?(Hue.feedback("Radio mode is already set to that"),!1):void Hue.socket_emit("change_radio_mode",{what:e}):(Hue.feedback(`Valid radio modes: ${o.join(" ")}`),!1)},Hue.clear_automatic_stop_radio=function(e=!0){clearTimeout(Hue.stop_radio_timeout),Hue.stop_radio_timeout=void 0,Hue.stop_radio_delay=0,e&&Hue.feedback("Radio won't stop automatically anymore")},Hue.restart_radio=function(){Hue.change_radio_source("restart"),Hue.msg_radio_picker.close()},Hue.show_radio_picker=function(){if(!Hue.can_radio)return Hue.feedback("You don't have radio permission"),!1;Hue.msg_radio_picker.show(function(){$("#radio_source_picker_input").focus(),Hue.scroll_modal_to_bottom("radio_picker")})},Hue.set_room_radio_mode=function(e){Hue.room_radio_mode=e,Hue.config_admin_room_radio_mode()},Hue.stop_radio_in=function(e){if(!Hue.radio_started)return Hue.feedback("Radio is not started"),!1;Hue.clear_automatic_stop_radio(!1);let o,a=6e4*e;Hue.stop_radio_delay=e,Hue.stop_radio_timeout=setTimeout(function(){Hue.radio_started&&Hue.stop_radio()},a),o=1===e?"1 minute":`${e} minutes`,Hue.feedback(`Radio will stop automatically in ${o}`)},Hue.set_media_menu_radio_volume=function(e=!1){!1===e?e=Hue.room_state.radio_volume:"increase"===e?(e=Hue.room_state.radio_volume+.2)>1&&(e=1):"decrease"===e?(e=Hue.room_state.radio_volume-.2)<0&&(e=0):"max"===e?e=1:"min"===e?e=0:"default"===e&&(e=Hue.config.room_state_default_radio_volume),$("#media_menu_radio_volume").val(e),Hue.set_radio_volume(e,!0,!1)},Hue.radio_picker_submit=function(){let e=$("#radio_source_picker_input").val().trim();""!==e&&(Hue.change_radio_source(e),Hue.msg_radio_picker.close())},Hue.setup_radio_widget=function(){$("#toggle_radio_state").on("auxclick",function(e){2===e.which&&Hue.radio_started&&(Hue.stop_radio(),Hue.start_radio())}),$("#header_now_playing_controls").on("auxclick",function(e){2===e.which&&Hue.search_on("youtube",$(this).data("q"))}),Hue.set_radio_volume_widget()};
Hue.send_reaction=function(e){return Hue.can_chat?!!Hue.reaction_types.includes(e)&&(Hue.socket_emit("send_reaction",{reaction_type:e}),void Hue.hide_reactions_box()):(Hue.feedback("You don't have permission to chat"),!1)},Hue.show_reaction=function(e,i=!1){let o,t,n;if(o=i||Date.now(),"like"===e.reaction_type)t="<i class='icon2c far fa-thumbs-up'></i>",n="likes this";else if("love"===e.reaction_type)t="<i class='icon2c far fa-heart'></i>",n="loves this";else if("happy"===e.reaction_type)t="<i class='icon2c far fa-smile'></i>",n="is feeling happy";else if("meh"===e.reaction_type)t="<i class='icon2c far fa-meh'></i>",n="is feeling meh";else if("sad"===e.reaction_type)t="<i class='icon2c far fa-frown'></i>",n="is feeling sad";else{if("dislike"!==e.reaction_type)return!1;t="<i class='icon2c far fa-thumbs-down'></i>",n="dislikes this"}Hue.update_chat({id:e.id,brk:t,message:n,username:e.username,prof_image:e.profile_image,third_person:!0,date:o})},Hue.setup_reactions_box=function(){$("#footer_user_menu_container").hover(function(){clearTimeout(Hue.hide_reactions_timeout),Hue.show_reactions_timeout=setTimeout(function(){Hue.show_reactions_box()},Hue.reactions_hover_delay)},function(){Hue.start_hide_reactions()}),$("#reactions_box_container").hover(function(){Hue.mouse_over_reactions=!0,clearTimeout(Hue.hide_reactions_timeout)},function(){Hue.mouse_over_reactions=!1,Hue.start_hide_reactions()}),$("#chat_area").click(function(){Hue.reactions_box_open&&Hue.hide_reactions_box()}),$("#input").click(function(){Hue.reactions_box_open&&Hue.hide_reactions_box()}),Hue.horizontal_separator.separate("reactions_box")},Hue.start_hide_reactions=function(){clearTimeout(Hue.show_reactions_timeout),Hue.hide_reactions_timeout=setTimeout(function(){if(Hue.mouse_over_reactions)return!1;Hue.hide_reactions_box()},Hue.reactions_hover_delay_2)},Hue.show_reactions_box=function(){Hue.reactions_box_open||($("#reactions_box_container").css("display","flex"),Hue.reactions_box_open=!0)},Hue.hide_reactions_box=function(){Hue.reactions_box_open&&($("#reactions_box_container").css("display","none"),Hue.reactions_box_open=!1)};
Hue.get_room_state=function(){let e=Hue.get_local_storage(Hue.ls_room_state);null===e&&(e={}),Hue.room_state=e[Hue.room_id],void 0===Hue.room_state&&(Hue.room_state={});let t=!1,i=["images_enabled","tv_enabled","radio_enabled","images_locked","tv_locked","radio_locked","radio_volume","tv_volume","screen_locked","synth_muted","lockscreen_lights_off","chat_searches","last_highlight_date"];for(let e of i)void 0===Hue.room_state[e]&&(Hue.room_state[e]=Hue.config[`room_state_default_${e}`],t=!0);t&&Hue.save_room_state()},Hue.save_room_state=function(){let e=Hue.get_local_storage(Hue.ls_room_state);null===e&&(e={}),e[Hue.room_id]=Hue.room_state,Hue.save_local_storage(Hue.ls_room_state,e)},Hue.show_status=function(){Hue.msg_info2.show(["Room Status",Hue.template_status({info:Hue.get_status_html()})])},Hue.get_status_html=function(){let e=$("<div></div>"),t="";t+="<div class='info_item'><div class='info_title'>Room Name</div><div class='info_item_content' id='status_room_name'></div></div>",Hue.topic_setter?t+="<div class='info_item' id='status_topic_item'><div class='info_title'>Topic</div><div class='info_item_content' id='status_topic'></div></div>":t+="<div class='info_item'><div class='info_title'>Topic</div><div class='info_item_content' id='status_topic'></div></div>",t+="<div class='info_item'><div class='info_title'>Privacy</div>",Hue.is_public?t+="<div class='info_item_content'>Public</div></div>":t+="<div class='info_item_content'>Private</div></div>",t+="<div class='info_item'><div class='info_title'>Log</div>",Hue.log_enabled?t+="<div class='info_item_content'>Enabled</div></div>":t+="<div class='info_item_content'>Disabled</div></div>",Hue.current_image().setter&&(t+="<div class='info_item'><div class='info_title'>Image Setter</div>",t+="<div class='info_item_content' id='status_image_setter'></div></div>"),Hue.current_image().source&&(t+="<div class='info_item'><div class='info_title'>Image Source</div>",t+="<div class='info_item_content' id='status_image_source'></div></div>"),Hue.current_image().nice_date&&(t+="<div class='info_item'><div class='info_title'>Image Date</div>",t+="<div class='info_item_content' id='status_image_date'></div></div>"),Hue.current_tv().setter&&(t+="<div class='info_item'><div class='info_title'>TV Setter</div>",t+="<div class='info_item_content' id='status_tv_setter'></div></div>"),Hue.current_tv().title&&(t+="<div class='info_item'><div class='info_title'>TV Title</div>",t+="<div class='info_item_content' id='status_tv_title'></div></div>"),Hue.current_tv().source&&(t+="<div class='info_item'><div class='info_title'>TV Source</div>",t+="<div class='info_item_content' id='status_tv_source'></div></div>"),Hue.current_tv().nice_date&&(t+="<div class='info_item'><div class='info_title'>TV Date</div>",t+="<div class='info_item_content' id='status_tv_date'></div></div>"),Hue.current_radio().setter&&(t+="<div class='info_item'><div class='info_title'>Radio Setter</div>",t+="<div class='info_item_content' id='status_radio_setter'></div></div>"),Hue.current_radio().title&&(t+="<div class='info_item'><div class='info_title'>Radio Title</div>",t+="<div class='info_item_content' id='status_radio_title'></div></div>"),Hue.current_radio().source&&(t+="<div class='info_item'><div class='info_title'>Radio Source</div>",t+="<div class='info_item_content' id='status_radio_source'></div></div>"),Hue.current_radio().nice_date&&(t+="<div class='info_item'><div class='info_title'>Radio Date</div>",t+="<div class='info_item_content' id='status_radio_date'></div></div>"),e.append(t),e.find("#status_room_name").eq(0).text(Hue.room_name).urlize(),e.find("#status_topic_item").eq(0).attr("title",`Setter: ${Hue.topic_setter} | ${Hue.topic_date}`);let i=e.find("#status_topic").eq(0);return i.text(Hue.get_topic()).urlize(),Hue.current_image().setter&&(i=e.find("#status_image_setter").eq(0)).text(Hue.current_image().setter),Hue.current_image().source&&(i=e.find("#status_image_source").eq(0)).text(Hue.get_proper_media_url("image")).urlize(),Hue.current_image().nice_date&&(i=e.find("#status_image_date").eq(0)).text(Hue.current_image().nice_date),Hue.current_tv().setter&&(i=e.find("#status_tv_setter").eq(0)).text(Hue.current_tv().setter),Hue.current_tv().title&&(i=e.find("#status_tv_title").eq(0)).text(Hue.current_tv().title).urlize(),Hue.current_tv().source&&(i=e.find("#status_tv_source").eq(0)).text(Hue.get_proper_media_url("tv")).urlize(),Hue.current_tv().nice_date&&(i=e.find("#status_tv_date").eq(0)).text(Hue.current_tv().nice_date),Hue.current_radio().setter&&(i=e.find("#status_radio_setter").eq(0)).text(Hue.current_radio().setter),Hue.current_radio().title&&(i=e.find("#status_radio_title").eq(0)).text(Hue.current_radio().title).urlize(),Hue.current_radio().source&&(i=e.find("#status_radio_source").eq(0)).text(Hue.get_proper_media_url("radio")).urlize(),Hue.current_radio().nice_date&&(i=e.find("#status_radio_date").eq(0)).text(Hue.current_radio().nice_date),e.html()},Hue.show_public=function(){Hue.is_public?Hue.feedback("This room is public"):Hue.feedback("This room is private")},Hue.show_room=function(){Hue.feedback(`Room: ${Hue.room_name}`)},Hue.change_room_name=function(e){if(!Hue.is_admin_or_op(Hue.role))return Hue.not_an_op(),!1;(e=Hue.utilz.clean_string2(e.substring(0,Hue.config.max_room_name_length)))!==Hue.room_name?e.length>0&&Hue.socket_emit("change_room_name",{name:e}):Hue.feedback("That's already the room name")},Hue.room_name_edit=function(){Hue.change_input(`/roomname ${Hue.room_name}`)},Hue.get_unset_topic=function(){return Hue.is_admin_or_op()?Hue.config.default_topic_admin:Hue.config.default_topic},Hue.get_topic=function(){return Hue.topic?Hue.topic:Hue.get_unset_topic()},Hue.show_topic=function(){Hue.topic?""!==Hue.topic_setter?Hue.feedback(`Topic: ${Hue.topic}`,{title:`Setter: ${Hue.topic_setter} | ${Hue.topic_date} | ${Hue.utilz.nice_date()}`}):Hue.feedback(`Topic: ${Hue.topic}`):Hue.feedback(`Topic: ${Hue.get_unset_topic()}`)},Hue.clear_room=function(){Hue.clear_chat();let e=Hue.images_changed=Hue.images_changed.slice(-1)[0],t=Hue.tv_changed=Hue.tv_changed.slice(-1)[0],i=Hue.radio_changed=Hue.radio_changed.slice(-1)[0];Hue.loaded_image={},Hue.loaded_tv={},Hue.loaded_radio={},Hue.images_changed=[],Hue.tv_changed=[],Hue.radio_changed=[],Hue.setup_image("show",e),Hue.setup_tv("show",t),Hue.setup_radio("show",i),Hue.change({type:"image"}),Hue.change({type:"tv"}),Hue.change({type:"radio"})},Hue.copy_room_url=function(){let e;e=Hue.room_id===Hue.config.main_room_id?"":"/"+Hue.room_id;let t=window.location.origin+e;Hue.copy_string(t)},Hue.announce_room_name_change=function(e){e.name!==Hue.room_name&&(Hue.show_room_notification(e.username,`${e.username} changed the room name to: "${e.name}"`),Hue.set_room_name(e.name),Hue.update_title(),Hue.update_input_placeholder())},Hue.set_room_name=function(e){Hue.room_name=e,Hue.config_admin_room_name()},Hue.change_topic=function(e){Hue.is_admin_or_op()?(e=Hue.utilz.clean_string2(e.substring(0,Hue.config.max_topic_length))).length>0&&(Hue.topic!==e?Hue.socket_emit("change_topic",{topic:e}):Hue.feedback("Topic is already set to that")):Hue.not_an_op()},Hue.topicadd=function(e){if(Hue.is_admin_or_op()){if(0===(e=Hue.utilz.clean_string2(e)).length)return;let t=Hue.topic+Hue.config.topic_separator+e;if(t.length>Hue.config.max_topic_length)return void Hue.feedback("There is no more room to add that to the topic");Hue.change_topic(t)}else Hue.not_an_op()},Hue.topictrim=function(e){if(Hue.is_admin_or_op()){let t=Hue.topic.split(Hue.config.topic_separator);if(t.length>1){if(isNaN(e))return Hue.feedback("Argument must be a number"),!1;if(e<1)return!1;if(e>t.length-1&&(e=t.length-1),t.length>1){let i=t.slice(0,-e).join(Hue.config.topic_separator);i.length>0&&Hue.change_topic(i)}}else Hue.feedback("Nothing to trim")}else Hue.not_an_op()},Hue.topicstart=function(e){if(Hue.is_admin_or_op()){if(0===(e=Hue.utilz.clean_string2(e)).length)return;let t=e+Hue.config.topic_separator+Hue.topic;if(t.length>Hue.config.max_topic_length)return void Hue.feedback("There is no more room to add that to the topic");Hue.change_topic(t)}else Hue.not_an_op()},Hue.topictrimstart=function(e){if(Hue.is_admin_or_op()){let t=Hue.topic.split(Hue.config.topic_separator);if(t.length>1){if(isNaN(e))return Hue.feedback("Argument must be a number"),!1;if(e<1)return!1;if(e>t.length-1&&(e=t.length-1),t.length>1){let i=t.slice(e,t.length).join(Hue.config.topic_separator);i.length>0&&Hue.change_topic(i)}}else Hue.feedback("Nothing to trim")}else Hue.not_an_op()},Hue.topicedit=function(){Hue.change_input(`/topic ${Hue.topic}`)},Hue.announce_topic_change=function(e){e.topic!==Hue.topic&&(Hue.show_room_notification(e.topic_setter,`${e.topic_setter} changed the topic to: "${e.topic}"`),Hue.set_topic_info(e),Hue.update_title())},Hue.set_topic_info=function(e){if(e||((e={}).topic="",e.topic_setter="",e.topic_date=""),Hue.topic=e.topic,Hue.topic_setter=e.topic_setter,Hue.topic_date=Hue.utilz.nice_date(e.topic_date),Hue.topic)$("#header_topic_text").text(Hue.topic);else{let e=Hue.get_unset_topic();$("#header_topic_text").text(e)}Hue.config_admin_topic()},Hue.change_privacy=function(e){return Hue.is_admin_or_op(Hue.role)?Hue.is_public===e?(e?Hue.feedback("Room is already public"):Hue.feedback("Room is already private"),!1):void Hue.socket_emit("change_privacy",{what:e}):(Hue.not_an_op(),!1)},Hue.announce_privacy_change=function(e){let t;Hue.set_privacy(e.what),Hue.is_public?(t=`${e.username} made the room public`,t+=". The room will appear in the public room list"):(t=`${e.username} made the room private`,t+=". The room won't appear in the public room list"),Hue.show_room_notification(e.username,t)},Hue.set_privacy=function(e){Hue.is_public=e,Hue.config_admin_privacy()},Hue.set_log_enabled=function(e){Hue.log_enabled=e,Hue.config_admin_log_enabled()},Hue.change_log=function(e){if(!Hue.is_admin_or_op(Hue.role))return Hue.not_an_op(),!1;e===Hue.log_enabled&&(e?Hue.feedback("Log is already enabled"):Hue.feedback("Log is already disabled")),Hue.socket_emit("change_log",{log:e})},Hue.clear_log=function(e="all",t=!1){return Hue.utilz.clear_log_types.includes(e)?"above"!==e&&"below"!==e||t?Hue.is_admin_or_op(Hue.role)?void Hue.socket_emit("clear_log",{type:e,id:t}):(Hue.not_an_op(),!1):(Hue.feedback("A message ID needs to be provided for this operation"),!1):(Hue.feedback(`Invalid type. Available types are: ${Hue.utilz.clear_log_types.join(", ")}`),!1)},Hue.announce_log_change=function(e){let t;e.log||Hue.clear_room(),t=e.log?`${e.username} enabled the log`:`${e.username} cleared and disabled the log`,Hue.set_log_enabled(e.log),Hue.show_room_notification(e.username,t)},Hue.announce_log_cleared=function(e){"all"===e.type?Hue.clear_room():"above"!==e.type&&"below"!==e.type||Hue.remove_messages_after_id(e.id,e.type),Hue.show_room_notification(e.username,`${e.username} cleared the log`)},Hue.show_log=function(){Hue.log_enabled?Hue.feedback("Log is enabled"):Hue.feedback("Log is disabled")},Hue.request_admin_activity=function(e=""){if(!Hue.is_admin_or_op(Hue.role))return Hue.not_an_op(),!1;Hue.admin_activity_filter_string=e,Hue.socket_emit("get_admin_activity",{})},Hue.show_admin_activity=function(e){$("#admin_activity_container").html(""),Hue.msg_admin_activity.show(function(){for(let t of e){let e=Hue.utilz.nice_date(t.date),i=$(`\n            <div class='modal_item admin_activity_item dynamic_title' title='${e}'>\n                <div class='admin_activity_message'></div>\n                <div class='admin_activity_date'></div>\n            </div>`);i.find(".admin_activity_message").eq(0).text(`${t.data.username} ${t.data.content}`),i.find(".admin_activity_date").eq(0).text(e),i.data("date",t.date),i.data("otitle",e),$("#admin_activity_container").prepend(i)}$("#admin_activity_filter").val(Hue.admin_activity_filter_string),Hue.do_modal_filter()})},Hue.request_admin_list=function(){if(!Hue.is_admin_or_op(Hue.role))return Hue.not_an_op(),!1;Hue.socket_emit("get_admin_list",{})},Hue.show_admin_list=function(e){let t=$("<div id='admin_list_container' class='grid_column_center'></div>");e.list.sort(Hue.compare_userlist);for(let i of e.list){let e=$(`<div class='admin_list_item pointer action'>${"<div class='flex_row_center'><div class='admin_list_username'></div>&nbsp;&nbsp;<div class='admin_list_role'></div></div>"}</div>`);e.find(".admin_list_username").eq(0).text(i.username),e.find(".admin_list_role").eq(0).text(`(${Hue.get_pretty_role_name(i.role)})`),e.click(function(){Hue.show_profile(i.username)}),t.append(e)}Hue.msg_info2.show([`Admin List (${e.list.length})`,t[0]],function(){Hue.admin_list_open=!0})},Hue.request_ban_list=function(){if(!Hue.is_admin_or_op(Hue.role))return Hue.not_an_op(),!1;Hue.socket_emit("get_ban_list",{})},Hue.show_ban_list=function(e){let t=$("<div id='ban_list_container' class='grid_column_center'></div>");for(let i of e.list){let e=$(`<div class='ban_list_item pointer action'>${"<div class='flex_row_center'><div class='ban_list_username' title='Click To Unban'></div></div>"}</div>`);e.find(".ban_list_username").eq(0).text(i.username),e.click(function(){confirm(`Are you sure you want to unban ${i.username}`)&&Hue.unban(i.username)}),t.append(e)}Hue.msg_info2.show([`Ban List (${e.list.length})`,t[0]],function(){Hue.ban_list_open=!0})},Hue.request_access_log=function(e=""){if(!Hue.is_admin_or_op(Hue.role))return Hue.not_an_op(),!1;Hue.access_log_filter_string=e,Hue.socket_emit("get_access_log",{})},Hue.show_access_log=function(e){$("#access_log_container").html(""),Hue.msg_access_log.show(function(){for(let t of e){let e=Hue.utilz.nice_date(t.date),i=$(`\n            <div class='modal_item access_log_item dynamic_title' title='${e}'>\n                <div class='access_log_message'></div>\n                <div class='access_log_date'></div>\n            </div>`);i.find(".access_log_message").eq(0).text(`${t.data.username} ${t.data.content}`),i.find(".access_log_date").eq(0).text(e),i.data("date",t.date),i.data("otitle",e),$("#access_log_container").prepend(i)}$("#access_log_filter").val(Hue.access_log_filter_string),Hue.do_modal_filter()})};
Hue.make_room_menu_permissions_container=function(){let e="";for(let n=1;n<Hue.vtypes.length+1;n++)e+=Hue.template_room_menu_permissions_container({number:n});return e},Hue.setup_room_menu=function(){Hue.setup_togglers("room_menu"),Hue.setup_togglers("room_menu_permissions"),$(".admin_voice_permissions_checkbox").each(function(){$(this).change(function(){let e=$(this).prop("checked");Hue.change_voice_permission($(this).data("ptype"),e)})}),$("#admin_enable_images").change(function(){let e=$("#admin_enable_images option:selected").val();Hue.change_room_images_mode(e)}),$("#admin_enable_tv").change(function(){let e=$("#admin_enable_tv option:selected").val();Hue.change_room_tv_mode(e)}),$("#admin_enable_radio").change(function(){let e=$("#admin_enable_radio option:selected").val();Hue.change_room_radio_mode(e)}),$("#admin_enable_synth").change(function(){let e=$("#admin_enable_synth option:selected").val();Hue.change_room_synth_mode(e)}),$("#admin_privacy").change(function(){let e=JSON.parse($("#admin_privacy option:selected").val());Hue.change_privacy(e)}),$("#admin_log").change(function(){let e=JSON.parse($("#admin_log option:selected").val());Hue.change_log(e)}),$("#admin_theme_mode_select").change(function(){let e=$("#admin_theme_mode_select option:selected").val();Hue.change_theme_mode(e)}),$("#admin_theme").change(function(){Hue.change_theme($(this).val())}),$("#admin_background_mode_select").change(function(){let e=$("#admin_background_mode_select option:selected").val();Hue.change_background_mode(e)}),$("#admin_background_effect_select").change(function(){let e=$("#admin_background_effect_select option:selected").val();Hue.change_background_effect(e)}),$("#admin_background_tile_dimensions").blur(function(){let e=Hue.utilz.clean_string2($(this).val());if(""===e)return $("#admin_background_tile_dimensions").val(Hue.background_tile_dimensions),!1;Hue.change_background_tile_dimensions(e)}),$("#admin_text_color_mode_select").change(function(){let e=$("#admin_text_color_mode_select option:selected").val();Hue.change_text_color_mode(e)}),$("#admin_text_color").change(function(){Hue.change_text_color($(this).val())}),$("#admin_room_name").blur(function(){let e=Hue.utilz.clean_string2($(this).val());if(""===e)return $("#admin_room_name").val(Hue.room_name),!1;e!==Hue.room_name&&Hue.change_room_name(e)}),$("#admin_topic").blur(function(){let e=Hue.utilz.clean_string2($(this).val());if(""===e)return $("#admin_topic").val(Hue.topic),!1;e!==Hue.topic&&Hue.change_topic(e)}),$("#admin_background_image").on("error",function(){$(this).attr("src")!==Hue.config.background_image_loading_url&&$(this).attr("src",Hue.config.background_image_loading_url)}),$("#admin_media_info").change(function(){let e=$("#admin_media_info option:selected").val();Hue.change_media_info(e)})},Hue.show_room_menu=function(){Hue.msg_room_menu.show()},Hue.config_room_menu=function(){Hue.is_admin_or_op()?(Hue.config_admin_permission_checkboxes(),Hue.config_admin_room_images_mode(),Hue.config_admin_room_tv_mode(),Hue.config_admin_room_radio_mode(),Hue.config_admin_room_synth_mode(),Hue.config_admin_privacy(),Hue.config_admin_log_enabled(),Hue.config_admin_theme_mode(),Hue.config_admin_theme(),Hue.config_admin_background_mode(),Hue.config_admin_background_effect(),Hue.config_admin_background_tile_dimensions(),Hue.config_admin_background_image(),Hue.config_admin_text_color_mode(),Hue.config_admin_text_color(),Hue.config_admin_room_name(),Hue.config_admin_topic(),Hue.config_admin_media_info(),$("#admin_menu").css("display","block")):$("#admin_menu").css("display","none")},Hue.config_admin_permission_checkboxes=function(){if(!Hue.is_admin_or_op())return!1;$(".admin_voice_permissions_checkbox").each(function(){$(this).prop("checked",Hue[$(this).data("ptype")])})},Hue.config_admin_background_mode=function(){if(!Hue.is_admin_or_op())return!1;$("#admin_background_mode_select").find("option").each(function(){$(this).val()===Hue.background_mode&&$(this).prop("selected",!0)}),$("#admin_background_effect_select").find("option").each(function(){$(this).val()===Hue.background_effect&&$(this).prop("selected",!0)}),"normal"===Hue.background_mode?($("#admin_background_tile_dimensions_container").css("display","none"),$("#admin_background_image_container").css("display","block"),$("#admin_background_effect_container").css("display","block")):"tiled"===Hue.background_mode?($("#admin_background_tile_dimensions_container").css("display","block"),$("#admin_background_image_container").css("display","block"),$("#admin_background_effect_container").css("display","block")):"mirror"===Hue.background_mode?($("#admin_background_tile_dimensions_container").css("display","none"),$("#admin_background_image_container").css("display","none"),$("#admin_background_effect_container").css("display","block")):"mirror_tiled"===Hue.background_mode?($("#admin_background_tile_dimensions_container").css("display","block"),$("#admin_background_image_container").css("display","none"),$("#admin_background_effect_container").css("display","block")):"solid"===Hue.background_mode&&($("#admin_background_tile_dimensions_container").css("display","none"),$("#admin_background_image_container").css("display","none"),$("#admin_background_effect_container").css("display","none"))},Hue.config_admin_background_tile_dimensions=function(){if(!Hue.is_admin_or_op())return!1;$("#admin_background_tile_dimensions").val(Hue.background_tile_dimensions)},Hue.config_admin_background_image=function(){if(!Hue.is_admin_or_op())return!1;if(Hue.background_image!==$("#admin_background_image").attr("src")&&(""!==Hue.background_image?$("#admin_background_image").attr("src",Hue.background_image):$("#admin_background_image").attr("src",Hue.config.default_background_image_url)),Hue.background_image_setter){let e=`Setter: ${Hue.background_image_setter}`;Hue.background_image_date&&(e+=` | ${Hue.utilz.nice_date(Hue.background_image_date)}`),$("#admin_background_image").attr("title",e)}},Hue.config_admin_background_effect=function(){$("#admin_background_effect_select").find("option").each(function(){$(this).val()===Hue.background_effect&&$(this).prop("selected",!0)})},Hue.config_admin_text_color_mode=function(){if(!Hue.is_admin_or_op())return!1;$("#admin_text_color_mode_select").find("option").each(function(){$(this).val()===Hue.text_color_mode&&$(this).prop("selected",!0)}),"custom"===Hue.text_color_mode?$("#admin_text_color_container").css("display","block"):$("#admin_text_color_container").css("display","none")},Hue.config_admin_text_color=function(){if(!Hue.is_admin_or_op())return!1;$("#admin_text_color").val(Hue.text_color)},Hue.config_admin_privacy=function(){if(!Hue.is_admin_or_op())return!1;$("#admin_privacy").find("option").each(function(){JSON.parse($(this).val())===Hue.is_public&&$(this).prop("selected",!0)})},Hue.config_admin_log_enabled=function(){if(!Hue.is_admin_or_op())return!1;$("#admin_log").find("option").each(function(){JSON.parse($(this).val())===Hue.log_enabled&&$(this).prop("selected",!0)})},Hue.config_admin_media_info=function(){if(!Hue.is_admin_or_op())return!1;$("#admin_media_info").val(Hue.media_info)},Hue.config_admin_room_images_mode=function(){if(!Hue.is_admin_or_op())return!1;$("#admin_enable_images").find("option").each(function(){$(this).val()===Hue.room_images_mode&&$(this).prop("selected",!0)})},Hue.config_admin_room_tv_mode=function(){if(!Hue.is_admin_or_op())return!1;$("#admin_enable_tv").find("option").each(function(){$(this).val()===Hue.room_tv_mode&&$(this).prop("selected",!0)})},Hue.config_admin_room_radio_mode=function(){if(!Hue.is_admin_or_op())return!1;$("#admin_enable_radio").find("option").each(function(){$(this).val()===Hue.room_radio_mode&&$(this).prop("selected",!0)})},Hue.config_admin_room_synth_mode=function(){if(!Hue.is_admin_or_op())return!1;$("#admin_enable_synth").find("option").each(function(){$(this).val()===Hue.room_synth_mode&&$(this).prop("selected",!0)})},Hue.config_admin_theme_mode=function(){if(!Hue.is_admin_or_op())return!1;$("#admin_theme_mode_select").find("option").each(function(){$(this).val()===Hue.theme_mode&&$(this).prop("selected",!0)}),"custom"===Hue.theme_mode?$("#admin_theme_mode_container").css("display","block"):$("#admin_theme_mode_container").css("display","none")},Hue.config_admin_theme=function(){if(!Hue.is_admin_or_op())return!1;$("#admin_theme").val(Hue.theme)},Hue.config_admin_room_name=function(){if(!Hue.is_admin_or_op())return!1;$("#admin_room_name").val(Hue.room_name)},Hue.config_admin_topic=function(){if(!Hue.is_admin_or_op())return!1;$("#admin_topic").val(Hue.topic)};
Hue.create_room=function(o){Hue.msg_info2.close(function(){Hue.socket_emit("create_room",o)})},Hue.request_roomlist=function(o="",e="public_roomlist"){if(Hue.requesting_roomlist)return!1;Hue.requesting_roomlist=!0,Hue[`${e}_filter_string`]=o,Hue.socket_emit("roomlist",{type:e}),setTimeout(function(){Hue.requesting_roomlist=!1},1e3)},Hue.on_roomlist_received=function(o){Hue.update_roomlist(o.type,o.roomlist),"public_roomlist"===o.type?Hue.show_public_roomlist():"visited_roomlist"===o.type&&Hue.show_visited_roomlist()},Hue.start_roomlist_click_events=function(){$("#public_roomlist_container").on("click",".roomlist_item_inner",function(){Hue.show_open_room($(this).data("room_id"))}),$("#visited_roomlist_container").on("click",".roomlist_item_inner",function(){Hue.show_open_room($(this).data("room_id"))})},Hue.update_roomlist=function(o,e){$(`#${o}_filter`).val(Hue[`${o}_filter_string`]);let t=$();t=t.add();for(let o=0;o<e.length;o++){let i,n=`<div class='roomlist_item_inner pointer inline action' data-room_id='${e[o].id}'>\n            <div class='roomlist_name'></div><div class='roomlist_topic'></div>\n            <div class='roomlist_here'></div><div class='roomlist_count'></div>\n        </div>`,_=$(`<div class='modal_item roomlist_item'>${n}</div>`);_.find(".roomlist_name").eq(0).text(e[o].name),_.find(".roomlist_count").eq(0).text(Hue.utilz.singular_or_plural(e[o].usercount,"users")),e[o].id===Hue.room_id&&_.find(".roomlist_here").eq(0).text("You are here").css("display","block"),i=e[o].topic.length>0?e[o].topic:"No topic set",_.find(".roomlist_topic").eq(0).text(i).urlize(),t=t.add(_)}$(`#${o}_container`).html(t),""!==Hue[`${o}_filter_string`]&&Hue.do_modal_filter(o)},Hue.show_create_room=function(){Hue.msg_info2.show(["Create Room",Hue.template_create_room()],function(){$("#create_room_name").focus(),Hue.create_room_open=!0})},Hue.create_room_submit=function(){let o={};if(o.name=Hue.utilz.clean_string2($("#create_room_name").val().substring(0,Hue.config.max_room_name_length)),""===o.name)return!1;o.public=JSON.parse($("#create_room_public option:selected").val()),Hue.create_room(o)},Hue.create_room_suggest_name=async function(){void 0===Hue.wordz&&await Hue.load_wordz();let o=Hue.wordz.make_random_sentence(2,!0);$("#create_room_name").val(o)},Hue.show_open_room=function(o){o===Hue.config.main_room_id&&(o="/"),Hue.msg_info2.show(["Open Room",Hue.template_open_room({id:o})],function(){Hue.open_room_open=!0})},Hue.show_public_roomlist=function(){Hue.msg_public_roomlist.show()},Hue.show_visited_roomlist=function(){Hue.msg_visited_roomlist.show()},Hue.show_goto_room=function(){Hue.msg_info2.show(["Go To Room",Hue.template_goto_room()],function(){$("#goto_room_input").focus(),Hue.goto_room_open=!0})},Hue.goto_room_action=function(){let o=$("#goto_room_input").val().trim();if(0===o.length)return!1;Hue.show_open_room(o)},Hue.on_room_created=function(o){Hue.feedback("Room Created",{brk:"<i class='icon2c fa fa-key'></i>",onclick:function(){Hue.show_open_room(o.id)},save:!0}),Hue.show_open_room(o.id)};
Hue.load_script=function(o){return!!Hue.load_scripts&&(console.info(`Loading script: ${o}`),new Promise((n,e)=>{const r=document.createElement("script");document.body.appendChild(r),r.onload=n,r.onerror=e,r.async=!0,r.src=o}))},Hue.load_wordz=async function(){return!Hue.wordz_loading&&(Hue.wordz_loading=!0,new Promise(async(o,n)=>{await Hue.load_script("/static/js/libs2/wordz.js?version=1"),Hue.wordz=Wordz(),o()}))};
Hue.user_settings={beep_on_messages:{widget_type:"checkbox",description:"Make a sound on new messages when the client is not visible",action:(e,t=!0)=>{Hue[e].beep_on_messages=$(`#${e}_beep_on_messages`).prop("checked"),t&&Hue[`save_${e}`]()}},beep_on_highlights:{widget_type:"checkbox",description:"Make a sound on new highlights when the client is not visible",action:(e,t=!0)=>{Hue[e].beep_on_highlights=$(`#${e}_beep_on_highlights`).prop("checked"),t&&Hue[`save_${e}`]()}},beep_on_media_change:{widget_type:"checkbox",description:"Make a sound on new media change announcements when the client is not visible",action:(e,t=!0)=>{Hue[e].beep_on_media_change=$(`#${e}_beep_on_media_change`).prop("checked"),t&&Hue[`save_${e}`]()}},beep_on_user_joins:{widget_type:"checkbox",description:"Make a sound when users join when the client is not visible",action:(e,t=!0)=>{Hue[e].beep_on_user_joins=$(`#${e}_beep_on_user_joins`).prop("checked"),t&&Hue[`save_${e}`]()}},highlight_current_username:{widget_type:"checkbox",description:"Whether messages containing the user's username must be highlighted",action:(e,t=!0)=>{Hue[e].highlight_current_username=$(`#${e}_highlight_current_username`).prop("checked"),t&&Hue[`save_${e}`]()}},case_insensitive_username_highlights:{widget_type:"checkbox",description:"Whether username highlight checks are case insensitive or not",action:(e,t=!0)=>{Hue[e].case_insensitive_username_highlights=$(`#${e}_case_insensitive_username_highlights`).prop("checked"),Hue.active_settings("case_insensitive_username_highlights")===e&&Hue.generate_mentions_regex(),t&&Hue[`save_${e}`]()}},case_insensitive_words_highlights:{widget_type:"checkbox",description:"Whether 'other words' highlight checks are case insensitive or not",action:(e,t=!0)=>{Hue[e].case_insensitive_words_highlights=$(`#${e}_case_insensitive_words_highlights`).prop("checked"),Hue.active_settings("case_insensitive_words_highlights")===e&&Hue.generate_highlight_words_regex(),t&&Hue[`save_${e}`]()}},case_insensitive_ignored_words:{widget_type:"checkbox",description:"Whether 'ignored words' highlight checks are case insensitive or not",action:(e,t=!0)=>{Hue[e].case_insensitive_ignored_words=$(`#${e}_case_insensitive_ignored_words`).prop("checked"),Hue.active_settings("case_insensitive_ignored_words")===e&&Hue.generate_ignored_words_regex(),t&&Hue[`save_${e}`]()}},ignored_words_exclude_same_user:{widget_type:"checkbox",description:"Whether messages containing 'ignored words' should be ignored if coming from the user itself",action:(e,t=!0)=>{Hue[e].ignored_words_exclude_same_user=$(`#${e}_ignored_words_exclude_same_user`).prop("checked"),t&&Hue[`save_${e}`]()}},other_words_to_highlight:{widget_type:"textarea",description:"Words on messages to trigger highlights",action:(e,t=!0)=>{let i=Hue.utilz.make_unique_lines(Hue.utilz.clean_string7($(`#${e}_other_words_to_highlight`).val()));$(`#${e}_other_words_to_highlight`).val(i),Hue[e].other_words_to_highlight=i,Hue.active_settings("other_words_to_highlight")===e&&Hue.generate_highlight_words_regex(),t&&Hue[`save_${e}`]()}},double_tap:{widget_type:"textarea",description:"Actions to perform after a Double Tap 1 trigger",action:(e,t=!0)=>{let i=Hue.utilz.clean_string7($(`#${e}_double_tap`).val());$(`#${e}_double_tap`).val(i),Hue[e].double_tap=i,t&&Hue[`save_${e}`]()}},double_tap_2:{widget_type:"textarea",description:"Actions to perform after a Double Tap 2 trigger",action:(e,t=!0)=>{let i=Hue.utilz.clean_string7($(`#${e}_double_tap_2`).val());$(`#${e}_double_tap_2`).val(i),Hue[e].double_tap_2=i,t&&Hue[`save_${e}`]()}},double_tap_3:{widget_type:"textarea",description:"Actions to perform after a Double Tap 3 trigger",action:(e,t=!0)=>{let i=Hue.utilz.clean_string7($(`#${e}_double_tap_3`).val());$(`#${e}_double_tap_3`).val(i),Hue[e].double_tap_3=i,t&&Hue[`save_${e}`]()}},at_startup:{widget_type:"textarea",description:"Actions to perform after a successful startup",action:(e,t=!0)=>{let i=Hue.utilz.clean_string7($(`#${e}_at_startup`).val());$(`#${e}_at_startup`).val(i),Hue[e].at_startup=i,t&&Hue[`save_${e}`]()}},afk_delay:{widget_type:"select",description:"How much time to consider the user as Away From Keyboard after the client loses visibility",action:(e,t=!0)=>{let i=$(`#${e}_afk_delay option:selected`).val();"never"!==i&&(i=parseInt(i)),Hue[e].afk_delay=i,t&&Hue[`save_${e}`]()}},ignored_usernames:{widget_type:"textarea",description:"Ignore messages and actions from these users",action:(e,t=!0)=>{let i=Hue.utilz.make_unique_lines(Hue.utilz.clean_string7($(`#${e}_ignored_usernames`).val()));$(`#${e}_ignored_usernames`).val(i),Hue[e].ignored_usernames=i,Hue.active_settings("ignored_usernames")===e&&(Hue.get_ignored_usernames_list(),Hue.check_activity_bar()),t&&Hue[`save_${e}`]()}},accept_commands_from:{widget_type:"textarea",description:"Accept remote command executions from these users",action:(e,t=!0)=>{let i=Hue.utilz.make_unique_lines(Hue.utilz.clean_string7($(`#${e}_accept_commands_from`).val()));$(`#${e}_accept_commands_from`).val(i),Hue[e].accept_commands_from=i,Hue.active_settings("ignored_usernames")===e&&Hue.get_accept_commands_from_list(),t&&Hue[`save_${e}`]()}},ignored_words:{widget_type:"textarea",description:"Ignore messages that contain these words",action:(e,t=!0)=>{let i=Hue.utilz.make_unique_lines(Hue.utilz.clean_string7($(`#${e}_ignored_words`).val()));$(`#${e}_ignored_words`).val(i),Hue[e].ignored_words=i,Hue.active_settings("ignored_words")===e&&Hue.generate_ignored_words_regex(),t&&Hue[`save_${e}`]()}},user_join_notifications_method:{widget_type:"select",description:"How user join notifications should be shown",action:(e,t=!0)=>{Hue[e].user_join_notifications_method=$(`#${e}_user_join_notifications_method option:selected`).val(),t&&Hue[`save_${e}`]()}},save_user_join_notifications:{widget_type:"checkbox",description:"Whether user join notifications should be saved in the notifications window",action:(e,t=!0)=>{Hue[e].save_user_join_notifications=$(`#${e}_save_user_join_notifications`).prop("checked"),t&&Hue[`save_${e}`]()}},user_part_notifications_method:{widget_type:"select",description:"How user part notifications should be shown",action:(e,t=!0)=>{Hue[e].user_part_notifications_method=$(`#${e}_user_part_notifications_method option:selected`).val(),t&&Hue[`save_${e}`]()}},save_user_part_notifications:{widget_type:"checkbox",description:"Whether user part notifications should be saved in the notifications window",action:(e,t=!0)=>{Hue[e].save_user_part_notifications=$(`#${e}_save_user_part_notifications`).prop("checked"),t&&Hue[`save_${e}`]()}},room_notifications_method:{widget_type:"select",description:"How room notifications should be shown",action:(e,t=!0)=>{Hue[e].room_notifications_method=$(`#${e}_room_notifications_method option:selected`).val(),t&&Hue[`save_${e}`]()}},save_room_notifications:{widget_type:"checkbox",description:"Whether room notifications should be saved in the notifications window",action:(e,t=!0)=>{Hue[e].save_room_notifications=$(`#${e}_save_room_notifications`).prop("checked"),t&&Hue[`save_${e}`]()}},auto_close_popup_notifications:{widget_type:"checkbox",description:"Whether info popups are closed automatically after a delay or just show close buttons",action:(e,t=!0)=>{Hue[e].auto_close_popup_notifications=$(`#${e}_auto_close_popup_notifications`).prop("checked"),t&&Hue[`save_${e}`]()}},animate_scroll:{widget_type:"checkbox",description:"Whether chat scroll animation is enabled in some cases or not at all",action:(e,t=!0)=>{Hue[e].animate_scroll=$(`#${e}_animate_scroll`).prop("checked"),t&&Hue[`save_${e}`]()}},afk_disable_messages_beep:{widget_type:"checkbox",description:"Whether alert sounds on new messages should be disabled when Away From Keyboard",action:(e,t=!0)=>{Hue[e].afk_disable_messages_beep=$(`#${e}_afk_disable_messages_beep`).prop("checked"),t&&Hue[`save_${e}`]()}},afk_disable_highlights_beep:{widget_type:"checkbox",description:"Whether alert sounds on new highlights should be disabled when Away From Keyboard",action:(e,t=!0)=>{Hue[e].afk_disable_highlights_beep=$(`#${e}_afk_disable_highlights_beep`).prop("checked"),t&&Hue[`save_${e}`]()}},afk_disable_media_change_beep:{widget_type:"checkbox",description:"Whether alert sounds on new media change announcements should be disabled when Away From Keyboard",action:(e,t=!0)=>{Hue[e].afk_disable_media_change_beep=$(`#${e}_afk_disable_media_change_beep`).prop("checked"),t&&Hue[`save_${e}`]()}},afk_disable_joins_beep:{widget_type:"checkbox",description:"Whether alert sounds on user joins should be disabled when Away From Keyboard",action:(e,t=!0)=>{Hue[e].afk_disable_joins_beep=$(`#${e}_afk_disable_joins_beep`).prop("checked"),t&&Hue[`save_${e}`]()}},afk_disable_image_change:{widget_type:"checkbox",description:"Whether automatic image change should be disabled when Away From Keyboard",action:(e,t=!0)=>{Hue[e].afk_disable_image_change=$(`#${e}_afk_disable_image_change`).prop("checked"),t&&Hue[`save_${e}`]()}},afk_disable_tv_change:{widget_type:"checkbox",description:"Whether automatic tv change should be disabled when Away From Keyboard",action:(e,t=!0)=>{Hue[e].afk_disable_tv_change=$(`#${e}_afk_disable_tv_change`).prop("checked"),t&&Hue[`save_${e}`]()}},afk_disable_radio_change:{widget_type:"checkbox",description:"Whether automatic radio change should be disabled when Away From Keyboard",action:(e,t=!0)=>{Hue[e].afk_disable_radio_change=$(`#${e}_afk_disable_radio_change`).prop("checked"),t&&Hue[`save_${e}`]()}},afk_disable_synth:{widget_type:"checkbox",description:"Whether the synth should be disabled when Away From Keyboard",action:(e,t=!0)=>{Hue[e].afk_disable_synth=$(`#${e}_afk_disable_synth`).prop("checked"),t&&Hue[`save_${e}`]()}},afk_disable_desktop_notifications:{widget_type:"checkbox",description:"Whether desktop notifications should be disabled when Away From Keyboard",action:(e,t=!0)=>{Hue[e].afk_disable_desktop_notifications=$(`#${e}_afk_disable_desktop_notifications`).prop("checked"),t&&Hue[`save_${e}`]()}},open_popup_messages:{widget_type:"checkbox",description:"Whether whisper messages received should open in a popup automatically apart from showing the chat notification",action:(e,t=!0)=>{Hue[e].open_popup_messages=$(`#${e}_open_popup_messages`).prop("checked"),t&&Hue[`save_${e}`]()}},user_function_1:{widget_type:"textarea",description:"Actions to perform when triggering User Function 1",action:(e,t=!0)=>{Hue.setting_user_function_do_action(1,e,t)}},user_function_2:{widget_type:"textarea",description:"Actions to perform when triggering User Function 2",action:(e,t=!0)=>{Hue.setting_user_function_do_action(2,e,t)}},user_function_3:{widget_type:"textarea",description:"Actions to perform when triggering User Function 3",action:(e,t=!0)=>{Hue.setting_user_function_do_action(3,e,t)}},user_function_4:{widget_type:"textarea",description:"Actions to perform when triggering User Function 4",action:(e,t=!0)=>{Hue.setting_user_function_do_action(4,e,t)}},user_function_5:{widget_type:"textarea",description:"Actions to perform when triggering User Function 5",action:(e,t=!0)=>{Hue.setting_user_function_do_action(5,e,t)}},user_function_6:{widget_type:"textarea",description:"Actions to perform when triggering User Function 6",action:(e,t=!0)=>{Hue.setting_user_function_do_action(6,e,t)}},user_function_7:{widget_type:"textarea",description:"Actions to perform when triggering User Function 7",action:(e,t=!0)=>{Hue.setting_user_function_do_action(7,e,t)}},user_function_8:{widget_type:"textarea",description:"Actions to perform when triggering User Function 8",action:(e,t=!0)=>{Hue.setting_user_function_do_action(8,e,t)}},user_function_1_name:{widget_type:"text",description:"Displayed name for User Function 1",action:(e,t=!0)=>{Hue.setting_user_function_name_do_action(1,e,t)}},user_function_2_name:{widget_type:"text",description:"Displayed name for User Function 2",action:(e,t=!0)=>{Hue.setting_user_function_name_do_action(2,e,t)}},user_function_3_name:{widget_type:"text",description:"Displayed name for User Function 3",action:(e,t=!0)=>{Hue.setting_user_function_name_do_action(3,e,t)}},user_function_4_name:{widget_type:"text",description:"Displayed name for User Function 4",action:(e,t=!0)=>{Hue.setting_user_function_name_do_action(4,e,t)}},user_function_5_name:{widget_type:"text",description:"Displayed name for User Function 5",action:(e,t=!0)=>{Hue.setting_user_function_name_do_action(5,e,t)}},user_function_6_name:{widget_type:"text",description:"Displayed name for User Function 6",action:(e,t=!0)=>{Hue.setting_user_function_name_do_action(6,e,t)}},user_function_7_name:{widget_type:"text",description:"Displayed name for User Function 7",action:(e,t=!0)=>{Hue.setting_user_function_name_do_action(7,e,t)}},user_function_8_name:{widget_type:"text",description:"Displayed name for User Function 8",action:(e,t=!0)=>{Hue.setting_user_function_name_do_action(8,e,t)}},on_lockscreen:{widget_type:"textarea",description:"Actions to perform when the screen gets locked",action:(e,t=!0)=>{let i=Hue.utilz.clean_string7($(`#${e}_on_lockscreen`).val());$(`#${e}_on_lockscreen`).val(i),Hue[e].on_lockscreen=i,t&&Hue[`save_${e}`]()}},on_unlockscreen:{widget_type:"textarea",description:"Actions to perform when the screen gets unlocked",action:(e,t=!0)=>{let i=Hue.utilz.clean_string7($(`#${e}_on_unlockscreen`).val());$(`#${e}_on_unlockscreen`).val(i),Hue[e].on_unlockscreen=i,t&&Hue[`save_${e}`]()}},afk_on_lockscreen:{widget_type:"checkbox",description:"Whether the user goes Away From Keyboard immidiately after locking the screen",action:(e,t=!0)=>{Hue[e].afk_on_lockscreen=$(`#${e}_afk_on_lockscreen`).prop("checked"),t&&Hue[`save_${e}`]()}},aliases:{widget_type:"textarea",description:"Custom commands defined by the user, based on other commands",action:(e,t=!0)=>{let i=Hue.utilz.clean_string7($(`#${e}_aliases`).val());i=Hue.format_command_aliases(i),$(`#${e}_aliases`).val(i),Hue[e].aliases=i,Hue.active_settings("aliases")===e&&Hue.setup_command_aliases(),t&&Hue[`save_${e}`]()}},other_words_to_autocomplete:{widget_type:"textarea",description:"Other words to be considered on Tab autocompletion",action:(e,t=!0)=>{let i=Hue.utilz.make_unique_lines(Hue.utilz.clean_string7($(`#${e}_other_words_to_autocomplete`).val()));$(`#${e}_other_words_to_autocomplete`).val(i),Hue[e].other_words_to_autocomplete=i,t&&Hue[`save_${e}`]()}},chat_font_size:{widget_type:"select",description:"The font size of the chat",action:(e,t=!0)=>{let i=$(`#${e}_chat_font_size option:selected`).val();Hue[e].chat_font_size=i,Hue.active_settings("chat_font_size")===e&&(Hue.apply_chat_style(),Hue.goto_bottom(!0,!1)),t&&Hue[`save_${e}`]()}},chat_profile_image_size:{widget_type:"select",description:"The size of profile images in the chat",action:(e,t=!0)=>{let i=$(`#${e}_chat_profile_image_size option:selected`).val();Hue[e].chat_profile_image_size=i,Hue.active_settings("chat_profile_image_size")===e&&(Hue.apply_chat_style(),Hue.goto_bottom(!0,!1)),t&&Hue[`save_${e}`]()}},warn_before_closing:{widget_type:"checkbox",description:"Show a confirmation message in some cases when the client is going to be closed or refreshed",action:(e,t=!0)=>{Hue[e].warn_before_closing=$(`#${e}_warn_before_closing`).prop("checked"),t&&Hue[`save_${e}`]()}},show_image_previews:{widget_type:"checkbox",description:"Whether to show image previews on certain chat image links",action:(e,t=!0)=>{Hue[e].show_image_previews=$(`#${e}_show_image_previews`).prop("checked"),t&&Hue[`save_${e}`]()}},show_link_previews:{widget_type:"checkbox",description:"Whether to show related information of chat links when available",action:(e,t=!0)=>{Hue[e].show_link_previews=$(`#${e}_show_link_previews`).prop("checked"),t&&Hue[`save_${e}`]()}},stop_radio_on_tv_play:{widget_type:"checkbox",description:"Whether the radio should stop when a new tv item is played",action:(e,t=!0)=>{Hue[e].stop_radio_on_tv_play=$(`#${e}_stop_radio_on_tv_play`).prop("checked"),t&&Hue[`save_${e}`]()}},stop_tv_on_radio_play:{widget_type:"checkbox",description:"Whether the tv should stop when the radio is started",action:(e,t=!0)=>{Hue[e].stop_tv_on_radio_play=$(`#${e}_stop_tv_on_radio_play`).prop("checked"),t&&Hue[`save_${e}`]()}},show_input_placeholder:{widget_type:"checkbox",description:"Whether information inside the input should be shown",action:(e,t=!0)=>{Hue[e].show_input_placeholder=$(`#${e}_show_input_placeholder`).prop("checked"),Hue.active_settings("show_input_placeholder")===e&&Hue.setup_input_placeholder(),t&&Hue[`save_${e}`]()}},show_clock_in_input_placeholder:{widget_type:"checkbox",description:"Whether the current time should be included in the input's information",action:(e,t=!0)=>{Hue[e].show_clock_in_input_placeholder=$(`#${e}_show_clock_in_input_placeholder`).prop("checked"),Hue.active_settings("show_clock_in_input_placeholder")===e&&Hue.setup_input_placeholder(),t&&Hue[`save_${e}`]()}},show_clock_in_lockscreen:{widget_type:"checkbox",description:"Whether the current time should be displayed in the lockscreen",action:(e,t=!0)=>{Hue[e].show_clock_in_lockscreen=$(`#${e}_show_clock_in_lockscreen`).prop("checked"),Hue.active_settings("show_clock_in_lockscreen")===e&&Hue.setup_lockscreen_clock(),t&&Hue[`save_${e}`]()}},bypass_images_lock_on_own_change:{widget_type:"checkbox",description:"Whether an enabled image lock should be ignored if the change comes from the user itself",action:(e,t=!0)=>{Hue[e].bypass_images_lock_on_own_change=$(`#${e}_bypass_images_lock_on_own_change`).prop("checked"),t&&Hue[`save_${e}`]()}},bypass_tv_lock_on_own_change:{widget_type:"checkbox",description:"Whether an enabled tv lock should be ignored if the change comes from the user itself",action:(e,t=!0)=>{Hue[e].bypass_tv_lock_on_own_change=$(`#${e}_bypass_tv_lock_on_own_change`).prop("checked"),t&&Hue[`save_${e}`]()}},bypass_radio_lock_on_own_change:{widget_type:"checkbox",description:"Whether an enabled radio lock should be ignored if the change comes from the user itself",action:(e,t=!0)=>{Hue[e].bypass_radio_lock_on_own_change=$(`#${e}_bypass_radio_lock_on_own_change`).prop("checked"),t&&Hue[`save_${e}`]()}},autoreveal_spoilers:{widget_type:"checkbox",description:"Whether spoiler messages should be autorevealed",action:(e,t=!0)=>{Hue[e].autoreveal_spoilers=$(`#${e}_autoreveal_spoilers`).prop("checked"),t&&Hue[`save_${e}`]()}},synth_enabled:{widget_type:"checkbox",description:"Whether the synth is enabled",action:(e,t=!0)=>{Hue[e].synth_enabled=$(`#${e}_synth_enabled`).prop("checked"),Hue.active_settings("synth_enabled")===e&&(Hue[e].synth_enabled||Hue.hide_synth(!0)),t&&Hue[`save_${e}`]()}},autoscroll_amount:{widget_type:"number",description:"Pixel amount to scroll up or down on each tick on autoscroll",action:(e,t=!0)=>{let i=parseInt(Hue.utilz.clean_string2($(`#${e}_autoscroll_amount`).val()));i||(i=Hue.config.global_settings_default_autoscroll_amount),$(`#${e}_autoscroll_amount`).val(i),Hue[e].autoscroll_amount=i,t&&Hue[`save_${e}`]()}},autoscroll_delay:{widget_type:"number",description:"Perform an autoscroll tick after these milliseconds",action:(e,t=!0)=>{let i=parseInt(Hue.utilz.clean_string2($(`#${e}_autoscroll_delay`).val()));i||(i=Hue.config.global_settings_default_autoscroll_delay),$(`#${e}_autoscroll_delay`).val(i),Hue[e].autoscroll_delay=i,t&&Hue[`save_${e}`]()}},speech_1:{widget_type:"textarea",description:"Configured text/voice Speech #1 to use with the synth",action:(e,t=!0)=>{Hue.setting_speech_do_action(1,e,t)}},speech_2:{widget_type:"textarea",description:"Configured text/voice Speech #2 to use with the synth",action:(e,t=!0)=>{Hue.setting_speech_do_action(2,e,t)}},speech_3:{widget_type:"textarea",description:"Configured text/voice Speech #3 to use with the synth",action:(e,t=!0)=>{Hue.setting_speech_do_action(3,e,t)}},speech_4:{widget_type:"textarea",description:"Configured text/voice Speech #4 to use with the synth",action:(e,t=!0)=>{Hue.setting_speech_do_action(4,e,t)}},speech_5:{widget_type:"textarea",description:"Configured text/voice Speech #5 to use with the synth",action:(e,t=!0)=>{Hue.setting_speech_do_action(5,e,t)}},speech_6:{widget_type:"textarea",description:"Configured text/voice Speech #6 to use with the synth",action:(e,t=!0)=>{Hue.setting_speech_do_action(6,e,t)}},speech_7:{widget_type:"textarea",description:"Configured text/voice Speech #7 to use with the synth",action:(e,t=!0)=>{Hue.setting_speech_do_action(7,e,t)}},speech_8:{widget_type:"textarea",description:"Configured text/voice Speech #8 to use with the synth",action:(e,t=!0)=>{Hue.setting_speech_do_action(8,e,t)}},speech_9:{widget_type:"textarea",description:"Configured text/voice Speech #9 to use with the synth",action:(e,t=!0)=>{Hue.setting_speech_do_action(9,e,t)}},speech_10:{widget_type:"textarea",description:"Configured text/voice Speech #10 to use with the synth",action:(e,t=!0)=>{Hue.setting_speech_do_action(10,e,t)}},chat_display_percentage:{widget_type:"range",description:"What percentage width the chat area should have compared to the media area",action:(e,t=!0)=>{let i=parseInt($(`#${e}_chat_display_percentage`).val());Hue[e].chat_display_percentage=i,Hue.active_settings("chat_display_percentage")===e&&Hue.apply_media_percentages(),t&&Hue[`save_${e}`]()}},tv_display_percentage:{widget_type:"range",description:"What percentage height the tv should have compared the image",action:(e,t=!0)=>{let i=parseInt($(`#${e}_tv_display_percentage`).val());Hue[e].tv_display_percentage=i,Hue.active_settings("tv_display_percentage")===e&&Hue.apply_media_percentages(),t&&Hue[`save_${e}`]()}},tv_display_position:{widget_type:"squaro",description:"The positions of the image and tv in the media area",action:(e,t=!0)=>{Hue.arrange_media_setting_display_positions(e),Hue.active_settings("tv_display_position")===e&&Hue.apply_media_positions(),t&&Hue[`save_${e}`]()}},theme_mode:{widget_type:"select",description:"It either uses the room's theme color or a custom theme color",action:(e,t=!0)=>{Hue[e].theme_mode=$(`#${e}_theme_mode option:selected`).val(),Hue.active_settings("theme_mode")===e&&Hue.apply_theme(),Hue.check_hideable_settings(),t&&Hue[`save_${e}`]()}},theme_color:{widget_type:"color",description:"The theme color to use if the user is using a custom theme mode",action:(e,t=!0)=>{Hue[e].theme_color=$(`#${e}_theme_color`).val(),Hue.active_settings("theme_color")===e&&Hue.apply_theme(),t&&Hue[`save_${e}`]()}},text_color:{widget_type:"color",description:"The text color to use if the user is using a custom theme mode",action:(e,t=!0)=>{Hue[e].text_color=$(`#${e}_text_color`).val(),Hue.active_settings("text_color")===e&&Hue.apply_theme(),t&&Hue[`save_${e}`]()}},background_mode:{widget_type:"select",description:"It either uses the room's background, a custom background, or no background",action:(e,t=!0)=>{Hue[e].background_mode=$(`#${e}_background_mode option:selected`).val(),Hue.active_settings("background_mode")===e&&Hue.apply_background(),Hue.check_hideable_settings(),t&&Hue[`save_${e}`]()}},background_url:{widget_type:"text",description:"The background url to use if the user is using a custom background",action:(e,t=!0)=>{let i=Hue.utilz.clean_string5($(`#${e}_background_url`).val().replace(".gifv",".gif"));$(`#${e}_background_url`).val(i),Hue[e].background_url=i,Hue.active_settings("background_url")===e&&Hue.apply_background(),t&&Hue[`save_${e}`]()}},background_tile_dimensions:{widget_type:"text",description:"The background url to use if the user is using a custom background",action:(e,t=!0)=>{let i=Hue.utilz.clean_string2($(`#${e}_background_tile_dimensions`).val());$(`#${e}_background_tile_dimensions`).val(i),Hue[e].background_tile_dimensions=i,Hue.active_settings("background_tile_dimensions")===e&&Hue.apply_background(),t&&Hue[`save_${e}`]()}},message_log:{widget_type:"checkbox",description:"Whether the user requests the message log on load",action:(e,t=!0)=>{Hue[e].message_log=$(`#${e}_message_log`).prop("checked"),t&&Hue[`save_${e}`]()}},chat_crop_limit:{widget_type:"number",description:"Crop the chat area after this many messages",action:(e,t=!0)=>{let i=parseInt(Hue.utilz.clean_string2($(`#${e}_chat_crop_limit`).val()));i||(i=Hue.config.global_settings_default_chat_crop_limit),$(`#${e}_chat_crop_limit`).val(i),Hue[e].chat_crop_limit=i,t&&Hue[`save_${e}`]()}},autoconnect:{widget_type:"checkbox",description:"Whether a user should autoconnect automatically after a socket disconnect",action:(e,t=!0)=>{Hue[e].autoconnect=$(`#${e}_autoconnect`).prop("checked"),t&&Hue[`save_${e}`]()}},popup_notifications_close_delay:{widget_type:"number",description:"How much time (ms) needs to pass before the notification popups close automatically",action:(e,t=!0)=>{let i=parseInt($(`#${e}_popup_notifications_close_delay`).val());isNaN(i)&&(i=Hue.config.global_settings_default_popup_notifications_close_delay),$(`#${e}_popup_notifications_close_delay`).val(i),Hue[e].popup_notifications_close_delay=i,t&&Hue[`save_${e}`]()}},popup_notifications_always_show_titlebar:{widget_type:"checkbox",description:"Whether notification popups should display the titlebar even when they autoclose",action:(e,t=!0)=>{Hue[e].popup_notifications_always_show_titlebar=$(`#${e}_popup_notifications_always_show_titlebar`).prop("checked"),t&&Hue[`save_${e}`]()}},media_info:{widget_type:"select",description:"It either uses the room's media info, forces enabled, or, forces disabled",action:(e,t=!0)=>{Hue[e].media_info=$(`#${e}_media_info option:selected`).val(),Hue.active_settings("media_info")===e&&Hue.configure_media_info(),t&&Hue[`save_${e}`]()}},transparent_panels:{widget_type:"checkbox",description:"Whether panels get a slight transparency",action:(e,t=!0)=>{Hue[e].transparent_panels=$(`#${e}_transparent_panels`).prop("checked"),Hue.active_settings("transparent_panels")===e&&Hue.apply_theme(),t&&Hue[`save_${e}`]()}},media_info_max_length:{widget_type:"number",description:"Maximum character length for media info",action:(e,t=!0)=>{let i=parseInt($(`#${e}_media_info_max_length`).val());isNaN(i)&&(i=Hue.config.global_settings_default_media_info_max_length),$(`#${e}_media_info_max_length`).val(i),Hue[e].media_info_max_length=i,Hue.active_settings("transparent_panels")===e&&Hue.reapply_media_info(),t&&Hue[`save_${e}`]()}},max_displayed_url:{widget_type:"number",description:"Maximum character length for URLs displayed in chat",action:(e,t=!0)=>{let i=parseInt($(`#${e}_max_displayed_url`).val());isNaN(i)&&(i=Hue.config.global_settings_default_max_displayed_url),$(`#${e}_max_displayed_url`).val(i),Hue[e].max_displayed_url=i,t&&Hue[`save_${e}`]()}},media_layout:{widget_type:"select",description:"The media (image, tv) layout, either column or row",action:(e,t=!0)=>{Hue[e].media_layout=$(`#${e}_media_layout option:selected`).val(),Hue.active_settings("media_layout")===e&&Hue.change_media_layout(),t&&Hue[`save_${e}`]()}},chat_enabled:{widget_type:"checkbox",description:"Whether chat is visible or not",action:(e,t=!0)=>{Hue[e].chat_enabled=$(`#${e}_chat_enabled`).prop("checked"),Hue.active_settings("chat_enabled")===e&&Hue.change_chat_visibility(),t&&Hue[`save_${e}`]()}}},Hue.empty_global_settings=function(){Hue.global_settings={},Hue.save_global_settings(!0)},Hue.get_global_settings=function(){Hue.global_settings=Hue.get_local_storage(Hue.ls_global_settings),null===Hue.global_settings&&(Hue.global_settings={});let e=!1;for(let t in Hue.user_settings)void 0===Hue.global_settings[t]&&(Hue.global_settings[t]=Hue.config[`global_settings_default_${t}`],e=!0);e&&Hue.save_global_settings()},Hue.save_global_settings=function(e=!1){Hue.save_local_storage(Hue.ls_global_settings,Hue.global_settings,e)},Hue.start_settings_widgets=function(e){for(let t in Hue.user_settings)Hue.modify_setting_widget(e,t);Hue.arrange_media_setting_display_positions(e)},Hue.modify_setting_widget=function(e,t){let i=Hue.user_settings[t].widget_type,s=$(`#${e}_${t}`);if("checkbox"===i)s.prop("checked",Hue[e][t]);else if("textarea"===i||"text"===i||"number"===i||"range"===i||"color"===i)s.val(Hue[e][t]);else if("select"===i)s.find("option").each(function(){$(this).val()==Hue[e][t]&&$(this).prop("selected",!0)});else if("squaro"===i){let i=s.find(".squaro_main").eq(0),o=s.find(".squaro_secondary").eq(0);1!=i.css("order")&&"top"===Hue[e][t]&&(i.css("order",1),o.css("order",2))}},Hue.start_settings_widgets_listeners=function(e){for(let t in Hue.user_settings){let i=Hue.user_settings[t],s=$(`#${e}_${t}`);"checkbox"===i.widget_type||"select"===i.widget_type?s.change(()=>i.action(e)):"textarea"===i.widget_type||"text"===i.widget_type||"number"===i.widget_type?s.blur(()=>i.action(e)):"color"===i.widget_type?s.change(()=>i.action(e)):"range"===i.widget_type?s.on("input change",function(){i.action(e)}):"squaro"===i.widget_type&&s.click(function(){Hue[e][t]="top"===Hue[e][t]?"bottom":"top",i.action(e)})}},Hue.call_setting_actions=function(e,t=!0){for(let i in Hue.user_settings){Hue.user_settings[i].action(e,t)}},Hue.empty_room_settings=function(){Hue.room_settings={},Hue.save_room_settings(!0)},Hue.get_room_settings=function(){let e=Hue.get_local_storage(Hue.ls_room_settings);null===e&&(e={}),Hue.room_settings=e[Hue.room_id],void 0===Hue.room_settings&&(Hue.room_settings={});let t=!1;for(let e in Hue.global_settings)void 0===Hue.room_settings[e]&&(Hue.room_settings[e]=Hue.global_settings[e],t=!0),void 0===Hue.room_settings[`${e}_override`]&&(Hue.room_settings[`${e}_override`]=!1,t=!0);t&&Hue.save_room_settings()},Hue.save_room_settings=function(e=!1){let t=Hue.get_local_storage(Hue.ls_room_settings);null===t&&(t={}),t[Hue.room_id]=Hue.room_settings,Hue.save_local_storage(Hue.ls_room_settings,t,e)},Hue.confirm_reset_settings=function(e){let t;t="global_settings"===e?"Global Settings":"Room Settings",confirm(`Are you sure you want to reset the ${t} to their initial state?`)&&Hue.reset_settings(e)},Hue.reset_settings=function(e,t=!0){t&&Hue[`empty_${e}`](),Hue[`get_${e}`](),Hue.start_settings_widgets(e),Hue.call_setting_actions("global_settings",!1),Hue.call_setting_actions("room_settings",!1),Hue.prepare_media_settings(),"room_settings"===e&&(Hue.set_room_settings_overriders(),Hue.check_room_settings_override())},Hue.scroll_settings_window_to_top=function(e){$(`#settings_window_right_${e}`).scrollTop(0)},Hue.show_global_settings=function(e=!1){Hue.do_settings_filter("global_settings",e),Hue.msg_global_settings.show()},Hue.show_room_settings=function(e=!1){Hue.do_settings_filter("room_settings",e),Hue.msg_room_settings.show()},Hue.setup_settings_windows=function(){Hue.setup_setting_elements("global_settings"),Hue.setup_setting_elements("room_settings"),Hue.create_room_settings_overriders(),Hue.set_room_settings_overriders(),Hue.start_room_settings_overriders(),Hue.check_room_settings_override(),Hue.setup_user_function_switch_selects(),Hue.set_user_settings_titles(),Hue.check_hideable_settings(),$(".settings_main_window").on("click",".settings_window_category",function(e){let t=$(this).data("category");Hue.change_settings_window_category(t)});let e=$("#global_settings_container .settings_window_category").eq(0).data("category");Hue.change_settings_window_category(e,"global_settings"),Hue.change_settings_window_category(e,"room_settings")},Hue.create_room_settings_overriders=function(){$("#room_settings_container").find(".settings_item").each(function(){let e=`\n        <div class='room_settings_overrider_container'>\n            <input type='checkbox' class='room_settings_overrider' id='room_settings_${$(this).data("setting")}_overrider'>\n            Override\n        </div>`;$(this).prepend(e)})},Hue.set_room_settings_overriders=function(){$(".room_settings_overrider").each(function(){let e=$(this).closest(".settings_item"),t=e.data("setting"),i=Hue.room_settings[`${t}_override`];void 0===i&&(i=!1),$(this).prop("checked",i),Hue.settings_window_item_fade(i,e)})},Hue.start_room_settings_overriders=function(){$(".room_settings_overrider").change(function(){let e=$(this).closest(".settings_item"),t=e.data("setting"),i=$(this).prop("checked");void 0===i&&(i=!1),Hue.settings_window_item_fade(i,e),Hue.room_settings[`${t}_override`]=i;let s=Hue.user_settings[t];i?s.action("room_settings",!1):s.action("global_settings",!1),Hue.check_room_settings_override(),Hue.save_room_settings();let o=e.find(".toggler");if(o.length>0){let e=o.eq(0);i?Hue.set_toggler("room_settings",e,"open"):Hue.set_toggler("room_settings",e,"close")}})},Hue.settings_window_item_fade=function(e,t){e?t.removeClass("faded"):t.addClass("faded"),$("#settings_window_right_global_settings .settings_item").each(function(){if(t.data("setting")===$(this).data("setting"))return e?$(this).addClass("faded"):$(this).removeClass("faded"),!1})},Hue.setup_setting_elements=function(e){$(`#${e}_double_tap_key`).text(Hue.config.double_tap_key),$(`#${e}_double_tap_2_key`).text(Hue.config.double_tap_key_2),$(`#${e}_double_tap_3_key`).text(Hue.config.double_tap_key_3),Hue.setup_togglers(e)},Hue.check_room_settings_override=function(){let e=!1;$("#settings_window_left_room_settings .settings_window_category").each(function(){$(this).find(".settings_window_category_status").eq(0).html(""),$(this).find(".settings_window_category_status_filler").eq(0).html("")});for(let t in Hue.global_settings)if(Hue.room_settings[`${t}_override`]){e=!0;let i=$(`#room_settings_${t}`);if(i.length>0){let e=i.closest(".settings_category");if(e.length>0){let t=e.data("category");$("#settings_window_left_room_settings .settings_window_category").each(function(){if($(this).data("category")===t)return $(this).find(".settings_window_category_status").eq(0).html("&nbsp;*"),$(this).find(".settings_window_category_status_filler").eq(0).html("&nbsp;*"),!1})}}}e?($("#user_menu_room_settings_status").html("&nbsp;*"),$("#user_menu_room_settings_status_filler").html("&nbsp;*")):$("#user_menu_room_settings_status").html("")},Hue.get_setting=function(e){try{return Hue.room_settings[`${e}_override`]?Hue.room_settings[e]:Hue.global_settings[e]}catch(e){return}},Hue.active_settings=function(e){return Hue.room_settings[`${e}_override`]?"room_settings":"global_settings"},Hue.set_user_settings_titles=function(){for(let e in Hue.user_settings){let t=Hue.user_settings[e],i=Hue.config[`global_settings_default_${e}`];"string"==typeof i&&(i=`"${i}"`);let s=`${t.description} (${e}) (Default: ${i})`;$(`#global_settings_${e}`).attr("title",s),$(`#room_settings_${e}`).attr("title",s)}},Hue.modify_setting=function(e,t=!0,i=!1){let s=e.split(" ");if(s.length<2)return!1;let o=s[0];if(void 0===Hue.user_settings[o])return!1;let n=s.slice(1).join(" ");"true"===n?n=!0:"false"===n?n=!1:isNaN(n)||(n=Number(n));let _=Hue.active_settings(o);if(Hue[_][o]===n)return t&&Hue.feedback(`Setting "${o}" is already set to that`),!1;let a=Hue.user_settings[o];Hue[_][o]=n,Hue.modify_setting_widget(_,o),a.action(_,!1),Hue[`save_${_}`](i),t&&Hue.feedback(`Setting "${o}" succesfully modified`)},Hue.show_import_settings=function(){Hue.msg_info2.show(["Import Settings","\n    <div class='container_22'>\n        Paste code generated by Export Settings\n        <textarea id='import_settings_textarea' rows=5 class='setting_textarea'></textarea>\n        <div class='menu_item inline action pointer unselectable' id='import_settings_apply'>Apply</div>\n    </div>\n    "],function(){$("#import_settings_textarea").focus(),$("#import_settings_apply").click(function(){Hue.process_imported_settings()}),Hue.import_settings_open=!0})},Hue.process_imported_settings=function(){let code=$("#import_settings_textarea").val().trim();if(""===code)return!1;try{eval(code)}catch(e){alert("Code provided is invalid")}},Hue.show_export_settings=function(){let e=localStorage.getItem(Hue.ls_global_settings),t=localStorage.getItem(Hue.ls_room_settings),i=`\n    <div class='container_22'>\n\n        <div id='export_settings_info'  class='grid_column_center'>\n            <div>In case you want to export your settings from one browser to another.</div>\n            <div>You can import either Global Settings, Room Settings, or both.</div>\n            <div>Room Settings copies every room's settings, not just the current one.</div>\n            <div>To do this, copy one of the codes below, and paste it in Import Settings in the other browser.</div>\n        </div>\n\n        <div class='export_settings_textarea_label'>(a) Use this code if you want to import <span class='bold'>Global</span> and <span class='bold'>Room</span> Settings</div>\n        <textarea rows=5 class='setting_textarea export_settings_textarea'>${`let gsettings = ${e}; Hue.save_local_storage(Hue.ls_global_settings, gsettings); let rsettings = ${t}; Hue.save_local_storage(Hue.ls_room_settings, rsettings); Hue.restart_client()`}</textarea>\n\n        <div class='export_settings_textarea_label'>(b) Use this code if you only want to import <span class='bold'>Global</span> Settings</div>\n        <textarea rows=5 class='setting_textarea export_settings_textarea'>${`let gsettings = ${e}; Hue.save_local_storage(Hue.ls_global_settings, gsettings); Hue.restart_client()`}</textarea>\n\n        <div class='export_settings_textarea_label'>(c) Use this code if you only want to import <span class='bold'>Room</span> Settings</div>\n        <textarea rows=5 class='setting_textarea'>${`let rsettings = ${t}; Hue.save_local_storage(Hue.ls_room_settings, rsettings); Hue.restart_client()`}</textarea>\n    </div>\n    `;Hue.msg_info2.show(["Export Settings",i])},Hue.prepare_media_settings=function(){Hue.apply_media_percentages(),Hue.apply_media_positions()},Hue.open_user_settings_category=function(e,t="global_settings"){Hue[`show_${t}`](),Hue.change_settings_window_category(e)},Hue.go_to_user_settings_item=function(e){let t=Hue.which_user_settings_window_is_open();$(`#${t}_container .settings_item`).each(function(){if($(this).data("setting")===e){let e=$(this).closest(".toggler_main_container"),i=e.find(".toggler").eq(0);return 0===i.length&&(i=(e=$(this).find(".toggler_main_container").eq(0)).find(".toggler").eq(0)),i.length>0?(Hue.set_toggler(t,i,"open"),e[0].scrollIntoView({block:"center"})):this.scrollIntoView({block:"center"}),!1}})},Hue.which_user_settings_window_is_open=function(){let e=!1;return Hue.msg_global_settings.is_highest()?e="global_settings":Hue.msg_room_settings.is_highest()&&(e="room_settings"),e},Hue.get_selected_user_settings_category=function(e){let t=!1;return $(`#settings_window_left_${e} .settings_window_category`).each(function(){if($(this).data("selected_category"))return t=$(this).data("category"),!1}),t},Hue.change_settings_window_category=function(e,t=!1){if(!(t=t||Hue.which_user_settings_window_is_open()))return!1;let i=$(`#settings_window_category_${e}_${t}`)[0],s=$(i).closest(".settings_main_window");s.find(".settings_window_category").each(function(){$(this).find(".settings_window_category_text").eq(0).removeClass("border_bottom"),$(this).data("selected_category",!1)}),$(i).find(".settings_window_category_text").eq(0).addClass("border_bottom"),$(i).data("selected_category",!0),s.find(".settings_window_category_container_selected").each(function(){$(this).removeClass("settings_window_category_container_selected"),$(this).addClass("settings_window_category_container")});let o=$(`#${$(i).data("category_container")}`);o.removeClass("settings_window_category_container"),o.addClass("settings_window_category_container_selected")},Hue.enable_setting_override=function(e){if(Hue.room_settings[`${e}_override`])return!1;$(`#room_settings_${e}_overrider`).click()},Hue.do_settings_filter=function(e,t=!1){t&&(t=t.trim());let i,s=t||"";if($(`#${e}_filter`).val(s),t){let e=Hue.utilz.clean_string2(t).toLowerCase();i=e.split(" ").filter(e=>""!==e.trim())}$(`#${e}_container .settings_top_level_item`).each(function(){if(t){let e=Hue.utilz.clean_string2($(this).text()).toLowerCase();i.some(t=>e.includes(t))?$(this).css("display","block"):$(this).css("display","none")}else $(this).css("display","block")});let o=Hue.get_selected_user_settings_category(e),n=!0,_=!1;$(`#${e}_container .settings_category`).each(function(){let t=$(this).data("category");0===$(this).find(".settings_top_level_item:not([style*='display: none'])").length?(t===o&&(n=!1),$(`#settings_window_category_${t}_${e}`).css("display","none")):(_||(_=t),$(`#settings_window_category_${t}_${e}`).css("display","flex"))});let a=n?o:_;a&&Hue.change_settings_window_category(a,e),t||Hue.check_hideable_settings(),Hue.scroll_settings_window_to_top(e)},Hue.hide_setting=function(e,t){$(`#${e}_${t}`).closest(".settings_top_level_item").css("display","none"),$(`#${e}_${t}`).closest(".settings_top_level_item").addClass("hidden_setting")},Hue.unhide_setting=function(e,t){$(`#${e}_${t}`).closest(".settings_top_level_item").css("display","block"),$(`#${e}_${t}`).closest(".settings_top_level_item").removeClass("hidden_setting")},Hue.check_hideable_settings=function(){"room"===Hue.get_setting("theme_mode")?(Hue.hide_setting("global_settings","theme_color"),Hue.hide_setting("global_settings","text_color"),Hue.hide_setting("room_settings","theme_color"),Hue.hide_setting("room_settings","text_color")):(Hue.unhide_setting("global_settings","theme_color"),Hue.unhide_setting("global_settings","text_color"),Hue.unhide_setting("room_settings","theme_color"),Hue.unhide_setting("room_settings","text_color"));let e=Hue.get_setting("background_mode");"room"===e||"custom_solid"===e?(Hue.hide_setting("global_settings","background_url"),Hue.hide_setting("global_settings","background_tile_dimensions"),Hue.hide_setting("room_settings","background_url"),Hue.hide_setting("room_settings","background_tile_dimensions")):(Hue.unhide_setting("global_settings","background_url"),Hue.unhide_setting("room_settings","background_url"),"custom_tiled"===e?(Hue.unhide_setting("global_settings","background_tile_dimensions"),Hue.unhide_setting("room_settings","background_tile_dimensions")):(Hue.hide_setting("global_settings","background_tile_dimensions"),Hue.hide_setting("room_settings","background_tile_dimensions")))},Hue.settings_chat_percentage_icon_click=function(e,t){if(e!==Hue.active_settings("chat_display_percentage"))return!1;"increase"===t?Hue.increase_chat_percentage():"decrease"===t&&Hue.decrease_chat_percentage()},Hue.settings_chat_percentage_icon_middle_click=function(e,t){if(e!==Hue.active_settings("chat_display_percentage"))return!1;Hue.do_chat_size_change(t)},Hue.settings_chat_percentage_slider_double_click=function(e){if(e!==Hue.active_settings("chat_display_percentage"))return!1;Hue.set_default_chat_size()},Hue.settings_tv_percentage_icon_click=function(e,t){if(e!==Hue.active_settings("tv_display_percentage"))return!1;"increase"===t?Hue.increase_tv_percentage():"decrease"===t&&Hue.decrease_tv_percentage()},Hue.settings_tv_percentage_icon_middle_click=function(e,t){if(e!==Hue.active_settings("tv_display_percentage"))return!1;Hue.do_media_tv_size_change(t)},Hue.settings_tv_percentage_slider_double_click=function(e){if(e!==Hue.active_settings("tv_display_percentage"))return!1;Hue.set_default_tv_size()};
Hue.restart_client=function(){Hue.user_leaving=!0,window.location=window.location},Hue.electron_signal=function(e,t={}){if(void 0===window.electron_api)return!1;void 0!==window.electron_api[e]&&window.electron_api[e](t)},Hue.ping_server=function(){Hue.socket_emit("ping_server",{date:Date.now()})},Hue.pong_received=function(e){let t=Hue.utilz.nice_time(Date.now(),e.date);Hue.feedback(`Pong: ${t}`)},Hue.trigger_activity=function(){Hue.socket_emit("activity_trigger",{})},Hue.send_system_restart_signal=function(){Hue.socket_emit("system_restart_signal",{})},Hue.show_reload_button=function(){Hue.feedback("Disconnected. Click to reload, or middle click to activate auto connect",{onclick:function(){Hue.restart_client()},onmiddleclick:function(){Hue.modify_setting("autoconnect true",!1,!0),Hue.restart_client()},brk:"<i class='icon2c fa fa-plug'></i>"})};
Hue.server_update_events={joined:e=>{Hue.on_join(e)},typing:e=>{Hue.show_typing(e)},chat_message:e=>{Hue.on_chat_message(e)},request_slice_upload:e=>{Hue.request_slice_upload(e)},upload_ended:e=>{Hue.upload_ended(e)},changed_image_source:e=>{Hue.setup_image("change",e)},changed_tv_source:e=>{Hue.setup_tv("change",e)},restarted_tv_source:e=>{Hue.setup_tv("restart",e)},changed_radio_source:e=>{Hue.setup_radio("change",e)},restarted_radio_source:e=>{Hue.setup_radio("restart",e)},profile_image_changed:e=>{Hue.profile_image_changed(e)},user_join:e=>{Hue.user_join(e)},receive_roomlist:e=>{Hue.on_roomlist_received(e)},upload_error:e=>{Hue.show_upload_error()},topic_change:e=>{Hue.announce_topic_change(e)},room_name_changed:e=>{Hue.announce_room_name_change(e)},log_changed:e=>{Hue.announce_log_change(e)},log_cleared:e=>{Hue.announce_log_cleared(e)},announce_role_change:e=>{Hue.announce_role_change(e)},voices_resetted:e=>{Hue.announce_voices_resetted(e)},announce_removedops:e=>{Hue.announce_removedops(e)},announce_ban:e=>{Hue.announce_ban(e)},announce_unban:e=>{Hue.announce_unban(e)},announce_unban_all:e=>{Hue.announce_unban_all(e)},receive_ban_count:e=>{Hue.receive_ban_count(e)},nothing_to_unban:e=>{Hue.feedback("There was nothing to unban")},nothing_to_clear:e=>{Hue.feedback("There was nothing to clear")},forbidden_user:e=>{Hue.forbidden_user()},nothing_was_found:e=>{Hue.feedback("Nothing was found")},user_not_found:e=>{Hue.feedback("User doesn't exist")},user_not_in_room:e=>{Hue.user_not_in_room()},no_ops_to_remove:e=>{Hue.feedback("There were no ops to remove")},no_voices_to_reset:e=>{Hue.feedback("There were no voices to reset")},is_already:e=>{Hue.is_already(e.who,e.what)},user_already_banned:e=>{Hue.feedback("User is already banned")},user_already_unbanned:e=>{Hue.feedback("User is already unbanned")},privacy_change:e=>{Hue.announce_privacy_change(e)},image_not_found:e=>{Hue.feedback("The image couldn't be found")},song_not_found:e=>{Hue.feedback("The song couldn't be found")},video_not_found:e=>{Hue.feedback("The video couldn't be found")},image_cooldown_wait:e=>{Hue.feedback("The image was changed recently. You must wait a while before changing it again")},tv_cooldown_wait:e=>{Hue.feedback("The tv was changed recently. You must wait a while before changing it again")},radio_cooldown_wait:e=>{Hue.feedback("The radio was changed recently. You must wait a while before changing it again")},room_created:e=>{Hue.on_room_created(e)},redirect:e=>{Hue.goto_url(e.location)},username_already_exists:e=>{Hue.feedback(`${e.username} already exists`)},email_already_exists:e=>{Hue.feedback(`${e.email} already exists`)},new_username:e=>{Hue.announce_new_username(e)},password_changed:e=>{Hue.password_changed(e)},email_changed:e=>{Hue.email_changed(e)},room_images_mode_change:e=>{Hue.announce_room_images_mode_change(e)},room_tv_mode_change:e=>{Hue.announce_room_tv_mode_change(e)},room_radio_mode_change:e=>{Hue.announce_room_radio_mode_change(e)},room_synth_mode_change:e=>{Hue.announce_room_synth_mode_change(e)},theme_mode_changed:e=>{Hue.announce_theme_mode_change(e)},theme_change:e=>{Hue.announce_theme_change(e)},background_image_change:e=>{Hue.announce_background_image_change(e)},background_mode_changed:e=>{Hue.announce_background_mode_change(e)},background_effect_changed:e=>{Hue.announce_background_effect_change(e)},background_tile_dimensions_changed:e=>{Hue.announce_background_tile_dimensions_change(e)},text_color_mode_changed:e=>{Hue.announce_text_color_mode_change(e)},text_color_changed:e=>{Hue.announce_text_color_change(e)},voice_permission_change:e=>{Hue.announce_voice_permission_change(e)},user_disconnect:e=>{Hue.user_disconnect(e)},others_disconnected:e=>{Hue.show_others_disconnected(e)},whisper:e=>{Hue.popup_message_received(e)},whisper_ops:e=>{Hue.popup_message_received(e,"ops")},room_broadcast:e=>{Hue.popup_message_received(e,"room")},system_broadcast:e=>{Hue.popup_message_received(e,"system")},system_restart_signal:e=>{Hue.disconnect_socket()},error_occurred:e=>{Hue.error_occurred()},email_change_code_sent:e=>{Hue.feedback(`Verification code sent. Use the command sent to ${e.email}. Email might take a couple of minutes to arrive`)},email_change_code_not_sent:e=>{Hue.feedback("Verification code not sent yet. Use /changeemail [new_email] to get a verification code")},email_change_wait:e=>{Hue.feedback("You must wait a while before changing the email again")},email_change_wrong_code:e=>{Hue.feedback("Code supplied didn't match")},email_change_expired_code:e=>{Hue.feedback("Code supplied has expired")},create_room_wait:e=>{Hue.msg_info.show("You must wait a while before creating another room")},pong_received:e=>{Hue.pong_received(e)},reaction_received:e=>{Hue.show_reaction(e)},cannot_embed_iframe:e=>{Hue.feedback("That website cannot be embedded")},same_image:e=>{Hue.feedback("Image is already set to that")},same_tv:e=>{Hue.feedback("TV is already set to that")},same_radio:e=>{Hue.feedback("Radio is already set to that")},receive_admin_activity:e=>{Hue.show_admin_activity(e.messages)},receive_access_log:e=>{Hue.show_access_log(e.messages)},receive_admin_list:e=>{Hue.show_admin_list(e)},receive_ban_list:e=>{Hue.show_ban_list(e)},activity_trigger:e=>{Hue.push_to_activity_bar(e.username,Date.now())},message_deleted:e=>{Hue.remove_message_from_chat(e)},receive_synth_key:e=>{Hue.receive_synth_key(e)},receive_synth_voice:e=>{Hue.receive_synth_voice(e)},announcement:e=>{Hue.show_announcement(e)},bio_changed:e=>{Hue.bio_changed(e)},badge_received:e=>{Hue.on_badge_received(e)},report_tv_progress:e=>{Hue.report_tv_progress(e)},receive_tv_progress:e=>{Hue.receive_tv_progress(e)},media_info_changed:e=>{Hue.media_info_changed(e)},new_message_board_post:e=>{Hue.on_message_board_received(e)},last_message_board_post_date_update:e=>{Hue.last_message_board_post_date_update(e)},message_board_post_deleted:e=>{Hue.remove_message_board_post(e)},message_board_cleared:e=>{Hue.on_message_board_cleared(e)},audio_clip_changed:e=>{Hue.audio_clip_changed(e)}},Hue.socket_emit=function(e,o){let _={destination:e,data:o};Hue.emit_queue.push(_),void 0===Hue.emit_queue_timeout&&Hue.check_emit_queue()},Hue.check_emit_queue=function(){if(Hue.emit_queue.length>0){let e=Hue.emit_queue[0];"first"!==e&&Hue.do_socket_emit(e),Hue.emit_queue.shift(),Hue.emit_queue_timeout=setTimeout(function(){Hue.check_emit_queue()},Hue.config.socket_emit_throttle)}else clearTimeout(Hue.emit_queue_timeout),Hue.emit_queue_timeout=void 0},Hue.do_socket_emit=function(e){Hue.debug_socket&&console.info(`Emit: ${e.destination} | Data: ${JSON.stringify(e.data).substring(0,250)}`),e.data.server_method_name=e.destination,Hue.socket.emit("server_method",e.data)},Hue.start_socket=function(){Hue.socket=io("/",{reconnection:!1}),Hue.socket.on("connect",()=>{let e=!Hue.get_setting("message_log");Hue.socket_emit("join_room",{room_id:Hue.room_id,user_id:Hue.user_id,token:Hue.jwt_token,no_message_log:e})}),Hue.socket.on("disconnect",e=>{Hue.started&&(Hue.userlist=[],Hue.activity_list=[],Hue.update_userlist(),Hue.update_activity_bar(),Hue.open_profile_username&&Hue.show_profile(Hue.open_profile_username),Hue.get_setting("autoconnect")?setTimeout(function(){Hue.restart_client()},5e3):Hue.show_reload_button())}),Hue.socket.on("update",e=>{let o=e.type,_=e.data;Hue.server_update_events[o]&&Hue.server_update_events[o](_)})},Hue.disconnect_socket=function(){Hue.socket.close()};
Hue.start_synth=async function(e){if(Hue.tone_loading)return!1;Hue.tone_loading=!0,await Hue.load_script("/static/js/libs2/Tone.js"),Hue.synth=new Tone.Synth({oscillator:{type:"triangle8"},envelope:{attack:2,decay:1,sustain:.4,release:4}}).toMaster(),Hue.play_synth_key(e)},Hue.setup_synth=function(){Hue.synth_voice=window.speechSynthesis,$("#synth_container").on("mouseenter",function(){Hue.show_synth()}),$("#synth_container").on("mouseleave",function(){Hue.hide_synth()}),$("#synth_content").on("mousedown",".synth_key",function(){$(this).addClass("synth_key_pressed")}),$("#synth_content").on("mouseup mouseleave",".synth_key",function(){$(this).removeClass("synth_key_pressed")}),$("#synth_content").on("click",".synth_key",function(){let e=$(this).attr("id").replace("synth_key_","");Hue.send_synth_key(e)}),$("#synth_content").on("auxclick",".synth_key",function(e){if(2===e.which){let e=$(this).attr("id").replace("synth_key_","");Hue.play_speech(e)}}),$("#synth_key_button_volume").click(function(){Hue.set_synth_muted()}),$("#synth_key_button_volume").on("auxclick",function(e){2===e.which&&Hue.open_user_settings_category("synth")}),$("#synth_voice_input").on("focus",function(){Hue.synth_voice_input_focused=!0}),$("#synth_voice_input").on("blur",function(){Hue.synth_voice_input_focused=!1,Hue.mouse_on_synth||Hue.hide_synth(!0)}),$(".synth_key").each(function(){let e=$(this).attr("id").replace("synth_key_","");Hue.set_synth_key_title(e)}),Hue.set_synth_muted(Hue.room_state.synth_muted)},Hue.set_synth_muted=function(e){let t;void 0===e?(Hue.room_state.synth_muted=!Hue.room_state.synth_muted,t=Hue.room_state.synth_muted):t=e,t?($("#synth_volume_icon").removeClass("fa-volume-up"),$("#synth_volume_icon").addClass("fa-volume-off"),Hue.clear_synth_voice_queue()):($("#synth_volume_icon").removeClass("fa-volume-off"),$("#synth_volume_icon").addClass("fa-volume-up")),Hue.save_room_state()},Hue.show_synth=function(){Hue.can_synth&&Hue.get_setting("synth_enabled")&&(Hue.mouse_on_synth=!0,clearTimeout(Hue.synth_timeout_2),Hue.synth_timeout=setTimeout(function(){$("#synth_content_container").css("display","flex"),Hue.synth_open=!0},Hue.synth_timeout_delay))},Hue.hide_synth=function(e=!1){if(Hue.mouse_on_synth=!1,!e&&Hue.synth_voice_input_focused)return!1;clearTimeout(Hue.synth_timeout);let t=Hue.synth_timeout_delay;e&&(t=0),Hue.synth_timeout_2=setTimeout(function(){$("#synth_content_container").css("display","none"),Hue.clear_synth_voice(),Hue.synth_open=!1},t)},Hue.send_synth_key=function(e){return!(!Hue.can_synth||Hue.room_state.synth_muted)&&(!((e=parseInt(e))<1||e>Hue.utilz.synth_notes.length)&&(Hue.play_synth_key(e),void Hue.socket_emit("send_synth_key",{key:e})))},Hue.play_synth_key=function(e){let t=Hue.utilz.synth_notes[e-1];if(t){if(void 0===Hue.synth)return Hue.start_synth(e),!1;Hue.synth.triggerAttackRelease(t,.1)}},Hue.receive_synth_key=function(e){if(!Hue.room_state.synth_muted&&Hue.get_setting("synth_enabled")){if(Hue.afk&&Hue.get_setting("afk_disable_synth"))return!1;if(Hue.user_is_ignored(e.username))return!1;e.user_id!==Hue.user_id&&Hue.play_synth_key(e.key),Hue.push_to_synth_recent_users(e,"key")}},Hue.push_to_synth_recent_users=function(e,t){let n=!1,s=Hue.synth_recent_users.map(e=>e.username),_={username:e.username,type:t,date:Date.now()};if(s.includes(e.username)){for(let t=0;t<s.length;t++){if(s[t]===e.username){Hue.synth_recent_users.splice(t,1);break}}Hue.synth_recent_users.unshift(_),n=!0}else Hue.synth_recent_users.unshift(_),n=!0;if(Hue.synth_recent_users.length>Hue.config.synth_max_recent_users&&(Hue.synth_recent_users=Hue.synth_recent_users.slice(0,Hue.config.synth_max_recent_users),n=!0),n){let e=Hue.synth_recent_users.map(e=>e.username).join(", ");$("#synth_key_button_volume").attr("title",e)}},Hue.send_synth_voice=function(e=!1){return!(!Hue.can_synth||Hue.room_state.synth_muted)&&(e||(e=Hue.utilz.clean_string2($("#synth_voice_input").val())),!(0===e.length||e.length>Hue.config.synth_max_voice_text)&&(Hue.clear_synth_voice(),void Hue.socket_emit("send_synth_voice",{text:e})))},Hue.receive_synth_voice=function(e){if(!Hue.room_state.synth_muted&&Hue.get_setting("synth_enabled")){if(Hue.afk&&Hue.get_setting("afk_disable_synth"))return!1;if(Hue.user_is_ignored(e.username))return!1;Hue.play_synth_voice(e.text,e.username),Hue.push_to_synth_recent_users(e,"voice")}},Hue.play_synth_voice=function(e,t,n=!1){let s=new SpeechSynthesisUtterance(e);n||(s.onstart=function(){Hue.show_voice_box(t,e)},s.onend=function(){Hue.synth_voice.pending||Hue.synth_voice.speaking||(Hue.hide_voice_box(),Hue.synth_voice_speeches=[])}),Hue.synth_voice.speak(s),n||Hue.synth_voice_speeches.push(s)},Hue.clear_synth_voice=function(){$("#synth_voice_input").val("")},Hue.clear_synth_voice_queue=function(){Hue.synth_voice.cancel()},Hue.set_synth_key_title=function(e){$(`#synth_key_${e}`).attr("title",Hue.get_setting(`speech_${e}`))},Hue.change_room_synth_mode=function(e){if(!Hue.is_admin_or_op(Hue.role))return Hue.not_an_op(),!1;let t=["enabled","disabled"];return t.includes(e)?e===Hue.room_synth_mode?(Hue.feedback("Synth mode is already set to that"),!1):void Hue.socket_emit("change_synth_mode",{what:e}):(Hue.feedback(`Valid synth modes: ${t.join(" ")}`),!1)},Hue.announce_room_synth_mode_change=function(e){Hue.show_room_notification(e.username,`${e.username} changed the synth mode to ${e.what}`),Hue.set_room_synth_mode(e.what),Hue.check_permissions()},Hue.set_room_synth_mode=function(e){Hue.room_synth_mode=e,Hue.config_admin_room_synth_mode()},Hue.play_speech=function(e){if(isNaN(e))return!1;if((e=parseInt(e))<0||e>Hue.utilz.synth_notes.length)return!1;let t=Hue.get_setting(`speech_${e}`);Hue.send_synth_voice(t)},Hue.show_voice_box=function(e,t){let n=$("\n    <div class='recent_voice_box_item'>\n        <i class='fa fa-volume-up'></i>&nbsp;&nbsp;\n        <div class='voice_box_username'></div>&nbsp;&nbsp;\n        <div class='voice_box_message'></div>\n    </div>");n.find(".voice_box_username").eq(0).text(`${e}:`),n.find(".voice_box_message").eq(0).text(t),$("#recent_voice_box_content").html(n),$("#recent_voice_box").css("display","flex")},Hue.hide_voice_box=function(){$("#recent_voice_box").css("display","none")},Hue.setting_speech_do_action=function(e,t,n=!0){let s=Hue.utilz.clean_string2($(`#${t}_speech_${e}`).val());s||(s=Hue.config[`global_settings_default_speech_${e}`]),$(`#${t}_speech_${e}`).val(s),Hue[t][`speech_${e}`]=s,Hue.active_settings(`speech_${e}`)===t&&Hue.set_synth_key_title(e),n&&Hue[`save_${t}`]()};
Hue.setup_theme_and_background=function(e){Hue.get_css_variables(),Hue.set_background_image(e),Hue.theme_mode=e.theme_mode,Hue.theme=e.theme,Hue.background_mode=e.background_mode,Hue.background_effect=e.background_effect,Hue.background_tile_dimensions=e.background_tile_dimensions,Hue.text_color_mode=e.text_color_mode,Hue.text_color=e.text_color},Hue.set_background_image=function(e){""!==e.background_image?Hue.background_image=e.background_image:Hue.background_image=Hue.config.default_background_image_url,Hue.background_image_setter=e.background_image_setter,Hue.background_image_date=e.background_image_date,Hue.apply_background(),Hue.config_admin_background_image()},Hue.apply_background=function(){let e,o,n,t=Hue.get_setting("background_mode"),r=Hue.get_setting("background_url"),a=Hue.get_setting("background_tile_dimensions");if("room"===t)e=!Hue.loaded_image.source||"mirror"!==Hue.background_mode&&"mirror_tiled"!==Hue.background_mode?Hue.background_image:Hue.loaded_image.source,o=Hue.background_mode,n=Hue.background_tile_dimensions;else if(t.startsWith("custom")){if(!r)return $(".background_image").css("background-image","none"),!1;e=r,o=t.replace("custom_",""),n=a}Hue.background_image_enabled()?$(".background_image").css("background-image",`url('${e}')`):$(".background_image").css("background-image","none"),"normal"===o||"mirror"===o?$(".background_image").each(function(){$(this).removeClass("background_image_tiled")}):"tiled"!==o&&"mirror_tiled"!==o||$(".background_image").each(function(){$(this).addClass("background_image_tiled")}),$(".background_image").each(function(){$(this).removeClass("background_image_blur"),$(this).removeClass("background_image_grayscale"),$(this).removeClass("background_image_saturate"),$(this).removeClass("background_image_brightness")}),"blur"===Hue.background_effect&&"solid"!==o?$(".background_image").each(function(){$(this).addClass("background_image_blur")}):"grayscale"===Hue.background_effect&&"solid"!==o?$(".background_image").each(function(){$(this).addClass("background_image_grayscale")}):"saturate"===Hue.background_effect&&"solid"!==o?$(".background_image").each(function(){$(this).addClass("background_image_saturate")}):"brightness"===Hue.background_effect&&"solid"!==o&&$(".background_image").each(function(){$(this).addClass("background_image_brightness")});let u=`\n    <style class='appended_background_style'>\n\n    .background_image_tiled\n    {\n        background-size: ${n} !important;\n        background-repeat: repeat !important;\n    }\n\n    </style>\n    `;$(".appended_background_style").each(function(){$(this).remove()}),$("head").append(u)},Hue.set_theme_mode=function(e){Hue.theme_mode=e,Hue.config_admin_theme_mode()},Hue.set_theme=function(e){Hue.theme=e,Hue.apply_theme(),Hue.config_admin_theme()},Hue.apply_theme=function(){let e,o=Hue.get_setting("theme_mode");"room"===o?e="automatic"===Hue.theme_mode&&Hue.dominant_theme?Hue.dominant_theme:Hue.theme:"custom"===o&&(e=Hue.get_setting("theme_color")),e.startsWith("#")&&(e=Hue.colorlib.array_to_rgb(Hue.colorlib.hex_to_rgb(e)));let n,t=e,r=Hue.colorlib.get_lighter_or_darker(t,Hue.config.color_contrast_amount_1);"room"===o?n="custom"===Hue.text_color_mode?Hue.text_color:Hue.colorlib.get_lighter_or_darker(t,Hue.config.color_contrast_amount_2):"custom"===o&&(n=Hue.get_setting("text_color"));let a,u,c=Hue.colorlib.rgb_to_rgba(t,Hue.config.opacity_amount_1),_=Hue.colorlib.rgb_to_rgba(r,Hue.config.opacity_amount_1),i=Hue.colorlib.rgb_to_rgba(r,Hue.config.opacity_amount_3),d=Hue.colorlib.get_lighter_or_darker(t,Hue.config.color_contrast_amount_3),g=Hue.colorlib.get_lighter_or_darker(t,Hue.config.color_contrast_amount_4),m=Hue.colorlib.rgb_to_rgba(g,Hue.config.opacity_amount_3),l=Hue.colorlib.rgb_to_rgba(g,Hue.config.opacity_amount_1),s=Hue.colorlib.rgb_to_rgba(d,Hue.config.opacity_amount_3),b=Hue.colorlib.get_lighter_or_darker(t,Hue.config.color_contrast_amount_5),H=Hue.colorlib.rgb_to_rgba(b,Hue.config.opacity_amount_3);$(".bg0").css("background-color",t),$(".bg1").css("background-color",c),$(".bg1").css("color",n),Hue.get_setting("transparent_panels")?(a=_,u=l):(a=r,u=g),$(".panel").css("background-color",a),$(".panel").css("color",n);let k=`\n    <style class='appended_theme_style'>\n\n    .Msg-overlay\n    {\n        background-color: ${s} !important;\n        color: ${t} !important;\n    }\n\n    .Msg-window, .overlay_same_color\n    {\n        background-color: ${t} !important;\n        color: ${n} !important;\n    }\n\n    .Msg-window-inner-x:hover\n    {\n        background-color: ${r} !important;\n    }\n\n    .custom_titlebar\n    {\n        background-color: ${r} !important;\n        color: ${n} !important;\n    }\n\n    .titlebar_inner_x\n    {\n        background-color: ${r} !important;\n    }\n\n    .titlebar_inner_x:hover\n    {\n        background-color: ${t} !important;\n    }\n\n    .custom_popup\n    {\n        border: 1px solid ${n} !important;\n    }\n\n    #reactions_box_container\n    {\n        background-color: ${g} !important;\n        color: ${n} !important;\n    }\n\n    .highlighted, .highlighted2, .highlighted3, .highlighted4\n    {\n        background-color: ${i} !important;\n        color: ${n} !important;\n    }\n\n    .squaro\n    {\n        background-color: ${r} !important;\n        color: ${n} !important;\n    }\n\n    .scroller\n    {\n        background-color: ${i} !important;\n        color: ${n} !important;\n    }\n\n    .left_scroller\n    {\n        border-right: 1px ${m} solid !important;\n    }\n\n    .center_scroller\n    {\n        border-right: 1px ${m} solid !important;\n    }\n\n    .draw_canvas\n    {\n        background-color: ${i} !important;\n        color: ${n} !important;\n    }\n\n    .modal_icon_selected\n    {\n        background-color: ${i} !important;\n        color: ${n} !important;\n    }\n\n    .settings_window_left\n    {\n        background-color: ${r} !important;\n        color: ${n} !important;\n    }\n\n    .maxer\n    {\n        background-color: ${n} !important;\n        color: ${n} !important;\n    }\n\n    .chat_menu_button\n    {\n        background-color: ${r} !important;\n        border-left: 1px solid ${b} !important;\n    }\n\n    .chat_menu_button:hover\n    {\n        background-color: ${g} !important;\n    }\n\n    .chat_menu_button_main:hover, .chat_menu_button_main_selected\n    {\n        background-color: ${b} !important;\n    }\n\n    #activity_bar_container\n    {\n        background-color: ${u} !important;\n        color: ${n} !important;\n    }\n\n    .link_preview\n    {\n        background-color: ${m} !important;\n        color: ${n} !important;\n    }\n\n    .message_edit_area\n    {\n        background-color: ${m} !important;\n        color: ${n} !important;\n    }\n\n    .synth_key\n    {\n        background-color: ${g} !important;\n        color: ${n} !important;\n    }\n\n    .synth_key_pressed\n    {\n        background-color: ${d} !important;\n        color: ${n} !important;\n    }\n\n    .synth_key_button\n    {\n        background-color: ${d} !important;\n        color: ${n} !important;\n    }\n\n    .synth_key_divider\n    {\n        background-color: ${b} !important;\n    }\n\n    .spoiler\n    {\n        background-color: ${n} !important;\n    }\n\n    #input::placeholder\n    {\n        color: ${d} !important;\n    }\n\n    ::-webkit-scrollbar-thumb\n    {\n        background-color: ${b} !important;\n    }\n\n    .Msg-container ::-webkit-scrollbar-thumb\n    {\n        background-color: ${g} !important;\n    }\n\n    body, html\n    {\n        scrollbar-color: ${b} transparent !important;\n    }\n\n    .Msg-container\n    {\n        scrollbar-color: ${g} transparent !important;\n    }\n\n    .modal_subheader\n    {\n        background-color: ${g} !important;\n    }\n\n    #reply_text\n    {\n        background-color: ${b} !important;\n    }\n\n    .slight_background\n    {\n        background-color: ${b} !important;\n    }\n\n    .slight_color\n    {\n        color: ${b} !important;\n    }\n\n    .color_3\n    {\n        color: ${d} !important;\n    }\n\n    #user_menu_bio_textarea\n    {\n        background-color: ${b} !important;\n        color: ${n} !important;\n    }\n\n    #user_menu_bio_textarea::placeholder\n    {\n        color: ${d} !important;\n    }\n\n    .vertical_separator\n    {\n        color: ${g} !important;\n    }\n\n    .room_menu_toggle_container \n    {\n        background-color: ${b} !important;\n    }\n\n    .backgrounded\n    {\n        background-color: ${b} !important;\n        outline: 1px dotted ${g} !important;\n    }\n\n    #notebook_textarea\n    {\n        background-color: ${H} !important;\n        color: ${n} !important;\n    }\n\n    </style>\n    `;$(".appended_theme_style").each(function(){$(this).remove()}),$("head").append(k)},Hue.change_theme_mode=function(e){return Hue.is_admin_or_op(Hue.role)?"automatic"!==e&&"custom"!==e?(Hue.feedback("Invalid theme mode"),!1):e===Hue.theme_mode?(Hue.feedback(`Theme mode is already ${Hue.theme_mode}`),!1):void Hue.socket_emit("change_theme_mode",{mode:e}):(Hue.not_an_op(),!1)},Hue.change_theme=function(e){return Hue.is_admin_or_op(Hue.role)?void 0!==(e=Hue.utilz.clean_string5(e).toLowerCase())&&(Hue.utilz.validate_hex(e)?e===Hue.theme?(Hue.feedback("Theme is already set to that"),!1):void Hue.socket_emit("change_theme",{color:e}):(Hue.feedback("Not a valid hex color value"),!1)):(Hue.not_an_op(),!1)},Hue.announce_theme_mode_change=function(e){Hue.show_room_notification(e.username,`${e.username} changed the theme mode to ${e.mode}`),Hue.set_theme_mode(e.mode),Hue.apply_theme()},Hue.announce_theme_change=function(e){Hue.show_room_notification(e.username,`${e.username} changed the theme to ${e.color}`),Hue.set_theme(e.color)},Hue.open_background_image_select=function(){Hue.msg_info2.show(["Change Background Image",Hue.template_background_image_select()]),Hue.horizontal_separator.separate("background_image_select_container")},Hue.open_background_image_picker=function(){Hue.msg_info2.close(),$("#background_image_input").click()},Hue.open_background_image_input=function(){Hue.msg_info2.show(["Change Background Image",Hue.template_background_image_input()],function(){$("#background_image_input_text").focus(),Hue.background_image_input_open=!0})},Hue.background_image_input_action=function(){let e=$("#background_image_input_text").val().trim();Hue.change_background_image_source(e)&&Hue.msg_info2.close()},Hue.background_image_selected=function(e){let o=e.files[0],n=o.size/1024;if($("#background_image_input").closest("form").get(0).reset(),n>Hue.config.max_image_size)return Hue.msg_info.show("File is too big"),!1;$("#admin_background_image").attr("src",Hue.config.background_image_loading_url),Hue.upload_file({file:o,action:"background_image_upload"})},Hue.change_background_image_source=function(e){if(!Hue.is_admin_or_op(Hue.role))return Hue.not_an_op(),!1;if(void 0===e)return!1;if("default"!==e){if(!Hue.utilz.is_url(e))return!1;if((e=e.replace(/\.gifv/g,".gif"))===Hue.background_image)return Hue.feedback("Background image is already set to that"),!1;if(0===e.length)return!1;if(e.length>Hue.config.max_media_source_length)return!1;let o=Hue.utilz.get_extension(e).toLowerCase();if(!o||!Hue.utilz.image_extensions.includes(o))return!1}else if(Hue.background_image===Hue.config.default_background_image_url)return Hue.feedback("Background image is already set to that"),!1;return Hue.socket_emit("change_background_image_source",{src:e}),!0},Hue.announce_background_image_change=function(e){Hue.show_room_notification(e.username,`${e.username} changed the background image`),Hue.set_background_image(e)},Hue.change_background_mode=function(e){return Hue.is_admin_or_op(Hue.role)?"normal"!==e&&"tiled"!==e&&"mirror"!==e&&"mirror_tiled"!==e&&"solid"!==e?(Hue.feedback("Invalid background mode"),!1):e===Hue.background_mode?(Hue.feedback(`Background mode is already ${Hue.background_mode}`),!1):void Hue.socket_emit("change_background_mode",{mode:e}):(Hue.not_an_op(),!1)},Hue.announce_background_mode_change=function(e){Hue.show_room_notification(e.username,`${e.username} changed the background mode to ${e.mode}`),Hue.set_background_mode(e.mode)},Hue.change_background_tile_dimensions=function(e){return Hue.is_admin_or_op(Hue.role)?!(e.length>Hue.config.safe_limit_1)&&(0!==(e=Hue.utilz.clean_string2(e)).length&&(e!==Hue.background_tile_dimensions&&void Hue.socket_emit("change_background_tile_dimensions",{dimensions:e}))):(Hue.not_an_op(),!1)},Hue.announce_background_tile_dimensions_change=function(e){Hue.show_room_notification(e.username,`${e.username} changed the background tile dimensions to ${e.dimensions}`),Hue.set_background_tile_dimensions(e.dimensions),Hue.apply_background()},Hue.background_image_enabled=function(){let e=Hue.get_setting("background_mode");if("room"===e){if("solid"===Hue.background_mode)return!1;if(("mirror"===Hue.background_mode||"mirror_tiled"===Hue.background_mode)&&"disabled"===Hue.room_images_mode)return!1}else if("custom_solid"===e)return!1;return!0},Hue.change_background_effect=function(e){return Hue.is_admin_or_op(Hue.role)?"none"!==e&&"blur"!==e&&"grayscale"!==e&&"saturate"!==e&&"brightness"!==e?(Hue.feedback("Invalid background effect"),!1):e===Hue.background_effect?(Hue.feedback(`Background effect is already ${Hue.background_effect}`),!1):void Hue.socket_emit("change_background_effect",{effect:e}):(Hue.not_an_op(),!1)},Hue.announce_background_effect_change=function(e){Hue.show_room_notification(e.username,`${e.username} changed the background effect to ${e.effect}`),Hue.set_background_effect(e.effect)},Hue.set_background_mode=function(e){Hue.background_mode=e,Hue.config_admin_background_mode(),Hue.apply_background()},Hue.set_background_effect=function(e){Hue.background_effect=e,Hue.config_admin_background_effect(),Hue.apply_background()},Hue.set_background_tile_dimensions=function(e){Hue.background_tile_dimensions=e,Hue.config_admin_background_tile_dimensions()},Hue.change_text_color_mode=function(e){return Hue.is_admin_or_op(Hue.role)?"automatic"!==e&&"custom"!==e?(Hue.feedback("Invalid text color mode"),!1):e===Hue.text_color_mode?(Hue.feedback(`Text color mode is already ${Hue.text_color_mode}`),!1):void Hue.socket_emit("change_text_color_mode",{mode:e}):(Hue.not_an_op(),!1)},Hue.announce_text_color_mode_change=function(e){Hue.show_room_notification(e.username,`${e.username} changed the text color mode to ${e.mode}`),Hue.set_text_color_mode(e.mode),Hue.apply_theme()},Hue.set_text_color_mode=function(e){Hue.text_color_mode=e,Hue.config_admin_text_color_mode()},Hue.change_text_color=function(e){return Hue.is_admin_or_op(Hue.role)?void 0!==(e=Hue.utilz.clean_string5(e).toLowerCase())&&(Hue.utilz.validate_hex(e)?e===Hue.text_color?(Hue.feedback("Text color is already set to that"),!1):void Hue.socket_emit("change_text_color",{color:e}):(Hue.feedback("Not a valid hex color value"),!1)):(Hue.not_an_op(),!1)},Hue.announce_text_color_change=function(e){Hue.show_room_notification(e.username,`${e.username} changed the text color to ${e.color}`),Hue.set_text_color(e.color),Hue.apply_theme()},Hue.set_text_color=function(e){Hue.text_color=e,Hue.config_admin_text_color()},Hue.get_css_variables=function(){let e=getComputedStyle(document.body);Hue.css_var_panel_height=e.getPropertyValue("--panel-height"),Hue.css_var_panel_height_double=e.getPropertyValue("--panel-height-double")},Hue.change_css_variable=function(e,o){document.documentElement.style.setProperty(`--${e}`,o)};
Hue.setup_tv=function(e,t={}){let i;if("restart"===e)(i=Hue.current_tv()).date=t.date,i.info+=` | ${Hue.utilz.nice_date(i.date)}`,i.message=`${t.setter} restarted the tv`,i.comment=t.comment,i.in_log=void 0===t.in_log||t.in_log;else{if((i={}).id=t.id,i.user_id=t.user_id,i.type=t.type,i.source=t.source,i.title=t.title,i.setter=t.setter,i.date=t.date,i.query=t.query,i.comment=t.comment,i.nice_date=i.date?Hue.utilz.nice_date(i.date):Hue.utilz.nice_date(),i.in_log=void 0===t.in_log||t.in_log,i.setter||(i.setter="The system"),i.source||(i.source=Hue.config.default_tv_source,i.type=Hue.config.default_tv_type,i.title=Hue.config.default_tv_title),i.title||(i.title=i.source),i.message=`${i.setter} changed the tv to: ${Hue.utilz.conditional_quotes(i.title)}`,"youtube"===i.type){let e=Hue.utilz.get_youtube_time(i.source);0!==e&&(i.message+=` (At ${Hue.utilz.humanize_seconds(e)})`)}let e=i.id?`${i.id.slice(-3)} | `:"";i.info=`${e}Setter: ${i.setter} | ${i.nice_date}`,i.query&&(i.info+=` | Search Term: "${i.query}"`),i.onclick=function(){Hue.open_url_menu({source:i.source,data:i,media_type:"tv"})}}i.date||(i.date=Date.now()),i.message&&(i.message_id=Hue.announce_tv(i).message_id),"change"!==e&&"show"!==e||Hue.push_tv_changed(i),"change"!==e&&"restart"!==e||("change"===e?(Hue.room_state.tv_locked&&$("#footer_lock_tv_icon").addClass("blinking"),Hue.change({type:"tv",force:!0})):"restart"===e&&Hue.change({type:"tv",force:!0,play:!0}))},Hue.announce_tv=function(e){return Hue.public_feedback(e.message,{id:e.id,save:!0,brk:"<i class='icon2c fa fa-tv'></i>",title:e.info,onclick:e.onclick,date:e.date,type:e.type,username:e.setter,comment:e.comment,type:"tv_change",user_id:e.user_id,in_log:e.in_log})},Hue.current_tv=function(){return Hue.tv_changed.length>0?Hue.tv_changed[Hue.tv_changed.length-1]:{}},Hue.push_tv_changed=function(e){Hue.tv_changed.push(e),Hue.tv_changed.length>Hue.config.media_changed_crop_limit&&(Hue.tv_changed=Hue.tv_changed.slice(Hue.tv_changed.length-Hue.config.media_changed_crop_limit)),Hue.after_push_media_change("tv",e)},Hue.stop_tv=function(e=!0){Hue.youtube_video_player&&Hue.youtube_video_player.pauseVideo(),Hue.twitch_video_player&&(clearTimeout(Hue.play_twitch_video_player_timeout),Hue.twitch_video_player.pause()),Hue.soundcloud_video_player&&Hue.soundcloud_video_player.pause(),Hue.vimeo_video_player&&Hue.vimeo_video_player.pause(),$("#media_video").length>0&&$("#media_video")[0].pause(),e&&($("#media_iframe_video").attr("src",""),$("#media_iframe_poster").css("display","block"))},Hue.play_tv=function(){if(!Hue.tv_visible)return!1;let e=!0;"youtube"===Hue.current_tv().type?Hue.youtube_video_player&&Hue.youtube_video_player.playVideo():"twitch"===Hue.current_tv().type?Hue.twitch_video_player&&Hue.twitch_video_player.play():"soundcloud"===Hue.current_tv().type?Hue.soundcloud_video_player&&Hue.soundcloud_video_player.play():"vimeo"===Hue.current_tv().type?Hue.vimeo_video_player&&Hue.vimeo_video_player.play():"video"===Hue.current_tv().type?$("#media_video").length>0&&$("#media_video")[0].play():"iframe"===Hue.current_tv().type?($("#media_iframe_video").attr("src",Hue.current_tv().source),$("#media_iframe_poster").css("display","none")):e=!1,e&&Hue.get_setting("stop_radio_on_tv_play")&&Hue.stop_radio()},Hue.hide_tv=function(e=!1){$("#media_tv .media_container").each(function(){let t=$(this).attr("id"),i=t.replace("media_","").replace("_video_container","");if(e&&e.type===i)$(this).css("display","flex");else{let e=$(`<div id='${t}' class='media_container'></div>`);e.css("display","none"),$(this).replaceWith(e),Hue[`${i}_video_player`]=void 0,Hue[`${i}_video_player_requested`]=!1,Hue[`${i}_video_player_request`]=!1}})},Hue.show_youtube_video=function(e=!0){let t=Hue.loaded_tv;Hue.before_show_tv(t);let i=Hue.utilz.get_youtube_id(t.source);if(Hue.youtube_video_play_on_queue=e,"video"===i[0])Hue.youtube_video_player.cueVideoById({videoId:i[1],startSeconds:Hue.utilz.get_youtube_time(t.source)});else{if("list"!==i[0])return!1;Hue.youtube_video_player.cuePlaylist({list:i[1][0],index:i[1][1]})}Hue.after_show_tv(e)},Hue.show_twitch_video=function(e=!0){let t=Hue.loaded_tv;Hue.before_show_tv(t);let i=Hue.utilz.get_twitch_id(t.source);if("video"===i[0])Hue.twitch_video_player.setVideoSource(t.source);else{if("channel"!==i[0])return!1;Hue.twitch_video_player.setChannel(i[1])}e?Hue.play_twitch_video_player_timeout=setTimeout(function(){Hue.twitch_video_player.play()},1e3):(clearTimeout(Hue.play_twitch_video_player_timeout),Hue.twitch_video_player.pause()),Hue.after_show_tv(e)},Hue.show_soundcloud_video=function(e=!0){let t=Hue.loaded_tv;Hue.before_show_tv(t),Hue.soundcloud_video_player.load(t.source,{auto_play:!1,single_active:!1,show_artwork:!0,callback:function(){e&&Hue.soundcloud_video_player.play()}}),Hue.after_show_tv(e)},Hue.show_video_video=async function(e=!0){let t=Hue.loaded_tv;if(0===$("#media_video").length){let e=`<video id='media_video'\n        class='video_frame' width="640px" height="360px"\n        preload="metadata" poster="${Hue.config.default_video_url}" controls></video>\n        <div class='media_info dynamic_title'></div>`;$("#media_video_video_container").html(e)}Hue.before_show_tv(t);let i=t.source.split(".");"m3u8"===i[i.length-1]?(await Hue.start_hls(),Hue.hls.loadSource(t.source),Hue.hls.attachMedia($("#media_video")[0])):$("#media_video").prop("src",t.source),e&&$("#media_video")[0].play(),Hue.after_show_tv(e)},Hue.show_iframe_video=function(e=!0){let t=Hue.loaded_tv;if(0===$("#media_iframe_video").length){let e="<div id='media_iframe_poster' class='pointer unselectable action'>Click Here To Load</div>\n        <iframe width=\"640px\" height=\"360px\" id='media_iframe_video' class='video_frame'></iframe>\n        <div class='media_info dynamic_title'></div>";$("#media_iframe_video_container").html(e),Hue.setup_iframe_video()}Hue.before_show_tv(t),e?($("#media_iframe_video").attr("src",t.source),$("#media_iframe_poster").css("display","none")):$("#media_iframe_poster").css("display","block"),Hue.after_show_tv(e)},Hue.show_vimeo_video=function(e=!0){let t=Hue.loaded_tv;Hue.before_show_tv(t);let i=Hue.utilz.get_vimeo_id(t.source);Hue.vimeo_video_player.loadVideo(i).then(()=>{e&&Hue.vimeo_video_player.play()}),Hue.after_show_tv(e)},Hue.before_show_tv=function(e){Hue.stop_tv(),Hue.hide_tv(e),Hue.hls=void 0},Hue.after_show_tv=function(e){let t=$(`#media_${Hue.loaded_tv.type}_video_container`).find(".media_info").get(0);Hue.apply_media_info(t,Hue.loaded_tv,"tv"),Hue.fix_visible_video_frame(),Hue.focus_input(),e&&Hue.get_setting("stop_radio_on_tv_play")&&Hue.stop_radio(),Hue.set_tv_volume(!1,!1)},Hue.change_tv_source=function(e,t=!1,i=""){let u=!0;if(t&&(u=!1),!Hue.can_tv)return u&&Hue.feedback("You don't have permission to change the tv"),!1;if(!i){let t=Hue.get_media_change_inline_comment("tv",e);e=t.source,i=t.comment}if(i.length>Hue.config.max_media_comment_length)return u&&Hue.feedback("Comment is too long"),!1;if(0===e.length)return!1;if((e=Hue.utilz.clean_string2(e)).length>Hue.config.max_media_source_length)return!1;if(e.startsWith("/"))return!1;if(e===Hue.current_tv().source||e===Hue.current_tv().query)return u&&Hue.feedback("TV is already set to that"),!1;if("default"===e);else if("prev"===e||"previous"===e){if(!(Hue.tv_changed.length>1))return u&&Hue.feedback("No tv source before current one"),!1;e=Hue.tv_changed[Hue.tv_changed.length-2].source}if(Hue.utilz.is_url(e)){if(Hue.check_domain_list("tv",e))return u&&Hue.feedback("TV sources from that domain are not allowed"),!1;if(e.includes("youtube.com")||e.includes("youtu.be")){if(Hue.utilz.get_youtube_id(e)&&!Hue.config.youtube_enabled)return u&&Hue.feedback("YouTube support is not enabled"),!1}else if(e.includes("twitch.tv")){if(Hue.utilz.get_twitch_id(e)&&!Hue.config.twitch_enabled)return u&&Hue.feedback("Twitch support is not enabled"),!1}else if(e.includes("soundcloud.com")){if(!Hue.config.soundcloud_enabled)return u&&Hue.feedback("Soundcloud support is not enabled"),!1}else if(e.includes("vimeo.com")){if(!Hue.config.vimeo_enabled)return u&&Hue.feedback("Vimeo support is not enabled"),!1}else{let t=Hue.utilz.get_extension(e).toLowerCase();if(t)if(Hue.utilz.video_extensions.includes(t)||Hue.utilz.audio_extensions.includes(t));else{if(Hue.utilz.image_extensions.includes(t))return u&&Hue.feedback("That doesn't seem to be a video"),!1;if(!Hue.config.iframes_enabled)return u&&Hue.feedback("IFrame support is not enabled"),!1}else if(!Hue.config.iframes_enabled)return u&&Hue.feedback("IFrame support is not enabled"),!1}}else if("restart"!==e&&"reset"!==e){if(e.length>Hue.config.safe_limit_1)return u&&Hue.feedback("Query is too long"),!1;if(!Hue.config.youtube_enabled)return u&&Hue.feedback("YouTube support is not enabled"),!1}if(t)return!0;Hue.socket_emit("change_tv_source",{src:e,comment:i})},Hue.toggle_tv=function(e,t=!0){void 0!==e?Hue.room_state.tv_enabled!==e?Hue.room_state.tv_enabled=e:t=!1:Hue.room_state.tv_enabled=!Hue.room_state.tv_enabled,Hue.tv_visible!==e&&Hue.change_tv_visibility(!1),t&&Hue.save_room_state()},Hue.change_tv_visibility=function(e=!0){if("disabled"!==Hue.room_tv_mode&&Hue.room_state.tv_enabled)$("#media").css("display","flex"),$("#media_tv").css("display","flex"),$("#footer_toggle_tv_icon").removeClass("fa-toggle-off"),$("#footer_toggle_tv_icon").addClass("fa-toggle-on"),Hue.tv_visible=!0,Hue.first_media_change&&Hue.change({type:"tv",force:!0,play:!1,current_source:Hue.room_state.tv_locked}),e&&Hue.play_tv(),Hue.fix_visible_video_frame();else{Hue.hide_tv(),$("#media_tv").css("display","none"),0===Hue.num_media_elements_visible()&&Hue.hide_media(),$("#footer_toggle_tv_icon").removeClass("fa-toggle-on"),$("#footer_toggle_tv_icon").addClass("fa-toggle-off"),Hue.tv_visible=!1}Hue.images_visible&&Hue.fix_image_frame(),Hue.check_footer_media_rotate(),Hue.goto_bottom(!1,!1)},Hue.toggle_lock_tv=function(e,t=!0){Hue.room_state.tv_locked=void 0!==e?e:!Hue.room_state.tv_locked,Hue.change_lock_tv(),t&&Hue.save_room_state()},Hue.change_lock_tv=function(){Hue.change_media_lock("tv")},Hue.tv_is_maximized=function(){return Hue.tv_visible&&!Hue.images_visible},Hue.maximize_tv=function(){Hue.tv_visible?Hue.images_visible?Hue.toggle_images(!1,!1):Hue.toggle_images(!0,!1):(Hue.toggle_tv(!0,!1),Hue.images_visible&&Hue.toggle_images(!1,!1)),Hue.save_room_state()},Hue.tv_volume_increase=function(e=.1){if(1===Hue.room_state.tv_volume)return!1;let t=Hue.room_state.tv_volume+e;Hue.set_tv_volume(t)},Hue.tv_volume_decrease=function(e=.1){if(0===Hue.room_state.tv_volume)return!1;let t=Hue.room_state.tv_volume-e;Hue.set_tv_volume(t)},Hue.tv_prev=function(){Hue.change_tv_source("prev"),Hue.msg_tv_picker.close()},Hue.show_tv_picker=function(){if(!Hue.can_tv)return Hue.feedback("You don't have tv permission"),!1;Hue.msg_tv_picker.show(function(){$("#tv_source_picker_input").focus(),Hue.scroll_modal_to_bottom("tv_picker")})},Hue.set_tv_volume=function(e=!1,t=!0,i=!0){"number"!=typeof e&&(e=Hue.room_state.tv_volume),(e=Hue.utilz.round(e,1))>1?e=1:e<0&&(e=0),Hue.room_state.tv_volume=e;let u=Hue.utilz.to_hundred(e);$("#media_video").length>0&&($("#media_video")[0].volume=e),Hue.youtube_video_player&&Hue.youtube_video_player.setVolume(u),Hue.twitch_video_player&&Hue.twitch_video_player.setVolume(e),Hue.soundcloud_video_player&&Hue.soundcloud_video_player.setVolume(u),Hue.vimeo_video_player&&Hue.vimeo_video_player.setVolume(e),t&&(i&&Hue.set_media_menu_tv_volume(e),Hue.save_room_state())},Hue.refresh_tv=function(){Hue.change({type:"tv",force:!0,play:!0,current_source:!0})},Hue.restart_tv=function(){Hue.change_tv_source("restart"),Hue.msg_tv_picker.close()},Hue.set_room_tv_mode=function(e){Hue.room_tv_mode=e,Hue.config_admin_room_tv_mode()},Hue.do_media_tv_size_change=function(e,t=!0,i=!0){if("max"===e?e=90:"min"===e&&(e=10),(e=parseInt(e))<0||e>100)return!1;0!==e?100!==e?(e!==Hue.get_setting("tv_display_percentage")&&Hue.modify_setting(`tv_display_percentage ${e}`,!1),t&&Hue.notify_media_tv_size_change(e)):Hue.tv_is_maximized()||(Hue.maximize_tv(),Hue.show_infotip("TV Maximized")):Hue.images_is_maximized()||(Hue.maximize_images(),Hue.show_infotip("Image Maximized"))},Hue.increase_tv_percentage=function(){let e=Hue.get_setting("tv_display_percentage");e+=10,e=Hue.utilz.round2(e,10),Hue.enable_setting_override("tv_display_percentage"),Hue.do_media_tv_size_change(e)},Hue.get_visible_video_frame_id=function(){let e=!1;return $(".video_frame").each(function(){if("none"!==$(this).parent().css("display"))return e=this.id,!1}),e},Hue.decrease_tv_percentage=function(){let e=Hue.get_setting("tv_display_percentage");e-=10,e=Hue.utilz.round2(e,10),Hue.enable_setting_override("tv_display_percentage"),Hue.do_media_tv_size_change(e)},Hue.set_default_tv_size=function(){Hue.do_media_tv_size_change(Hue.config.global_settings_default_tv_display_percentage)},Hue.announce_room_tv_mode_change=function(e){Hue.show_room_notification(e.username,`${e.username} changed the tv mode to ${e.what}`),Hue.set_room_tv_mode(e.what),Hue.change_tv_visibility(!1),Hue.check_permissions(),Hue.check_media_maxers()},Hue.set_media_menu_tv_volume=function(e=!1){!1===e?e=Hue.room_state.tv_volume:"increase"===e?(e=Hue.room_state.tv_volume+.2)>1&&(e=1):"decrease"===e?(e=Hue.room_state.tv_volume-.2)<0&&(e=0):"max"===e?e=1:"min"===e?e=0:"default"===e&&(e=Hue.config.room_state_default_tv_volume),$("#media_menu_tv_volume").val(e),Hue.set_tv_volume(e,!0,!1)},Hue.notify_media_tv_size_change=function(e){let t;t=e===Hue.config.global_settings_default_tv_display_percentage?" (Default)":"",Hue.show_infotip(`TV Size: ${e}%${t}`)},Hue.setup_iframe_video=function(){$("#media_iframe_poster").click(function(){Hue.play_tv()})},Hue.fix_visible_video_frame=function(){let e=Hue.get_visible_video_frame_id();e&&Hue.fix_frame(e)},Hue.change_room_tv_mode=function(e){if(!Hue.is_admin_or_op(Hue.role))return Hue.not_an_op(),!1;let t=["enabled","disabled","locked"];return t.includes(e)?e===Hue.room_tv_mode?(Hue.feedback("TV mode is already set to that"),!1):void Hue.socket_emit("change_tv_mode",{what:e}):(Hue.feedback(`Valid tv modes: ${t.join(" ")}`),!1)},Hue.tv_picker_submit=function(){let e=$("#tv_source_picker_input").val().trim();""!==e&&(Hue.change_tv_source(e),Hue.msg_tv_picker.close())},Hue.can_sync_tv=function(){return!(Date.now()-Hue.last_media_sync<Hue.config.media_sync_cooldown)&&(!!Hue.room_state.tv_enabled&&(Hue.current_tv()===Hue.loaded_tv&&("youtube"===Hue.loaded_tv.type&&!!Hue.youtube_video_player)))},Hue.sync_tv=function(e){return!!Hue.can_sync_tv()&&(!!Hue.user_is_online_by_username(e)&&void Hue.socket_emit("sync_tv",{username:e}))},Hue.report_tv_progress=function(e){if(!Hue.can_sync_tv())return!1;let t=Math.round(Hue.youtube_video_player.getCurrentTime());t&&(Hue.last_media_sync=Date.now(),Hue.socket_emit("report_tv_progress",{requester:e.requester,progress:t}))},Hue.receive_tv_progress=function(e){if(!Hue.can_sync_tv())return!1;let t=Hue.utilz.get_youtube_id(Hue.loaded_tv.source);Hue.youtube_video_play_on_queue=!0,"video"===t[0]&&Hue.youtube_video_player.cueVideoById({videoId:t[1],startSeconds:e.progress})};
Hue.start_dropzone=function(){Hue.dropzone=new Dropzone("body",{url:"/",maxFiles:1,maxFilesize:Hue.config.max_image_size/1024,autoProcessQueue:!1,clickable:"#image_file_picker, #image_upload_comment_change",acceptedFiles:"image/jpeg,image/png,image/gif,image/webp,image/bmp"}),Hue.dropzone.on("addedfile",function(e){if(Hue.focus_input(),!Hue.can_images)return Hue.feedback("You don't have permission to change images"),Hue.dropzone.files=[],!1;if(Hue.dropzone.files.length>1)return Hue.dropzone.files=[],!1;if(e.size/1024>Hue.config.max_image_size)return Hue.dropzone.files=[],Hue.feedback("File is too big"),!1;let a=e.name.split(".").pop(-1).toLowerCase();if(!Hue.utilz.image_extensions.includes(a))return Hue.dropzone.files=[],!1;Hue.dropzone.files=[],Hue.show_image_upload_comment(e,"image_upload")})},Hue.create_file_reader=function(e){let a=new FileReader;return a.addEventListener("loadend",function(i){Hue.socket_emit("slice_upload",{data:a.result,action:e.hue_data.action,name:e.hue_data.name,type:e.hue_data.type,size:e.hue_data.size,date:e.hue_data.date,comment:e.hue_data.comment})}),a},Hue.upload_file=function(e={}){if(!(e=Object.assign({file:!1,action:!1,name:!1,comment:!1},e)).file||!e.action)return!1;if(void 0===e.file.hue_data&&(e.file.hue_data={}),e.file.hue_data.action=e.action,e.name?e.file.hue_data.name=e.name:e.file.hue_data.name=e.file.name,e.comment&&(e.file.hue_data.comment=e.comment),"background_image_upload"===e.file.hue_data.action)for(let e in Hue.files){"background_image_upload"===Hue.files[e].hue_data.action&&Hue.cancel_file_upload(e,!1)}e.file.hue_data.size=e.file.size,e.file.hue_data.type=e.file.type;let a=Date.now();e.file.hue_data.date=a,void 0!==e.file.hue_data.name?e.file.hue_data.name=Hue.utilz.clean_string5(e.file.hue_data.name).replace(/.gifv/g,".gif"):e.file.hue_data.name="no_name",e.file.hue_data.reader=Hue.create_file_reader(e.file);let i=e.file.slice(0,Hue.config.upload_slice_size);Hue.files[a]=e.file,e.file.hue_data.next=Hue.get_file_next(e.file),e.file.hue_data.next>=100?e.file.hue_data.sending_last_slice=!0:e.file.hue_data.sending_last_slice=!1,e.file.hue_data.percentage=0;let u={message:`Uploading ${Hue.get_file_action_name(e.file.hue_data.action)}: 0%`,icon:"fa fa-camera",id:`uploading_${a}`,title:`Size: ${Hue.utilz.get_size_string(e.file.hue_data.size/1024)}`};e.file.hue_data.sending_last_slice||(u.after_close=function(){Hue.cancel_file_upload(a)}),e.file.hue_popup=Hue.show_action_popup(u),e.file.hue_data.reader.readAsArrayBuffer(i)},Hue.cancel_file_upload=function(e,a=!0){let i=Hue.files[e];return!!i&&(!i.hue_data.sending_last_slice&&(Hue.change_upload_status(i,"Cancelled",!0),a&&"background_image_upload"===i.hue_data.action&&Hue.config_admin_background_image(),delete Hue.files[e],void Hue.socket_emit("cancel_upload",{date:e})))},Hue.get_file_next=function(e){let a=Math.floor(1*Hue.config.upload_slice_size/e.hue_data.size*100);return a>100&&(a=100),a},Hue.change_upload_status=function(e,a,i=!1){if(!e.hue_popup)return!1;$(e.hue_popup.content).find(".action_popup_message").eq(0).text(`Uploading ${Hue.get_file_action_name(e.hue_data.action)}: ${a}`),i&&e.hue_popup.close()},Hue.get_file_action_name=function(e){let a="";return"image_upload"===e?a="image":"profile_image_upload"===e?a="profile image":"background_image_upload"===e?a="background image":"audio_clip_upload"===e&&(a="audio clip"),a},Hue.request_slice_upload=function(e){let a=Hue.files[e.date];if(!a)return!1;let i=e.current_slice*Hue.config.upload_slice_size,u=a.slice(i,i+Math.min(Hue.config.upload_slice_size,a.hue_data.size-i));a.hue_data.next=Hue.get_file_next(a),a.hue_data.next>=100&&(a.hue_data.sending_last_slice=!0),a.hue_data.percentage=Math.floor(Hue.config.upload_slice_size*e.current_slice/a.hue_data.size*100),a.hue_data.reader.readAsArrayBuffer(u),Hue.change_upload_status(a,`${a.hue_data.percentage}%`)},Hue.upload_ended=function(e){let a=Hue.files[e.date];a&&(Hue.change_upload_status(a,"100%",!0),delete Hue.files[e.date])},Hue.show_upload_error=function(){Hue.feedback("The file could not be uploaded")};
jQuery.fn.urlize=function(e=!0){try{let n=this.html();if(!n||!Hue.utilz.includes_url(n))return!1;let l=n.split(" "),u=[],_=/(?:^|\s)\"?(https?:\/\/(?:[^"|\s]*)+)/;for(let e of l){let n=_.exec(e);n&&u.push(n[1])}u.length>0&&function(n,l,u){let _="generic action";e&&(_+=" stop_propagation");let t=[];for(let e=0;e<n.length;e++){let u=n[e];if(t.includes(u))continue;t.push(u);let o=new RegExp(Hue.utilz.escape_special_characters(n[e]),"g"),a=n[e],i=Hue.get_setting("max_displayed_url");a.length>i&&(a=`${a.substring(0,i)}...`),l=l.replace(o,`<a class='${_}' target='_blank' href='${u}'>${a}</a>`)}$(u).html(l),$(u).find(".stop_propagation").each(function(){$(this).click(function(e){e.stopPropagation()})})}(u,n,this)}catch(e){}},Hue.goto_url=function(e,n="same",l=!1){l&&(e=encodeURIComponent(e)),"tab"===n?window.open(e,"_blank"):(Hue.user_leaving=!0,window.location=e)},Hue.search_on=function(e,n){n=encodeURIComponent(n),"google"===e?Hue.goto_url(`https://www.google.com/search?q=${n}`,"tab"):"soundcloud"===e?Hue.goto_url(`https://soundcloud.com/search?q=${n}`,"tab"):"youtube"===e&&Hue.goto_url(`https://www.youtube.com/results?search_query=${n}`,"tab")},Hue.setup_drag_events=function(){$("#main_container")[0].addEventListener("drop",function(e){let n=e.dataTransfer.getData("text/plain").trim();n&&(Hue.check_handle_url_options(n),$("#handle_url_input").val(n),$("#handle_url_comment").val(""),Hue.handled_url_input=n,Hue.handled_url_comment="",Hue.msg_handle_url.show())}),$("#handle_url_chat").click(function(){Hue.process_message({message:Hue.handled_url_input}),Hue.handled_url_comment&&Hue.process_message({message:Hue.handled_url_comment}),Hue.close_all_modals()}),$("#handle_url_image").click(function(){Hue.change_image_source(Hue.handled_url_input,!1,Hue.handled_url_comment),Hue.close_all_modals()}),$("#handle_url_tv").click(function(){Hue.change_tv_source(Hue.handled_url_input,!1,Hue.handled_url_comment),Hue.close_all_modals()}),$("#handle_url_radio").click(function(){Hue.change_radio_source(Hue.handled_url_input,!1,Hue.handled_url_comment),Hue.close_all_modals()}),$("#handle_url_input").on("input blur",function(){Hue.handled_url_input=$(this).val().trim(),$("#handle_url_input").val(Hue.handled_url_input),Hue.check_handle_url_options(Hue.handled_url_input)}),$("#handle_url_comment").on("input blur",function(){Hue.handled_url_comment=$(this).val().substring(0,Hue.config.max_media_comment_length).trim(),$("#handle_url_comment").val(Hue.handled_url_comment)})},Hue.check_handle_url_options=function(e){e&&e.length<Hue.config.max_input_length?$("#handle_url_chat").css("display","inline-block"):$("#handle_url_chat").css("display","none"),Hue.change_image_source(e,!0)?$("#handle_url_image").css("display","inline-block"):$("#handle_url_image").css("display","none"),Hue.change_tv_source(e,!0)?$("#handle_url_tv").css("display","inline-block"):$("#handle_url_tv").css("display","none"),Hue.change_radio_source(e,!0)?$("#handle_url_radio").css("display","inline-block"):$("#handle_url_radio").css("display","none"),Hue.horizontal_separator.separate("handle_url_container")},Hue.setup_open_url=function(){$("#open_url_menu_open").click(function(){Hue.goto_url(Hue.open_url_source,"tab"),Hue.close_all_modals()}),$("#open_url_menu_copy").click(function(){Hue.copy_string(Hue.open_url_source),Hue.close_all_modals()}),$("#open_url_menu_copy_title").click(function(){Hue.copy_string(Hue.open_url_title),Hue.close_all_modals()}),$("#open_url_menu_load").click(function(){Hue[`toggle_${Hue.open_url_media_type}`](!0),Hue.change({type:Hue.open_url_media_type,item:Hue.open_url_data,force:!0}),Hue[`toggle_lock_${Hue.open_url_media_type}`](!0),Hue.close_all_modals()}),$("#open_url_menu_change").click(function(){confirm("This will change it for everyone. Are you sure?")&&(Hue[`change_${Hue.open_url_media_type}_source`](Hue.open_url_data.source),Hue.close_all_modals())})},Hue.open_url_menu=function(e={}){if(e=Object.assign({source:!1,type:1,data:{},media_type:!1,title:!1},e),Hue.open_url_title=e.title||e.data.title,Hue.open_url_title&&Hue.open_url_title!==e.source?$("#open_url_menu_copy_title").css("display","inline-block"):$("#open_url_menu_copy_title").css("display","none"),e.media_type&&e.data){let n=Hue.fix_images_string(e.media_type),l=Hue[`room_${n}_mode`];"enabled"!==l&&"locked"!==l||e.data===Hue[`loaded_${e.media_type}`]?$("#open_url_menu_load").css("display","none"):$("#open_url_menu_load").css("display","inline-block"),Hue[`change_${e.media_type}_source`](e.source,!0)?$("#open_url_menu_change").css("display","inline-block"):$("#open_url_menu_change").css("display","none")}else $("#open_url_menu_load").css("display","none"),$("#open_url_menu_change").css("display","none");Hue.horizontal_separator.separate("open_url_container"),Hue.open_url_source=e.source,Hue.open_url_data=e.data,Hue.open_url_media_type=e.media_type;let n=Hue.utilz.get_limited_string(e.source,Hue.config.url_title_max_length);Hue.msg_open_url.set_title(n),Hue.msg_open_url.show()},Hue.check_domain_list=function(e,n){let l=Hue.config[`${e}_domain_white_or_black_list`];if("white"!==l&&"black"!==l)return!1;let u=Hue.config[`${e}_domain_list`];if(0===u.length)return!1;let _=Hue.utilz.get_root(n),t=u.includes(_)||u.includes(`${_}/`);if("white"===l){if(!t)return!0}else if("black"===l&&t)return!0;return!1},Hue.show_links=function(){Hue.show_chat_search("http:// https://")};
Hue.logout=function(){Hue.goto_url("/logout")},Hue.change_username=function(e,n=!0){return Hue.utilz.clean_string4(e)!==e?(n&&Hue.feedback("Username contains invalid characters"),!1):0===e.length?(n&&Hue.feedback("Username can't be empty"),!1):e.length>Hue.config.max_username_length?(n&&Hue.feedback("Username is too long"),!1):e===Hue.username?(n&&Hue.feedback("That's already your username"),!1):(Hue.socket_emit("change_username",{username:e}),!0)},Hue.change_password=function(e,n=!0){return e.length<Hue.config.min_password_length?(n&&Hue.feedback(`Password is too short. It must be at least ${Hue.config.min_password_length} characters long`),!1):e.length>Hue.config.max_password_length?(n&&Hue.feedback("Password is too long"),!1):(Hue.socket_emit("change_password",{password:e}),!0)},Hue.password_changed=function(e){Hue.feedback(`Password succesfully changed to ${e.password}. To force other clients connected to your account to disconnect you can use /disconnectothers`)},Hue.change_email=function(e,n=!0){return Hue.utilz.clean_string5(e)!==e?(n&&Hue.feedback("Invalid email address"),!1):0===e.length?(n&&Hue.feedback("Username can't be empty"),!1):e.includes("@")?e.length>Hue.config.max_email_length?(n&&Hue.feedback("Email is too long"),!1):(Hue.socket_emit("change_email",{email:e}),!0):(n&&Hue.feedback("Invalid email address"),!1)},Hue.email_changed=function(e){Hue.set_email(e.email),Hue.feedback(`Email succesfully changed to ${e.email}`)},Hue.change_bio=function(e){return e===Hue.utilz.clean_string12(e)&&(e!==Hue.bio&&(!(e.length>Hue.config.max_bio_length)&&(!(e.split("\n").length>Hue.config.max_bio_lines)&&(Hue.socket_emit("change_bio",{bio:e}),!0))))},Hue.build_details=function(){$("#details_username").text(Hue.username),$("#details_email").text(Hue.user_email);let e=`<div>${Hue.utilz.nice_date(Hue.user_reg_date)}</div>\n    </div>(${Hue.get_timeago(Hue.user_reg_date)})</div>`;$("#details_reg_date").html(e),e=`<div>${Hue.utilz.nice_date(Hue.date_joined)}</div>\n    </div>(${Hue.get_timeago(Hue.date_joined)})</div>`,$("#details_joined_room").html(e)},Hue.show_details=function(e){Hue.build_details(),Hue.msg_details.show()},Hue.show_change_username=function(){Hue.msg_info2.show(["Change Username","\n    <input type='text' placeholder='New Username' id='change_username_input' class='nice_input_2'>\n    <div class='flex_row_center'>\n        <div class='action pointer bigger unselectable details_change_submit' id='change_username_submit'>Change</div>\n    </div>"],function(){$("#change_username_input").val(Hue.username),$("#change_username_input").focus(),$("#change_username_submit").click(function(){Hue.submit_change_username()}),Hue.change_user_username_open=!0})},Hue.submit_change_username=function(){let e=$("#change_username_input").val().trim();Hue.change_username(e,!1)?Hue.msg_info2.close():alert("Invalid username format")},Hue.show_change_password=function(){Hue.msg_info2.show(["Change Password","\n    <input type='password' placeholder='New Password' id='change_password_input' class='nice_input_2'>\n    <div class='flex_row_center'>\n        <div class='action pointer bigger unselectable details_change_submit' id='change_password_submit'>Change</div>\n    </div>"],function(){$("#change_password_input").focus(),$("#change_password_submit").click(function(){Hue.submit_change_password()}),Hue.change_user_password_open=!0})},Hue.submit_change_password=function(){let e=$("#change_password_input").val().trim();Hue.change_password(e,!1)?Hue.msg_info2.close():alert("Invalid password format")},Hue.show_change_email=function(){Hue.msg_info2.show(["Change Email","\n    <input type='text' placeholder='New Email' id='change_email_input' class='nice_input_2'>\n    <div class='flex_row_center'>\n        <div class='action pointer bigger unselectable details_change_submit' id='change_email_submit'>Change</div>\n    </div>"],function(){$("#change_email_input").focus(),$("#change_email_submit").click(function(){Hue.submit_change_email()}),Hue.change_user_email_open=!0})},Hue.submit_change_email=function(){let e=$("#change_email_input").val().trim();Hue.change_email(e,!1)?Hue.msg_info2.close():alert("Invalid email format")},Hue.set_username=function(e){Hue.username=e,Hue.generate_mentions_regex(),$("#user_menu_username").text(Hue.username)},Hue.set_email=function(e){Hue.user_email=e},Hue.set_bio=function(e){Hue.bio=e,$("#user_menu_bio_textarea").val(Hue.bio)},Hue.setup_user_menu=function(){$("#user_menu_profile_image").on("error",function(){$(this).attr("src")!==Hue.config.default_profile_image_url&&$(this).attr("src",Hue.config.default_profile_image_url)}),$("#user_menu_profile_image").attr("src",Hue.profile_image),$("#user_menu_bio_textarea").val(Hue.bio),$("#user_menu_bio_textarea").blur(function(){let e=Hue.utilz.clean_string12($(this).val());if(e!==Hue.bio){Hue.change_bio(e)?$(this).val(e):$(this).val(Hue.bio)}else $(this).val(e)}),Hue.setup_togglers("user_menu")},Hue.clear_show_reactions_box=function(){clearTimeout(Hue.show_reactions_timeout),Hue.hide_reactions_box()},Hue.show_user_menu=function(){Hue.clear_show_reactions_box(),Hue.msg_user_menu.show()},Hue.verify_email=function(e){Hue.utilz.clean_string5(e)===e?0!==e.length?e.length>Hue.config.email_change_code_max_length?Hue.feedback("Invalid code"):Hue.socket_emit("verify_email",{code:e}):Hue.feedback("Empty code"):Hue.feedback("Invalid code")},Hue.open_profile_image_picker=function(){$("#profile_image_picker").click()},Hue.profile_image_selected=function(e){if(e.files&&e.files[0]){let n=new FileReader;n.onload=function(e){Hue.msg_info.show("\n            <img id='profile_image_canvas_image'>\n            <div id='profile_image_canvas_buttons'>\n                <div id='profile_image_canvas_cancel' class='action pointer unselectable profile_image_canvas_button'>Cancel</div>\n                <div id='profile_image_canvas_upload' class='action pointer unselectable profile_image_canvas_button'>Upload</div>\n            </div>",function(){Hue.horizontal_separator.separate("profile_image_canvas_buttons"),$("#profile_image_canvas_image").attr("src",e.target.result),$("#profile_image_picker").closest("form").get(0).reset();let n=$("#profile_image_canvas_image")[0],o=$("#profile_image_canvas_cancel")[0],t=$("#profile_image_canvas_upload")[0],i=!1,a=new Cropper(n,{aspectRatio:1,viewMode:3,ready:function(){let e=a.getContainerData();a.setCropBoxData({width:e.width,height:e.height});let n=a.getCropBoxData(),o=(e.width-n.width)/2,t=(e.height-n.height)/2;a.setCropBoxData({left:o,right:t}),i=!0}});o.onclick=function(){Hue.msg_info.close()},t.onclick=function(){let e,n;i&&(e=a.getCroppedCanvas(),(n=Hue.get_rounded_canvas(e)).toBlob(function(e){$("#user_menu_profile_image").attr("src",Hue.config.profile_image_loading_url),Hue.upload_file({file:e,action:"profile_image_upload",name:"profile.png"}),Hue.msg_info.close()},"image/png",.95))}})},n.readAsDataURL(e.files[0])}},Hue.get_rounded_canvas=function(e){let n=document.createElement("canvas"),o=n.getContext("2d"),t=Hue.config.profile_image_diameter,i=Hue.config.profile_image_diameter;return n.width=t,n.height=i,o.imageSmoothingEnabled=!0,o.drawImage(e,0,0,t,i),o.globalCompositeOperation="destination-in",o.beginPath(),o.arc(t/2,i/2,Math.min(t,i)/2,0,2*Math.PI,!0),o.fill(),n},Hue.not_an_op=function(){Hue.feedback("You are not a room operator")},Hue.check_firstime=function(){null===Hue.get_local_storage(Hue.ls_first_time)?(Hue.first_time=!0,Hue.show_intro(),Hue.request_desktop_notifications_permission(),Hue.save_local_storage(Hue.ls_first_time,!1)):Hue.first_time=!1},Hue.show_joined=function(){Hue.feedback(`You joined ${Hue.room_name}`,{}),Hue.show_topic()},Hue.disconnect_others=function(){Hue.socket_emit("disconnect_others",{})},Hue.show_others_disconnected=function(e){let n;n=1===e.amount?`${e.amount} client was disconnected`:`${e.amount} clients were disconnected`,Hue.feedback(n)},Hue.show_intro=function(){let e="\n    You can chat in this area. The icon on the left opens the user menu where you can change your profile image and other settings.\n    When someone is typing a message the user menu icon turns into a pencil. Hovering this icon shows additional actions.";Hue.create_popup({position:"bottomleft"}).show(["Chat and User Menu",e]),e="\n    This area has media controls. You can use these to change the room's media or control what is displayed to you.",Hue.create_popup({position:"bottomright"}).show(["Media Controls",e]),e="\n    This area contains the room menu, user list, voice chat, and radio controls. Above that there's the Activty Bar which shows users that have shown activity recently.",Hue.create_popup({position:"top"}).show(["Top Panel",e]),e="\n    You can lock the screen in this corner.",Hue.create_popup({position:"topright"}).show(["Lock Screen",e]),e="\n    Close this to close all the popups.";Hue.create_popup({position:"topleft",after_close:()=>{Hue.close_all_popups()}}).show(["Close Popups",e]),e="\n    Please read all the popups.",Hue.create_popup({position:"center"}).show(["Welcome",e])},Hue.setup_notebook=function(){$("#notebook_textarea").on("blur",function(){Hue.save_notebook()})},Hue.get_notebook=function(){let e=Hue.get_local_storage(Hue.ls_notebook);return e||""},Hue.show_notebook=function(){Hue.msg_notebook.show(function(){let e=Hue.get_notebook();e&&(e="\n\n"+e),$("#notebook_textarea").val(e),$("#notebook_textarea").focus(),$("#notebook_textarea")[0].setSelectionRange(0,0),$("#notebook_textarea").scrollTop(0)})},Hue.save_notebook=function(){let e=$("#notebook_textarea").val().trim();Hue.save_local_storage(Hue.ls_notebook,e)},Hue.add_to_notebook=function(e,n=!0){Hue.save_local_storage(Hue.ls_notebook,`${e}\n\n${Hue.get_notebook()}`),n&&Hue.feedback("Note added to notebook",{onclick:function(){Hue.show_notebook()}})},Hue.select_audio_clip=function(){$("#audio_clip_picker").click()},Hue.audio_clip_selected=function(e){let n=e.files[0];if(n.size/1024>Hue.config.max_audio_clip_size)return Hue.msg_info.show("File is too big"),!1;Hue.upload_file({file:n,action:"audio_clip_upload"})};
Hue.setup_user_functions=function(){for(let e=1;e<Hue.user_functions.length+1;e++)$(`#user_function_button_${e}`).click(function(){Hue.run_user_function(e)}),$(`#user_function_button_${e}`).on("auxclick",function(n){2===n.which&&Hue.open_user_function_in_settings(e)});Hue.setup_user_function_titles()},Hue.run_user_function=function(e){if(!Hue.user_functions.includes(e))return!1;Hue.get_setting(`user_function_${e}`)?Hue.execute_commands(`user_function_${e}`):Hue.open_user_function_in_settings(e),Hue.hide_reactions_box()},Hue.setup_user_function_switch_selects=function(){$(".user_function_switch_select").each(function(){$(this).change(function(){let e=$(this).find("option:selected").val();if("0"==e)return!1;let n=$(this).data("number"),t=$(this).data("type"),u=Hue[t][`user_function_${n}`],_=Hue[t][`user_function_${n}_name`],i=Hue[t][`user_function_${e}`],s=Hue[t][`user_function_${e}_name`];_===Hue.config[`global_settings_default_user_function_${n}_name`]&&(_=Hue.config[`global_settings_default_user_function_${e}_name`]),s===Hue.config[`global_settings_default_user_function_${e}_name`]&&(s=Hue.config[`global_settings_default_user_function_${n}_name`]),Hue[t][`user_function_${n}`]=i,Hue[t][`user_function_${n}_name`]=s,Hue[t][`user_function_${e}`]=u,Hue[t][`user_function_${e}_name`]=_,$(`#${t}_user_function_${n}`).val(Hue[t][`user_function_${n}`]),$(`#${t}_user_function_${n}_name`).val(Hue[t][`user_function_${n}_name`]),$(`#${t}_user_function_${e}`).val(Hue[t][`user_function_${e}`]),$(`#${t}_user_function_${e}_name`).val(Hue[t][`user_function_${e}_name`]),$(this).find("option").each(function(){"0"==$(this).val()&&$(this).prop("selected",!0)}),Hue.active_settings(`user_function_${n}`)!==t&&Hue.active_settings(`user_function_${e}`)!==t&&Hue.active_settings(`user_function_${n}_name`)!==t&&Hue.active_settings(`user_function_${e}_name`)!==t||Hue.setup_user_function_titles(),Hue[`save_${t}`]()})})},Hue.setup_user_function_titles=function(){let e=$(".user_function_button").length;if(0===e)return!1;for(let n=1;n<e+1;n++){let e=Hue.utilz.clean_string2(Hue.get_setting(`user_function_${n}`)).substring(0,100);e||(e="Empty User Function. Set what it does in the User Settings");let t=Hue.get_setting(`user_function_${n}_name`);$(`#user_function_button_${n}`).text(t),$(`#user_function_button_${n}`).attr("title",e)}},Hue.open_user_function_in_settings=function(e){Hue.open_user_settings_category("functions"),Hue.go_to_user_settings_item(`user_function_${e}`)},Hue.setting_user_function_do_action=function(e,n,t=!0){let u=Hue.utilz.clean_string7($(`#${n}_user_function_${e}`).val());$(`#${n}_user_function_${e}`).val(u),Hue[n][`user_function_${e}`]=u,Hue.active_settings(`user_function_${e}`)===n&&Hue.setup_user_function_titles(),t&&Hue[`save_${n}`]()},Hue.setting_user_function_name_do_action=function(e,n,t=!0){let u=Hue.utilz.clean_string2($(`#${n}_user_function_${e}_name`).val());u||(u=Hue.config[`global_settings_default_user_function_${e}_name`]),$(`#${n}_user_function_${e}_name`).val(u),Hue[n][`user_function_${e}_name`]=u,Hue.active_settings(`user_function_${e}_name`)===n&&Hue.setup_user_function_titles(),t&&Hue[`save_${n}`]()},Hue.make_settings_user_functions=function(e){let n="";for(let t=1;t<Hue.user_functions.length+1;t++){let u="<option value='0' selected>----</option>";for(let e=1;e<Hue.user_functions.length+1;e++)t!==e&&(u+=`<option value='${e}'>Switch With ${e}</option>`);n+=Hue.template_settings_user_function({number:t,type:e,options:u})}return n};
Hue.show_role=function(){"admin"===Hue.role?Hue.feedback("You are an admin"):"op"===Hue.role?Hue.feedback("You are an op"):Hue.role.startsWith("voice")&&Hue.feedback(`You have ${Hue.role}`);let e=0;Hue.can_chat&&(Hue.feedback("You have chat permission"),e+=1),Hue.can_images&&(Hue.feedback("You have images permission"),e+=1),Hue.can_tv&&(Hue.feedback("You have tv permission"),e+=1),Hue.can_radio&&(Hue.feedback("You have radio permission"),e+=1),0===e&&Hue.feedback("You cannot interact")},Hue.show_username=function(){Hue.feedback(`Username: ${Hue.username}`)},Hue.user_join=function(e){Hue.add_to_userlist({user_id:e.user_id,username:e.username,role:e.role,profile_image:e.profile_image,date_joined:e.date_joined,bio:e.bio,hearts:e.hearts,skulls:e.skulls,audio_clip:e.audio_clip});let i=function(){Hue.show_profile(e.username)},u=Hue.make_info_popup_item({icon:"fa fa-user-plus",message:`${e.username} has joined`,on_click:i,type:"user_join"});if(!Hue.user_is_ignored(e.username)){let t=Hue.get_setting("user_join_notifications_method");if("popups"===t){Hue.make_info_popup(i).show(u)}else"chat"===t&&Hue.public_feedback(`${e.username} has joined`,{brk:"<i class='icon2c fa fa-user-plus'></i>",username:e.username,open_profile:!0})}e.username!==Hue.username&&Hue.on_activity("join"),Hue.update_user_last_message(e.user_id),Hue.open_profile_username===e.username&&Hue.show_profile(e.username,$("#show_profile_image").attr("src"))},Hue.update_user_last_message=function(e){let i=Hue.get_last_chat_message_by_user_id(e);if(!i)return!1;let u=$(i).find(".chat_content").last().text();if(!u)return!1;i&&Hue.replace_property_in_userlist_by_user_id(e,"last_message",u)},Hue.update_usercount=function(){let e=`${Hue.utilz.singular_or_plural(Hue.usercount,"Users")} Online`;$("#usercount").text(e),"normal"===Hue.userlist_mode&&Hue.msg_userlist.set_title(e)},Hue.add_to_userlist=function(e={}){e=Object.assign({user_id:!1,username:!1,role:!1,profile_image:!1,date_joined:!1,bio:"",hearts:0,skulls:0,last_message:"",audio_clip:!1},e);for(let i=0;i<Hue.userlist.length;i++)if(Hue.userlist[i].user_id===e.user_id)return Hue.userlist[i].user_id=e.user_id,Hue.userlist[i].username=e.username,Hue.userlist[i].role=e.role,Hue.userlist[i].profile_image=e.profile_image,Hue.userlist[i].bio=e.bio,Hue.userlist[i].hearts=e.hearts,Hue.userlist[i].skulls=e.skulls,Hue.userlist[i].last_message=e.last_message,Hue.userlist[i].audio_clip=e.audio_clip,Hue.update_userlist(),!1;return Hue.userlist.push({user_id:e.user_id,username:e.username,role:e.role,profile_image:e.profile_image,date_joined:e.date_joined,bio:e.bio,hearts:e.hearts,skulls:e.skulls,last_message:e.last_message,audio_clip:e.audio_clip}),Hue.update_userlist(),!0},Hue.remove_from_userlist=function(e){for(let i=0;i<Hue.userlist.length;i++)if(Hue.userlist[i].user_id===e){Hue.userlist.splice(i,1),Hue.update_userlist();break}},Hue.replace_property_in_userlist_by_username=function(e,i,u,t=!0){let s=!1;for(let t=0;t<Hue.userlist.length;t++)if(Hue.userlist[t].username===e){Hue.userlist[t][i]=u,s=!0;break}t&&s&&(Hue.update_userlist(),Hue.open_profile_username===e&&Hue.show_profile(e))},Hue.replace_property_in_userlist_by_user_id=function(e,i,u,t=!0){let s,r=!1;for(let t=0;t<Hue.userlist.length;t++)if(Hue.userlist[t].user_id===e){Hue.userlist[t][i]=u,s=Hue.userlist[t],r=!0;break}t&&r&&(Hue.update_userlist(),Hue.open_profile_username===s.username&&Hue.show_profile(s.username))},Hue.get_role=function(e){for(let i=0;i<Hue.userlist.length;i++)if(Hue.userlist[i].username===e)return Hue.userlist[i].role},Hue.reset_voices_userlist=function(){for(let e=0;e<Hue.userlist.length;e++)Hue.userlist[e].role.startsWith("voice")&&"voice1"!==Hue.userlist[e].role&&(Hue.userlist[e].role="voice1");Hue.update_userlist()},Hue.remove_ops_userlist=function(){for(let e=0;e<Hue.userlist.length;e++)"op"===Hue.userlist[e].role&&(Hue.userlist[e].role="voice1");Hue.update_userlist()},Hue.role_tag=function(e){let i;return i="admin"===e?"[A]":"op"===e?"[O]":"voice1"===e?"[V1]":"voice2"===e?"[V2]":"voice3"===e?"[V3]":"voice4"===e?"[V4]":""},Hue.get_pretty_role_name=function(e){let i;return i="admin"===e?"Admin":"op"===e?"Operator":"voice1"===e?"Voice 1":"voice2"===e?"Voice 2":"voice3"===e?"Voice 3":"voice4"===e?"Voice 4":""},Hue.get_user_by_username=function(e){for(let i of Hue.userlist)if(i.username===e)return i;return!1},Hue.get_user_by_id=function(e){for(let i of Hue.userlist)if(i.user_id===e)return i;return!1},Hue.update_userlist=function(){Hue.userlist.sort(Hue.compare_userlist),Hue.usernames=[];for(let e of Hue.userlist)Hue.usernames.push(e.username);Hue.msg_userlist.is_open()&&(Hue.update_userlist_window(),Hue.check_userlist_visibility()),Hue.usercount=Hue.userlist.length,Hue.update_usercount()},Hue.setup_userlist_window=function(){$("#userlist").on("click",".userlist_item",function(){let e=$(this).data("username");"normal"===Hue.userlist_mode?Hue.show_profile(e):"whisper"===Hue.userlist_mode&&Hue.update_whisper_users(e)}),$("#userlist").on("auxclick",".userlist_item",function(e){2===e.which&&Hue.process_write_whisper($(this).data("username"))}),$("#Msg-content-container-userlist").scroll(function(){Hue.on_userlist_scroll()})},Hue.update_userlist_window=function(){let e=$();e=e.add();for(let i=0;i<Hue.userlist.length;i++){let u=Hue.userlist[i],t=$("\n        <div class='modal_item userlist_item dynamic_title'>\n            <div class='userlist_column flex_column_center'>\n                <div>\n                    <div class='userlist_item_profile_image_container round_image_container unselectable action4'>\n                        <img class='userlist_item_profile_image profile_image' src=''>\n                    </div>\n                    <div class='userlist_item_details_container'>\n                        <div class='userlist_item_username action'></div>\n                        <div class='userlist_item_role action'></div>\n                    </div>\n                </div>\n                <div class='userlist_item_bio action'></div>\n            </div>\n        </div>"),s=Hue.get_user_info_title(u);t.attr("title",s),t.data("otitle",s),t.data("date",u.date_joined),t.data("username",u.username);let r=t.find(".userlist_item_profile_image").eq(0);r.data("src",u.profile_image),r.data("username",u.username),r.data("src_applied",!1),r.attr("src",Hue.config.default_profile_image_url);let a=Hue.role_tag(u.role);t.find(".userlist_item_role").eq(0).text(a),t.find(".userlist_item_username").eq(0).text(u.username);let n=t.find(".userlist_item_bio").eq(0);u.bio?n.text(u.bio.substring(0,50)):n.css("display","none"),e=e.add(t)}$("#userlist").html(e),Hue.userlist_filtered&&Hue.do_modal_filter()},Hue.compare_userlist=function(e,i){return""===e.role&&(e.role="voice1"),""===i.role&&(i.role="voice1"),e.role.startsWith("voice")&&i.role.startsWith("voice")?e.role<i.role?1:e.role>i.role?-1:e.username>i.username?-1:e.username<i.username?1:0:e.role>i.role?1:e.role<i.role?-1:e.username<i.username?-1:e.username>i.username?1:0},Hue.user_is_online_by_username=function(e){let i=Hue.get_user_by_username(e);return Boolean(i)},Hue.user_is_controllable=function(e){return e.user_id===Hue.user_id||!!Hue.is_admin_or_op()&&("admin"!==e.role&&"op"!==e.role||"admin"===Hue.role)},Hue.show_userlist_window=function(e="normal",i=!1){Hue.userlist_mode=e,"normal"===e?Hue.update_usercount():"whisper"===e&&Hue.msg_userlist.set_title("Add or Remove a User"),Hue.update_userlist_window(),Hue.msg_userlist.show(function(){Hue.check_userlist_visibility(),i&&($("#userlist_filter").val(i),Hue.do_modal_filter())})},Hue.check_userlist_visibility=function(){let e=$("#Msg-window-userlist"),i=e.height(),u=e.offset().top;$(".userlist_item").each(function(){if("none"===$(this).css("display"))return!0;let e=$(this).offset().top-u;if(e>0&&e<i){let e=$(this).find(".userlist_item_profile_image").eq(0);e.data("src_applied")||(e.on("error",function(){$(this).attr("src")!==Hue.config.default_profile_image_url&&$(this).attr("src",Hue.config.default_profile_image_url)}),e.attr("src",e.data("src")),e.data("src_applied",!0))}})},Hue.sort_userlist_by_activity_trigger=function(e,i){return e.last_activity_trigger<i.last_activity_trigger?-1:e.last_activity_trigger>i.last_activity_trigger?1:0},Hue.update_user_profile_image=function(e,i){for(let u=0;u<Hue.userlist.length;u++){if(Hue.userlist[u].username===e)return void(Hue.userlist[u].profile_image=i)}},Hue.get_ignored_usernames_list=function(){let e=Hue.get_setting("ignored_usernames").split("\n");1!==e.length||e[0]||(e=[]),Hue.ignored_usernames_list=e},Hue.setup_activity_bar=function(){let e=Hue.userlist.slice(0);e.sort(Hue.sort_userlist_by_activity_trigger);for(let i of e)Hue.push_to_activity_bar(i.username,i.last_activity_trigger);setInterval(function(){Hue.check_activity_bar()},Hue.config.activity_bar_interval),setInterval(function(){Hue.app_focused&&Hue.trigger_activity()},Hue.config.activity_bar_trigger_interval),$("#activity_bar_container").on("click",".activity_bar_item",function(){Hue.show_profile($(this).data("username"))}),$("#activity_bar_container").on("auxclick",".activity_bar_item",function(e){2===e.which&&Hue.process_write_whisper($(this).data("username"))})},Hue.check_activity_bar=function(e=!0){if(0===Hue.activity_list.length)return!1;let i=Date.now()-Hue.config.max_activity_bar_delay,u=[],t=!1;for(let e of Hue.activity_list){let s=Hue.get_user_by_username(e.username);e.date>i&&s&&!Hue.user_is_ignored(e.username)?u.push(e):t=!0}return t&&(Hue.activity_list=u,e&&Hue.update_activity_bar()),t},Hue.update_activity_bar=function(){let e=$("#activity_bar_content");if(0===Hue.activity_list.length)return Hue.clear_activity_bar_items(),$("#activity_bar_no_activity").css("display","block"),!1;$("#activity_bar_no_activity").css("display","none");let i=[];if($(".activity_bar_item").each(function(){let e=$(this).data("username"),u=Hue.get_user_by_username(e);if(u&&Hue.activity_list.some(i=>i.username===e)){let t=Hue.get_user_info_title(u,!0);$(this).attr("title",t),$(this).data("otitle",t),i.push(e)}else $(this).remove()}),Hue.activity_list.length>i.length)for(let u of Hue.activity_list){let t=Hue.get_user_by_username(u.username);if(!i.includes(t.username)&&t){let i=t.profile_image||Hue.config.default_profile_image_url,u=$(`\n                <div class='activity_bar_item dynamic_title'>\n                    <div class='activity_bar_image_container round_image_container action4'>\n                        <img class='activity_bar_image profile_image' src='${i}'>\n                    </div>\n                    <div class='activity_bar_text action'></div>\n                </div>`),s=u.find(".activity_bar_text").eq(0),r=u.find(".activity_bar_image").eq(0);r.on("error",function(){$(this).attr("src")!==Hue.config.default_profile_image_url&&$(this).attr("src",Hue.config.default_profile_image_url)}),r.data("username",t.username),s.text(t.username);let a=Hue.get_user_info_title(t,!0);u.attr("title",a),u.data("otitle",a),u.data("date",t.date_joined),u.data("username",t.username),e.append(u)}}},Hue.push_to_activity_bar=function(e,i){let u=Hue.get_user_by_username(e);if(!u||!Hue.check_permission(u.role,"chat"))return!1;if(i<Date.now()-Hue.config.max_activity_bar_delay)return!1;if(Hue.user_is_ignored(e))return!1;for(let i=0;i<Hue.activity_list.length;i++)if(Hue.activity_list[i].username===e){Hue.activity_list.splice(i,1);break}Hue.activity_list.unshift({username:e,date:i}),Hue.activity_list.length>Hue.config.max_activity_bar_items&&Hue.activity_list.pop(),Hue.check_activity_bar(!1),Hue.started&&Hue.update_activity_bar()},Hue.get_activity_bar_item_by_username=function(e){let i=!1;return $(".activity_bar_item").each(function(){if($(this).data("username")===e)return i=this,!1}),i},Hue.clear_activity_bar_items=function(){$("#activity_bar_content").find(".activity_bar_item").each(function(){$(this).remove()})},Hue.update_activity_bar_image=function(e,i){$("#activity_bar_content").find(".activity_bar_item").each(function(){if($(this).data("username")===e)return $(this).find(".activity_bar_image").eq(0).attr("src",i),!1})},Hue.user_disconnect=function(e){let i,u;Hue.remove_from_userlist(e.user_id),Hue.update_activity_bar();let t=e.disconnection_type;"disconnection"===t?(i=`${e.username} has left`,u="normal"):"pinged"===t?(i=`${e.username} has left (Ping Timeout)`,u="normal"):"kicked"===t?(i=`${e.username} was kicked by ${e.info1}`,u="action"):"banned"===t&&(i=`${e.username} was banned by ${e.info1}`,Hue.ban_list_open&&Hue.request_ban_list(),u="action");let s=Hue.make_info_popup_item({icon:"fas fa-sign-out-alt",message:i,action:!1,type:"user_part"});if(!Hue.user_is_ignored(e.username)||"action"===u){let u=Hue.get_setting("user_part_notifications_method");if("popups"===u){Hue.make_info_popup().show(s)}else"chat"===u&&Hue.public_feedback(i,{brk:"<i class='icon2c fas fa-sign-out-alt'></i>",username:e.username})}Hue.open_profile_username===e.username&&Hue.show_profile(e.username,$("#show_profile_image").attr("src"))},Hue.forbidden_user=function(){Hue.feedback("That operation is forbidden on that user")},Hue.announce_new_username=function(e){Hue.replace_property_in_userlist_by_username(e.old_username,"username",e.username);let i=Hue.check_permission(Hue.get_role(e.username),"chat");Hue.username===e.old_username?(Hue.set_username(e.username),i?Hue.show_room_notification(e.username,`${e.old_username} is now known as ${Hue.username}`):Hue.show_room_notification(e.username,`You are now known as ${e.username}`)):i&&Hue.show_room_notification(e.username,`${e.old_username} is now known as ${e.username}`),Hue.admin_list_open&&Hue.request_admin_list()},Hue.user_is_ignored=function(e){return e!==Hue.username&&!!Hue.ignored_usernames_list.includes(e)},Hue.user_not_in_room=function(e){e?Hue.feedback(`${e} is not in the room`):Hue.feedback("User is not in the room")},Hue.get_matching_usernames=function(e){let i=Hue.get_user_by_username(e);if(i)return[i.username];let u=e.split(" "),t=u[0],s=[];for(let e=0;e<u.length;e++)e>0&&(t=`${t} ${u[e]}`),Hue.usernames.includes(t)&&s.push(t);return s},Hue.setup_profile_image=function(e){Hue.profile_image=""===e?Hue.config.default_profile_image_url:e},Hue.setup_show_profile=function(){$("#show_profile_whisper").click(function(){Hue.write_popup_message([Hue.open_profile_username])}),$("#show_profile_edit").click(function(){Hue.show_user_menu()}),$("#show_profile_image").on("error",function(){$(this).attr("src")!==Hue.config.default_profile_image_url&&$(this).attr("src",Hue.config.default_profile_image_url)}),$("#show_profile_hearts_icon").click(function(){Hue.send_badge(Hue.open_profile_username,"heart")}),$("#show_profile_skulls_icon").click(function(){Hue.send_badge(Hue.open_profile_username,"skull")}),$("#show_profile_audio_clip").click(function(){Hue.show_profile_audio_clip_started?Hue.stop_show_profile_audio():(Hue.show_profile_audio=document.createElement("audio"),Hue.show_profile_audio.src=Hue.open_profile_user.audio_clip,Hue.show_profile_audio.onended=function(){Hue.stop_show_profile_audio()},Hue.show_profile_audio.play(),setTimeout(function(){Hue.stop_show_profile_audio()},Hue.config.max_audio_clip_duration),$("#show_profile_audio_clip_icon").removeClass("fa-play-circle"),$("#show_profile_audio_clip_icon").addClass("fa-pause-circle"),Hue.show_profile_audio_clip_started=!0)})},Hue.stop_show_profile_audio=function(){Hue.show_profile_audio&&(Hue.show_profile_audio.pause(),Hue.show_profile_audio_clip_started=!1,$("#show_profile_audio_clip_icon").addClass("fa-play-circle"),$("#show_profile_audio_clip_icon").removeClass("fa-pause-circle"))},Hue.show_profile=function(e,i){let u,t="Offline",s="",r=0,a=0,n=Hue.get_user_by_username(e),o=!1;if(n&&(t=Hue.get_pretty_role_name(n.role),s=n.bio,r=n.hearts,a=n.skulls,n.username===Hue.username&&(o=!0),Hue.open_profile_user=n),Hue.open_profile_username=e,u=""===i||void 0===i||"undefined"===i?n&&n.profile_image?n.profile_image:Hue.config.default_profile_image_url:i,$("#show_profile_uname").text(e),$("#show_profile_role").text(`(${t})`),$("#show_profile_bio").html(Hue.utilz.make_html_safe(s).replace(/\n+/g," <br> ")).urlize(),$("#show_profile_image").attr("src",u),$("#show_profile_image").data("username",e),n){let e=Hue.get_user_info_title(n);$("#show_profile_image").attr("title",e),$("#show_profile_image").data("otitle",e),$("#show_profile_image").data("date",n.date_joined),$("#show_profile_image").addClass("dynamic_title")}else $("#show_profile_image").attr("title",""),$("#show_profile_image").removeClass("dynamic_title");Hue.can_chat&&Hue.usernames.includes(e)?($("#show_profile_whisper").css("display","block"),$("#show_profile_hearts").css("display","flex"),$("#show_profile_skulls").css("display","flex"),Hue.set_hearts_counter(r),Hue.set_skulls_counter(a)):($("#show_profile_whisper").css("display","none"),$("#show_profile_hearts").css("display","none"),$("#show_profile_skulls").css("display","none")),n&&n.audio_clip?$("#show_profile_audio_clip").css("display","inline-flex"):$("#show_profile_audio_clip").css("display","none"),o?$("#show_profile_edit").css("display","block"):$("#show_profile_edit").css("display","none"),$(".show_profile_button").filter(function(){return"none"!==$(this).css("display")}).length?$("#show_profile_buttons").css("display","flex"):$("#show_profile_buttons").css("display","none"),Hue.msg_profile.show()},Hue.profile_image_changed=function(e){e.username===Hue.username&&(Hue.profile_image=e.profile_image,$("#user_menu_profile_image").attr("src",Hue.profile_image)),Hue.update_user_profile_image(e.username,e.profile_image),Hue.user_is_ignored(e.username)||Hue.show_room_notification(e.username,`${e.username} changed their profile image`),Hue.update_activity_bar_image(e.username,e.profile_image)},Hue.bio_changed=function(e){Hue.replace_property_in_userlist_by_username(e.username,"bio",e.bio),e.username===Hue.username&&Hue.set_bio(e.bio),e.bio&&!Hue.user_is_ignored(e.username)&&Hue.show_room_notification(e.username,`${e.username} changed their bio`)},Hue.reset_voices=function(){if(!Hue.is_admin_or_op(Hue.role))return Hue.not_an_op(),!1;Hue.socket_emit("reset_voices",{})},Hue.remove_ops=function(){if("admin"!==Hue.role)return Hue.feedback("You are not a room admin"),!1;Hue.socket_emit("remove_ops",{})},Hue.announce_voices_resetted=function(e){Hue.show_room_notification(e.username,`${e.username} resetted the voices`),Hue.role.startsWith("voice")&&"voice1"!==Hue.role&&Hue.set_role("voice1"),Hue.reset_voices_userlist()},Hue.announce_removedops=function(e){Hue.show_room_notification(e.username,`${e.username} removed all ops`),"op"===Hue.role&&Hue.set_role("voice1"),Hue.remove_ops_userlist(),Hue.admin_list_open&&Hue.request_admin_list()},Hue.change_role=function(e,i){if(Hue.is_admin_or_op()){if(e.length>0&&e.length<=Hue.config.max_max_username_length){if(e===Hue.username)return Hue.feedback("You can't assign a role to yourself"),!1;if(("admin"===i||"op"===i)&&"admin"!==Hue.role)return Hue.forbidden_user(),!1;if(!Hue.roles.includes(i))return Hue.feedback("Invalid role"),!1;Hue.socket_emit("change_role",{username:e,role:i})}}else Hue.not_an_op()},Hue.announce_role_change=function(e){Hue.username===e.username2&&Hue.set_role(e.role),Hue.show_room_notification(e.username1,`${e.username1} gave ${e.role} to ${e.username2}`),Hue.replace_property_in_userlist_by_username(e.username2,"role",e.role),Hue.admin_list_open&&Hue.request_admin_list()},Hue.set_role=function(e,i=!0){Hue.role=e,Hue.check_permissions(),Hue.check_message_board_permissions(),i&&Hue.config_room_menu()},Hue.ban=function(e){if(Hue.is_admin_or_op()){if(e.length>0&&e.length<=Hue.config.max_max_username_length){if(e===Hue.username)return Hue.feedback("You can't ban yourself"),!1;Hue.socket_emit("ban",{username:e})}}else Hue.not_an_op()},Hue.unban=function(e){if(Hue.is_admin_or_op()){if(e.length>0&&e.length<=Hue.config.max_max_username_length){if(e===Hue.username)return Hue.feedback("You can't unban yourself"),!1;Hue.socket_emit("unban",{username:e})}}else Hue.not_an_op()},Hue.unban_all=function(){Hue.is_admin_or_op()?Hue.socket_emit("unban_all",{}):Hue.not_an_op()},Hue.get_ban_count=function(){Hue.is_admin_or_op()&&Hue.socket_emit("get_ban_count",{})},Hue.receive_ban_count=function(e){let i;i=1===e.count?`There is ${e.count} user banned`:`There are ${e.count} users banned`,Hue.msg_info.show(i)},Hue.kick=function(e){if(Hue.is_admin_or_op()){if(e.length>0&&e.length<=Hue.config.max_max_username_length){if(e===Hue.username)return Hue.feedback("You can't kick yourself"),!1;if(!Hue.usernames.includes(e))return Hue.user_not_in_room(),!1;let i=Hue.get_role(e);if(("admin"===i||"op"===i)&&"admin"!==Hue.role)return Hue.forbidden_user(),!1;Hue.socket_emit("kick",{username:e})}}else Hue.not_an_op()},Hue.announce_ban=function(e){Hue.show_room_notification(e.username1,`${e.username1} banned ${e.username2}`),Hue.ban_list_open&&Hue.request_ban_list()},Hue.announce_unban=function(e){Hue.show_room_notification(e.username1,`${e.username1} unbanned ${e.username2}`),Hue.ban_list_open&&Hue.request_ban_list()},Hue.announce_unban_all=function(e){Hue.show_room_notification(e.username,`${e.username} unbanned all banned users`)},Hue.is_already=function(e,i){"voice1"===i?Hue.feedback(`${e} already has voice 1`):"voice2"===i?Hue.feedback(`${e} already has voice 2`):"voice3"===i?Hue.feedback(`${e} already has voice 3`):"voice4"===i?Hue.feedback(`${e} already has voice 4`):"op"===i?Hue.feedback(`${e} is already an op`):"admin"===i&&Hue.feedback(`${e} is already an admin`)},Hue.start_generic_uname_click_events=function(){$("body").on("click",".generic_uname",function(){let e=$(this).text();Hue.show_profile(e)})},Hue.is_admin_or_op=function(e=!1){let i;return"admin"===(i=e||Hue.role)||"op"===i},Hue.annex=function(e="admin"){if(!Hue.roles.includes(e))return Hue.feedback("Invalid role"),!1;Hue.socket_emit("change_role",{username:Hue.username,role:e})},Hue.after_userlist_filtered=function(){Hue.check_userlist_visibility()},Hue.after_userlist_scroll=function(){Hue.check_userlist_visibility()},Hue.send_badge=function(e,i){if(Hue.send_badge_disabled)return!1;if(e===Hue.username)return!1;return!!Hue.get_user_by_username(e)&&(("heart"===i||"skull"===i)&&(Hue.socket_emit("send_badge",{username:e,type:i}),Hue.send_badge_disabled=!0,void setTimeout(function(){Hue.send_badge_disabled=!1},Hue.config.send_badge_cooldown+100)))},Hue.on_badge_received=function(e){let i,u;e.username===Hue.open_profile_username&&("heart"===e.type?Hue.set_hearts_counter(e.badges):"skull"===e.type&&Hue.set_skulls_counter(e.badges));let t=Hue.get_user_by_username(e.username);if("heart"===e.type&&(i="hearts",u=t.hearts+1),"skull"===e.type&&(i="skulls",u=t.skulls+1),Hue.replace_property_in_userlist_by_username(e.username,i,u),Hue.app_focused){let i=Hue.get_last_chat_message_by_username(e.username);if(i){let u=$(i).find(".chat_profile_image_container").eq(0);Hue.change_profile_image_badge(u,e.type)}}},Hue.change_profile_image_badge=function(e,i){let u;Hue.remove_badge_icons(e),e.addClass(`${i}_badge`),e.addClass("profile_image_badge"),"heart"===i?u="fa fa-heart":"skull"===i&&(u="fa fa-skull"),e.append(`<i class='${u} profile_image_badge_icon ${i}_badge'>`);let t=e.data("badge_feedback_number");t?t+=1:t=1,e.data("badge_feedback_number",t),setTimeout(function(){let i=e.data("badge_feedback_number");if(t!==i)return!1;Hue.remove_badge_icons(e)},Hue.config.badge_feedback_duration)},Hue.remove_badge_icons=function(e){e.removeClass("heart_badge"),e.removeClass("skull_badge"),e.removeClass("profile_image_badge"),e.find(".profile_image_badge_icon").each(function(){$(this).remove()})},Hue.set_hearts_counter=function(e){$("#show_profile_hearts_counter").text(Hue.utilz.format_number(e))},Hue.set_skulls_counter=function(e){$("#show_profile_skulls_counter").text(Hue.utilz.format_number(e))},Hue.get_user_info_title=function(e,i=!1){let u="",t="";return i&&(t=`${e.username}\n`),e.last_message&&(u=`Last Message: ${e.last_message.substring(0,100)}\n`),`${t}${u}${`Joined: ${Hue.utilz.nice_date(e.date_joined)}`}`},Hue.push_to_all_usernames=function(e){e&&(Hue.all_usernames.includes(e)||(Hue.all_usernames.push(e),Hue.all_usernames.length>1e3&&Hue.all_usernames.shift()))},Hue.audio_clip_changed=function(e){Hue.replace_property_in_userlist_by_username(e.username,"audio_clip",e.audio_clip,!1),e.username===Hue.open_profile_username&&Hue.show_profile(e.username),Hue.show_room_notification(e.username,`${e.username} changed their audio clip`)};
Hue.setup_separators=function(){Hue.horizontal_separator=Separator.factory({mode:"horizontal",class:"color_3"}),Hue.vertical_separator=Separator.factory({mode:"vertical",class:"vertical_separator",html:"",width:"100%",margin_top:"1.8rem",margin_bottom:"1.8rem"})},Hue.setup_generic_separators=function(){$(".generic_horizontal_separator").each(function(){Hue.horizontal_separator.separate(this)}),$(".generic_vertical_separator").each(function(){Hue.vertical_separator.separate(this)})},Hue.make_main_container_visible=function(){$("#loading").css("opacity",0),$("#main_container").css("opacity",1).css("pointer-events","initial"),setTimeout(function(){$("#loading").css("display","none")},1600)},Hue.start_titles=function(){$(".nicetitle").each(function(){tippy(this,{delay:[1e3,100],animation:"scale",hideOnClick:!0,duration:100,arrow:!0,performance:!0,size:"regular",arrowSize:"small",zIndex:99999999999})})},Hue.setup_fonts=function(){document.fonts.ready.then(function(){Hue.on_fonts_loaded()})},Hue.on_fonts_loaded=function(){Hue.goto_bottom(!0,!1)},Hue.make_safe=function(e={}){e=Object.assign({text:"",text_as_html:!1,text_classes:!1,html:!1,urlize:!0,onclick:!1,html_unselectable:!0,title:!1,remove_text_if_empty:!1,date:!1,no_spacing:!1},e);let t=$("<div></div>");if(e.text||!e.remove_text_if_empty){let a="message_info_text inline";e.onclick&&(a+=" pointer action"),e.text_classes&&(a+=` ${e.text_classes}`),t.append(`<div class='${a}'></div>`);let i=t.find(".message_info_text").eq(0);if(e.text_as_html){let t=Hue.replace_markdown(Hue.utilz.make_html_safe(e.text));e.urlize?i.html(t).urlize():i.html(t)}else e.urlize?i.text(e.text).urlize():i.text(e.text);if(e.onclick&&i.on("click",e.onclick),e.date){let t=Hue.utilz.nice_date(e.date);i.data("date",e.date),i.data("otitle",t),i.attr("title",t),i.addClass("dynamic_title")}else e.title&&i.attr("title",e.title)}if(e.html){let a;a=e.no_spacing||!e.text&&e.remove_text_if_empty?"":"message_info_html_spaced",t.append(`<div class='message_info_html ${a}'>${e.html}</div>`),e.html_unselectable&&t.find(".message_info_html").eq(0).addClass("unselectable")}return t[0]};
Hue.check_whisper_user=function(e){return Hue.can_chat?!!Hue.usernames.includes(e)||(Hue.user_not_in_room(e),!1):(Hue.cant_chat(),!1)},Hue.process_write_whisper=function(e,s=!0){let t=Hue.get_user_by_username(e);if(e.includes(">"))Hue.send_inline_whisper(e,s);else if(t)Hue.write_popup_message([e],"user");else if(e.includes("&&")){let s=e.split("&&").map(e=>e.trim());Hue.write_popup_message(s,"user")}else{let t=Hue.get_matching_usernames(e);if(1!==t.length)return t.length>1?(Hue.feedback("Multiple usernames matched. Use the proper > syntax. For example /whisper bob > hi"),!1):(Hue.user_not_in_room(),!1);{let i=e.replace(t[0],""),n=`${t[0]} > ${i}`;Hue.send_inline_whisper(n,s)}}},Hue.send_inline_whisper=function(e,s=!0){let t=e.split(">");if(t.length<2)return!1;let i=t[0].trim().split("&&"),n=Hue.utilz.clean_string10(Hue.utilz.clean_multiline(t.slice(1).join(">")));if(!n)return!1;if(n.split("\n").length>Hue.config.max_num_newlines)return!1;let _=[];for(let e of i)e=e.trim(),Hue.check_whisper_user(e)&&_.push(e);if(0===_.length)return!1;Hue.do_send_whisper_user(_,n,!1,s)},Hue.write_popup_message=function(e=[],s="user"){let t;if("user"===s){for(let s of e)if(!Hue.check_whisper_user(s))return!1;let s=function(){Hue.show_userlist_window("whisper")};t={text:`Whisper to ${Hue.utilz.nice_list(e)}`,onclick:s}}else if("ops"===s){if(!Hue.is_admin_or_op(Hue.role))return Hue.not_an_op(),!1;t={text:"* Whisper to Operators *"}}else if("room"===s){if(!Hue.is_admin_or_op(Hue.role))return Hue.not_an_op(),!1;t={text:"* Message To Room *"}}else"system"===s&&(t={text:"* Message To System *"});Hue.message_unames=e,Hue.message_type=s,Hue.msg_message.set_title(Hue.make_safe(t)),Hue.msg_message.show(function(){$("#write_message_area").focus(),Hue.sending_whisper=!1})},Hue.update_whisper_users=function(e){if(Hue.message_unames.includes(e)){if(1===Hue.message_unames.length)return!1;for(let s=0;s<Hue.message_unames.length;s++){if(Hue.message_unames[s]===e){Hue.message_unames.splice(s,1);break}}}else Hue.message_unames.push(e);let s={text:`Whisper to ${Hue.utilz.nice_list(Hue.message_unames)}`,onclick:function(){Hue.show_userlist_window("whisper")}};Hue.msg_message.set_title(Hue.make_safe(s)),Hue.msg_userlist.close()},Hue.send_popup_message=function(e=!1){if(Hue.sending_whisper)return!1;Hue.sending_whisper=!0;let s,t,i=Hue.utilz.clean_string10($("#write_message_area").val()),n=Hue.config.max_input_length-i.length;if(s=Hue.draw_message_click_x.length>0&&[Hue.draw_message_click_x,Hue.draw_message_click_y,Hue.draw_message_drag],n===Hue.config.max_input_length){if(!s)return Hue.sending_whisper=!1,!1}else if(n<0)return $("#write_message_feedback").text(`Character limit exceeded by ${Math.abs(n)}`),$("#write_message_feedback").css("display","block"),Hue.sending_whisper=!1,!1;if(i.split("\n").length>Hue.config.max_num_newlines)return $("#write_message_feedback").text("Too many linebreaks"),$("#write_message_feedback").css("display","block"),Hue.sending_whisper=!1,!1;"user"===Hue.message_type?t=Hue.send_whisper_user(i,s,e):"ops"===Hue.message_type?t=Hue.send_whisper_ops(i,s):"room"===Hue.message_type?t=Hue.send_room_broadcast(i,s):"system"===Hue.message_type&&(t=Hue.send_system_broadcast(i,s)),t?Hue.msg_message.close(function(){Hue.sending_whisper=!1}):Hue.sending_whisper=!1},Hue.sent_popup_message_function=function(e,s,t,i=[]){let n,_,a=function(){},u=function(){};if("whisper"!==e)return!1;n=Hue.utilz.nonbreak("Send Another Whisper"),_=`Whisper sent to ${Hue.utilz.nice_list(i)}`,a=function(){Hue.write_popup_message(i)},u=function(){Hue.show_profile(i[0])};let o,r=`<div class='small_button action' id='modal_popup_feedback_send'>${n}</div>`;(o=t?"<canvas id='modal_popup_feedback_draw' class='draw_canvas' width='400px' height='300px' tabindex=1></canvas>":"")&&(r=o+r);let p=Hue.make_safe({text:s,html:r,remove_text_if_empty:!0,no_spacing:!0,date:Date.now()});return function(){Hue.msg_info2.show([Hue.make_safe({text:_,onclick:u}),p],function(){if($("#modal_popup_feedback_send").click(a),t){let e=$("#modal_popup_feedback_draw")[0].getContext("2d");Hue.canvas_redraw({context:e,click_x:t[0],click_y:t[1],drag:t[2]})}})}},Hue.send_whisper_user=function(e,s,t=!1){let i=Hue.message_unames;if(!i)return!1;if(!Hue.can_chat)return $("#write_message_feedback").text("You don't have chat permission"),$("#write_message_feedback").css("display","block"),!1;let n=[],_=[];for(let e of i)Hue.usernames.includes(e)?_.push(e):n.push(e);if(!t&&n.length>0){let e=Hue.utilz.nice_list(n),s=1===n.length?"is":"are",t="";return i.length>n.length&&(t=" Double click Send to send anyway"),$("#write_message_feedback").text(`(${e} ${s} not in the room)${t}`),$("#write_message_feedback").css("display","block"),!1}return 0!==_.length&&(Hue.do_send_whisper_user(_,e,s),!0)},Hue.do_send_whisper_user=function(e,s,t,i=!0){if(Hue.socket_emit("whisper",{type:"user",usernames:e,message:s,draw_coords:t}),i){let i=Hue.sent_popup_message_function("whisper",s,t,e),n=`Whisper sent to ${Hue.utilz.nice_list(e)}`;Hue.show_action_popup({icon:"fa fa-envelope",message:n,on_click:i,autoclose:!0,titlebar:!1}),Hue.push_whisper(n,i)}},Hue.send_whisper_ops=function(e,s){return Hue.socket_emit("whisper",{type:"ops",message:e,draw_coords:s}),!0},Hue.send_room_broadcast=function(e,s){return Hue.is_admin_or_op(Hue.role)?(Hue.socket_emit("whisper",{type:"broadcast",message:e,draw_coords:s}),!0):(Hue.not_an_op(),!1)},Hue.send_system_broadcast=function(e,s){return Hue.socket_emit("whisper",{type:"system_broadcast",message:e,draw_coords:s}),!0},Hue.popup_message_received=function(e,s="user",t=!0,i="popup"){e.id||(Hue.popup_message_id+=1,e.id=Hue.popup_message_id),e.date||(e.date=Date.now());let n,_,a,u,o,r=Hue.utilz.nice_date(e.date);if(e.username){if(Hue.user_is_ignored(e.username))return!1;if(Hue.accept_commands_from_list.includes(e.username)&&e.message&&Hue.is_command(e.message))return void Hue.execute_whisper_command(e.username,e.message);n=function(){Hue.show_profile(e.username)}}if(_=!!e.draw_coords&&`<canvas\n        id='draw_popup_area_${e.id}'\n        class='draw_canvas dynamic_title draw_canvas_received'\n        title='${r}' data-otitle='${r}'\n        data-date='${e.date}'\n        width='400px' height='300px'\n        tabindex=1></canvas>`,"user"===s)u={text:a=`Whisper from ${e.username}`,onclick:n},o=`<div class='small_button action inline show_message_reply'>${Hue.utilz.nonbreak("Send Whisper")}</div>`;else if("ops"===s){let s;u={text:a=`Whisper (To Operators) from ${e.username}`,onclick:n},o=`<div class='flex_column_center'>${s=e.username!==Hue.username?`<div class='small_button_2 action show_message_reply show_message_reply_with_spacing'>${Hue.utilz.nonbreak("Send Whisper")}</div>`:""}<div class='small_button_2 action show_message_reply_ops'>${Hue.utilz.nonbreak("Send Whisper to Operators")}</div></div>`}else"room"===s?(u={text:a=`Room Message from ${e.username}`,onclick:n},o=!1):"system"===s&&(u={text:a="System Message"},o=!1);if(_&&(o=o?_+o:_),e.content=Hue.make_safe({text:e.message,text_as_html:!0,text_classes:"popup_message_text",html:o,remove_text_if_empty:!0,date:e.date}),Hue.setup_whispers_click(e.content,e.username),e.title=Hue.make_safe(u),!t||Hue.get_setting("open_popup_messages"))if("popup"===i){let s=!1;for(let t of Hue.get_popup_instances())if(t.window&&t.window.id.includes("popup_message")&&t.window.id===`Msg-window-popup_message_${e.id}`){t.close(function(){Hue.show_popup_message(e)}),s=!0;break}s||Hue.show_popup_message(e)}else"modal"===i&&Hue.show_popup_message(e,"modal");if(t){let t=function(){Hue.popup_message_received(e,s,!1,"modal")};if(Hue.push_whisper(a,t),!Hue.get_setting("open_popup_messages")){let e=Hue.make_info_popup(t,!1),i=Hue.make_info_popup_item({icon:"fa fa-envelope",message:a,push:!1,type:s="whisper"});e.show(i)}Hue.on_highlight()}},Hue.show_popup_message=function(e,s="popup"){let t;"popup"===s?t=Hue.create_popup({position:"top",id:`popup_message_${e.id}`}):"modal"===s&&(t=Hue.msg_info2),t.show([e.title,e.content],function(){if($(t.content).find(".show_message_reply").eq(0).click(function(){Hue.write_popup_message([e.username])}),$(t.content).find(".show_message_reply_ops").eq(0).click(function(){Hue.write_popup_message(!1,"ops")}),e.draw_coords){let s=$(`#draw_popup_area_${e.id}`)[0].getContext("2d");Hue.canvas_redraw({context:s,click_x:e.draw_coords[0],click_y:e.draw_coords[1],drag:e.draw_coords[2]})}})},Hue.setup_whispers_click=function(e,s){$(e).find(".whisper_link").each(function(){$(this).click(function(){Hue.process_write_whisper(`${s} > ${$(this).data("whisper")}`,!1)})})},Hue.setup_message_area=function(){Hue.draw_message_context=$("#draw_message_area")[0].getContext("2d"),Hue.clear_draw_message_state(),$("#draw_message_area").mousedown(function(e){Hue.draw_message_just_entered=!1,Hue.draw_message_add_click(e.offsetX,e.offsetY,!1),Hue.redraw_draw_message()}),$("#draw_message_area").mousemove(function(e){Hue.mouse_is_down&&(Hue.draw_message_add_click(e.offsetX,e.offsetY,!Hue.draw_message_just_entered),Hue.redraw_draw_message()),Hue.draw_message_just_entered=!1}),$("#draw_message_area").mouseenter(function(e){Hue.draw_message_just_entered=!0})},Hue.push_whisper=function(e,s){let t=Date.now(),i=Hue.utilz.nice_date(t),n=`<div class='whispers_messasge'>${Hue.utilz.make_html_safe(e)}</div>`,_=$(`<div class='whispers_item modal_item'><div class='whispers_item_content action pointer dynamic_title'>${n}</div>`),a=_.find(".whispers_item_content").eq(0);a.attr("title",i),a.data("otitle",i),a.data("date",t),a.click(function(){s()});let u=$("#whispers_container .whispers_item").length;0===u?$("#whispers_container").html(_):$("#whispers_container").prepend(_),u>Hue.config.whispers_crop_limit&&$("#whispers_container .whispers_item").last().remove()},Hue.show_whispers=function(e=!1){Hue.msg_whispers.show(function(){e&&($("#whispers_filter").val(e),Hue.do_modal_filter())})};
Hue.alert_title=function(e){return!![1,2].includes(e)&&((1!==e||0===Hue.alert_mode)&&((2!==e||2!==Hue.alert_mode)&&(Hue.alert_mode=e,void Hue.update_title())))},Hue.remove_alert_title=function(){Hue.alert_mode>0&&(Hue.alert_mode=0,Hue.update_title())},Hue.set_title=function(e){document.title=e.substring(0,Hue.config.max_title_length)},Hue.update_title=function(){let e="";1===Hue.alert_mode?e+="(*) ":2===Hue.alert_mode&&(e+="(!) "),e+=Hue.room_name,""!==Hue.topic&&(e+=` ${Hue.config.title_separator} ${Hue.topic}`),Hue.set_title(e)},Hue.activate_visibility_listener=function(){document.addEventListener("visibilitychange",function(){Hue.process_visibility()},!1),window.onblur=function(){Hue.keys_pressed={}}},Hue.process_visibility=function(){if(Hue.room_state.screen_locked&&Hue.get_setting("afk_on_lockscreen"))return!1;Hue.app_focused=!document.hidden,Hue.app_focused?Hue.on_app_focused():Hue.on_app_unfocused()},Hue.on_app_focused=function(){void 0!==Hue.afk_timer&&clearTimeout(Hue.afk_timer),Hue.afk=!1,Hue.remove_alert_title(),Hue.change_image_when_focused&&(Hue.change({type:"image"}),Hue.change_image_when_focused=!1),Hue.change_tv_when_focused&&(Hue.change({type:"tv"}),Hue.change_tv_when_focused=!1),Hue.change_radio_when_focused&&(Hue.change({type:"radio"}),Hue.change_radio_when_focused=!1),Hue.activate_info_popup_timeouts(),Hue.show_fresh_messages(),Hue.trigger_activity()},Hue.on_app_unfocused=function(){"never"!==Hue.get_setting("afk_delay")&&(Hue.afk_timer=setTimeout(function(){Hue.afk=!0},Hue.get_setting("afk_delay"))),Hue.check_scrollers()},Hue.resize_events=function(){$(window).resize(function(){Hue.resize_timer()})},Hue.on_resize=function(){Hue.fix_frames(),Hue.goto_bottom(!1,!1),Hue.check_scrollers()},Hue.setup_before_unload=function(){window.onbeforeunload=function(e){if(!Hue.user_leaving&&Hue.get_setting("warn_before_closing"))return"Are you sure?"}};
Hue.setup_templates=function(){$(".template").each(function(){let e=$(this).attr("id");Hue[e]=Handlebars.compile($(`#${e}`).html())})},Hue.start_msg=function(){let e={show_effect_duration:[200,200],close_effect_duration:[200,200],clear_editables:!0,class:"modal",show_effect:"none",close_effect:"none",after_create:function(e){Hue.after_modal_create(e)},before_show:function(e){if(Hue.room_state.screen_locked&&"lockscreen"!==e.options.id)return!1},after_show:function(e){Hue.after_modal_show(e),Hue.after_modal_set_or_show(e)},after_set:function(e){Hue.after_modal_set_or_show(e)},after_close:function(e){Hue.after_modal_close(e)}},t={enable_titlebar:!0,center_titlebar:!0,titlebar_class:"!custom_titlebar !unselectable",window_inner_x_class:"!titlebar_inner_x"};Hue.msg_room_menu=Msg.factory(Object.assign({},e,t,{id:"room_menu",window_width:"22em",after_close:function(t){e.after_close(t),Hue.close_togglers("room_menu"),Hue.close_togglers("room_menu_permissions")}})),Hue.msg_user_menu=Msg.factory(Object.assign({},e,t,{id:"user_menu",clear_editables:!1,window_width:"22em",after_close:function(t){e.after_close(t),Hue.close_togglers("user_menu")}})),Hue.msg_userlist=Msg.factory(Object.assign({},e,t,{id:"userlist",window_min_width:"22em",window_max_width:"45em"})),Hue.msg_public_roomlist=Msg.factory(Object.assign({},e,t,{id:"public_roomlist",window_width:"26em"})),Hue.msg_visited_roomlist=Msg.factory(Object.assign({},e,t,{id:"visited_roomlist",window_width:"26em"})),Hue.msg_played=Msg.factory(Object.assign({},e,t,{id:"played",window_width:"26em"})),Hue.msg_modal_image=Msg.factory(Object.assign({},e,{id:"modal_image",preset:"window",overlay_class:"!overlay_same_color",after_show:function(t){e.after_show(t),Hue.modal_image_open=!0},after_close:function(t){e.after_close(t),Hue.clear_modal_image_info(),Hue.msg_modal_image_number.close(),Hue.modal_image_open=!1}})),Hue.msg_modal_image_number=Msg.factory(Object.assign({},e,{id:"modal_image_number",after_show:function(t){e.after_show(t),Hue.modal_image_number_open=!0},after_close:function(t){e.after_close(t),Hue.modal_image_number_open=!1}})),Hue.msg_lockscreen=Msg.factory(Object.assign({},e,{id:"lockscreen",preset:"window",overlay_class:"!overlay_same_color"})),Hue.msg_profile=Msg.factory(Object.assign({},e,{id:"profile",window_width:"22em",after_close:function(t){e.after_close(t),$("#show_profile_uname").text("Loading"),$("#show_profile_image").attr("src",Hue.config.profile_image_loading_url),Hue.open_profile_username=!1,Hue.open_profile_user=!1,Hue.stop_show_profile_audio()}})),Hue.msg_info=Msg.factory(Object.assign({},e,{id:"info",window_height:"auto",before_show:function(t){e.before_show(t),Hue.info_vars_to_false()},after_close:function(t){e.after_close(t),t.content.innerHTML="",Hue.info_vars_to_false()}})),Hue.msg_info2=Msg.factory(Object.assign({},e,t,{id:"info2",window_height:"auto",before_show:function(t){e.before_show(t),Hue.info2_vars_to_false()},after_close:function(t){e.after_close(t),t.content.innerHTML="",t.titlebar.innerHTML="",Hue.info2_vars_to_false()}})),Hue.msg_image_picker=Msg.factory(Object.assign({},e,{id:"image_picker",after_show:function(t){e.after_show(t),Hue.image_picker_open=!0},after_close:function(t){e.after_close(t),$("#image_source_picker_input").val(""),$("#image_source_picker_input_comment").val(""),Hue.check_image_picker(),Hue.image_picker_open=!1}})),Hue.msg_tv_picker=Msg.factory(Object.assign({},e,{id:"tv_picker",after_show:function(t){e.after_show(t),Hue.tv_picker_open=!0},after_close:function(t){e.after_close(t),$("#tv_source_picker_input").val(""),$("#tv_source_picker_input_comment").val(""),Hue.tv_picker_open=!1}})),Hue.msg_radio_picker=Msg.factory(Object.assign({},e,{id:"radio_picker",after_show:function(t){e.after_show(t),Hue.radio_picker_open=!0},after_close:function(t){e.after_close(t),$("#radio_source_picker_input").val(""),$("#radio_source_picker_input_comment").val(""),Hue.radio_picker_open=!1}})),Hue.msg_media_menu=Msg.factory(Object.assign({},e,t,{id:"media_menu",window_width:"22em",after_show:function(t){e.after_show(t),Hue.media_menu_open=!0},after_close:function(t){e.after_close(t),Hue.media_menu_open=!1}})),Hue.msg_message=Msg.factory(Object.assign({},e,t,{id:"message",window_width:"26em",close_on_overlay_click:!1,after_show:function(t){e.after_show(t),Hue.writing_message=!0},after_close:function(t){e.after_close(t),$("#write_message_area").val(""),$("#write_message_feedback").text(""),$("#write_message_feedback").css("display","none"),Hue.writing_message=!1,Hue.clear_draw_message_state()}})),Hue.msg_input_history=Msg.factory(Object.assign({},e,t,{id:"input_history",window_width:"24em"})),Hue.msg_chat_search=Msg.factory(Object.assign({},e,t,{id:"chat_search",window_width:"30em",after_close:function(t){e.after_close(t),Hue.reset_chat_search_filter()}})),Hue.msg_highlights=Msg.factory(Object.assign({},e,t,{id:"highlights",window_width:"30em",after_close:function(t){e.after_close(t),Hue.reset_highlights_filter()}})),Hue.msg_image_history=Msg.factory(Object.assign({},e,t,{id:"image_history",window_width:"24em",after_close:function(t){e.after_close(t),Hue.reset_media_history_filter("image")}})),Hue.msg_tv_history=Msg.factory(Object.assign({},e,t,{id:"tv_history",window_width:"24em",after_close:function(t){e.after_close(t),Hue.reset_media_history_filter("tv")}})),Hue.msg_radio_history=Msg.factory(Object.assign({},e,t,{id:"radio_history",window_width:"24em",after_close:function(t){e.after_close(t),Hue.reset_media_history_filter("radio")}})),Hue.msg_locked=Msg.factory(Object.assign({},e,{id:"locked",closeable:!1,window_x:"none",show_effect:"none",close_effect:"none",enable_overlay:!0,window_class:"!no_effects"})),Hue.msg_global_settings=Msg.factory(Object.assign({},e,t,{id:"global_settings",after_close:function(t){e.after_close(t),Hue.close_togglers("global_settings")}})),Hue.msg_room_settings=Msg.factory(Object.assign({},e,t,{id:"room_settings",after_close:function(t){e.after_close(t),Hue.close_togglers("room_settings")}})),Hue.msg_draw_image=Msg.factory(Object.assign({},e,t,{id:"draw_image",close_on_overlay_click:!1,after_show:function(t){e.after_show(t),Hue.draw_image_open=!0},after_close:function(t){e.after_close(t),Hue.draw_image_open=!1}})),Hue.msg_credits=Msg.factory(Object.assign({},e,t,{id:"credits",after_close:function(t){e.after_close(t),Hue.credits_audio&&Hue.credits_audio.pause()}})),Hue.msg_admin_activity=Msg.factory(Object.assign({},e,t,{id:"admin_activity"})),Hue.msg_access_log=Msg.factory(Object.assign({},e,t,{id:"access_log"})),Hue.msg_expand_image=Msg.factory(Object.assign({},e,{id:"expand_image",preset:"window",overlay_class:"!overlay_same_color",after_close:function(t){e.after_close(t),Hue.clear_modal_image_info()}})),Hue.msg_image_upload_comment=Msg.factory(Object.assign({},e,t,{id:"image_upload_comment",after_show:function(t){e.after_show(t),Hue.image_upload_comment_open=!0},after_close:function(t){e.after_close(t),Hue.clear_modal_image_info(),$("#image_upload_comment_input").val(""),Hue.image_upload_comment_file=!1,Hue.image_upload_comment_type=!1,Hue.image_upload_comment_open=!1}})),Hue.msg_reply=Msg.factory(Object.assign({},e,t,{id:"reply",window_width:"26em",after_show:function(t){e.after_show(t),Hue.writing_reply=!0},after_close:function(t){e.after_close(t),Hue.clear_modal_image_info(),Hue.writing_reply=!1}})),Hue.msg_handle_url=Msg.factory(Object.assign({},e,t,{id:"handle_url",after_close:function(t){e.after_close(t)}})),Hue.msg_open_url=Msg.factory(Object.assign({},e,t,{id:"open_url",after_close:function(t){e.after_close(t),Hue.clear_modal_image_info()}})),Hue.msg_details=Msg.factory(Object.assign({},e,t,{id:"details",after_close:function(t){e.after_close(t),Hue.clear_modal_image_info()}})),Hue.msg_notifications=Msg.factory(Object.assign({},e,t,{id:"notifications",window_width:"26rem"})),Hue.msg_whispers=Msg.factory(Object.assign({},e,t,{id:"whispers",window_width:"26rem"})),Hue.msg_message_board=Msg.factory(Object.assign({},e,t,{id:"message_board",window_width:"28rem",after_close:function(t){e.after_close(t),Hue.writing_message_board_post=!1,$("#message_board_post_textarea").val("")}})),Hue.msg_notebook=Msg.factory(Object.assign({},e,t,{id:"notebook",window_width:"28rem",clear_editables:!1})),Hue.msg_room_menu.set(Hue.template_room_menu({permissions_containers:Hue.make_room_menu_permissions_container()})),Hue.msg_global_settings.set(Hue.template_global_settings({settings:Hue.template_settings({type:"global_settings",user_functions:Hue.make_settings_user_functions("global_settings")})})),Hue.msg_room_settings.set(Hue.template_room_settings({settings:Hue.template_settings({type:"room_settings",user_functions:Hue.make_settings_user_functions("room_settings")})})),Hue.msg_user_menu.set(Hue.template_user_menu()),Hue.msg_userlist.set(Hue.template_userlist()),Hue.msg_public_roomlist.set(Hue.template_roomlist({type:"public_roomlist"})),Hue.msg_visited_roomlist.set(Hue.template_roomlist({type:"visited_roomlist"})),Hue.msg_played.set(Hue.template_played()),Hue.msg_profile.set(Hue.template_profile({profile_image:Hue.config.profile_image_loading_url})),Hue.msg_image_picker.set(Hue.template_image_picker()),Hue.msg_tv_picker.set(Hue.template_tv_picker()),Hue.msg_radio_picker.set(Hue.template_radio_picker()),Hue.msg_media_menu.set(Hue.template_media_menu()),Hue.msg_message.set(Hue.template_message()),Hue.msg_highlights.set(Hue.template_highlights()),Hue.msg_image_history.set(Hue.template_image_history()),Hue.msg_tv_history.set(Hue.template_tv_history()),Hue.msg_radio_history.set(Hue.template_radio_history()),Hue.msg_input_history.set(Hue.template_input_history()),Hue.msg_chat_search.set(Hue.template_chat_search()),Hue.msg_modal_image.set(Hue.template_modal_image()),Hue.msg_modal_image_number.set(Hue.template_modal_image_number()),Hue.msg_lockscreen.set(Hue.template_lockscreen()),Hue.msg_locked.set(Hue.template_locked_menu()),Hue.msg_notifications.set(Hue.template_notifications()),Hue.msg_whispers.set(Hue.template_whispers()),Hue.msg_draw_image.set(Hue.template_draw_image()),Hue.msg_credits.set(Hue.template_credits({background_url:Hue.config.credits_background_url})),Hue.msg_admin_activity.set(Hue.template_admin_activity()),Hue.msg_access_log.set(Hue.template_access_log()),Hue.msg_expand_image.set(Hue.template_expand_image()),Hue.msg_image_upload_comment.set(Hue.template_image_upload_comment()),Hue.msg_reply.set(Hue.template_reply()),Hue.msg_handle_url.set(Hue.template_handle_url()),Hue.msg_open_url.set(Hue.template_open_url()),Hue.msg_details.set(Hue.template_details()),Hue.msg_message_board.set(Hue.template_message_board()),Hue.msg_notebook.set(Hue.template_notebook()),Hue.msg_info.create(),Hue.msg_info2.create(),Hue.msg_input_history.set_title("Input History"),Hue.msg_highlights.set_title("<span id='highlights_window_title' class='pointer'>Highlights</span>"),Hue.msg_chat_search.set_title("<span id='chat_search_window_title' class='pointer'>Chat Search</span>"),Hue.msg_image_history.set_title("<span id='image_history_window_title' class='pointer'>Image History</span>"),Hue.msg_tv_history.set_title("<span id='tv_history_window_title' class='pointer'>TV History</span>"),Hue.msg_radio_history.set_title("<span id='radio_history_window_title' class='pointer'>Radio History</span>"),Hue.msg_global_settings.set_title("<span id='global_settings_window_title' class='pointer'>Global Settings</span>"),Hue.msg_room_settings.set_title("<span id='room_settings_window_title' class='pointer'>Room Settings</span>"),Hue.msg_public_roomlist.set_title("<span id='public_rooms_window_title' class='pointer'>Public Rooms</span>"),Hue.msg_visited_roomlist.set_title("<span id='visited_rooms_window_title' class='pointer'>Visited Rooms</span>"),Hue.msg_played.set_title("Recently Played"),Hue.msg_room_menu.set_title("<span id='room_menu_window_title' class='pointer'>Room Menu</span>"),Hue.msg_user_menu.set_title("<span id='user_menu_window_title' class='pointer'>User Menu</span>"),Hue.msg_media_menu.set_title("Media Menu"),Hue.msg_draw_image.set_title("Draw an Image"),Hue.msg_credits.set_title(Hue.config.credits_title),Hue.msg_admin_activity.set_title("Admin Activity"),Hue.msg_access_log.set_title("Access Log"),Hue.msg_image_upload_comment.set_title("Add a Comment"),Hue.msg_reply.set_title("Write a Reply"),Hue.msg_details.set_title("User Details"),Hue.msg_notifications.set_title("Notifications"),Hue.msg_whispers.set_title("Whispers"),Hue.msg_handle_url.set_title("Drag n' Drop"),Hue.msg_message_board.set_title("Message Board"),Hue.msg_notebook.set_title("Notebook"),$("#global_settings_window_title").click(function(){Hue.toggle_settings_windows()}),$("#room_settings_window_title").click(function(){Hue.toggle_settings_windows()}),$("#public_rooms_window_title").click(function(){Hue.toggle_rooms_windows()}),$("#visited_rooms_window_title").click(function(){Hue.toggle_rooms_windows()}),$("#image_history_window_title").click(function(){Hue.toggle_media_history_windows()}),$("#tv_history_window_title").click(function(){Hue.toggle_media_history_windows()}),$("#radio_history_window_title").click(function(){Hue.toggle_media_history_windows()}),$("#room_menu_window_title").click(function(){Hue.toggle_menu_windows()}),$("#user_menu_window_title").click(function(){Hue.toggle_menu_windows()}),$("#chat_search_window_title").click(function(){Hue.toggle_search_windows()}),$("#highlights_window_title").click(function(){Hue.toggle_search_windows()})},Hue.info_vars_to_false=function(){},Hue.info2_vars_to_false=function(){Hue.create_room_open=!1,Hue.import_settings_open=!1,Hue.goto_room_open=!1,Hue.open_room_open=!1,Hue.background_image_input_open=!1,Hue.admin_list_open=!1,Hue.ban_list_open=!1,Hue.change_user_username_open=!1,Hue.change_user_password_open=!1,Hue.change_user_email_open=!1},Hue.after_modal_create=function(e){},Hue.after_modal_show=function(e){Hue.active_modal=e,Hue.modal_open=!0,Hue.blur_input(),Hue.focus_modal_filter(e)},Hue.focus_modal_filter=function(e){let t=$(`#Msg-content-${e.options.id}`).find(".filter_input, .filter_input_2").eq(0);t.length&&t.focus()},Hue.reset_modal_filter=function(e){let t=e.options.id,s=$(`#Msg-content-${t}`).find(".filter_input, .filter_input_2").eq(0);if("info"===t||"info2"===t||"manual"===s.data("mode"))return!1;s.length&&s.val()&&(s.val(""),Hue.do_modal_filter(t))},Hue.after_modal_set_or_show=function(e){setTimeout(function(){"global_settings"===e.options.id||"room_settings"===e.options.id?($(`#settings_window_${e.options.id} .settings_window_category_container_selected`).get(0).scrollTop=0,$(`#settings_window_left_content_${e.options.id}`).get(0).scrollTop=0):e.content_container.scrollTop=0},100)},Hue.after_modal_close=function(e){Hue.any_modal_open()||(Hue.active_modal=!1,Hue.modal_open=!1,Hue.focus_input()),Hue.reset_modal_filter(e)},Hue.get_modal_instances=function(){return Hue.msg_room_menu.higher_instances()},Hue.get_popup_instances=function(){return Hue.msg_room_menu.lower_instances()},Hue.get_all_msg_instances=function(){return Hue.msg_room_menu.instances()},Hue.any_msg_open=function(){return Hue.msg_room_menu.any_open()},Hue.any_modal_open=function(){return Hue.msg_room_menu.any_higher_open()},Hue.any_popup_open=function(){return Hue.msg_room_menu.any_lower_open()},Hue.close_all_msg=function(e=!1){e?Hue.msg_room_menu.close_all(e):Hue.msg_room_menu.close_all()},Hue.close_all_modals=function(e=!1){e?Hue.msg_room_menu.close_all_higher(e):Hue.msg_room_menu.close_all_higher()},Hue.close_all_popups=function(e=!1){e?Hue.msg_room_menu.close_all_lower(e):Hue.msg_room_menu.close_all_lower()},Hue.start_filters=function(){$("#chat_search_filter").on("input",function(){Hue.chat_search_timer()}),$("#highlights_filter").on("input",function(){Hue.highlights_filter_timer()}),$("#image_history_filter").on("input",function(){Hue.media_history_filter_timer("image")}),$("#tv_history_filter").on("input",function(){Hue.media_history_filter_timer("tv")}),$("#radio_history_filter").on("input",function(){Hue.media_history_filter_timer("radio")}),$("#global_settings_filter").on("input",function(){Hue.settings_filter_timer("global_settings")}),$("#room_settings_filter").on("input",function(){Hue.settings_filter_timer("room_settings")}),$("#input_history_filter").on("input",function(){Hue.input_history_filter_timer()})},Hue.do_modal_filter=function(e=!1){if(!e){if(!Hue.active_modal)return!1;e=Hue.active_modal.options.id}let t=$(`#Msg-content-${e}`),s=t.find(".filter_input, .filter_input_2").eq(0);if(!s.length)return!1;let o=s.val().trim();s.val(o);let i,_=Hue.utilz.clean_string2(o).toLowerCase(),n=t.find(".modal_item");if(t.data("filter_display")?i=t.data("filter_display"):(i=n.first().css("display"),t.data("filter_display",i)),_){let t=_.split(" ");n.each(function(){let e=$(this).text().toLowerCase();t.some(t=>e.includes(t))?$(this).css("display",i):$(this).css("display","none")}),Hue[`${e}_filtered`]=!0}else n.each(function(){$(this).css("display",i)}),Hue[`${e}_filtered`]=!1;Hue.scroll_modal_to_top(e),Hue[`after_${e}_filtered`]&&Hue[`after_${e}_filtered`]()},Hue.scroll_modal_to_top=function(e){$(`#Msg-content-container-${e}`).scrollTop(0)},Hue.scroll_modal_to_bottom=function(e){let t=$(`#Msg-content-container-${e}`)[0];t.scrollTop=t.scrollHeight},Hue.create_popup=function(e={}){e.id||(Hue.popup_id+=1,e.id=Hue.popup_id);let t=$("#footer").height(),s=t+20;e.position.includes("top")&&(s+=t);let o={preset:"popup",class:"popup",position:"top",show_effect_duration:[0,400],close_effect_duration:[400,0],clear_editables:!0,show_effect:"fade",close_effect:"fade",window_class:"!custom_popup",enable_titlebar:!0,center_titlebar:!0,titlebar_class:"!custom_titlebar !unselectable",window_inner_x_class:"!titlebar_inner_x",edge_padding_y:s};return e=Object.assign(o,e),Msg.factory(e)},Hue.set_toggler=function(e,t,s=!1){let o=$(t).next(`.${e}_toggle_container`);if("none"===o.css("display")){if(s&&"open"!==s)return!1;Hue.close_togglers(e),o.css("display","block"),$(t).html(`- ${$(t).html().trim().substring(2)}`),o.closest(".toggler_main_container")[0].scrollIntoView({block:"center"})}else{if(s&&"close"!==s)return!1;o.css("display","none"),$(t).html(`+ ${$(t).html().trim().substring(2)}`)}},Hue.setup_togglers=function(e){$(`.${e}_toggle`).each(function(){$(this).click(function(){Hue.set_toggler(e,this)})})},Hue.open_togglers=function(e){$(`.${e}_toggle`).each(function(){Hue.set_toggler(e,this,"open")})},Hue.close_togglers=function(e){$(`.${e}_toggle`).each(function(){Hue.set_toggler(e,this,"close")})},Hue.process_msg_close_button=function(e){let t=$(e).closest(".Msg-container");t.hasClass("Msg-container-modal")?Hue.close_all_modals():t.hasClass("Msg-container-popup")&&Hue.close_all_popups()},Hue.process_window_toggle=function(e){let t=Hue.msg_room_menu.highest_instance().options.id,s=e[t];if(!t||!s)return!1;Hue[`msg_${t}`].close(function(){s()})},Hue.toggle_search_windows=function(){let e={chat_search:function(){Hue.show_highlights()},highlights:function(){Hue.show_chat_search()}};Hue.process_window_toggle(e)},Hue.toggle_menu_windows=function(){let e={room_menu:function(){Hue.show_user_menu()},user_menu:function(){Hue.show_room_menu()}};Hue.process_window_toggle(e)},Hue.toggle_media_history_windows=function(){let e={image_history:function(){Hue.show_media_history("tv")},tv_history:function(){Hue.show_media_history("radio")},radio_history:function(){Hue.show_media_history("image")}};Hue.process_window_toggle(e)},Hue.toggle_rooms_windows=function(){let e={public_roomlist:function(){Hue.request_roomlist("","visited_roomlist")},visited_roomlist:function(){Hue.request_roomlist("","public_roomlist")}};Hue.process_window_toggle(e)},Hue.toggle_settings_windows=function(){let e={global_settings:function(){let e=Hue.get_selected_user_settings_category("global_settings");Hue.open_user_settings_category(e,"room_settings");let t=$("#global_settings_filter").val();t&&Hue.do_settings_filter("room_settings",t)},room_settings:function(){let e=Hue.get_selected_user_settings_category("room_settings");Hue.open_user_settings_category(e,"global_settings");let t=$("#room_settings_filter").val();t&&Hue.do_settings_filter("global_settings",t)}};Hue.process_window_toggle(e)},Hue.show_action_popup=function(e={}){let t=function(){};(e=Object.assign({id:!1,message:"",icon:"",title:"",on_click:!1,after_close:function(){},autoclose:!1,titlebar:!0},e)).on_click&&(t=function(t){t.close(),e.on_click()});let s="inner_right";e.titlebar||(s="none");let o={position:"bottomright",enable_titlebar:e.titlebar,window_x:s,content_class:"!action_popup",window_width:"auto",on_click:t,after_close:e.after_close,close_on_escape:!1,autoclose:e.autoclose,autoclose_delay:5e3};e.id&&(o.id=e.id);let i=Hue.create_popup(o),_="";e.on_click&&(_="pointer action");let n="";e.icon&&(n=`<i class='${e.icon} action_popup_icon'></i>`);let a=`<div class='action_popup_item unselectable ${_}'>${n}<div class='action_popup_message'>${Hue.utilz.make_html_safe(e.message)}</div></div>`;return e.title?i.show([e.title,a]):i.show(a),i};
