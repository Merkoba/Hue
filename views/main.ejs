<html>

	<head>

		<title><%= vars.default_title %></title> 
		<script src="/js/jquery.js"></script>
		<script src="/js/handlebars.js"></script>
		<script src="/js/colorlib.js?v=4"></script>
		<script src="/js/msg.min.js?v=5"></script>
		<script src="/js/storageui.min.js?v=2"></script>
		<script src="/js/dropzone.js"></script>
		<script src="/js/dateformat.js"></script>
		<script src="/js/perfect-scrollbar.min.js?v=3"></script>
		<script src="/js/nicescroll.min.js"></script>
		<script type="text/javascript" src="/js/contextmenu/jquery.contextMenu.min.js"></script>
		<script src="/js/contextmenu/jquery.ui.position.min.js"></script>
		<script src="/socket.io/socket.io.js"></script>

		<link rel="stylesheet" type="text/css" href="/css/perfect-scrollbar.css?v=3" />
		<link rel="stylesheet" href="/css/font-awesome/css/font-awesome.min.css">
		<link rel="stylesheet" type="text/css" href="/js/contextmenu/jquery.contextMenu.min.css"> 

		<script src="/js/base.js?ver=588"></script>
		<link rel="stylesheet" type="text/css" href="/css/style.css?ver=141" />

		<script src="https://www.youtube.com/iframe_api"></script>

		<script>
			$(function()
			{
				<% 
					for(var key in vars)
					{
						var v = vars[key]

						%><%-key%> = <%

						if(typeof v === "string")
						{
							%>`<%-v%>`; <% 
						}

						else
						{
							%><%-v%>; <%
						}
					}
				%>

				init()
			})
		</script>

	</head>

	<body>

		<div id="main_container">

			<div id='background_image'></div>

			<div id="main_flex">

				<div id='header' class='unselectable'>

					<div id='header_items'>

						<div id='header_items_inner'>

							<i id='main_menu' class='header_item icon fa fa-th-large' onclick='show_menu()'></i>
							<span class='hspacer1'></span>|<span class='hspacer1'></span>
							<span class='header_item' id='usercount' onclick='show_userlist()'></span>
							<span class='hspacer1'></span>|<span class='hspacer1'></span>
							<span class='header_item' id='toggle_radio' onclick='toggle_radio()'>
								<i class='icon fa fa-volume-up' id='playing_icon'></i>
								<span id='toggle_radio_text'>Start Radio</span>
							</span>
							<span id='volume_area'>
								<span class='hspacer1'></span>|<span class='hspacer1'></span>
								<span id='volume_controls'>
									<i id='header_icon_minus' class='header_item icon fa fa-minus' onclick='volume_decrease()'></i>
									<span onclick='volume_decrease()'>Volume:</span>
									<span class='header_item' id='volume' onclick='volume_increase()'>100%</span>
									<i id='header_icon_plus' class='header_item icon fa fa-plus' onclick='volume_increase()'></i>
								</span>
							</span>
							<span id="now_playing_area" onclick="show_played()">
								<span class='hspacer1'></span>|<span class='hspacer1'></span> 
								<span id='now_playing_controls'>
									<span class='header_item'>Now Playing:</span>
									<span class='header_item' id='now_playing'></span>
								</span>
							</span>

						</div>

					</div>

				</div>

				<div id="flex_columns">

					<div id='chat_main'>

						<div id='chat_area_parent'>
							<div id='chat_area'></div>
						</div>
						
						<div id='scroll_notice' onclick='goto_bottom(true)'>Go To Bottom</div>
					</div>

					<div id='media' class='unselectable' draggable='false'>
						<img id='media_image' draggable='false'>
					</div>

				</div>


				<div id='footer'>
					<div id='footer_items'>
						<span id='footer_nickname' onClick="show_user_info()"></span>
						<input id='input' type='text'>
					</div>
				</div>				

			</div>

			<img id='test_image'>

		</div>

		<script id='template_menu' type='text/x-handlebars-template'>
			<div id='menu' class='unselectable'>

				<div class='menu_item' onclick="request_roomlist()">Public Rooms</div>
				<div class='menu_item' onclick='show_create_room()'>Create Room</div>
				<div class='menu_item' onclick='show_settings()'>Settings</div>

				<div id='menu_smaller_container'>

					<div class='menu_item_smaller' onclick='copy_room_url()'>Copy Room URL</div>

					<div class='spacer2'></div>

					<div class='menu_item_smaller' onclick='chat_search()'>Search</div>

					&nbsp;|&nbsp;

					<div class='menu_item_smaller' onclick='show_history()'>History</div>

					<div class='spacer2'></div>

					<span class='menu_item_smaller' onclick='clear_chat();close_all_modals()'>Clear</span>

					&nbsp;|&nbsp;

					<span class='menu_item_smaller' onclick='show_status()'>Status</span>

					&nbsp;|&nbsp;

					<span class='menu_item_smaller' onclick='help()'>Help</span>

				</div>

				<div class='spacer3'></div>

			</div>
		</script>

		<script id='template_create_room' type='text/x-handlebars-template'>
			<div id='create_room'>

				<br>

				<div>All&nbsp;of&nbsp;these&nbsp;can&nbsp;be&nbsp;changed&nbsp;later</div>

				<div class='spacer1'></div>

				<input id='create_room_name' placeholder="Name" type="text">

				<div class='unselectable'>

					<div class='spacer1'></div>

					<div>Chat Permission</div>

					<div class='spacer2'></div>

					<select id='create_room_chat_permission'>
						<option value='1' selected>Anyone</option>
						<option value='2'>Voiced Users And Up</option>
						<option value='3'>Ops And Up</option>
					</select>

					<div class='spacer1'></div>

					<div>Upload Permission</div>

					<div class='spacer2'></div>					

					<select id='create_room_upload_permission'>
						<option value='1' selected>Anyone</option>
						<option value='2'>Voiced Users And Up</option>
						<option value='3'>Ops And Up</option>
					</select>

					<div class='spacer1'></div>

					<div>Radio Permission</div>

					<div class='spacer2'></div>					

					<select id='create_room_radio_permission'>
						<option value='1' selected>Anyone</option>
						<option value='2'>Voiced Users And Up</option>
						<option value='3'>Ops And Up</option>
					</select>

					<div class='spacer1'></div>

					<select id='create_room_public'>
						<option value='true' selected>Public</option>
						<option value='false'>Private</option>
					</select>					

					<div class='spacer3'></div>
					<div class='spacer2'></div>

					<div id='create_room_done' class='menu_item'>Create</div>

				</div>

			</div>
		</script>

		<script id='template_open_room' type='text/x-handlebars-template'>

				<div id="open_buttons" class='unselectable'>

					<div id='open_room_here' class='menu_item' onclick='goto_url("{{id}}");msg_info.close()'>Open&nbsp;Here</div>

					<div id='open_room_new_tab' class='menu_item' onclick='goto_url("{{id}}", "tab");msg_info.close()'>Open&nbsp;In&nbsp;New&nbsp;Tab</div>

				</div>

		</script>

		<script id='template_user_info' type='text/x-handlebars-template'>

				<input value={{nick}} id="user_info_nickname_input">
				<div class="spacer3"></div>
				<div id='user_info'>{{{info}}}</div>

		</script>

		<script id='template_status' type='text/x-handlebars-template'>
				<div>{{{info}}}</div>
		</script>

		<script id='template_settings' type='text/x-handlebars-template'>
			<div id='settings' class='unselectable'>

				<br>

				<div class="setting_title">Background Image</div>
				<input class="setting_checkbox" id="setting_background_image" type="checkbox">
				
				<div class='spacer1'></div>

				<div class="setting_title">Foreground Image</div>
				<input class="setting_checkbox" id="setting_foreground_image" type="checkbox">

				<div class='spacer1'></div>

				<div class="setting_title">Custom Scrollbars</div>
				<input class="setting_checkbox" id="setting_custom_scrollbars" type="checkbox">

				<div class='spacer1'></div>

				<div class="setting_title">Header Contrast</div>
				<input class="setting_checkbox" id="setting_header_contrast" type="checkbox">

				<div class='spacer1'></div>

				<div class="setting_title">Footer Contrast</div>
				<input class="setting_checkbox" id="setting_footer_contrast" type="checkbox">
				
				<div class='spacer1'></div>

				<div class="setting_title">Nickname On Footer</div>
				<input class="setting_checkbox" id="setting_nickname_on_footer" type="checkbox">

				<div class='spacer1'></div>

				<div class="setting_title">Modal Color</div>

				<select id='setting_modal_color'>
					<option value='white'>White</option>
					<option value='red'>Red</option>
					<option value='green'>Green</option>
					<option value='blue'>Blue</option>
					<option value='black'>Black</option>
				</select>

				<div class='spacer1'></div>

				<div class='menu_item' onclick='show_data()'>+ Storage Manager</div>

				<br>

			</div>
		</script>

		<script id='template_userlist' type='text/x-handlebars-template'>
			<input type="text" id="userlist_filter" class="filter_input" placeholder="Filter">
			<div class='spacer3'></div>
			<div id='userlist'></div>
		</script>		
		
		<script id='template_roomlist' type='text/x-handlebars-template'>
			<input type="text" id="roomlist_filter" class="filter_input" placeholder="Filter">
			<div class='spacer3'></div>			
			<div id='roomlist'></div>
		</script>		
		
		<script id='template_played' type='text/x-handlebars-template'>
			<input type="text" id="played_filter" class="filter_input" placeholder="Filter">
			<div class='spacer3'></div>
			<div id='played'></div>
		</script>

		<script id='template_help' type='text/x-handlebars-template'>

			<div class='info_title2'>Basic Features</div>
			<div class='info_item2'>Chat by typing anything.</div>
			<div class='info_item2'>All elements in the top and bottom bar are clickable.</div>
			<div class='info_item2'>Change the image on the right by pasting an image url.</div>
			<div class='info_item2'>Change it by clicking on the current image.</div>
			<div class='info_item2'>Change it by dropping an image file anywhere on the page.</div>
			<div class='info_item2'>/nick x: Used to change your nickname in the current room. There is also an editor that appears when you click the nickname in the bottom left.</div>
			<div class='info_item2'>/radio x: Changes the radio source. This can be an internet radio url, a file url, a youtube url or a search term to find a video on youtube. If x is \'default\' it changes to the default radio.</div>
			<div class='info_item2'>/me x: Makes a message in third person.</div>
			<div class='info_item2'>/help: Shows this message.</div>
			<div class='info_item2'>/help2: Shows additional features.</div>
			<div class='info_item2'>/help3: Shows administration features.</div>
			<div class='info_item2'>Note: Chat, upload, and radio features have permission settings per room. So you might not be able to do certain actions depending on what settings the ops/admins have set. Click your nickname in the footer to check your permissions.</div>
			<div class='spacer1'></div>
			<span class='help_link' onclick='help2()'>Additional Features</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class='help_link' onclick='help3()'>Administration Features</span>

		</script>

		<script id='template_help2' type='text/x-handlebars-template'>

			<div class='info_title2'>Additional Features</div>
			<div class='info_item2'>Escape clears the input or closes popups.</div>
			<div class='info_item2'>Shift + Escape or /clear clears all messages from the chat.</div>
			<div class='info_item2'>Shift + Tab cycles between room status and user info windows.</div>
			<div class='info_item2'>Up and Down Arrows cycle through the input history.</div>
			<div class='info_item2'>Shift + Up Arrow and Shift + Down Arrow or Page Up and Page down make the chat scroll.</div>
			<div class='info_item2'>Enter without text in the input scrolls to the bottom of the chat.</div>
			<div class='info_item2'>Clicking on a nickname sends it to the input.</div>
			<div class='info_item2'>Tab completes nicknames and commands.</div>
			<div class='info_item2'>Shift + Enter toggles the radio.</div>
			<div class='info_item2'>/nickedit: Puts the nickname in the input, ready to be edited.</div>	
			<div class='info_item2'>/defnick x: Changes your default nickname for rooms you visit for the first time.</div>
			<div class='info_item2'>/reserve: Reserves current nickname to be recoverable later. If called again it changes the key with a new one.</div>
			<div class='info_item2'>/unreserve: Makes a nickname available again.</div>
			<div class='info_item2'>/recover x: Recovers reserved nickname in case someone else in the room is using it.</div>			
			<div class='info_item2'>/status: Shows the room status window.</div>			
			<div class='info_item2'>/userinfo: Shows the user info window.</div>
			<div class='info_item2'>/priv: Shows information regarding privileges and permissions.</div>
			<div class='info_item2'>/users: Shows the user list. Accepts a filter as an argument.</div>
			<div class='info_item2'>/rooms: Shows the room list. Accepts a filter as an argument.</div>
			<div class='info_item2'>/played: Shows the list of songs played. Accepts a filter as an argument.</div>
			<div class='info_item2'>/search: Opens the search window. Accepts a query as an argument.</div>
			<div class='info_item2'>/history: Shows the input history. Accepts a filter as an argument.</div>
			<div class='info_item2'>/create x: Quickly create a room with name x.</div>
			<div class='info_item2'>/startradio: Starts the radio.</div>
			<div class='info_item2'>/stopradio: Stops the radio.</div>
			<div class='info_item2'>/volume x: Changes the volume of the radio.</div>
			<div class='info_item2'>Note: Dates shown when hovering some items show the time when the item was placed on the screen, except when a nickname is displayed beside it meaning it's that date an action was performed.</div>
			<div class='info_item2'>Note: In the Open Here or Open In New Tab picker, 'here' can be triggered with Shift + Enter, 'new tab' with Enter.</div>
			<div class='spacer1'></div>
			<span class='help_link' onclick='help()'>Basic Features</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class='help_link' onclick='help3()'>Administration Features</span>			
		</script>

		<script id='template_help3' type='text/x-handlebars-template'>

			<div class='info_title2'>Administration Features</div>
			<div class='info_item2'>/topic x: Changes the topic of the room.</div>
			<div class='info_item2'>/topicadd x: Adds a section at the end of the topic.</div>
			<div class='info_item2'>/topictrim x: Removes a section from the end of the topic, where the optional x is the number of trims you want to do.</div>
			<div class='info_item2'>/topicaddstart x: Adds a section at the start of the topic.</div>
			<div class='info_item2'>/topictrimstart x: Removes a section from the start of the topic, where the optional x is the number of trims you want to do.</div>
			<div class='info_item2'>/topicedit: Puts the topic in the input, ready to be edited.</div>
			<div class='info_item2'>/uploadpermission 1: Anyone can upload images.</div>
			<div class='info_item2'>/uploadpermission 2: Only voiced users and up can upload images.</div>
			<div class='info_item2'>/uploadpermission 3: Only ops and up can upload images.</div>
			<div class='info_item2'>/chatpermission 1: Anyone can chat.</div>
			<div class='info_item2'>/chatpermission 2: Only voiced users and up can chat.</div>
			<div class='info_item2'>/chatpermission 3: Only ops and up can chat.</div>
			<div class='info_item2'>/radiopermission 1: Anyone can change the radio.</div>
			<div class='info_item2'>/radiopermission 2: Only voiced users and up can change the radio.</div>
			<div class='info_item2'>/radiopermission 3: Only ops and up can change the radio.</div>
			<div class='info_item2'>/voice x: Gives voice to a user.</div>
			<div class='info_item2'>/op x: Gives op to a user. Ops can do anything an admin can do except more high level commands.</div>
			<div class='info_item2'>/admin x: Gives admin to a user. This gives a user the same rights as the original admin.</div>
			<div class='info_item2'>/strip x: Removes all privileges from a user.</div>
			<div class='info_item2'>/removevoices: Removes all privileges from voiced users.</div>
			<div class='info_item2'>/removeops: Removes all privileges from op\'d users.</div>
			<div class='info_item2'>/removeboth: Removes all privileges from voiced and op\'d users.</div>
			<div class='info_item2'>/private: Room doesn\'t appear in the public room list.</div>
			<div class='info_item2'>/public: Room appears in the public room list.</div>
			<div class='info_item2'>/roomname x: Chages the name of the room.</div>
			<div class='info_item2'>/roomnameedit x: Puts the room name in the input, ready to be edited.</div>
			<div class='info_item2'>/kick x: Kicks a user out of the room.</div>
			<div class='info_item2'>/ban x: Bans a user from the room.</div>
			<div class='info_item2'>/unbanlast: Unbans the latest banned user.</div>
			<div class='info_item2'>/unbanall: Removes all bans.</div>
			<div class='info_item2'>/bannedcount: Displays the number of banned users in the room.</div>
			<div class='info_item2'>/claim: Requests administration of the room. If it hasn\'t been claimed, user gets the ownership.</div>
			<div class='info_item2'>/reclaim: Reclaims the room if you\'re already an admin. Removes all given privileges to other users.</div>
			<div class='info_item2'>/unclaim: Removes all ownership on the room and resets it to a default state.</div>
			<div class='info_item2'>Note: Nicknames and main menu have a context (right click) menu with some operations if you are an op or admin.</div>
			<div class='info_item2'>Note: Check /help for information about how users interact in the room through chat, image uploads, or radio.</div>
			<div class='info_item2'>Note: Currently automatic fetching of song metadata from internet radios are only supported for icecast2 servers. The metadada url is gathered automatically. To work, the server needs to allow cross-domain requests and be https enabled if this system is being served through https.</div>
			<div class='spacer1'></div>
			<span class='help_link' onclick='help()'>Basic Features</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class='help_link' onclick='help2()'>Additional Features</span>		
		</script>		

		<audio id='audio' autoplay></audio>

		<audio id='pup' src='/audio/pup.ogg'></audio>

		<div id='youtube_player'></div>

	</body>

</html>